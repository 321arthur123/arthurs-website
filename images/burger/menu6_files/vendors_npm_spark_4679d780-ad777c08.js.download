(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[14],{"+N83":function(t,e,n){var o,r,i,a=e,s=n("oAGj"),l=n("c9Jm"),u=n("yGNn"),c=n("jo4Y"),h=n("lmwz");a.DeleteImagesTest=(o=function(){this.actionSequence_Delete=[],this.page_=null,this.backgroundImages_=[],l.ActionTestBase.call(this)},s.defineClass({name:"DeleteImagesTest",ctor:o,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return h.ImageFacade.getBackgroundImagesFromPage(n.firstPage).length>0},populateActionSequence:function(t,e,n){var o=this,r=s.clone(t);return this.backgroundImages_=s.clone(h.ImageFacade.getBackgroundImagesFromPage(n.firstPage)),this.backgroundImages_.length>0&&(r=r.concat([function(){return new c.DeleteAction(s.clone(o.backgroundImages_))}])),u.CorePromise.resolve(s.clone(r))},setUpActionSequence:function(t,e,n){this.page_=n.firstPage},validateAfterActionSequence:function(t,e){var n=s.clone(h.ImageFacade.getBackgroundImagesFromPage(this.page_));XCTAssertEqual(n.length,0)},validateAfterUndo:function(t,e){var n=s.clone(h.ImageFacade.getBackgroundImagesFromPage(this.page_));XCTAssertEqual(n.length,this.backgroundImages_.length)},validateAfterRedo:function(t,e){var n=s.clone(h.ImageFacade.getBackgroundImagesFromPage(this.page_));XCTAssertEqual(n.length,0)}}}),o),a.DeleteCellsTest=(r=function(){this.actionSequence_Delete=[],this.doc_=null,this.frameCells_=[],this.deleteableCells_=[],this.expectedRemainingCells_=0,l.ActionTestBase.call(this)},s.defineClass({name:"DeleteCellsTest",ctor:r,superName:"ActionTestBase",props:{getFrameCells:function(t){return this.allSelectableFormae(t,(function(t){return t.isGridCell()}))},deleteableFrameCells:function(t){var e;return this.getFrameCells(t).filter((function(t){return!(!(e=s.opt(t.controller,(function(t){return t.deleteable})))&&null==e)&&e}),this)},canRunActionSequence:function(t,e,n){var o=this.getFrameCells(n).length,r=this.deleteableFrameCells(n).length;return o>r&&r>0||r>1},populateActionSequence:function(t,e,n){var o=this,r=s.clone(t);this.frameCells_=s.clone(this.getFrameCells(n)),this.deleteableCells_=s.clone(this.deleteableFrameCells(n)),this.deleteableCells_.length==this.frameCells_.length&&this.deleteableCells_.splice(0,1),this.expectedRemainingCells_=this.frameCells_.length-this.deleteableCells_.length;for(var i=s.iter(s.range(1,this.deleteableCells_.length,!0));!i.done;i.next())r=r.concat([function(){var t=s.clone(o.deleteableFrameCells(o.doc_));return new c.DeleteAction([s.first(t)])}]);return u.CorePromise.resolve(s.clone(r))},setUpActionSequence:function(t,e,n){this.doc_=n},validateAfterActionSequence:function(t,e){var n=s.clone(this.getFrameCells(this.doc_));XCTAssertEqual(n.length,this.expectedRemainingCells_)},validateAfterUndo:function(t,e){var n=s.clone(this.getFrameCells(this.doc_));XCTAssertEqual(n.length,this.frameCells_.length)},validateAfterRedo:function(t,e){var n=s.clone(this.getFrameCells(this.doc_));XCTAssertEqual(n.length,this.expectedRemainingCells_)}}}),r),a.DeleteItemsTest=(i=function(){this.actionSequence_Delete=[],this.doc_=null,this.floatingItems_=[],l.ActionTestBase.call(this)},s.defineClass({name:"DeleteItemsTest",ctor:i,superName:"ActionTestBase",props:{getDeletableForma:function(t){return s.clone(this.allSelectableFormae(t,(function(t){return t.controller.canMultiSelect})))},populateActionSequence:function(t,e,n){var o=this,r=s.clone(t);return this.floatingItems_=s.clone(this.getDeletableForma(n)),this.floatingItems_.length>0&&(r=r.concat([function(){return new c.DeleteAction(s.clone(o.floatingItems_))}])),u.CorePromise.resolve(s.clone(r))},setUpActionSequence:function(t,e,n){this.doc_=n},validateAfterActionSequence:function(t,e){var n=s.clone(this.getDeletableForma(this.doc_));XCTAssertEqual(n.length,0)},validateAfterUndo:function(t,e){var n=s.clone(this.getDeletableForma(this.doc_));XCTAssertEqual(n.length,this.floatingItems_.length)},validateAfterRedo:function(t,e){var n=s.clone(this.getDeletableForma(this.doc_));XCTAssertEqual(n.length,0)}}}),i)},"1vuF":function(t,e,n){var o,r=e,i=n("oAGj"),a=n("c9Jm"),s=n("yGNn"),l=n("sTUO"),u=n("MYNe");r.LayerTest=(o=function(){this.actionSequence_LayerTest=[],this.testDoc_=null,this.initialFormaIndex_=0,this.finalFormaIndex_=0,a.ActionTestBase.call(this)},i.defineClass({name:"LayerTest",ctor:o,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){this.testDoc_=n;var o=this.getLayerItem();return null!=o&&(this.initialLayerItem_=o,u.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)>1)},populateActionSequence:function(t,e,n){var o=this;this.initialFormaIndex_=u.LayerFacade.getZOrder(this.initialLayerItem_);var r=u.LayerFacade.getMinLayerIndex(this.initialLayerItem_),i=u.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)+r-1;return this.initialFormaIndex_<i?this.finalFormaIndex_=this.initialFormaIndex_+1:this.initialFormaIndex_<r?this.finalFormaIndex_=this.initialFormaIndex_-1:XCTFail("Not enough items to change zorder"),s.CorePromise.resolve([function(){return new l.ChangeZOrderAction(o.finalFormaIndex_)}])},setUpActionSequence:function(t,e,n){n.controller.selection.replaceSelection(this.initialLayerItem_)},validateAfterActionSequence:function(t,e){var n=u.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.finalFormaIndex_)},validateAfterUndo:function(t,e){var n=u.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.initialFormaIndex_)},validateAfterRedo:function(t,e){var n=u.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.finalFormaIndex_)},getLayerItem:function(){var t=null,e=i.clone(this.allSelectableFormae(this.testDoc_,(function(t){return 1==t.controller.floating})));return e.length>0&&(t=i.first(e)),t}}}),o)},"4zuo":function(t,e,n){var o,r=e,i=n("oAGj"),a=n("c9Jm"),s=n("pnSN"),l=n("434x"),u=n("8t9B"),c=n("oKlP"),h=n("sIWg");r.NudgeTest=(o=function(){this.actionSequence_NudgeUpRight=[function(){return new l.NudgeAction(new c.TheoPoint(10,0),null)},function(){return new l.NudgeAction(new c.TheoPoint(0,-10),null)}],this.formaToNudge_=null,this.initialBounds_=h.TheoRect.Zero,this.postNudgeBounds_=h.TheoRect.Zero,a.ActionTestBase.call(this)},i.defineClass({name:"NudgeTest",ctor:o,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){this.formaToNudge_=i.last(this.allSelectableFormae(n,(function(t){return t instanceof s.GroupForma&&t.controller.kind==u.TypeLockupController.KIND}))),XCTAssertNotNil(this.formaToNudge_),null!=this.formaToNudge_&&(n.controller.selection.replaceSelection(this.formaToNudge_),this.initialBounds_=this.formaToNudge_.finalFrame)},validateAfterActionSequence:function(t,e){this.postNudgeBounds_=this.formaToNudge_.finalFrame,XCTAssertFalse(this.postNudgeBounds_.equal(this.initialBounds_))},validateAfterUndo:function(t,e){var n=this.formaToNudge_.finalFrame;XCTAssertTrue(this.initialBounds_.equal(n))},validateAfterRedo:function(t,e){var n=this.formaToNudge_.finalFrame;XCTAssertTrue(n.equal(this.postNudgeBounds_))}}}),o)},ALtN:function(t,e,n){var o,r=e,i=n("oAGj"),a=n("cZuM"),s=n("lbYW"),l=n("c9Jm"),u=n("6Rk9"),c=n("sIWg");r.AlignTest=(o=function(){this.actionSequence_AlignRightAndBottom=[function(){return new s.AlignFormaeAction(a.AlignmentType.Right)},function(){return new s.AlignFormaeAction(a.AlignmentType.Bottom)}],this.formaeToAlign_=[],this.initialBounds_=c.TheoRect.Zero,this.postAlignBounds_=c.TheoRect.Zero,this.epsilon=1e-8,l.ActionTestBase.call(this)},i.defineClass({name:"AlignTest",ctor:o,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o=u.GeometryFacade.getFormaeBounds([n.firstPage.root],!0);this.formaeToAlign_=i.clone(this.allSelectableFormae(n,(function(t){return 1==t.controller.floating&&o.contains(u.GeometryFacade.getFormaeBounds([t],!0))}))),XCTAssertNotNil(i.clone(this.formaeToAlign_)),this.formaeToAlign_.length>0&&(n.controller.selection.replaceSelectionWithFormae(i.clone(this.formaeToAlign_)),this.initialBounds_=u.GeometryFacade.getFormaeBounds(i.clone(this.formaeToAlign_),!0))},validateAfterActionSequence:function(t,e){this.postAlignBounds_=u.GeometryFacade.getFormaeBounds(i.clone(this.formaeToAlign_),!0),this.validatePostAlignmentRightAndBottom()},validateAfterUndo:function(t,e){var n=u.GeometryFacade.getFormaeBounds(i.clone(this.formaeToAlign_),!0);XCTAssertTrue(this.initialBounds_.equal(n))},validateAfterRedo:function(t,e){this.postAlignBounds_=u.GeometryFacade.getFormaeBounds(i.clone(this.formaeToAlign_),!0),this.validatePostAlignmentRightAndBottom()},validatePostAlignmentRightAndBottom:function(){for(var t=i.iter(this.formaeToAlign_);!t.done;t.next()){var e=t.value,n=this.postAlignBounds_.evalXY(1,1),o=u.GeometryFacade.getFormaeBounds([e],!0).evalXY(1,1);XCTAssertTrue(n.equalWithAccuracy(o,this.epsilon))}},tearDown:function(){this.formaeToAlign_=[],l.ActionTestBase.prototype.tearDown.call(this)}}}),o)},CSb8:function(t,e,n){var o,r=e,i=n("oAGj"),a=n("c9Jm"),s=n("yGNn"),l=n("pjjd"),u=n("FNB+"),c=n("pnSN"),h=n("8t9B");r.DuplicateTest=(o=function(){this.actionSequence_DuplicateAllText=[],this.doc_=null,this.initialCounts_={},a.ActionTestBase.call(this)},i.defineClass({name:"DuplicateTest",ctor:o,superName:"ActionTestBase",props:{countDuplicates:function(t){var e,n=0;return(e=i.as(t.controller,h.TypeLockupController))&&i.opt(this.doc_,(function(t){return t.firstPage.root.visit(u.FormaTraversal.PreOrder,(function(t,o,r){var a,s;return(a=i.as(t,c.GroupForma))&&(s=i.as(a.controller,h.TypeLockupController))&&s.text==e.text&&(n+=1),!1}))})),n},populateActionSequence:function(t,e,n){for(var o=i.clone(this.allSelectableFormae(n,(function(t){return t instanceof c.GroupForma&&t.controller.kind==h.TypeLockupController.KIND}))),r=i.iter(o);!r.done;r.next()){var a=r.value;this.initialCounts_[a]=1}return s.CorePromise.resolve([function(){return new l.DuplicateAction(i.clone(o),!0,!1)}])},setUpActionSequence:function(t,e,n){for(var o=i.iter(i.keys(this.initialCounts_));!o.done;o.next()){var r=o.value;this.initialCounts_[r]=this.countDuplicates(r)}},validateAfterActionSequence:function(t,e){for(var n=i.iter(i.keys(this.initialCounts_));!n.done;n.next()){var o=n.value;XCTAssertTrue(this.countDuplicates(o)==2*this.initialCounts_[o])}},validateAfterUndo:function(t,e){for(var n=i.iter(i.keys(this.initialCounts_));!n.done;n.next()){var o=n.value;XCTAssertTrue(this.countDuplicates(o)==this.initialCounts_[o])}},validateAfterRedo:function(t,e){for(var n=i.iter(i.keys(this.initialCounts_));!n.done;n.next()){var o=n.value;XCTAssertTrue(this.countDuplicates(o)==2*this.initialCounts_[o])}}}}),o)},Jgdj:function(t,e,n){var o,r,i,a,s=e,l=n("oAGj"),u=n("c9Jm"),c=n("yGNn"),h=n("lqhW"),f=n("ylxa"),m=n("cEBg"),d=n("1NAc");s.PageSizeLetterTest=(o=function(){this.actionSequence_PageSizeLetter=[],this.testDoc_=null,this.testPage_=null,this.initialPageSizeID_="",this.initialPageSizePPI_=f.FormaPageExportData.DEFAULT_PPI,this.initialPageSizeFormat_=f.PageExportFormat.PIXELS,u.ActionTestBase.call(this)},l.defineClass({name:"PageSizeLetterTest",ctor:o,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o,r,i;this.testDoc_=n,this.testPage_=n.firstPage,this.initialPageSizeID_=(o=l.opt(this.testPage_,(function(t){return t.sizeID})))||null!=o?o:"",this.initialPageSizePPI_=(r=l.opt(this.testPage_,(function(t){return t.customSizePPI})))||null!=r?r:300,this.initialPageSizeFormat_=(i=l.opt(this.testPage_,(function(t){return t.customSizeFormat})))||null!=i?i:f.PageExportFormat.PIXELS},populateActionSequence:function(t,e,n){var o=this,r=h.DesignSizeLibrary.getById("Letter");return c.CorePromise.resolve([function(){return new m.ChangePageSizeAction(o.testPage_,r)}])},validateAfterActionSequence:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue("Letter"==n),XCTAssertTrue(300==o),XCTAssertTrue(r==f.PageExportFormat.INCHES),XCTAssertTrue(this.testPage_.getPageExportData().pointDimensions.equal(new d.TheoSize(8.5,11).multiply(f.FormaPageExportData.POINTS_PER_INCH)))},validateAfterUndo:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue(n==this.initialPageSizeID_),XCTAssertTrue(o==this.initialPageSizePPI_),XCTAssertTrue(r==this.initialPageSizeFormat_)},validateAfterRedo:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue("Letter"==n),XCTAssertTrue(300==o),XCTAssertTrue(r==f.PageExportFormat.INCHES),XCTAssertTrue(this.testPage_.getPageExportData().pointDimensions.equal(new d.TheoSize(8.5,11).multiply(f.FormaPageExportData.POINTS_PER_INCH)))}}}),o),s.PageSizeCustomTest=(r=function(){this.actionSequence_PageSizeCustom=[],this.testDoc_=null,this.testPage_=null,this.initialPageSizeID_="",this.initialPageSizePPI_=f.FormaPageExportData.DEFAULT_PPI,this.initialPageSizeFormat_=f.PageExportFormat.PIXELS,u.ActionTestBase.call(this)},l.defineClass({name:"PageSizeCustomTest",ctor:r,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o,r,i;this.testDoc_=n,this.testPage_=n.firstPage,this.initialPageSizeID_=(o=l.opt(this.testPage_,(function(t){return t.sizeID})))||null!=o?o:"",this.initialPageSizePPI_=(r=l.opt(this.testPage_,(function(t){return t.customSizePPI})))||null!=r?r:300,this.initialPageSizeFormat_=(i=l.opt(this.testPage_,(function(t){return t.customSizeFormat})))||null!=i?i:f.PageExportFormat.PIXELS},populateActionSequence:function(t,e,n){var o=this,r=h.DesignSizeLibrary.getCustomSize(1011,990,f.PageExportFormat.PIXELS,f.FormaPageExportData.DEFAULT_PPI);return c.CorePromise.resolve([function(){return new m.ChangePageSizeAction(o.testPage_,r)}])},validateAfterActionSequence:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue("Custom"==n),XCTAssertTrue(300==o),XCTAssertTrue(r==f.PageExportFormat.PIXELS),XCTAssertTrue(this.testPage_.getPageExportData().pixelDimensions.equal(new d.TheoSize(1011,990)))},validateAfterUndo:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue(n==this.initialPageSizeID_),XCTAssertTrue(o==this.initialPageSizePPI_),XCTAssertTrue(r==this.initialPageSizeFormat_)},validateAfterRedo:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue("Custom"==n),XCTAssertTrue(300==o),XCTAssertTrue(r==f.PageExportFormat.PIXELS),XCTAssertTrue(this.testPage_.getPageExportData().pixelDimensions.equal(new d.TheoSize(1011,990)))}}}),r),s.PageSizeA4Test=(i=function(){this.actionSequence_PageSizeA4=[],this.testDoc_=null,this.testPage_=null,this.initialPageSizeID_="",this.initialPageSizePPI_=f.FormaPageExportData.DEFAULT_PPI,this.initialPageSizeFormat_=f.PageExportFormat.PIXELS,u.ActionTestBase.call(this)},l.defineClass({name:"PageSizeA4Test",ctor:i,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o,r,i;this.testDoc_=n,this.testPage_=n.firstPage,this.initialPageSizeID_=(o=l.opt(this.testPage_,(function(t){return t.sizeID})))||null!=o?o:"",this.initialPageSizePPI_=(r=l.opt(this.testPage_,(function(t){return t.customSizePPI})))||null!=r?r:300,this.initialPageSizeFormat_=(i=l.opt(this.testPage_,(function(t){return t.customSizeFormat})))||null!=i?i:f.PageExportFormat.PIXELS},populateActionSequence:function(t,e,n){var o=this,r=h.DesignSizeLibrary.getById("A4");return c.CorePromise.resolve([function(){return new m.ChangePageSizeAction(o.testPage_,r)}])},validateAfterActionSequence:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue("A4"==n),XCTAssertTrue(300==o),XCTAssertTrue(r==f.PageExportFormat.MILLIMETERS),XCTAssertTrue(this.testPage_.getPageExportData().pointDimensions.equal(new d.TheoSize(210,297).multiply(f.FormaPageExportData.POINTS_PER_INCH*f.FormaPageExportData.MM_TO_INCHES)))},validateAfterUndo:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue(n==this.initialPageSizeID_),XCTAssertTrue(o==this.initialPageSizePPI_),XCTAssertTrue(r==this.initialPageSizeFormat_)},validateAfterRedo:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue("A4"==n),XCTAssertTrue(300==o),XCTAssertTrue(r==f.PageExportFormat.MILLIMETERS),XCTAssertTrue(this.testPage_.getPageExportData().pointDimensions.equal(new d.TheoSize(210,297).multiply(f.FormaPageExportData.POINTS_PER_INCH*f.FormaPageExportData.MM_TO_INCHES)))}}}),i),s.PageSizePhoneTest=(a=function(){this.actionSequence_PageSizePhone=[],this.testDoc_=null,this.testPage_=null,this.initialPageSizeID_="",this.initialPageSizePPI_=f.FormaPageExportData.DEFAULT_PPI,this.initialPageSizeFormat_=f.PageExportFormat.PIXELS,u.ActionTestBase.call(this)},l.defineClass({name:"PageSizePhoneTest",ctor:a,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o,r,i;this.testDoc_=n,this.testPage_=n.firstPage,this.initialPageSizeID_=(o=l.opt(this.testPage_,(function(t){return t.sizeID})))||null!=o?o:"",this.initialPageSizePPI_=(r=l.opt(this.testPage_,(function(t){return t.customSizePPI})))||null!=r?r:300,this.initialPageSizeFormat_=(i=l.opt(this.testPage_,(function(t){return t.customSizeFormat})))||null!=i?i:f.PageExportFormat.PIXELS},populateActionSequence:function(t,e,n){var o=this,r=h.DesignSizeLibrary.getById("iPhone");return c.CorePromise.resolve([function(){return new m.ChangePageSizeAction(o.testPage_,r)}])},validateAfterActionSequence:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue("iPhone"==n),XCTAssertTrue(300==o),XCTAssertTrue(r==f.PageExportFormat.PIXELS),XCTAssertTrue(this.testPage_.getPageExportData().pixelDimensions.equal(new d.TheoSize(1080,1920)))},validateAfterUndo:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue(n==this.initialPageSizeID_),XCTAssertTrue(o==this.initialPageSizePPI_),XCTAssertTrue(r==this.initialPageSizeFormat_)},validateAfterRedo:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue("iPhone"==n),XCTAssertTrue(300==o),XCTAssertTrue(r==f.PageExportFormat.PIXELS),XCTAssertTrue(this.testPage_.getPageExportData().pixelDimensions.equal(new d.TheoSize(1080,1920)))}}}),a)},QO3H:function(t,e,n){var o,r=e,i=n("oAGj"),a=n("Tq01"),s=n("KgU+"),l=n("KSe6"),u=n("c9Jm"),c=n("yGNn");r.AnimationTest=(o=function(){this.actionSequence_Animation=[],this.testDoc_=null,this.testPage_=null,this.initialAnimationStyle_=null,this.initialAnimationVariant_=null,this.appliedAnimationStyle_=null,u.ActionTestBase.call(this)},i.defineClass({name:"AnimationTest",ctor:o,superName:"ActionTestBase",props:{shuffledAnimationStyle_:{get:function(){return i.opt(i.as(this.getActionResult(0),a.AnimationStyleActionResult),(function(t){return t.style}))}},populateActionSequence:function(t,e,n){var o=this;if(this.testDoc_=n,this.testPage_=n.firstPage,this.initialAnimationStyle_=n.firstPage.animationController.animationStyle,this.initialAnimationVariant_=i.opt(this.initialAnimationStyle_,(function(t){return t.variant})),null!=this.initialAnimationStyle_)return c.CorePromise.resolve(t.concat([function(){return new s.ShuffleAnimationStyleAction(o.initialAnimationStyle_,o.testPage_)},function(){return new s.ApplyAnimationStyleAction(o.shuffledAnimationStyle_,o.testPage_)}]));var r=i.clone(l.AnimationLibrary.getDisplayableAnimationStyles(this.testPage_.root));return r.length>1?(this.appliedAnimationStyle_=i.last(r),null==this.appliedAnimationStyle_&&XCTAssertNotEqual(this.appliedAnimationStyle_,null),c.CorePromise.resolve(t.concat([function(){return new s.ApplyAnimationStyleAction(o.appliedAnimationStyle_,o.testPage_)}]))):(XCTFail("Could not get style for AnimationTest"),c.CorePromise.resolve([]))},validateAfterActionSequence:function(t,e){if(null!=this.initialAnimationStyle_){var n=(a=i.opt(this.testPage_,(function(t){return t.animationController.animationStyle}))).variant,o=a.variantCount,r=this.testPage_.animationLibrary.getNextAnimationStyleOfSameType(this.initialAnimationStyle_);XCTAssertEqual(r.name,this.initialAnimationStyle_.name),XCTAssertEqual(a.name,this.initialAnimationStyle_.name),XCTAssertEqual(n,this.initialAnimationVariant_+1%o)}else if(null!=this.appliedAnimationStyle_){var a;n=(a=i.opt(this.testPage_,(function(t){return t.animationController.animationStyle}))).variant,XCTAssertEqual(a.name,this.appliedAnimationStyle_.name),XCTAssertEqual(n,0)}},validateAfterUndo:function(t,e){if(null!=this.initialAnimationStyle_){var n=(o=i.opt(this.testPage_,(function(t){return t.animationController.animationStyle}))).variant;XCTAssertEqual(o.name,this.initialAnimationStyle_.name),XCTAssertEqual(n,this.initialAnimationVariant_)}else if(null!=this.appliedAnimationStyle_){var o=i.opt(this.testPage_,(function(t){return t.animationController.animationStyle}));XCTAssertEqual(o,null)}},validateAfterRedo:function(t,e){if(null!=this.initialAnimationStyle_){var n=(a=i.opt(this.testPage_,(function(t){return t.animationController.animationStyle}))).variant,o=a.variantCount,r=this.testPage_.animationLibrary.getNextAnimationStyleOfSameType(this.initialAnimationStyle_);XCTAssertEqual(r.name,this.initialAnimationStyle_.name),XCTAssertEqual(a.name,this.initialAnimationStyle_.name),XCTAssertEqual(n,this.initialAnimationVariant_+1%o)}else if(null!=this.appliedAnimationStyle_){var a;n=(a=i.opt(this.testPage_,(function(t){return t.animationController.animationStyle}))).variant,XCTAssertEqual(a.name,this.appliedAnimationStyle_.name),XCTAssertEqual(n,0)}}}}),o)},WR9q:function(t,e,n){var o,r,i=e,a=n("oAGj"),s=n("O8XL"),l=n("lbYW"),u=n("c9Jm"),c=n("FNB+"),h=n("6Rk9"),f=n("sIWg");i.DistributeTest=(o=function(){this.actionSequence_Distribute=[function(){return new l.DistributeFormaeAction(s.DistributeType.LeftEdge)},function(){return new l.DistributeFormaeAction(s.DistributeType.TopEdge)}],this.formaeToDistribute_=[],this.initialBounds_=f.TheoRect.Zero,this.postDistributeBounds_=f.TheoRect.Zero,this.epsilon=.001,u.ActionTestBase.call(this)},a.defineClass({name:"DistributeTest",ctor:o,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){var o=h.GeometryFacade.getFormaeBounds([n.firstPage.root],!0);return this.allSelectableFormae(n,(function(t){return 1==t.controller.floating&&o.contains(h.GeometryFacade.getFormaeBounds([t],!0))})).length>2},setUpActionSequence:function(t,e,n){var o=h.GeometryFacade.getFormaeBounds([n.firstPage.root],!0);this.formaeToDistribute_=a.clone(this.allSelectableFormae(n,(function(t){return 1==t.controller.floating&&o.contains(h.GeometryFacade.getFormaeBounds([t],!0))}))),XCTAssertNotNil(a.clone(this.formaeToDistribute_)),this.formaeToDistribute_.length>0&&(n.controller.selection.replaceSelectionWithFormae(a.clone(this.formaeToDistribute_)),this.initialBounds_=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToDistribute_),!0))},validateAfterActionSequence:function(t,e){this.postDistributeBounds_=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToDistribute_),!0),this.validatePostDistributeLeftAndTop()},validateAfterUndo:function(t,e){var n=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToDistribute_),!0);XCTAssertTrue(this.initialBounds_.equal(n))},validateAfterRedo:function(t,e){this.postDistributeBounds_=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToDistribute_),!0),this.validatePostDistributeLeftAndTop()},validatePostDistributeLeftAndTop:function(){for(var t=a.iter(this.formaeToDistribute_);!t.done;t.next()){var e=t.value,n=h.GeometryFacade.getFormaeBounds([e],!0).evalXY(0,0);XCTAssertTrue(this.postDistributeBounds_.containsPoint(n))}},tearDown:function(){this.formaeToDistribute_=[],u.ActionTestBase.prototype.tearDown.call(this)}}}),o),i.ArrangeTest=(r=function(){this.actionSequence_Distribute=[function(){return new l.ArrangeFormaeAction(!0)}],this.formaeToArrange_=[],this.initialBounds_=f.TheoRect.Zero,this.postArrangeBounds_=f.TheoRect.Zero,u.ActionTestBase.call(this)},a.defineClass({name:"ArrangeTest",ctor:r,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o=h.GeometryFacade.getFormaeBounds([n.firstPage.root],!0);this.formaeToArrange_=a.clone(this.allSelectableFormae(n,(function(t){return 1==t.controller.floating&&o.contains(h.GeometryFacade.getFormaeBounds([t],!0))}))),XCTAssertNotNil(a.clone(this.formaeToArrange_)),this.formaeToArrange_.length>0&&(n.controller.selection.replaceSelectionWithFormae(a.clone(this.formaeToArrange_)),this.initialBounds_=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToArrange_),!0))},validateAfterActionSequence:function(t,e){this.postArrangeBounds_=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToArrange_),!0),this.validatePostArrangeRow()},validateAfterUndo:function(t,e){var n=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToArrange_),!0);XCTAssertTrue(this.initialBounds_.equal(n))},validateAfterRedo:function(t,e){this.postArrangeBounds_=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToArrange_),!0),this.validatePostArrangeRow()},validatePostArrangeRow:function(){var t=a.clone(this.sortInRowOrder(a.clone(this.formaeToArrange_)));if(t.length>0){var e=a.first(t),n=h.GeometryFacade.getFormaeBounds([e],!0).evalXY(0,0).x;XCTAssertTrue(this.postArrangeBounds_.minX==n);for(var o=a.iter(t);!o.done;o.next()){var r=o.value,i=h.GeometryFacade.getFormaeBounds([r],!0).evalXY(0,0);XCTAssertTrue(i.x>n||a.eq(c._equality_Forma_Forma,r,e))}}},sortInRowOrder:function(t){var e=a.clone(t);return a.sortInPlace(e,(function(t,e){var n=h.GeometryFacade.getFormaeBounds([t],!0),o=h.GeometryFacade.getFormaeBounds([e],!0);return n.minX<o.minX})),e},tearDown:function(){this.formaeToArrange_=[],u.ActionTestBase.prototype.tearDown.call(this)}}}),r)},YX5m:function(t,e,n){var o,r,i,a,s=e,l=n("oAGj"),u=n("c9Jm"),c=n("yGNn"),h=n("quOg"),f=n("FNB+"),m=n("x6FH"),d=n("9Lk3"),A=n("x35w");s.CreatePaddedCollageTest=(o=function(){this.actionSequence_CreatePaddedCollage=[function(){return new m.CreatePaddedCollageAction}],u.ActionTestBase.call(this)},l.defineClass({name:"CreatePaddedCollageTest",ctor:o,superName:"ActionTestBase",props:{validateAfterActionSequence:function(t,e){},validateAfterUndo:function(t,e){},validateAfterRedo:function(t,e){}}}),o),s.SetGridParametersTest=(r=function t(){this.actionSequence_SetGridParameters=[function(){return new m.EnterGridLayoutModeAction},function(){return new m.SetGridParametersAction(t.spacing_,t.margin_)}],this.gridForma_=null,this.oldMargin_=0,this.oldSpacing_=0,u.ActionTestBase.call(this)},l.defineClass({name:"SetGridParametersTest",ctor:r,superName:"ActionTestBase",statics:{margin_:10,spacing_:5},props:{canRunActionSequence:function(t,e,n){return this.gridForma_=l.first(n.firstPage.root.filterByControllerKind(d.GridController.KIND)),null!=this.gridForma_},setUpActionSequence:function(t,e,n){var o;(o=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(this.oldMargin_=o.margin,this.oldSpacing_=o.spacing)},validateAfterActionSequence:function(t,e){var n;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(XCTAssertEqual(n.margin,r.margin_),XCTAssertEqual(n.spacing,r.spacing_))},validateAfterUndo:function(t,e){var n;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(XCTAssertEqual(n.margin,this.oldMargin_),XCTAssertEqual(n.spacing,this.oldSpacing_))},validateAfterRedo:function(t,e){var n;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(XCTAssertEqual(n.margin,r.margin_),XCTAssertEqual(n.spacing,r.spacing_))}}}),r),s.SetGridStyleTest=(i=function(){this.actionSequence_SetGridStyle=[function(){return new m.EnterGridLayoutModeAction}],this.actionSequence_SetGridStyleMovableShift=[function(){return new m.EnterGridLayoutModeAction}],this.gridForma_=null,this.gridLayouts_=null,this.oldGridStyle_=null,this.newGridStyle_=null,u.ActionTestBase.call(this)},l.defineClass({name:"SetGridStyleTest",ctor:i,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){var o;if(this.gridForma_=l.first(n.firstPage.root.filterByControllerKind(d.GridController.KIND)),o=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController)){var r=o.numCells;this.gridLayouts_=l.clone(n.gridLibrary.getGridsByCellNumber(r,!0))}return null!=this.gridForma_&&null!=this.gridLayouts_&&this.gridLayouts_.length>0},populateActionSequence:function(t,e,n){var o=this;return this.newGridStyle_=l.last(this.gridLayouts_),c.CorePromise.resolve(t.concat([function(){return new m.SetGridStyleAction(o.newGridStyle_,0)}]))},setUpActionSequence:function(t,e,n){var o,r,i="actionSequence_SetGridStyleMovableShift"==e;l.opt(this.newGridStyle_,(function(t){return t.moveableShift=i})),l.opt(this.oldGridStyle_,(function(t){return t.moveableShift=i})),(o=n.controller)&&(o.interactionMode=h.InteractionMode.AutomaticGrid),(r=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(this.oldGridStyle_=r.gridStyle)},validateAfterActionSequence:function(t,e){var n;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&XCTAssertEqual(l.opt(n.gridStyle,(function(t){return t.asString})),l.opt(this.newGridStyle_,(function(t){return t.asString})))},validateAfterUndo:function(t,e){var n;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&XCTAssertEqual(l.opt(n.gridStyle,(function(t){return t.asString})),l.opt(this.oldGridStyle_,(function(t){return t.asString})))},validateAfterRedo:function(t,e){var n;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&XCTAssertEqual(l.opt(n.gridStyle,(function(t){return t.asString})),l.opt(this.newGridStyle_,(function(t){return t.asString})))}}}),i),s.SwapGridFormaTest=(a=function(){this.actionSequence_SwapGridForma=[function(){return new m.EnterGridLayoutModeAction}],this.gridForma_=null,this.childA_=null,this.childB_=null,this.oldChildACell_=-1,this.oldChildBCell_=-1,u.ActionTestBase.call(this)},l.defineClass({name:"SwapGridFormaTest",ctor:a,superName:"ActionTestBase",statics:{margin_:10,spacing_:5},props:{canRunActionSequence:function(t,e,n){var o,r=this;return this.gridForma_=l.first(n.firstPage.root.filterByControllerKind(d.GridController.KIND)),(o=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&l.opt(this.gridForma_,(function(t){return t.visit(f.FormaTraversal.PreOrder,(function(t,e,n){if(A.GridFacade.isChildSwappable(t))if(null==r.childA_)l.opt(o.gridStyle,(function(e){return null!=e.cellForForma(t)}))&&(r.childA_=t);else{var i,a=l.opt(o.gridStyle,(function(t){return t.cellForForma(r.childA_)}));null!=(i=l.opt(o.gridStyle,(function(e){return e.cellForForma(t)})))&&l.opt(a,(function(t){return t[0]!=i[0]}))&&(r.childB_=t)}return null!=r.childA_&&null!=r.childB_}))})),null!=this.gridForma_&&null!=this.childA_&&null!=this.childB_},populateActionSequence:function(t,e,n){var o=this;return c.CorePromise.resolve(t.concat([function(){return new m.SwapGridFormaAction(o.childA_,o.childB_)}]))},setUpActionSequence:function(t,e,n){var o,r;(o=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(r=o.gridStyle)&&(this.oldChildACell_=r.cellForForma(this.childA_)[0],this.oldChildBCell_=r.cellForForma(this.childB_)[0])},validateAfterActionSequence:function(t,e){var n,o;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(o=n.gridStyle)&&(XCTAssertEqual(o.cellForForma(this.childA_)[0],this.oldChildBCell_),XCTAssertEqual(o.cellForForma(this.childB_)[0],this.oldChildACell_))},validateAfterUndo:function(t,e){var n,o;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(o=n.gridStyle)&&(XCTAssertEqual(o.cellForForma(this.childA_)[0],this.oldChildACell_),XCTAssertEqual(o.cellForForma(this.childB_)[0],this.oldChildBCell_))},validateAfterRedo:function(t,e){var n,o;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(o=n.gridStyle)&&(XCTAssertEqual(o.cellForForma(this.childA_)[0],this.oldChildBCell_),XCTAssertEqual(o.cellForForma(this.childB_)[0],this.oldChildACell_))}}}),a)},Ztps:function(t,e,n){var o,r,i=e,a=n("oAGj"),s=n("c9Jm"),l=n("yGNn"),u=n("9Lk3"),c=n("j89o"),h=n("T8w7"),f=n("uxH+");i.OpacityTest=(o=function(){this.actionSequence_SetOpacity=[function(){return new c.SetOpacityAction(.55)}],this.formaeToChangeOpacity_=[],this.initialOpacities_=[],s.ActionTestBase.call(this)},a.defineClass({name:"OpacityTest",ctor:o,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o;this.formaeToChangeOpacity_=a.clone(this.allSelectableFormae(n,(function(t){return!(!(o=a.opt(t.controller,(function(t){return t.opacityChangeable})))&&null==o)&&o}))),this.initialOpacities_=this.formaeToChangeOpacity_.map((function(t){return h.OpacityFacade.getOpacityForForma(t)}),this),n.controller.selection.replaceSelectionWithFormae(a.clone(this.formaeToChangeOpacity_))},validateAfterActionSequence:function(t,e){for(var n=a.iter(this.formaeToChangeOpacity_);!n.done;n.next()){var o=n.value,r=h.OpacityFacade.getOpacityForForma(o);XCTAssertEqual(r,.55)}},validateAfterUndo:function(t,e){for(var n=a.iter(a.range(0,this.formaeToChangeOpacity_.length,!1));!n.done;n.next()){var o=n.value,r=this.formaeToChangeOpacity_[o],i=h.OpacityFacade.getOpacityForForma(r),s=this.initialOpacities_[o];XCTAssertEqual(i,s)}},validateAfterRedo:function(t,e){for(var n=a.iter(this.formaeToChangeOpacity_);!n.done;n.next()){var o=n.value,r=h.OpacityFacade.getOpacityForForma(o);XCTAssertEqual(r,.55)}}}}),o),i.BackgroundOpacityTest=(r=function(){this.testDoc_=null,this.rootForma_=null,this.actionSequence_SetBackgroundOpacity=[],s.ActionTestBase.call(this)},a.defineClass({name:"BackgroundOpacityTest",ctor:r,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){var o;return this.rootForma_=n.firstPage.root,this.testDoc_=n,!!(o=a.as(a.opt(this.rootForma_,(function(t){return t.controller})),f.RootController))&&o.suggestTransparentBackground()},populateActionSequence:function(t,e,n){return l.CorePromise.resolve([function(){return new c.SetBackgroundOpacityAction(0,n.firstPage)}])},setUpActionSequence:function(t,e,n){var o;if(o=a.as(a.opt(this.rootForma_,(function(t){return t.controller})),f.RootController)){XCTAssertTrue(o.suggestTransparentBackground());var r=h.OpacityFacade.getBackgroundOpacity(n.firstPage);XCTAssertTrue(1==r);for(var i=a.iter(this.rootForma_.filterWithCallback((function(t){return u.GridController.isBackgroundColoredCell(t)})));!i.done;i.next()){var s=i.value;XCTAssertTrue(1==s.style.opacity)}}else XCTFail("no root controller?")},validateAfterActionSequence:function(t,e){var n;if(n=a.as(a.opt(this.rootForma_,(function(t){return t.controller})),f.RootController)){XCTAssertTrue(n.suggestTransparentBackground());var o=h.OpacityFacade.getBackgroundOpacity(this.testDoc_.firstPage);XCTAssertTrue(0==o);for(var r=a.iter(this.rootForma_.filterWithCallback((function(t){return u.GridController.isBackgroundColoredCell(t)})));!r.done;r.next()){var i=r.value;XCTAssertTrue(0==i.style.opacity)}}else XCTFail("no root controller?")},validateAfterUndo:function(t,e){var n;if(n=a.as(a.opt(this.rootForma_,(function(t){return t.controller})),f.RootController)){XCTAssertTrue(n.suggestTransparentBackground());var o=h.OpacityFacade.getBackgroundOpacity(this.testDoc_.firstPage);XCTAssertTrue(1==o);for(var r=a.iter(this.rootForma_.filterWithCallback((function(t){return u.GridController.isBackgroundColoredCell(t)})));!r.done;r.next()){var i=r.value;XCTAssertTrue(1==i.style.opacity)}}else XCTFail("no root controller?")},validateAfterRedo:function(t,e){var n;if(n=a.as(a.opt(this.rootForma_,(function(t){return t.controller})),f.RootController)){XCTAssertTrue(n.suggestTransparentBackground());var o=h.OpacityFacade.getBackgroundOpacity(this.testDoc_.firstPage);XCTAssertTrue(0==o);for(var r=a.iter(this.rootForma_.filterWithCallback((function(t){return u.GridController.isBackgroundColoredCell(t)})));!r.done;r.next()){var i=r.value;XCTAssertTrue(0==i.style.opacity)}}else XCTFail("no root controller?")}}}),r)},bpSr:function(t,e,n){var o,r,i,a,s,l,u,c,h,f,m,d,A,_,p=e,T=n("oAGj"),g=n("Tq01"),C=n("c9Jm"),F=n("yGNn"),S=n("FNB+"),v=n("6ZWm"),E=n("cmoc"),I=n("bqbo"),R=n("q5zr"),P=n("fdtz"),D=n("lmwz"),y=n("uWOl"),N=n("j89o"),B=n("Zifs"),q=n("djAF"),L=n("umUn");p.ReplaceImagesWithColorsTest=(o=function t(){this.actionSequence_ReplaceImagesWithColors=[function(){return new I.ReplaceImagesWithColorsAction(null,[t.green_])}],this.formaToReplace_=null,C.ActionTestBase.call(this)},r={},T.defineClass({name:"ReplaceImagesWithColorsTest",ctor:o,superName:"ActionTestBase",statics:{green_:{get:function(){return void 0===r.green_&&(r.green_=L.TheoColor.init_5344(new B.SolidColor(0,1,0,1))),r.green_}}},props:{replacementForma:{get:function(){return T.first(T.opt(T.as(this.getActionResult(0),g.FormaActionResult),(function(t){return t.formae})))}},canRunActionSequence:function(t,e,n){return this.formaToReplace_=T.as(T.last(this.allSelectableFormae(n,(function(t){return t instanceof E.FrameForma&&T.opt(T.as(t,E.FrameForma),(function(t){return t.childAt(0)instanceof P.ImageForma}))}))),E.FrameForma),null!=this.formaToReplace_},setUpActionSequence:function(t,e,n){XCTAssertNotNil(this.formaToReplace_),null!=this.formaToReplace_&&n.controller.selection.replaceSelection(this.formaToReplace_)},validateAfterActionSequence:function(t,e){var n;if(XCTAssertNotNil(this.replacementForma),XCTAssertTrue(this.replacementForma instanceof q.ShapeForma),XCTAssertNil(T.opt(this.formaToReplace_,(function(t){return t.parent}))),n=T.as(this.replacementForma,q.ShapeForma)){var r=n.style.colors.fieldPrimary;XCTAssertNotNil(r),XCTAssertEqual(r,o.green_.rgbColor)}},validateAfterUndo:function(t,e){XCTAssertNil(T.opt(this.replacementForma,(function(t){return t.parent}))),XCTAssertNotNil(T.opt(this.formaToReplace_,(function(t){return t.parent})))},validateAfterRedo:function(t,e){var n;if(XCTAssertNotNil(this.replacementForma),XCTAssertTrue(this.replacementForma instanceof q.ShapeForma),XCTAssertNil(T.opt(this.formaToReplace_,(function(t){return t.parent}))),n=T.as(this.replacementForma,q.ShapeForma)){var r=n.style.colors.fieldPrimary;XCTAssertNotNil(r),XCTAssertEqual(r,o.green_.rgbColor)}this.formaToReplace_=null}}}),o),p.SetImageFilterTest=(i=function(){this.actionSequence_SetImageFilter=[],this.formaToChange_=null,this.originalStyleName_=null,C.ActionTestBase.call(this)},T.defineClass({name:"SetImageFilterTest",ctor:i,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.formaToChange_=T.as(T.last(this.allSelectableFormae(n,(function(t){return t instanceof E.FrameForma&&T.opt(T.as(t,E.FrameForma),(function(t){return t.childAt(0)instanceof P.ImageForma}))}))),E.FrameForma),null!=this.formaToChange_},populateActionSequence:function(t,e,n){return F.CorePromise.resolve([function(){return new I.SetImageFilterAction(n.firstPage.imageFilterLibrary.getImageStyle("Greyscale"))}])},setUpActionSequence:function(t,e,n){XCTAssertNotNil(this.formaToChange_),null!=this.formaToChange_&&(this.originalStyleName_=T.opt(T.as(T.opt(T.as(T.opt(this.formaToChange_,(function(t){return t.childAt(0)})),P.ImageForma),(function(t){return t.style})),y.ImageStyle),(function(t){return t.name})),n.controller.selection.replaceSelection(this.formaToChange_))},validateAfterActionSequence:function(t,e){if(null!=this.formaToChange_){var n=T.as(T.opt(this.formaToChange_,(function(t){return t.childAt(0)})),P.ImageForma);XCTAssertNotNil(n);var o=T.as(T.opt(n,(function(t){return t.style})),y.ImageStyle);XCTAssertNotNil(o),XCTAssertTrue(T.opt(o,(function(t){return"Greyscale"==t.name})))}},validateAfterUndo:function(t,e){if(null!=this.formaToChange_){var n=T.as(T.opt(this.formaToChange_,(function(t){return t.childAt(0)})),P.ImageForma);XCTAssertNotNil(n),XCTAssertEqual(this.originalStyleName_,T.opt(T.as(T.opt(n,(function(t){return t.style})),y.ImageStyle),(function(t){return t.name})))}},validateAfterRedo:function(t,e){if(null!=this.formaToChange_){var n=T.as(T.opt(this.formaToChange_,(function(t){return t.childAt(0)})),P.ImageForma);XCTAssertNotNil(n);var o=T.as(T.opt(n,(function(t){return t.style})),y.ImageStyle);XCTAssertNotNil(o),XCTAssertTrue(T.opt(o,(function(t){return"Greyscale"==t.name}))),this.formaToChange_=null}}}}),i),p.ShuffleImageFilterTest=(a=function(){this.actionSequence_ShuffleImageFilter=[],this.page_=null,this.formaToChange_=null,this.styleToShuffle_=null,this.originalStyleName_=null,C.ActionTestBase.call(this)},T.defineClass({name:"ShuffleImageFilterTest",ctor:a,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.formaToChange_=T.as(T.last(this.allSelectableFormae(n,(function(t){return t instanceof E.FrameForma&&T.opt(T.as(t,E.FrameForma),(function(t){return t.childAt(0)instanceof P.ImageForma}))}))),E.FrameForma),null!=this.formaToChange_},prepareDocument:function(t,e){var n=this;return this.page_=t.firstPage,this.styleToShuffle_=this.page_.imageFilterLibrary.getImageStyle("Multiply"),null!=this.formaToChange_&&t.controller.selection.replaceSelection(this.formaToChange_),F.CorePromise.resolve([function(){return new I.SetImageFilterAction(n.styleToShuffle_)}])},populateActionSequence:function(t,e,n){var o=this;return F.CorePromise.resolve([function(){return new I.ShuffleImageFilterAction(o.styleToShuffle_,o.page_)}])},setUpActionSequence:function(t,e,n){XCTAssertNotNil(this.formaToChange_),null!=this.formaToChange_&&(this.originalStyleName_=T.opt(T.as(T.opt(T.as(T.opt(this.formaToChange_,(function(t){return t.childAt(0)})),P.ImageForma),(function(t){return t.style})),y.ImageStyle),(function(t){return t.name})),n.controller.selection.replaceSelection(this.formaToChange_))},validateAfterActionSequence:function(t,e){if(null!=this.formaToChange_){var n=T.as(T.opt(this.formaToChange_,(function(t){return t.childAt(0)})),P.ImageForma);XCTAssertNotNil(n);var o=T.as(T.opt(n,(function(t){return t.style})),y.ImageStyle);XCTAssertNotNil(o),XCTAssertTrue(T.opt(o,(function(t){return"Multiply"==t.name})))}},validateAfterUndo:function(t,e){if(null!=this.formaToChange_){var n=T.as(T.opt(this.formaToChange_,(function(t){return t.childAt(0)})),P.ImageForma);XCTAssertNotNil(n),XCTAssertEqual(this.originalStyleName_,T.opt(T.as(T.opt(n,(function(t){return t.style})),y.ImageStyle),(function(t){return t.name})))}},validateAfterRedo:function(t,e){if(null!=this.formaToChange_){var n=T.as(T.opt(this.formaToChange_,(function(t){return t.childAt(0)})),P.ImageForma);XCTAssertNotNil(n);var o=T.as(T.opt(n,(function(t){return t.style})),y.ImageStyle);XCTAssertNotNil(o),XCTAssertTrue(T.opt(o,(function(t){return"Multiply"==t.name}))),this.formaToChange_=null}}}}),a),p.ChangeImageAdjustmentsTest=(s=function(){this.actionSequence_ChangeImageAdjustments=[function(){return I.ChangeImageAdjustmentsAction.init_dd66("saturation",100)}],this.formaToAdjust_=null,this.oldValue_=null,C.ActionTestBase.call(this)},T.defineClass({name:"ChangeImageAdjustmentsTest",ctor:s,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.formaToAdjust_=T.as(T.last(this.allSelectableFormae(n,(function(t){return t instanceof E.FrameForma&&T.opt(T.as(t,E.FrameForma),(function(t){return t.childAt(0)instanceof P.ImageForma}))}))),E.FrameForma),null!=this.formaToAdjust_},setUpActionSequence:function(t,e,n){if(XCTAssertNotNil(this.formaToAdjust_),null!=this.formaToAdjust_){var o=T.as(T.opt(this.formaToAdjust_,(function(t){return t.childAt(0)})),P.ImageForma);this.oldValue_=T.opt(T.opt(o,(function(t){return t.style.adjustments})),(function(t){return t.saturation})),n.controller.selection.replaceSelection(this.formaToAdjust_)}},validateAfterActionSequence:function(t,e){var n;if(null!=this.formaToAdjust_){var o=T.as(T.opt(this.formaToAdjust_,(function(t){return t.childAt(0)})),P.ImageForma);XCTAssertNotNil(o);var r=T.as(T.opt(o,(function(t){return t.style})),y.ImageStyle);XCTAssertNotNil(r),XCTAssertEqual(100,(n=T.opt(T.opt(r,(function(t){return t.adjustments})),(function(t){return t.saturation})))||null!=n?n:0)}},validateAfterUndo:function(t,e){var n,o;if(null!=this.formaToAdjust_){var r=T.as(T.opt(this.formaToAdjust_,(function(t){return t.childAt(0)})),P.ImageForma);XCTAssertNotNil(r);var i=T.as(T.opt(r,(function(t){return t.style})),y.ImageStyle);XCTAssertNotNil(i),XCTAssertEqual((n=this.oldValue_)||null!=n?n:0,(o=T.opt(T.opt(i,(function(t){return t.adjustments})),(function(t){return t.saturation})))||null!=o?o:0)}},validateAfterRedo:function(t,e){var n;if(null!=this.formaToAdjust_){var o=T.as(T.opt(this.formaToAdjust_,(function(t){return t.childAt(0)})),P.ImageForma);XCTAssertNotNil(o);var r=T.as(T.opt(o,(function(t){return t.style})),y.ImageStyle);XCTAssertNotNil(r),XCTAssertEqual(100,(n=T.opt(T.opt(r,(function(t){return t.adjustments})),(function(t){return t.saturation})))||null!=n?n:0),this.formaToAdjust_=null}}}}),s),p.SetImageAsFloatingTest=(l=function(){this.actionSequence_SetAsFloating=[function(){return new I.SetImageAsFloatingAction}],this.frameForma_=null,C.ActionTestBase.call(this)},T.defineClass({name:"SetImageAsFloatingTest",ctor:l,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.frameForma_=T.as(T.last(this.allSelectableFormae(n,(function(t){return t.isBackgroundImage()}))),E.FrameForma),null!=this.frameForma_},setUpActionSequence:function(t,e,n){XCTAssertFalse(this.frameForma_.controller.floating),n.controller.selection.replaceSelection(this.frameForma_)},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.frameForma_.controller.floating)},validateAfterUndo:function(t,e){XCTAssertFalse(this.frameForma_.controller.floating)},validateAfterRedo:function(t,e){XCTAssertTrue(this.frameForma_.controller.floating)}}}),l),p.SetImageAsBackgroundTest=(u=function(){this.actionSequence_SetAsBackground=[function(){return new I.SetImageAsBackgroundAction}],this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.call(this)},T.defineClass({name:"SetImageAsBackgroundTest",ctor:u,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=T.as(T.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),E.FrameForma),null!=this.oneFrameForma_},prepareDocument:function(t,e){var n=[];return this.frameForma_=T.as(T.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),E.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),n.push((function(){return new I.SetImageAsFloatingAction}))),F.CorePromise.resolve(T.clone(n))},setUpActionSequence:function(t,e,n){XCTAssertTrue(this.frameForma_.controller.floating),n.controller.selection.replaceSelection(this.frameForma_)},validateAfterActionSequence:function(t,e){XCTAssertFalse(this.frameForma_.controller.floating)},validateAfterUndo:function(t,e){XCTAssertTrue(this.frameForma_.controller.floating)},validateAfterRedo:function(t,e){XCTAssertFalse(this.frameForma_.controller.floating)}}}),u),p.CropToRatioTest=(c=function(){this.actionSequence_CropToRatio=[],this.oneFrameForma_=null,this.frameForma_=null,this.imageForma_=null,this.initialRatio_=1,this.cropRatio_=1,C.ActionTestBase.call(this)},T.defineClass({name:"CropToRatioTest",ctor:c,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=T.as(T.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),E.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(t,e,n){var o=this;return F.CorePromise.resolve([function(){return o.initialRatio_=o.frameForma_.bounds.aspectRatio,o.cropRatio_=o.initialRatio_<1?4/3:.75,new I.CropImageToRatioAction(o.imageForma_,o.cropRatio_,null)}])},prepareDocument:function(t,e){var n=[];return this.frameForma_=T.as(T.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),E.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),n.push((function(){return new I.SetImageAsFloatingAction}))),this.imageForma_=D.ImageFacade.getImageFormaForForma(this.frameForma_),F.CorePromise.resolve(T.clone(n))},validateAfterActionSequence:function(t,e){var n=this.frameForma_.bounds.aspectRatio;XCTAssertEqual(n,this.cropRatio_,.001)},validateAfterUndo:function(t,e){var n=this.frameForma_.bounds.aspectRatio;XCTAssertEqual(n,this.initialRatio_,.001)},validateAfterRedo:function(t,e){var n=this.frameForma_.bounds.aspectRatio;XCTAssertEqual(n,this.cropRatio_,.001)}}}),c),p.ApplyShapeMaskTest=(h=function(){this.actionSequence_ApplyShapeMask=[],this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.call(this)},T.defineClass({name:"ApplyShapeMaskTest",ctor:h,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=T.as(T.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),E.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(t,e,n){var o=this;return F.CorePromise.resolve([function(){return new I.ApplyShapeMaskToImageAction(o.frameForma_,"diamond")}])},prepareDocument:function(t,e){var n=this,o=[];return this.frameForma_=T.as(T.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),E.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),o.push((function(){return new I.SetImageAsFloatingAction}))),D.ImageFacade.formaHasMask(this.frameForma_)&&o.push((function(){return new I.ApplyShapeMaskToImageAction(n.frameForma_)})),F.CorePromise.resolve(T.clone(o))},validateAfterActionSequence:function(t,e){var n;if(n=T.as(T.opt(this.frameForma_,(function(t){return t.controller})),v.FrameController)){var o=T.as(n.mask,q.ShapeForma);XCTAssertNotNil(o),XCTAssertEqual(o.shapeLibraryID,"diamond")}},validateAfterUndo:function(t,e){var n;(n=T.as(T.opt(this.frameForma_,(function(t){return t.controller})),v.FrameController))&&XCTAssertNil(n.mask)},validateAfterRedo:function(t,e){var n;if(n=T.as(T.opt(this.frameForma_,(function(t){return t.controller})),v.FrameController)){var o=T.as(n.mask,q.ShapeForma);XCTAssertNotNil(o),XCTAssertEqual(o.shapeLibraryID,"diamond")}}}}),h),p.ApplyRasterMaskTest=(f=function(){this.actionSequence_ApplyRasterMask=[],this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.call(this)},T.defineClass({name:"ApplyRasterMaskTest",ctor:f,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=T.as(T.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),E.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(t,e,n){var o=this;return F.CorePromise.resolve([function(){return new I.ApplyRasterMaskToImageAction(o.frameForma_,"raster-01")}])},prepareDocument:function(t,e){var n=this,o=[];return this.frameForma_=T.as(T.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),E.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),o.push((function(){return new I.SetImageAsFloatingAction}))),D.ImageFacade.formaHasMask(this.frameForma_)&&!D.ImageFacade.formaHasShapeMask(this.frameForma_)&&o.push((function(){return new I.ApplyRasterMaskToImageAction(n.frameForma_)})),F.CorePromise.resolve(T.clone(o))},validateAfterActionSequence:function(t,e){var n;if(n=T.as(T.opt(this.frameForma_,(function(t){return t.controller})),v.FrameController)){var o=T.as(n.mask,P.ImageForma);XCTAssertNotNil(o),XCTAssertEqual(o.contentNode.getTag(R.ImageContentNode.ASSET_ID_TAG),"raster-01")}},validateAfterUndo:function(t,e){var n;(n=T.as(T.opt(this.frameForma_,(function(t){return t.controller})),v.FrameController))&&XCTAssertNil(n.mask)},validateAfterRedo:function(t,e){var n;if(n=T.as(T.opt(this.frameForma_,(function(t){return t.controller})),v.FrameController)){var o=T.as(n.mask,P.ImageForma);XCTAssertNotNil(o),XCTAssertEqual(o.contentNode.getTag(R.ImageContentNode.ASSET_ID_TAG),"raster-01")}}}}),f),p.AllowFreeformCropTest=(m=function(){this.actionSequence_AllowFreeformCrop=[],this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.call(this)},T.defineClass({name:"AllowFreeformCropTest",ctor:m,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=T.as(T.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),E.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(t,e,n){var o=this;return F.CorePromise.resolve([function(){return new I.SetImageCropToFreeformAction(o.frameForma_)}])},prepareDocument:function(t,e){var n=this,o=[];return this.frameForma_=T.as(T.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),E.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),o.push((function(){return new I.SetImageAsFloatingAction}))),D.ImageFacade.formaHasMask(this.frameForma_)||o.push((function(){return new I.ApplyShapeMaskToImageAction(n.frameForma_,"diamond")})),F.CorePromise.resolve(T.clone(o))},validateAfterActionSequence:function(t,e){XCTAssertTrue(D.ImageFacade.usesFreeformCropPreset(this.frameForma_)),XCTAssertFalse(D.ImageFacade.formaHasShapeMask(this.frameForma_))},validateAfterUndo:function(t,e){XCTAssertFalse(D.ImageFacade.usesFreeformCropPreset(this.frameForma_)),XCTAssertTrue(D.ImageFacade.formaHasShapeMask(this.frameForma_))},validateAfterRedo:function(t,e){XCTAssertTrue(D.ImageFacade.usesFreeformCropPreset(this.frameForma_)),XCTAssertFalse(D.ImageFacade.formaHasShapeMask(this.frameForma_))}}}),m),p.EnterCropModeTest=(d=function(){this.actionSequence_EnterCropMode=[],this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.call(this)},T.defineClass({name:"EnterCropModeTest",ctor:d,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=T.as(T.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),E.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(t,e,n){var o=this;return F.CorePromise.resolve([function(){return new I.EnterCropModeAction(o.frameForma_)}])},prepareDocument:function(t,e){var n=this,o=[];return this.frameForma_=T.as(T.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),E.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),o.push((function(){return new I.SetImageAsFloatingAction})),o.push((function(){var t=n.frameForma_.bounds.aspectRatio<1?4/3:.75;return new I.CropImageToRatioAction(n.frameForma_,t,null)}))),F.CorePromise.resolve(T.clone(o))},validateAfterActionSequence:function(t,e){var n,o=null;if(n=T.opt(this.frameForma_,(function(t){return t.parent})))for(var r=T.iter(n.visitAsArray(S.FormaTraversal.JustChildren));!r.done;r.next()){var i=r.value;i.hasIntent(S.Forma.INTENT_TEMP_IMAGE_CROP)&&(o=i)}XCTAssertNotNil(o)},validateAfterUndo:function(t,e){var n,o=null;if(n=T.opt(this.frameForma_,(function(t){return t.parent})))for(var r=T.iter(n.visitAsArray(S.FormaTraversal.JustChildren));!r.done;r.next()){var i=r.value;i.hasIntent(S.Forma.INTENT_TEMP_IMAGE_CROP)&&(o=i)}XCTAssertNil(o)},validateAfterRedo:function(t,e){var n,o=null;if(n=T.opt(this.frameForma_,(function(t){return t.parent})))for(var r=T.iter(n.visitAsArray(S.FormaTraversal.JustChildren));!r.done;r.next()){var i=r.value;i.hasIntent(S.Forma.INTENT_TEMP_IMAGE_CROP)&&(o=i)}XCTAssertNotNil(o)}}}),d),p.ExitCropModeTest=(A=function(){this.actionSequence_ExitCropMode=[],this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.call(this)},T.defineClass({name:"ExitCropModeTest",ctor:A,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=T.as(T.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),E.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(t,e,n){return F.CorePromise.resolve([function(){return new I.ExitCropModeAction}])},prepareDocument:function(t,e){var n=this,o=[];return this.frameForma_=T.as(T.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),E.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),o.push((function(){return new I.SetImageAsFloatingAction})),o.push((function(){var t=n.frameForma_.bounds.aspectRatio<1?4/3:.75;return new I.CropImageToRatioAction(n.frameForma_,t,null)})),o.push((function(){return new I.EnterCropModeAction(n.frameForma_)}))),F.CorePromise.resolve(T.clone(o))}}}),A),p.AddHiddenImageToGridTest=(_=function(){this.actionSequence_AddHidden=[],this.oneFrameForma_=null,this.frameForma_=null,this.imageForma_=null,C.ActionTestBase.call(this)},T.defineClass({name:"AddHiddenImageToGridTest",ctor:_,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=T.as(T.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),E.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(t,e,n){var o=this;return F.CorePromise.resolve([function(){return new I.AddHiddenImageToGridAction([o.imageForma_])}])},prepareDocument:function(t,e){var n=this,o=[];return this.frameForma_=T.as(T.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),E.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),o.push((function(){return new I.SetImageAsFloatingAction}))),this.imageForma_=D.ImageFacade.getImageFormaForForma(this.frameForma_),o.push((function(){return new N.SetOpacityAction(0,[n.imageForma_])})),F.CorePromise.resolve(T.clone(o))},validateAfterActionSequence:function(t,e){XCTAssertFalse(this.frameForma_.controller.floating),XCTAssertEqual(this.imageForma_.style.opacity,1)},validateAfterUndo:function(t,e){XCTAssertTrue(this.frameForma_.controller.floating),XCTAssertEqual(this.imageForma_.style.opacity,0)},validateAfterRedo:function(t,e){XCTAssertFalse(this.frameForma_.controller.floating),XCTAssertEqual(this.imageForma_.style.opacity,1)}}}),_)},c9Jm:function(t,e,n){var o,r,i,a,s,l=e,u=n("oAGj"),c=n("Tq01"),h=n("kYI4"),f=n("yGNn"),m=n("C42b"),d=n("iCxV"),A=n("3lr5"),_=n("sRQj"),p=n("jcfx"),T=n("umUn"),g=n("VJ9E");l.ActionTestBase=(o=function(){this.canRun_=!0,this.runningSequenceName_="",this.qualifiedSequenceName_="",this.completePath_="",this.path_="",this.undoToIndex_=0,this.performanceFilename="performance.json",this.validationState_=new l.ValidationState,this.prepResults_=[],this.actionResults_=[],this.synchronizer=null,this.FAKE_COLOR_ELEMENT_PRIMARY_ID="themeColor0",this.FAKE_COLOR_ELEMENT_SECONDARY_ID1="themeColor1",this.FAKE_COLOR_ELEMENT_SECONDARY_ID2="themeColor2",this.FAKE_COLOR_ELEMENT_SHADE_ID0="themeColor3",this.FAKE_COLOR_ELEMENT_SHADE_ID1="themeColor4",this.FAKE_COLOR_ELEMENT_SHADE_ID2="themeColor5",this.FAKE_COLOR_ELEMENT_SHADE_ID3="themeColor6",this.FAKE_COLOR_ELEMENT_SHADE_ID4="themeColor7",this.FAKE_COLOR_ELEMENT_SHADE_ID5="themeColor8",this.FAKE_COLOR_ELEMENT_SHADE_ID6="themeColor9",this.FAKE_LOGO_ELEMENT_PRIMARY_ID="logo-001",this.FAKE_LOGO_ELEMENT_STAMP_ID="logo-002",this.FAKE_FONT_ELEMENT_HEADLINE_ID="fnt-001",this.FAKE_FONT_ELEMENT_BODY_ID="fnt-002",this.FAKE_COLOR_ELEMENT_PRIMARY_ID_2="themeColor0-2",this.FAKE_COLOR_ELEMENT_SECONDARY_ID1_2="themeColor1-2",this.FAKE_COLOR_ELEMENT_SECONDARY_ID2_2="themeColor2-2",this.FAKE_COLOR_ELEMENT_SHADE_ID0_2="themeColor3-2",this.FAKE_COLOR_ELEMENT_SHADE_ID1_2="themeColor4-2",this.FAKE_COLOR_ELEMENT_SHADE_ID2_2="themeColor5-2",this.FAKE_COLOR_ELEMENT_SHADE_ID3_2="themeColor6-2",this.FAKE_COLOR_ELEMENT_SHADE_ID4_2="themeColor7-2",this.FAKE_COLOR_ELEMENT_SHADE_ID5_2="themeColor8-2",this.FAKE_COLOR_ELEMENT_SHADE_ID6_2="themeColor9-2",this.FAKE_LOGO_ELEMENT_PRIMARY_ID_2="logo-001-2",this.FAKE_LOGO_ELEMENT_STAMP_ID_2="logo-002-2",this.FAKE_FONT_ELEMENT_HEADLINE_ID_2="fnt-001-2",this.FAKE_FONT_ELEMENT_BODY_ID_2="fnt-002-2"},u.defineClass({name:"ActionTestBase",ctor:o,statics:{actionPerformanceData:{}},props:{lastActionResult:{get:function(){return u.last(this.actionResults_)}},appendActionResult:function(t){this.actionResults_.push(t)},getActionResult:function(t){return t>=0&&t<this.actionResults_.length?this.actionResults_[t]:null},getPrepActionResult:function(t){return t>=0&&t<this.prepResults_.length?this.prepResults_[t]:null},testName:{get:function(){return"ActionTest:"+this.path_+"::"+this.runningSequenceName_}},initializeDocPath:function(t){this.completePath_=t,this.path_=u.toString(u.last(t.split("/")))},initializeTestParameters:function(t,e,n){this.runningSequence_=u.clone(t),this.runningSequenceName_=e,this.qualifiedSequenceName_=n},setUp:function(){var t=this;this.doc_=u.opt(d.Host.actionTesting,(function(e){return e.openDocument(t.completePath_)}))},tearDown:function(){var t=this;u.opt(d.Host.actionTesting,(function(e){return e.closeDocument(t.completePath_)}))},validateActionSequence:function(){var t=this,e=this.nextValidationState();u.opt(d.Host.actionTesting,(function(n){return n.awaitResult(e,t.synchronizer)}))},nextValidationState:function(){var t,e=this;switch(this.validationState_.next()){case 0:return new f.CorePromise((function(t,n){var o;(o=e.doc_)?(m.CoreRandom.seedRandom(5489),e.canRun_=e.canRunActionSequence(u.clone(e.runningSequence_),e.runningSequenceName_,o),e.canRun_||e.validationState_.finish()):e.validationState_.fail(),t(null)})).then((function(t){return e.nextValidationState()}));case 1:return this.prepareDocument(this.doc_,this.runningSequenceName_).then((function(n){return e.prepareSequence_=u.clone((t=u.as(n,["Array","Function"]))||null!=t?t:[]),e.runActions(u.clone(e.prepareSequence_))})).then((function(t){return e.nextValidationState()}));case 2:return this.populateActionSequence(u.clone(this.runningSequence_),this.runningSequenceName_,this.doc_).then((function(t){return e.runningSequence_=u.clone(u.as(t,["Array","Function"])),null})).then((function(t){return e.nextValidationState()}));case 3:return new f.CorePromise((function(t,n){e.setUpActionSequence(u.clone(e.runningSequence_),e.runningSequenceName_,e.doc_),t(null)})).then((function(t){return e.nextValidationState()}));case 4:return new f.CorePromise((function(t,n){e.renderBeforeRunning(u.clone(e.runningSequence_),e.runningSequenceName_),t(null)})).then((function(t){return e.nextValidationState()}));case 5:var n=0;return f.CorePromise.resolve(null).then((function(t){return n=d.Host.async.getSystemUptimeInSeconds(),f.CorePromise.resolve(null)})).then((function(t){return e.runActionSequence(u.clone(e.runningSequence_),e.runningSequenceName_)})).then((function(t){var r=d.Host.async.getSystemUptimeInSeconds()-n,i=d.Host.locale.formatNumber(r,3),a=e.qualifiedSequenceName_+"/"+e.path_;return o.actionPerformanceData[a]={time:i,buffer:"99.99"},e.nextValidationState()}));case 6:return new f.CorePromise((function(t,n){e.validateAfterActionSequence(u.clone(e.runningSequence_),e.runningSequenceName_),t(null)})).then((function(t){return e.nextValidationState()}));case 7:return new f.CorePromise((function(t,n){e.renderAfterRunning(u.clone(e.runningSequence_),e.runningSequenceName_),t(null)})).then((function(t){return e.nextValidationState()}));case 8:return this.undoActionSequence(u.clone(this.runningSequence_),this.runningSequenceName_).then((function(t){return e.nextValidationState()}));case 9:return new f.CorePromise((function(t,n){e.validateAfterUndo(u.clone(e.runningSequence_),e.runningSequenceName_),t(null)})).then((function(t){return e.nextValidationState()}));case 10:return new f.CorePromise((function(t,n){e.renderAfterUndo(u.clone(e.runningSequence_),e.runningSequenceName_),t(null)})).then((function(t){return e.nextValidationState()}));case 11:return this.redoActionSequence(u.clone(this.runningSequence_),this.runningSequenceName_).then((function(t){return e.nextValidationState()}));case 12:return new f.CorePromise((function(t,n){e.validateAfterRedo(u.clone(e.runningSequence_),e.runningSequenceName_),t(null)})).then((function(t){return e.nextValidationState()}));case 13:return new f.CorePromise((function(t,n){e.renderAfterRedo(u.clone(e.runningSequence_),e.runningSequenceName_),t(null)})).then((function(t){return e.nextValidationState()}));case 14:return new f.CorePromise((function(t,n){e.shutdown(u.clone(e.runningSequence_),e.runningSequenceName_,e.doc_),t(null)})).then((function(t){return e.nextValidationState()}));default:return f.CorePromise.resolve(null)}},canRunActionSequence:function(t,e,n){return!0},populateActionSequence:function(t,e,n){return f.CorePromise.resolve(u.clone(t))},prepareDocument:function(t,e){return f.CorePromise.resolve([])},setUpActionSequence:function(t,e,n){},renderBeforeRunning:function(t,e){this.render(this.doc_,"before/"+this.qualifiedSequenceName_)},runActions:function(t){var e=this,n=new l.TestActionHandler(this.doc_.controller),o=u.clone(t);if(0==o.length)return f.CorePromise.resolve(null);var r=n.doAction(o.shift()()).then((function(t){return e.appendActionResult(c.ActionResult.fromPromiseAny(t))}));if(0==!o.length)for(var i=u.iter(o);!i.done;i.next()){var a=i.value;r=r.then((function(t){var e=a();return n.doAction(e)})).then((function(t){return e.appendActionResult(c.ActionResult.fromPromiseAny(t))}))}return r},clearResultsBeforeRunning:function(){this.prepResults_=u.clone(this.actionResults_),this.actionResults_=[]},runActionSequence:function(t,e){var n,o=this;return this.clearResultsBeforeRunning(),XCTAssertTrue(t.length>0,"should not run a test with no actions. Implement CanRun for this test to skip if the test can't be run on it"),(n=u.opt(u.opt(this.doc_,(function(t){return t.controller})),(function(t){return t.undoRedoMgr})))&&(this.undoToIndex_=n.getCurrentTimelineIndex()),this.runActions(u.clone(t)).then((function(e){return XCTAssertTrue(o.actionResults_.length==t.length)}))},validateAfterActionSequence:function(t,e){},renderAfterRunning:function(t,e){var n=this;this.render(this.doc_,"after_actions/"+this.qualifiedSequenceName_);var r={action:o.actionPerformanceData};u.opt(d.Host.actionTesting,(function(t){return t.writeJsonToFile(u.clone(r),"after_actions/"+n.performanceFilename)}))},undoActionSequence:function(t,e){var n,o=f.CorePromise.resolve(null);if(0==!t.length&&(n=u.opt(u.opt(this.doc_,(function(t){return t.controller})),(function(t){return t.undoRedoMgr})))){o=o.then((function(t){return XCTAssertTrue(null!=n.getUndoDescription(),"Undo not found before undoing tested actions"),XCTAssertTrue(null==n.getRedoDescription(),"Redo found before undoing tested actions"),null}));for(var r=this.undoToIndex_,i=u.iter(u.range(0,t.length,!1));!i.done;i.next())o=o.then((function(t){return new f.CorePromise((function(t,e){n.getCurrentTimelineIndex()>r?n.undo((function(){return t(null)})):t(null)}))}));o=o.then((function(t){return XCTAssertTrue(null!=n.getRedoDescription(),"No redo found after undoing tested actions"),null}))}return o},validateAfterUndo:function(t,e){},renderAfterUndo:function(t,e){this.render(this.doc_,"after_undo/"+this.qualifiedSequenceName_)},redoActionSequence:function(t,e){var n,o=f.CorePromise.resolve(null);if(0==!t.length&&(n=u.opt(u.opt(this.doc_,(function(t){return t.controller})),(function(t){return t.undoRedoMgr})))){o=o.then((function(t){return XCTAssertTrue(null!=n.getRedoDescription(),"Redo not found before redoing tested actions"),null}));for(var r=u.iter(u.range(0,t.length,!1));!r.done;r.next())o=o.then((function(t){return new f.CorePromise((function(t,e){return n.redo((function(){return t(null)}))}))}));o=o.then((function(t){return XCTAssertTrue(null==n.getRedoDescription(),"Extra redo found after redoing tested actions"),XCTAssertTrue(null!=n.getUndoDescription(),"No undo found after redoing tested actions"),null}))}return o},validateAfterRedo:function(t,e){},renderAfterRedo:function(t,e){this.render(this.doc_,"after_redo/"+this.qualifiedSequenceName_)},shutdown:function(t,e,n){},allSelectableFormae:function(t,e){var n;return void 0===e&&(e=null),t.firstPage.root.filterWithCallback((function(t){return null!=t.controller&&t.controller.selectable&&(!(n=u.opt(e,(function(e){return e(t)})))&&null==n||n)}))},findLargestForma:function(t){return t.reduce(this.chooseLargerForma,[null,0])[0]},chooseLargerForma:function(t,e){var n,o=(n=u.opt(e.bounds,(function(t){return t.area})))||null!=n?n:0;return o>t[1]?[e,o]:t},test_ValidateActionSequence:function(t,e){},installBrandkit:function(t){(new p.ProfilingColorMap).reset();var e=[],n=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_PRIMARY_ID,[T.TheoColor.SPARK_COLOR_ROLE_PRIMARY],25.5,127.5,255,1),o=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SECONDARY_ID1,[T.TheoColor.SPARK_COLOR_ROLE_SECONDARY],125,128,255,1),r=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SECONDARY_ID2,[T.TheoColor.SPARK_COLOR_ROLE_SECONDARY],25,228,155,1),i=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID0,[T.TheoColor.SPARK_COLOR_ROLE_SHADE0],30,20,40,1),a=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID1,[T.TheoColor.SPARK_COLOR_ROLE_SHADE1],60,40,80,1),s=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID2,[T.TheoColor.SPARK_COLOR_ROLE_SHADE2],100,50,255,1),l=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID3,[T.TheoColor.SPARK_COLOR_ROLE_SHADE3],140,60,120,1),c=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID4,[T.TheoColor.SPARK_COLOR_ROLE_SHADE4],190,80,160,1),f=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID5,[T.TheoColor.SPARK_COLOR_ROLE_SHADE5],230,100,200,1),m=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID6,[T.TheoColor.SPARK_COLOR_ROLE_SHADE6],255,255,255,1),C=T.TheoColor.init_bb45(n);e.push(C),e.push(T.TheoColor.init_bb45(o)),e.push(T.TheoColor.init_bb45(r)),e.push(T.TheoColor.init_bb45(i)),e.push(T.TheoColor.init_bb45(a)),e.push(T.TheoColor.init_bb45(s)),e.push(T.TheoColor.init_bb45(l)),e.push(T.TheoColor.init_bb45(c)),e.push(T.TheoColor.init_bb45(f)),e.push(T.TheoColor.init_bb45(m)),d.Host.fontProvider.getSuggestableFonts(A.ANY_DOCUMENT);var F=u.opt(d.Host.fontProvider,(function(t){return t.descriptorForPostScriptName("Yellowtail",A.ANY_DOCUMENT)})),S=u.opt(d.Host.fontProvider,(function(t){return t.descriptorForPostScriptName("WanderlustShine-Regular ",A.ANY_DOCUMENT)})),v=[],E=new _.MockAuthoringContextFont(this.FAKE_FONT_ELEMENT_HEADLINE_ID,g.TheoFont.SPARK_FONT_ROLE_HEADLINE,F),I=new _.MockAuthoringContextFont(this.FAKE_FONT_ELEMENT_BODY_ID,g.TheoFont.SPARK_FONT_ROLE_BODY,S);v.push(E),v.push(I);var R=new _.MockAuthoringContextLogo(this.FAKE_LOGO_ELEMENT_PRIMARY_ID,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNg/sXzHwAEFgIJ5hSCsQAAAABJRU5ErkJggg==",h.SPARK_LOGO_ROLE_PRIMARY,3,3),P=new _.MockAuthoringContextLogo(this.FAKE_LOGO_ELEMENT_STAMP_ID,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAADCAIAAADZSiLoAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAABZJREFUCJlj+P//PwMDA4REpf7//w8A4D0O8mtAqaUAAAAASUVORK5CYII=",h.SPARK_LOGO_ROLE_POST_STAMP,3,3),D=[];D.push(R),D.push(P);var y=_.MockAuthoringContext.init_44fd("Fake Brandkit","brandkit-for-actions",[n,o,r,i,a,s,l,c,f,m],u.clone(v),u.clone(D));d.Host.brandkitManager.fakeBrandkitForElementsForTesting=y},installSecondBrandkit:function(t){(new p.ProfilingColorMap).reset();var e=[],n=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_PRIMARY_ID_2,[T.TheoColor.SPARK_COLOR_ROLE_PRIMARY],65.5,167.5,222,1),o=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SECONDARY_ID1_2,[T.TheoColor.SPARK_COLOR_ROLE_SECONDARY],25,108,201,1),r=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SECONDARY_ID2_2,[T.TheoColor.SPARK_COLOR_ROLE_SECONDARY],75,208,105,1),i=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID0_2,[T.TheoColor.SPARK_COLOR_ROLE_SHADE0],245,245,245,1),a=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID1_2,[T.TheoColor.SPARK_COLOR_ROLE_SHADE1],230,100,200,1),s=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID2_2,[T.TheoColor.SPARK_COLOR_ROLE_SHADE2],190,80,160,1),l=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID3_2,[T.TheoColor.SPARK_COLOR_ROLE_SHADE3],140,60,120,1),c=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID4_2,[T.TheoColor.SPARK_COLOR_ROLE_SHADE4],100,50,255,1),f=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID5_2,[T.TheoColor.SPARK_COLOR_ROLE_SHADE5],60,40,80,1),m=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID6_2,[T.TheoColor.SPARK_COLOR_ROLE_SHADE6],30,20,40,1),C=T.TheoColor.init_bb45(n);e.push(C),e.push(T.TheoColor.init_bb45(o)),e.push(T.TheoColor.init_bb45(r)),e.push(T.TheoColor.init_bb45(i)),e.push(T.TheoColor.init_bb45(a)),e.push(T.TheoColor.init_bb45(s)),e.push(T.TheoColor.init_bb45(l)),e.push(T.TheoColor.init_bb45(c)),e.push(T.TheoColor.init_bb45(f)),e.push(T.TheoColor.init_bb45(m)),d.Host.fontProvider.getSuggestableFonts(A.ANY_DOCUMENT);var F=u.opt(d.Host.fontProvider,(function(t){return t.descriptorForPostScriptName("Yellowtail",A.ANY_DOCUMENT)})),S=u.opt(d.Host.fontProvider,(function(t){return t.descriptorForPostScriptName("WanderlustShine-Regular ",A.ANY_DOCUMENT)})),v=[],E=new _.MockAuthoringContextFont(this.FAKE_FONT_ELEMENT_HEADLINE_ID_2,g.TheoFont.SPARK_FONT_ROLE_HEADLINE,F),I=new _.MockAuthoringContextFont(this.FAKE_FONT_ELEMENT_BODY_ID_2,g.TheoFont.SPARK_FONT_ROLE_BODY,S);v.push(E),v.push(I);var R=new _.MockAuthoringContextLogo(this.FAKE_LOGO_ELEMENT_PRIMARY_ID_2,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNg/sXzHwAEFgIJ5hSCsQAAAABJRU5ErkJggg==",h.SPARK_LOGO_ROLE_PRIMARY,3,3),P=new _.MockAuthoringContextLogo(this.FAKE_LOGO_ELEMENT_STAMP_ID_2,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAADCAIAAADZSiLoAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAABZJREFUCJlj+P//PwMDA4REpf7//w8A4D0O8mtAqaUAAAAASUVORK5CYII=",h.SPARK_LOGO_ROLE_POST_STAMP,3,3),D=[];D.push(R),D.push(P);var y=_.MockAuthoringContext.init_44fd("Fake Brandkit 2","brandkit-for-actions-2",[n,o,r,i,a,s,l,c,f,m],u.clone(v),u.clone(D));d.Host.brandkitManager.fakeBrandkitForElementsForTesting=y},removeBrandkit:function(t){d.Host.brandkitManager.fakeBrandkitForElementsForTesting=null,(new p.ProfilingColorMap).reset()},urlForAsset:function(t){return u.opt(d.Host.actionTesting,(function(e){return e.urlForAsset(t)}))},imageDataForAsset:function(t){return null!=d.Host.actionTesting?d.Host.actionTesting.imageDataForAsset(t):f.CorePromise.resolve(null)},render:function(t,e){var n,o=this,r=((n=u.opt(d.Host.actionTesting,(function(t){return t.outputFolder})))||null!=n?n:"")+e+"/";u.opt(d.Host.actionTesting,(function(e){return e.render(t,r,o.path_)}))}}}),o),l.TestActionHandler=(r=function(t){this.actionQueue=[],this.executingAction=null,this.dc=t},u.defineClass({name:"TestActionHandler",ctor:r,statics:{_implements:function(t){return"IActionHandler"==t}},props:{canDoAction:function(t){return XCTAssertTrue(t.canDo(this.dc)),t.canDo(this.dc)},finishAction:function(){this.executingAction=null;var t=u.first(this.actionQueue);null!=t&&(this.actionQueue.shift(),this.doActionWithCallback(t[0],t[1]))},doActionWithCallback:function(t,e){var n,o=this;if(null!=this.executingAction)this.actionQueue.push([t,e]);else if(n=this.dc){var r=null;n.undoRedoMgr.beginUserActionAsync(t.getUserAction(n)).then((function(e){return t.execute(n)})).then((function(t){return r=t,n.undoRedoMgr.endUserActionAsync()})).then((function(e){return t.updateSelection(n)})).then((function(t){return e(c.ActionResult.fromPromiseAny(r),null)})).fail((function(t){return e(null,t)})).then((function(t){return o.finishAction()}))}else XCTFail("Document controller destroyed")},doAction:function(t){var e=this;return new f.CorePromise((function(n,o){return e.doActionWithCallback(t,(function(t,e){var r;null!=(r=e)?o(r):n(t)}))}))}}}),r),l.TestState=u.defineEnum("TestState",{kFailed:-1,kCanRun:0,kPrepDoc:1,kPopulate:2,kSetUp:3,kRenderBeforeRunning:4,kRun:5,kValidateAfterRunning:6,kRenderAfterRunning:7,kUndo:8,kValidateAfterUndo:9,kRenderAfterUndo:10,kRedo:11,kValidateAfterRedo:12,kRenderAfterRedo:13,kShutdown:14,kFinished:15}),l.EnabledTestStates=(i=function(){},a={},u.defineClass({name:"EnabledTestStates",ctor:i,statics:{kRunStates:{get:function(){return void 0===a.kRunStates&&(a.kRunStates=i.init_34d9([l.TestState.kCanRun,l.TestState.kPrepDoc,l.TestState.kPopulate,l.TestState.kSetUp,l.TestState.kRun,l.TestState.kValidateAfterRunning,l.TestState.kRenderAfterRunning,l.TestState.kShutdown])),a.kRunStates}},kUndoStates:{get:function(){return void 0===a.kUndoStates&&(a.kUndoStates=i.init_34d9([l.TestState.kUndo,l.TestState.kValidateAfterUndo,l.TestState.kRenderAfterUndo])),a.kUndoStates}},kRedoStates:{get:function(){return void 0===a.kRedoStates&&(a.kRedoStates=i.init_34d9([l.TestState.kRedo,l.TestState.kValidateAfterRedo,l.TestState.kRenderAfterRedo])),a.kRedoStates}},kRenderingStates:{get:function(){return void 0===a.kRenderingStates&&(a.kRenderingStates=i.init_34d9([l.TestState.kRenderBeforeRunning,l.TestState.kRenderAfterRunning,l.TestState.kRenderAfterUndo,l.TestState.kRenderAfterRedo])),a.kRenderingStates}},kValidationStates:{get:function(){return void 0===a.kValidationStates&&(a.kValidationStates=i.init_34d9([l.TestState.kValidateAfterRunning,l.TestState.kValidateAfterUndo,l.TestState.kValidateAfterRedo])),a.kValidationStates}},kAllStates:{get:function(){return void 0===a.kAllStates&&(a.kAllStates=i.init_34d9([l.TestState.kCanRun,l.TestState.kPrepDoc,l.TestState.kPopulate,l.TestState.kSetUp,l.TestState.kRenderBeforeRunning,l.TestState.kRun,l.TestState.kValidateAfterRunning,l.TestState.kRenderAfterRunning,l.TestState.kUndo,l.TestState.kValidateAfterUndo,l.TestState.kRenderAfterUndo,l.TestState.kRedo,l.TestState.kValidateAfterRedo,l.TestState.kRenderAfterRedo,l.TestState.kShutdown])),a.kAllStates}}},props:{init_5d5e:function(t){this.rawValue=t},init_b14a:function(t){this.rawValue=1<<t},init_34d9:function(t){this.rawValue=t.reduce((function(t,e){return t|1<<e}),0)},enabled:function(t){return this.rawValue&1<<t!=0},enable:function(t){return i.init_5d5e(this.rawValue|1<<t)},disable:function(t){return i.init_5d5e(this.rawValue&(i.kAllStates.rawValue^1<<t))},subtracting:function(t){return i.init_5d5e(this.rawValue&(i.kAllStates.rawValue^t.rawValue))}}}),i),l.ValidationState=(s=function(){var t,e,n;this.state_=l.TestState.kCanRun,this.enabledStates_=l.EnabledTestStates.kAllStates,((t=u.opt(d.Host.actionTesting,(function(t){return t.renderingEnabled})))||null!=t)&&t||(this.enabledStates_=this.enabledStates_.subtracting(l.EnabledTestStates.kRenderingStates)),((e=u.opt(d.Host.actionTesting,(function(t){return t.undoEnabled})))||null!=e)&&e||(this.enabledStates_=this.enabledStates_.subtracting(l.EnabledTestStates.kUndoStates),this.enabledStates_=this.enabledStates_.subtracting(l.EnabledTestStates.kRedoStates)),((n=u.opt(d.Host.actionTesting,(function(t){return t.validationEnabled})))||null!=n)&&n||(this.enabledStates_=this.enabledStates_.subtracting(l.EnabledTestStates.kValidationStates))},u.defineClass({name:"ValidationState",ctor:s,props:{next:function(){var t,e,n=this.state_;for(this.state_=(t=l.TestState.toCaseValue(this.state_+1))||null!=t?t:l.TestState.kFailed;!this.enabledStates_.enabled(this.state_)&&this.hasNext;)this.state_=(e=l.TestState.toCaseValue(this.state_+1))||null!=e?e:l.TestState.kFailed;return n},hasNext:{get:function(){return this.state_!=l.TestState.kFailed&&this.state_!=l.TestState.kFinished}},fail:function(){this.state_=l.TestState.kFailed},finish:function(){this.hasNext&&(this.state_=l.TestState.kFinished)}}}),s)},eLhV:function(t,e,n){var o,r,i,a,s=e,l=n("oAGj"),u=n("Tq01"),c=n("4mEG"),h=n("c9Jm"),f=n("yGNn"),m=n("FNB+"),d=n("iCxV"),A=n("3lr5"),_=n("cRpU"),p=n("a9ow"),T=n("enh0"),g=n("VJ9E"),C=n("8t9B"),F=n("uUew");s.SetHighlightMethodTest=(o=function t(){this.actionSequence_SetHighlightMethod=[function(){return new c.AddTextContentAction(t.initialText_)}],this.testDoc_=null,this.testPage_=null,this.testFormaID_=null,this.lockupFont_=null,h.ActionTestBase.call(this)},l.defineClass({name:"SetHighlightMethodTest",ctor:o,superName:"ActionTestBase",statics:{initialText_:"Some text that is long enough to span lines",testFont_:"Bellfort",getTheoFont:function(t){var e=g.TheoFont.init_9e5c(d.Host.fontProvider.getIncludedFonts(A.ANY_DOCUMENT).find((function(e){return e.postScriptName==t})));return XCTAssertEqual(e.fontData.postScriptName,t),e}},props:{textForma:{get:function(){return l.first(l.opt(l.as(this.getActionResult(0),u.FormaActionResult),(function(t){return t.formae})))}},populateActionSequence:function(t,e,n){var r=this;return f.CorePromise.resolve(t.concat([function(){return r.lockupFont_=l.opt(l.opt(l.opt(l.as(l.opt(r.textForma,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.lockupStyle})),(function(t){return t.font})),(function(t){return t.fontData.postScriptName})),l.opt(l.opt(r.testDoc_,(function(t){return t.controller})),(function(t){return t.selection.replaceSelection(r.textForma)})),new _.EnterCharStyleModeAction(r.textForma)},function(){return new _.SetHighlightMethodAction(C.HighlightMethod.EvenRows,!0)},function(){return new _.SetFontAction(o.getTheoFont(o.testFont_))},function(){return new _.ExitCharStyleModeAction(r.textForma)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.testPage_=n.firstPage},validateAfterActionSequence:function(t,e){var n=this;this.testFormaID_=l.opt(this.textForma,(function(t){return t.formaID})),XCTAssertNotNil(this.testDoc_),XCTAssertNotNil(this.testPage_),XCTAssertNotNil(this.testFormaID_);var r=l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)}));XCTAssertTrue(r===this.textForma),XCTAssertEqual(l.opt(l.opt(r,(function(t){return t.controller})),(function(t){return t.kind})),C.TypeLockupController.KIND),XCTAssertEqual(l.opt(l.opt(l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.lockupStyle})),(function(t){return t.font})),(function(t){return t.fontData.postScriptName})),this.lockupFont_),r.visit(m.FormaTraversal.PreOrder,(function(t,e,n){var r;return(r=l.as(t,T.TextForma))&&r.rowIndex%2==0&&(XCTAssertNotNil(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0)),XCTAssertNotNil(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute)),XCTAssertEqual(l.opt(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute),(function(t){return t.value.postScriptName})),o.testFont_)),!1}))},validateAfterUndo:function(t,e){var n=this;XCTAssertEqual(l.opt(l.opt(l.opt(l.as(l.opt(this.textForma,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.lockupStyle})),(function(t){return t.font})),(function(t){return t.fontData.postScriptName})),this.lockupFont_),XCTAssertNil(l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)})))},validateAfterRedo:function(t,e){var n=this,r=l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)}));XCTAssertNotNil(r),XCTAssertEqual(l.opt(l.opt(r,(function(t){return t.controller})),(function(t){return t.kind})),C.TypeLockupController.KIND),XCTAssertEqual(l.opt(l.opt(l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.lockupStyle})),(function(t){return t.font})),(function(t){return t.fontData.postScriptName})),this.lockupFont_),r.visit(m.FormaTraversal.PreOrder,(function(t,e,n){var r;return(r=l.as(t,T.TextForma))&&r.rowIndex%2==0&&(XCTAssertNotNil(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0)),XCTAssertNotNil(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute)),XCTAssertEqual(l.opt(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute),(function(t){return t.value.postScriptName})),o.testFont_)),!1}))}}}),o),s.ApplyCharStyleTest=(r=function t(){this.actionSequence_ApplyCharStyle=[function(){return new c.AddTextContentAction(t.initialText_)}],this.testDoc_=null,this.testPage_=null,this.testFormaID_=null,this.oldRanges_=null,this.lastChildForma_=null,h.ActionTestBase.call(this)},l.defineClass({name:"ApplyCharStyleTest",ctor:r,superName:"ActionTestBase",statics:{initialText_:"0 1 2 3 4"},props:{textForma:{get:function(){return l.first(l.opt(l.as(this.getActionResult(0),u.FormaActionResult),(function(t){return t.formae})))}},populateActionSequence:function(t,e,n){var o=this;return f.CorePromise.resolve(t.concat([function(){return o.oldRanges_=l.clone(l.opt(l.as(l.opt(o.textForma,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges}))||[]),l.opt(l.opt(o.testDoc_,(function(t){return t.controller})),(function(t){return t.selection.replaceSelection(o.textForma)})),o.textForma.visit(m.FormaTraversal.PreOrder,(function(t,e,n){var r;return(r=l.as(t,T.TextForma))&&(o.lastChildForma_=r),!1})),new _.EnterCharStyleModeAction(o.textForma)},function(){return new _.ApplyCharStyleAction(o.lastChildForma_,C.TypeLockupController.HIGHLIGHT_STYLE,C.CharStyleApplyMode.Apply,new F.TextRange(0,0))},function(){return new _.ExitCharStyleModeAction(o.textForma)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.testPage_=n.firstPage},validateAfterActionSequence:function(t,e){var n=this;this.testFormaID_=l.opt(this.textForma,(function(t){return t.formaID})),XCTAssertNotNil(this.testDoc_),XCTAssertNotNil(this.testPage_),XCTAssertNotNil(this.testFormaID_);var o,r=l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)}));XCTAssertTrue(r===this.textForma),XCTAssertEqual(l.opt(l.opt(r,(function(t){return t.controller})),(function(t){return t.kind})),C.TypeLockupController.KIND),XCTAssertNotNil(l.clone(l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges})))),(o=l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges})))&&(XCTAssertEqual(l.last(o).start,this.lastChildForma_.rangeInLockup.start),XCTAssertEqual(l.last(o).end,this.lastChildForma_.rangeInLockup.end))},validateAfterUndo:function(t,e){var n=this;XCTAssertEqual(l.clone(l.opt(l.as(l.opt(this.textForma,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges}))),l.clone(this.oldRanges_)),XCTAssertNil(l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)})))},validateAfterRedo:function(t,e){var n,o=this,r=l.opt(this.testPage_,(function(t){return t.formaByID(o.testFormaID_)}));XCTAssertNotNil(r),XCTAssertEqual(l.opt(l.opt(r,(function(t){return t.controller})),(function(t){return t.kind})),C.TypeLockupController.KIND),XCTAssertNotNil(l.clone(l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges})))),(n=l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges})))&&(XCTAssertEqual(l.last(n).start,this.lastChildForma_.rangeInLockup.start),XCTAssertEqual(l.last(n).end,this.lastChildForma_.rangeInLockup.end))}}}),r),s.ApplyCharStyleWithoutUITest=(i=function t(){this.actionSequence_ApplyCharStyle=[function(){return new c.AddTextContentAction(t.initialText_)}],this.testDoc_=null,this.testPage_=null,this.testFormaID_=null,this.oldRanges_=null,this.lastChildForma_=null,h.ActionTestBase.call(this)},l.defineClass({name:"ApplyCharStyleWithoutUITest",ctor:i,superName:"ActionTestBase",statics:{initialText_:"0 1 2 3 4"},props:{textForma:{get:function(){return l.first(l.opt(l.as(this.getActionResult(0),u.FormaActionResult),(function(t){return t.formae})))}},populateActionSequence:function(t,e,n){var o=this;return f.CorePromise.resolve(t.concat([function(){return o.oldRanges_=l.clone(l.opt(l.as(l.opt(o.textForma,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges}))||[]),l.opt(l.opt(o.testDoc_,(function(t){return t.controller})),(function(t){return t.selection.replaceSelection(o.textForma)})),o.textForma.visit(m.FormaTraversal.PreOrder,(function(t,e,n){var r;return(r=l.as(t,T.TextForma))&&(o.lastChildForma_=r),!1})),new _.ApplyCharStyleWithoutUIAction(o.lastChildForma_,C.TypeLockupController.HIGHLIGHT_STYLE,C.CharStyleApplyMode.Apply,new F.TextRange(0,0))}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.testPage_=n.firstPage},validateAfterActionSequence:function(t,e){var n=this;this.testFormaID_=l.opt(this.textForma,(function(t){return t.formaID})),XCTAssertNotNil(this.testDoc_),XCTAssertNotNil(this.testPage_),XCTAssertNotNil(this.testFormaID_);var o,r=l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)}));XCTAssertTrue(r===this.textForma),XCTAssertEqual(l.opt(l.opt(r,(function(t){return t.controller})),(function(t){return t.kind})),C.TypeLockupController.KIND),XCTAssertNotNil(l.clone(l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges})))),(o=l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges})))&&(XCTAssertEqual(l.last(o).start,this.lastChildForma_.rangeInLockup.start),XCTAssertEqual(l.last(o).end,this.lastChildForma_.rangeInLockup.end))},validateAfterUndo:function(t,e){var n=this;XCTAssertEqual(l.clone(l.opt(l.as(l.opt(this.textForma,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges}))),l.clone(this.oldRanges_)),XCTAssertNil(l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)})))},validateAfterRedo:function(t,e){var n,o=this,r=l.opt(this.testPage_,(function(t){return t.formaByID(o.testFormaID_)}));XCTAssertNotNil(r),XCTAssertEqual(l.opt(l.opt(r,(function(t){return t.controller})),(function(t){return t.kind})),C.TypeLockupController.KIND),XCTAssertNotNil(l.clone(l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges})))),(n=l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges})))&&(XCTAssertEqual(l.last(n).start,this.lastChildForma_.rangeInLockup.start),XCTAssertEqual(l.last(n).end,this.lastChildForma_.rangeInLockup.end))}}}),i),s.UpdateCharStyleRangeTest=(a=function t(){this.actionSequence_UpdateCharStyleRange=[function(){return new c.AddTextContentAction(t.initialText_)}],this.testDoc_=null,this.testPage_=null,this.testFormaID_=null,this.lockupFont_=null,h.ActionTestBase.call(this)},l.defineClass({name:"UpdateCharStyleRangeTest",ctor:a,superName:"ActionTestBase",statics:{initialText_:"1 2 3 4 5",newText_:"one two three four five",testFont_:"Bellfort",getTheoFont:function(t){var e=g.TheoFont.init_9e5c(d.Host.fontProvider.getIncludedFonts(A.ANY_DOCUMENT).find((function(e){return e.postScriptName==t})));return XCTAssertEqual(e.fontData.postScriptName,t),e}},props:{textForma:{get:function(){return l.first(l.opt(l.as(this.getActionResult(0),u.FormaActionResult),(function(t){return t.formae})))}},populateActionSequence:function(t,e,n){var o=this;return f.CorePromise.resolve(t.concat([function(){return o.lockupFont_=l.opt(l.opt(l.opt(l.as(l.opt(o.textForma,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.lockupStyle})),(function(t){return t.font})),(function(t){return t.fontData.postScriptName})),l.opt(l.opt(o.testDoc_,(function(t){return t.controller})),(function(t){return t.selection.replaceSelection(o.textForma)})),new _.EnterCharStyleModeAction(o.textForma)},function(){return new _.UpdateCharStyleRangeAction(o.textForma,new F.TextRange(0,1),3)},function(){return new _.SetTextAction(a.newText_,o.textForma)},function(){return new _.SetFontAction(a.getTheoFont(a.testFont_))},function(){return new _.ExitCharStyleModeAction(o.textForma)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.testPage_=n.firstPage},validateAfterActionSequence:function(t,e){var n=this;this.testFormaID_=l.opt(this.textForma,(function(t){return t.formaID})),XCTAssertNotNil(this.testDoc_),XCTAssertNotNil(this.testPage_),XCTAssertNotNil(this.testFormaID_);var o=l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)}));XCTAssertTrue(o===this.textForma),XCTAssertEqual(l.opt(l.opt(o,(function(t){return t.controller})),(function(t){return t.kind})),C.TypeLockupController.KIND),XCTAssertEqual(l.opt(l.opt(l.opt(l.as(l.opt(o,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.lockupStyle})),(function(t){return t.font})),(function(t){return t.fontData.postScriptName})),this.lockupFont_),o.visit(m.FormaTraversal.PreOrder,(function(t,e,o){var r;return(r=l.as(t,T.TextForma))&&(0==r.rangeInLockup.start?(XCTAssertNotNil(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0)),XCTAssertNotNil(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute)),XCTAssertEqual(l.opt(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute),(function(t){return t.value.postScriptName})),a.testFont_)):(XCTAssertNotNil(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0)),XCTAssertNotNil(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute)),XCTAssertEqual(l.opt(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute),(function(t){return t.value.postScriptName})),n.lockupFont_))),!1}))},validateAfterUndo:function(t,e){var n=this;XCTAssertEqual(l.opt(l.opt(l.opt(l.as(l.opt(this.textForma,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.lockupStyle})),(function(t){return t.font})),(function(t){return t.fontData.postScriptName})),this.lockupFont_),XCTAssertNil(l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)})))},validateAfterRedo:function(t,e){var n=this,o=l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)}));XCTAssertNotNil(o),XCTAssertEqual(l.opt(l.opt(o,(function(t){return t.controller})),(function(t){return t.kind})),C.TypeLockupController.KIND),XCTAssertEqual(l.opt(l.opt(l.opt(l.as(l.opt(o,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.lockupStyle})),(function(t){return t.font})),(function(t){return t.fontData.postScriptName})),this.lockupFont_),o.visit(m.FormaTraversal.PreOrder,(function(t,e,o){var r;return(r=l.as(t,T.TextForma))&&(0==r.rangeInLockup.start?(XCTAssertNotNil(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0)),XCTAssertNotNil(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute)),XCTAssertEqual(l.opt(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute),(function(t){return t.value.postScriptName})),a.testFont_)):(XCTAssertNotNil(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0)),XCTAssertNotNil(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute)),XCTAssertEqual(l.opt(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute),(function(t){return t.value.postScriptName})),n.lockupFont_))),!1}))}}}),a)},jE7t:function(t,e,n){var o,r=e,i=n("oAGj"),a=n("c9Jm"),s=n("o+xL");r.RotateTest=(o=function(){this.actionSequence_Rotate=[function(){return new s.RotateAction(Math.PI/2,null,null,!1)}],this.formaeToRotate_=[],this.formaeToTest_=[],this.initialTransforms_=[],a.ActionTestBase.call(this)},i.defineClass({name:"RotateTest",ctor:o,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o;this.formaeToRotate_=i.clone(this.allSelectableFormae(n,(function(t){return!(!(o=i.opt(t.controller,(function(t){return t.rotateable})))&&null==o)&&o}))),this.initialTransforms_=this.formaeToTest_.map((function(t){return t.placement}),this),n.controller.selection.replaceSelectionWithFormae(i.clone(this.formaeToRotate_))},validateAfterActionSequence:function(t,e){for(var n=i.iter(i.range(0,this.formaeToTest_.length,!1));!n.done;n.next()){var o=n.value,r=this.initialTransforms_[o].rotate(0,1);XCTAssertEqual(this.formaeToTest_[o].placement.transformValues.rotSine,r.transformValues.rotSine,.001),XCTAssertEqual(this.formaeToTest_[o].placement.transformValues.rotCosine,r.transformValues.rotCosine,.001)}},validateAfterUndo:function(t,e){for(var n=i.iter(i.range(0,this.formaeToTest_.length,!1));!n.done;n.next()){var o=n.value;XCTAssertEqual(this.formaeToTest_[o].placement.transformValues.rotSine,this.initialTransforms_[o].transformValues.rotSine),XCTAssertEqual(this.formaeToTest_[o].placement.transformValues.rotCosine,this.initialTransforms_[o].transformValues.rotCosine)}},validateAfterRedo:function(t,e){for(var n=i.iter(i.range(0,this.formaeToTest_.length,!1));!n.done;n.next()){var o=n.value,r=this.initialTransforms_[o].rotate(0,1);XCTAssertEqual(this.formaeToTest_[o].placement.transformValues.rotSine,r.transformValues.rotSine,.001),XCTAssertEqual(this.formaeToTest_[o].placement.transformValues.rotCosine,r.transformValues.rotCosine,.001)}},tearDown:function(){this.formaeToRotate_=[],this.formaeToTest_=[],a.ActionTestBase.prototype.tearDown.call(this)}}}),o)},mSLX:function(t,e,n){var o,r,i,a,s=e,l=n("oAGj"),u=n("Tq01"),c=n("4mEG"),h=n("c9Jm"),f=n("kYI4"),m=n("70fJ"),d=n("yGNn"),A=n("ascj"),_=n("rsKm"),p=n("FNB+"),T=n("x6FH"),g=n("iCxV"),C=n("VkKB"),F=n("JO5d"),S=n("Zifs"),v=n("umUn"),E=n("8t9B");s.ApplyColorIconTest=(o=function t(){this.actionSequence_ApplyColorIcon=[function(){return new c.AddIconContentAction(t.originalIconURL_,C.MediaMetadata.init_36a2(),null)}],this.testDoc_=null,this.testPage_=null,this.testColor_=null,this.oldIconColor_=null,h.ActionTestBase.call(this)},r={},l.defineClass({name:"ApplyColorIconTest",ctor:o,superName:"ActionTestBase",statics:{originalIconURL_:"",purple_:{get:function(){return void 0===r.purple_&&(r.purple_=new S.SolidColor(.4,.2,.6,1)),r.purple_}}},props:{iconForma:{get:function(){return l.first(l.opt(l.as(this.getActionResult(0),u.FormaActionResult),(function(t){return t.formae})))}},populateActionSequence:function(t,e,n){var r=this;return d.CorePromise.resolve(t.concat([function(){return r.oldIconColor_=l.opt(l.opt(r.iconForma,(function(t){return t.style})),(function(t){return t.colors.theoColor(A.ColorRole.FieldPrimary)})),r.testColor_=v.TheoColor.init_5344(o.purple_),new m.ApplyColorAction([r.iconForma],[r.testColor_],!1,0)}]))},setUpActionSequence:function(t,e,n){var r;this.testDoc_=n,this.testPage_=n.firstPage,null!=(r=this.urlForAsset("dog1.svg"))&&(o.originalIconURL_=r)},validateAfterActionSequence:function(t,e){var n=l.opt(l.opt(this.iconForma,(function(t){return t.style})),(function(t){return t.colors.theoColor(A.ColorRole.FieldPrimary)}));XCTAssertEqual(n,this.testColor_)},validateAfterUndo:function(t,e){var n=l.opt(l.opt(this.iconForma,(function(t){return t.style})),(function(t){return t.colors.theoColor(A.ColorRole.FieldPrimary)}));XCTAssertEqual(n,this.oldIconColor_)},validateAfterRedo:function(t,e){var n=l.opt(l.opt(this.iconForma,(function(t){return t.style})),(function(t){return t.colors.theoColor(A.ColorRole.FieldPrimary)}));XCTAssertEqual(n,this.testColor_)}}}),o),s.ApplyColorRootTest=function(){var t=function(){this.actionSequence_ApplyColorRoot=[],this.testDoc_=null,this.testPage_=null,this.rootForma_=null,this.testColor_=null,this.oldColor_=null,h.ActionTestBase.call(this)},e={};return l.defineClass({name:"ApplyColorRootTest",ctor:t,superName:"ActionTestBase",statics:{purple_:{get:function(){return void 0===e.purple_&&(e.purple_=new S.SolidColor(.4,.2,.6,1)),e.purple_}}},props:{populateActionSequence:function(e,n,o){var r=this;return d.CorePromise.resolve(e.concat([function(){return r.oldColor_=l.opt(r.rootForma_,(function(t){return t.style.colors.theoColor(A.ColorRole.FieldPrimary)})),r.testColor_=v.TheoColor.init_5344(t.purple_),new T.EnterGridLayoutModeAction},function(){return new T.SetGridParametersAction(NaN,8)},function(){return new m.ApplyColorAction([r.rootForma_],[r.testColor_],!1,0)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.testPage_=n.firstPage,this.rootForma_=l.opt(this.testPage_,(function(t){return t.root}))},validateAfterActionSequence:function(t,e){var n=l.opt(this.rootForma_,(function(t){return t.style.colors.theoColor(A.ColorRole.FieldPrimary)}));XCTAssertEqual(n,this.testColor_)},validateAfterUndo:function(t,e){var n=l.opt(this.rootForma_,(function(t){return t.style.colors.theoColor(A.ColorRole.FieldPrimary)}));XCTAssertEqual(n,this.oldColor_)},validateAfterRedo:function(t,e){var n=l.opt(this.rootForma_,(function(t){return t.style.colors.theoColor(A.ColorRole.FieldPrimary)}));XCTAssertEqual(n,this.testColor_)}}}),t}(),s.ApplyColorThemeTest=(i=function(){this.actionSequence_ApplyColorTheme=[],this.testDoc_=null,this.page_=null,this.themeColors_=[],h.ActionTestBase.call(this)},l.defineClass({name:"ApplyColorThemeTest",ctor:i,superName:"ActionTestBase",props:{verifyColors:function(t){for(var e=0,n=l.clone(this.page_.colorLibraryController.getTheoColorsUsedInDocument()),o=l.iter(n);!o.done;o.next()){var r=o.value;(r.isBrandkitPrimaryColor()||r.isBrandkitSecondaryColor()||r.isBrandkitShade())&&(e+=1)}t?XCTAssertTrue(e>0):XCTAssertEqual(e,0)},populateActionSequence:function(t,e,n){var o=this;this.installBrandkit(n);for(var r=g.Host.brandkitManager.fakeBrandkitForElementsForTesting,i=l.clone(f.BrandingFacade.getBrandkitColorsForUI(r,null)),a=l.iter(i);!a.done;a.next()){var s=a.value[0];this.themeColors_.push(s)}return d.CorePromise.resolve(t.concat([function(){return new _.ApplyColorThemeAction(l.clone(o.themeColors_),"brandkit-for-actions",o.page_,!0)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.page_=n.firstPage},validateAfterActionSequence:function(t,e){this.verifyColors(!0)},validateAfterUndo:function(t,e){this.verifyColors(!1)},validateAfterRedo:function(t,e){this.verifyColors(!0)},shutdown:function(t,e,n){h.ActionTestBase.prototype.shutdown.call(this,l.clone(t),e,n),this.removeBrandkit(n)}}}),i),s.ApplyColorThemeWithShuffleTest=(a=function(){this.actionSequence_ApplyColorThemeWithShuffle=[],this.testDoc_=null,this.page_=null,this.themeColors_=[],this.colorDictionary_={},h.ActionTestBase.call(this)},l.defineClass({name:"ApplyColorThemeWithShuffleTest",ctor:a,superName:"ActionTestBase",props:{gatherColors:function(){var t={},e=l.opt(this.page_,(function(t){return t.root}));return l.opt(e,(function(e){return e.visitAll(p.FormaTraversal.PreOrder,(function(e){var n;if((n=l.as(e,p.Forma))&&null!=n.style.colors.colorID(A.ColorRole.FieldPrimary)){var o,r=null;l.as(n.controller,E.TypeLockupController)&&(r=n.style.colors.theoColor(A.ColorRole.FieldPrimary)),l.as(n.controller,F.ShapeController)&&(r=n.style.colors.theoColor(A.ColorRole.FieldPrimary)),null!=(o=l.opt(r,(function(t){return t.asString})))&&(t[n.formaID]=o)}}))})),t},gatherSparkColors:function(){var t={},e=l.opt(this.page_,(function(t){return t.root}));return l.opt(e,(function(e){return e.visitAll(p.FormaTraversal.PreOrder,(function(e){var n,o;(n=l.as(e,p.Forma))&&null!=n.style.colors.colorID(A.ColorRole.FieldPrimary)&&null!=l.opt(n.style.colors.theoColor(A.ColorRole.FieldPrimary),(function(t){return t.sparkElementID}))&&null!=(o=l.opt(n.style.colors.theoColor(A.ColorRole.FieldPrimary),(function(t){return t.asString})))&&(t[n.formaID]=o)}))})),t},verifyShuffledColors:function(t,e){for(var n=0,o=l.iter(t);!o.done;o.next()){var r,i=o.key,a=o.value;null!=(r=e[i])&&a!=r&&(n+=1)}l.toDouble(n)/l.toDouble(l.count(t))<=.15&&g.Host.logging.info("verifyShuffledColors diffCount "+n+" and count "+l.count(t)),XCTAssertTrue(l.toDouble(n)/l.toDouble(l.count(t))>.15)},populateActionSequence:function(t,e,n){var o=this;this.installBrandkit(n);for(var r=g.Host.brandkitManager.fakeBrandkitForElementsForTesting,i=l.iter(r.colors);!i.done;i.next()){var a=i.value;this.themeColors_.push(v.TheoColor.init_bb45(a))}return d.CorePromise.resolve(t.concat([function(){return new _.ApplyColorThemeAction(l.clone(o.themeColors_),"brandkit-for-actions",o.page_,!0)},function(){return o.colorDictionary_=l.clone(o.gatherColors()),new _.ApplyColorThemeAction(l.clone(o.themeColors_),"brandkit-for-actions",o.page_,!0)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.page_=n.firstPage},validateAfterActionSequence:function(t,e){var n=l.clone(this.gatherColors());this.verifyShuffledColors(l.clone(this.colorDictionary_),l.clone(n))},validateAfterUndo:function(t,e){var n=l.clone(this.gatherSparkColors());XCTAssertEqual(l.count(n),0)},validateAfterRedo:function(t,e){var n=l.clone(this.gatherColors());this.verifyShuffledColors(l.clone(this.colorDictionary_),l.clone(n))},shutdown:function(t,e,n){h.ActionTestBase.prototype.shutdown.call(this,l.clone(t),e,n),this.removeBrandkit(n)}}}),a),s.ModifyColorThemeTest=function(){var t=function t(){this.actionSequence_ModifyColorTheme=[function(){return new c.AddIconContentAction(t.originalIconURL_,C.MediaMetadata.init_36a2(),null)}],this.testDoc_=null,this.testPage_=null,this.testColor_=null,this.oldIconColor_=null,this.iconColorKey_="",this.themeColors_=[],h.ActionTestBase.call(this)},e={};return l.defineClass({name:"ModifyColorThemeTest",ctor:t,superName:"ActionTestBase",statics:{originalIconURL_:"",darkBlue_:{get:function(){return void 0===e.darkBlue_&&(e.darkBlue_=new S.SolidColor(1/255,1/255,164/255,1)),e.darkBlue_}}},props:{iconForma:{get:function(){return l.first(l.opt(l.as(this.getActionResult(0),u.FormaActionResult),(function(t){return t.formae})))}},populateActionSequence:function(e,n,o){var r=this;this.installBrandkit(o);for(var i=g.Host.brandkitManager.fakeBrandkitForElementsForTesting,a=l.iter(i.colors);!a.done;a.next()){var s=a.value;this.themeColors_.push(v.TheoColor.init_bb45(s))}return d.CorePromise.resolve(e.concat([function(){return new _.ApplyColorThemeAction(l.clone(r.themeColors_),"brandkit-for-actions",r.testPage_,!1)},function(){return r.oldIconColor_=l.opt(l.opt(r.iconForma,(function(t){return t.style})),(function(t){return t.colors.theoColor(A.ColorRole.FieldPrimary)})),r.iconColorKey_=l.opt(l.opt(r.iconForma,(function(t){return t.style})),(function(t){return t.colors.colorID(A.ColorRole.FieldPrimary)})),r.testColor_=v.TheoColor.init_5344(t.darkBlue_),new _.ModifyColorThemeAction(r.testColor_,r.iconColorKey_,r.testPage_)}]))},setUpActionSequence:function(e,n,o){var r;this.testDoc_=o,this.testPage_=o.firstPage,null!=(r=this.urlForAsset("dog1.svg"))&&(t.originalIconURL_=r)},validateAfterActionSequence:function(t,e){var n=l.opt(l.opt(this.iconForma,(function(t){return t.style})),(function(t){return t.colors.theoColor(A.ColorRole.FieldPrimary)}));XCTAssertEqual(n,this.testColor_);var o=l.opt(l.opt(this.iconForma,(function(t){return t.style})),(function(t){return t.colors.colorID(A.ColorRole.FieldPrimary)}));XCTAssertEqual(o,this.iconColorKey_)},validateAfterUndo:function(t,e){XCTAssertEqual(l.opt(this.iconForma,(function(t){return t.parent})),null)},validateAfterRedo:function(t,e){var n=l.opt(l.opt(this.iconForma,(function(t){return t.style})),(function(t){return t.colors.theoColor(A.ColorRole.FieldPrimary)}));XCTAssertEqual(n,this.testColor_);var o=l.opt(l.opt(this.iconForma,(function(t){return t.style})),(function(t){return t.colors.colorID(A.ColorRole.FieldPrimary)}));XCTAssertEqual(o,this.iconColorKey_)},shutdown:function(t,e,n){h.ActionTestBase.prototype.shutdown.call(this,l.clone(t),e,n),this.removeBrandkit(n)}}}),t}()},md5b:function(t,e,n){var o,r,i,a=e,s=n("oAGj"),l=n("c9Jm"),u=n("yGNn"),c=n("pnSN"),h=n("H1Z2"),f=n("tGKA"),m=n("8t9B"),d=n("oKlP"),A=n("sIWg");a.MoveHandleTest=(o=function(){this.actionSequence_MoveHandle=[],this.formaToMove_=null,this.delta_=new d.TheoPoint(5,-5),this.initialBounds_=A.TheoRect.Zero,this.postMoveBounds_=A.TheoRect.Zero,l.ActionTestBase.call(this)},s.defineClass({name:"MoveHandleTest",ctor:o,superName:"ActionTestBase",props:{findFormaToMove:function(t){return s.last(this.allSelectableFormae(t,(function(t){return t instanceof c.GroupForma&&t.controller.kind==m.TypeLockupController.KIND})))},canRunActionSequence:function(t,e,n){return null!=this.findFormaToMove(n)},populateActionSequence:function(t,e,n){var o=this;return this.formaToMove_=this.findFormaToMove(n),XCTAssertNotNil(this.formaToMove_),null!=this.formaToMove_&&(n.controller.selection.replaceSelection(this.formaToMove_),this.initialBounds_=this.formaToMove_.finalFrame),u.CorePromise.resolve([function(){return new h.MoveHandleAction(o.formaToMove_,o.delta_,o.initialBounds_.center,1)}])},validateAfterActionSequence:function(t,e){this.postMoveBounds_=this.formaToMove_.finalFrame,XCTAssertFalse(this.postMoveBounds_.equal(this.initialBounds_))},validateAfterUndo:function(t,e){var n=this.formaToMove_.finalFrame;XCTAssertTrue(this.initialBounds_.equal(n))},validateAfterRedo:function(t,e){var n=this.formaToMove_.finalFrame;XCTAssertTrue(n.equal(this.postMoveBounds_))}}}),o),a.ResizeHandleTest=(r=function(){this.actionSequence_ResizeHandleTracking=[],this.actionSequence_ResizeHandleLeading=[],this.actionSequence_ResizeHandleCorner=[],this.formaToResize_=null,this.trackingSpot_=new d.TheoPoint(1,.5),this.leadingSpot_=new d.TheoPoint(.5,1),this.cornerSpot_=new d.TheoPoint(1,1),this.initialBounds_=A.TheoRect.Zero,this.postResizeBounds_=A.TheoRect.Zero,l.ActionTestBase.call(this)},s.defineClass({name:"ResizeHandleTest",ctor:r,superName:"ActionTestBase",props:{findFormaToResize:function(t){return s.last(this.allSelectableFormae(t,(function(t){return t instanceof c.GroupForma&&t.controller.kind==m.TypeLockupController.KIND})))},canRunActionSequence:function(t,e,n){return null!=this.findFormaToResize(n)},populateActionSequence:function(t,e,n){var o=this;this.formaToResize_=this.findFormaToResize(n),XCTAssertNotNil(this.formaToResize_),null!=this.formaToResize_&&(n.controller.selection.replaceSelection(this.formaToResize_),this.initialBounds_=this.formaToResize_.finalFrame);var r=this.cornerSpot_,i=new A.TheoRect(this.initialBounds_.minX,this.initialBounds_.minY,this.initialBounds_.minX+100,this.initialBounds_.minY+100);return"actionSequence_ResizeHandleTracking"==e?r=this.trackingSpot_:"actionSequence_ResizeHandleLeading"==e&&(r=this.leadingSpot_),u.CorePromise.resolve([function(){return new h.ResizeHandleAction(o.formaToResize_,r,d.TheoPoint.ZERO,i)}])},validateAfterActionSequence:function(t,e){this.postResizeBounds_=this.formaToResize_.finalFrame,XCTAssertTrue(Math.abs(this.postResizeBounds_.width-100)<5||Math.abs(this.postResizeBounds_.height-100)<5)},validateAfterUndo:function(t,e){var n=this.formaToResize_.finalFrame;XCTAssertTrue(this.initialBounds_.equal(n))},validateAfterRedo:function(t,e){var n=this.formaToResize_.finalFrame;XCTAssertTrue(n.equal(this.postResizeBounds_))}}}),r),a.RotateHandleTest=(i=function(){this.actionSequence_RotateHandle=[],this.formaToRotate_=null,this.delta_=new d.TheoPoint(5,-5),this.initialPlacement_=f.Matrix2D.Identity,this.postRotatePlacement_=f.Matrix2D.Identity,l.ActionTestBase.call(this)},s.defineClass({name:"RotateHandleTest",ctor:i,superName:"ActionTestBase",props:{findFormaToRotate:function(t){return s.last(this.allSelectableFormae(t,(function(t){return t instanceof c.GroupForma&&t.controller.kind==m.TypeLockupController.KIND&&1==t.placement.transformValues.rotCosine})))},canRunActionSequence:function(t,e,n){return null!=this.findFormaToRotate(n)},populateActionSequence:function(t,e,n){var o=this;this.formaToRotate_=this.findFormaToRotate(n),XCTAssertNotNil(this.formaToRotate_);var r=d.TheoPoint.ZERO;return null!=this.formaToRotate_&&(n.controller.selection.replaceSelection(this.formaToRotate_),this.initialPlacement_=this.formaToRotate_.placement,r=this.formaToRotate_.frame.center),u.CorePromise.resolve([function(){return new h.RotateHandleAction(o.formaToRotate_,Math.PI/4,r,o.initialPlacement_)}])},validateAfterActionSequence:function(t,e){this.postRotatePlacement_=this.formaToRotate_.placement,XCTAssertTrue(Math.abs(this.postRotatePlacement_.transformValues.rotCosine-.707)<.01),XCTAssertTrue(Math.abs(this.postRotatePlacement_.transformValues.rotSine-.707)<.01)},validateAfterUndo:function(t,e){var n=this.formaToRotate_.placement;XCTAssertTrue(this.initialPlacement_.equal(n))},validateAfterRedo:function(t,e){var n=this.formaToRotate_.placement;XCTAssertTrue(n.equal(this.postRotatePlacement_))}}}),i)},oTkQ:function(t,e,n){var o,r=e,i=n("oAGj"),a=n("c9Jm"),s=n("vV1H");r.FlipTest=(o=function(){this.actionSequence_FlipVertical=[function(){return new s.FlipAction(!0)}],this.actionSequence_FlipHorizontal=[function(){return new s.FlipAction(!1)}],this.formaeToFlip_=[],this.initialTransforms_=[],this.vertical_=!1,a.ActionTestBase.call(this)},i.defineClass({name:"FlipTest",ctor:o,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o;this.formaeToFlip_=i.clone(this.allSelectableFormae(n,(function(t){return!(!(o=i.opt(t.controller,(function(t){return t.flippable})))&&null==o)&&o}))),this.vertical_="actionSequence_FlipVertical"==e,this.initialTransforms_=this.formaeToFlip_.map((function(t){return t.totalPlacement}),this),n.controller.selection.replaceSelectionWithFormae(i.clone(this.formaeToFlip_))},validateAfterActionSequence:function(t,e){for(var n=i.iter(i.range(0,this.formaeToFlip_.length,!1));!n.done;n.next()){var o=n.value;XCTAssertEqual(this.formaeToFlip_[o].totalPlacement.extractedScale.scale,this.initialTransforms_[o].scaleXY(this.vertical_?1:-1,this.vertical_?-1:1).extractedScale.scale)}},validateAfterUndo:function(t,e){for(var n=i.iter(i.range(0,this.formaeToFlip_.length,!1));!n.done;n.next()){var o=n.value;XCTAssertEqual(this.formaeToFlip_[o].totalPlacement.extractedScale.scale,this.initialTransforms_[o].extractedScale.scale)}},validateAfterRedo:function(t,e){for(var n=i.iter(i.range(0,this.formaeToFlip_.length,!1));!n.done;n.next()){var o=n.value;XCTAssertEqual(this.formaeToFlip_[o].totalPlacement.extractedScale.scale,this.initialTransforms_[o].scaleXY(this.vertical_?1:-1,this.vertical_?-1:1).extractedScale.scale)}},tearDown:function(){this.formaeToFlip_=[],a.ActionTestBase.prototype.tearDown.call(this)}}}),o)},qWkq:function(t,e,n){var o,r,i=e,a=n("oAGj"),s=n("c9Jm"),l=n("yGNn"),u=n("FNB+"),c=n("y/On"),h=n("9Lk3"),f=n("6Rk9"),m=n("sIWg");i.GroupTest=(o=function(){this.actionSequence_Group=[function(){return new c.GroupAction}],this.formaeToGroup_=[],this.initialBounds_=m.TheoRect.Zero,this.testDoc_=null,s.ActionTestBase.call(this)},a.defineClass({name:"GroupTest",ctor:o,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){this.formaeToGroup_=a.clone(this.allSelectableFormae(n,(function(t){return 1==t.controller.floating}))),XCTAssertNotNil(a.clone(this.formaeToGroup_)),this.testDoc_=n,this.formaeToGroup_.length>1&&(n.controller.selection.replaceSelectionWithFormae(a.clone(this.formaeToGroup_)),this.initialBounds_=f.GeometryFacade.getFormaeBounds(a.clone(this.formaeToGroup_),!0))},validateAfterActionSequence:function(t,e){this.validateGrouping(!0)},validateAfterUndo:function(t,e){var n,o=f.GeometryFacade.getFormaeBounds(a.clone(this.formaeToGroup_),!0);XCTAssertTrue(this.initialBounds_.equal(o));for(var r=a.iter(this.formaeToGroup_);!r.done;r.next()){var i=r.value;XCTAssertFalse(i.controller.userGroupMember),XCTAssertTrue(i.parent.controller.kind==h.GridController.KIND)}if(this.formaeToGroup_.length>1){var s=!1;a.opt(this.formaeToGroup_[0].root,(function(t){return t.visitAll(u.FormaTraversal.PreOrder,(function(t){((n=a.opt(t.controller,(function(t){return t.userGroupMember})))||null!=n)&&n&&(s=!0)}))})),XCTAssertFalse(s)}},validateAfterRedo:function(t,e){this.validateGrouping(!1)},validateGrouping:function(t){var e=f.GeometryFacade.getFormaeBounds(a.clone(this.formaeToGroup_),!0);if(XCTAssertTrue(this.initialBounds_.equalWithAccuracy(e,.01)),this.formaeToGroup_.length>1){var n=this.formaeToGroup_[0].parent;XCTAssertTrue(n.controller.userGroup);for(var o=a.iter(this.formaeToGroup_);!o.done;o.next()){var r=o.value;XCTAssertTrue(r.controller.userGroupChild),XCTAssertTrue(r.parent==n)}if(t){XCTAssertTrue(1==this.testDoc_.controller.selection.selectedCountInDocument);var i=this.testDoc_.controller.selection.formaAt(0);XCTAssertTrue(i.controller.userGroup)}}},tearDown:function(){this.formaeToGroup_=[],s.ActionTestBase.prototype.tearDown.call(this)}}}),o),i.UngroupTest=(r=function(){this.actionSequence_Ungroup=[function(){return new c.UngroupAction}],this.formaeToGroup_=[],this.initialBounds_=m.TheoRect.Zero,this.root_=null,this.testDoc_=null,s.ActionTestBase.call(this)},a.defineClass({name:"UngroupTest",ctor:r,superName:"ActionTestBase",props:{prepareDocument:function(t,e){this.root_=t.firstPage.root,this.formaeToGroup_=a.clone(this.allSelectableFormae(t,(function(t){return 1==t.controller.floating}))),XCTAssertNotNil(a.clone(this.formaeToGroup_)),this.formaeToGroup_.length>0&&(t.controller.selection.replaceSelectionWithFormae(a.clone(this.formaeToGroup_)),this.initialBounds_=f.GeometryFacade.getFormaeBounds(a.clone(this.formaeToGroup_),!0));var n=[function(){return new c.GroupAction}];return l.CorePromise.resolve(a.clone(n))},setUpActionSequence:function(t,e,n){this.testDoc_=n},validateAfterActionSequence:function(t,e){this.validateNoGrouping(!0)},validateAfterUndo:function(t,e){this.validateGrouping()},validateAfterRedo:function(t,e){this.validateNoGrouping(!1)},validateGrouping:function(){if(this.formaeToGroup_.length>1){var t=this.formaeToGroup_[0].parent;XCTAssertTrue(t.controller.userGroup);for(var e=a.iter(this.formaeToGroup_);!e.done;e.next()){var n=e.value;XCTAssertTrue(n.controller.userGroupChild),XCTAssertTrue(n.parent==t)}}},validateNoGrouping:function(t){var e,n=f.GeometryFacade.getFormaeBounds(a.clone(this.formaeToGroup_),!0);XCTAssertTrue(this.initialBounds_.equalWithAccuracy(n,.01));for(var o=a.iter(this.formaeToGroup_);!o.done;o.next()){var r=o.value;XCTAssertFalse(r.controller.userGroupMember),XCTAssertTrue(r.parent.controller.kind==h.GridController.KIND)}if(this.formaeToGroup_.length>1){var i=!1;a.opt(this.formaeToGroup_[0].root,(function(t){return t.visitAll(u.FormaTraversal.PreOrder,(function(t){((e=a.opt(t.controller,(function(t){return t.userGroupMember})))||null!=e)&&e&&(i=!0)}))})),XCTAssertFalse(i),t&&XCTAssertTrue(this.testDoc_.controller.selection.selectedCountInDocument==this.formaeToGroup_.length)}},tearDown:function(){this.formaeToGroup_=[],s.ActionTestBase.prototype.tearDown.call(this)}}}),r)},wYGt:function(t,e,n){var o,r,i,a,s,l,u,c,h,f=e,m=n("oAGj"),d=n("Tq01"),A=n("4mEG"),_=n("c9Jm"),p=n("CWW7"),T=n("yGNn"),g=n("FNB+"),C=n("pnSN"),F=n("iCxV"),S=n("xWmh"),v=n("fdtz"),E=n("VkKB"),I=n("djAF"),R=n("cRpU"),P=n("8t9B"),D=n("RkYL"),y=n("LGJg"),N=n("zjod");f.AddTextTest=(o=function(){this.actionSequence_AddText=[function(){return new A.AddTextContentAction("Dog")}],this.text_="Dog",this.rootForma_=null,_.ActionTestBase.call(this)},m.defineClass({name:"AddTextTest",ctor:o,superName:"ActionTestBase",props:{hasText:function(){var t=this,e=!1;return m.opt(this.rootForma_,(function(n){return n.visitAll(g.FormaTraversal.PreOrder,(function(n){var o,r;(o=m.as(n,C.GroupForma))&&(r=m.as(o.controller,P.TypeLockupController))&&r.text==t.text_&&(e=!0)}))})),e},setUpActionSequence:function(t,e,n){this.rootForma_=n.firstPage.root},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasText())},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasText())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasText())}}}),o),f.ReplaceTextTest=(r=function(){this.actionSequence_ReplaceText=[],this.initialText_="Initial...",this.finalText_="Final!",this.rootForma_=null,_.ActionTestBase.call(this)},m.defineClass({name:"ReplaceTextTest",ctor:r,superName:"ActionTestBase",props:{textForma:{get:function(){return m.first(m.opt(m.as(this.getActionResult(0),d.FormaActionResult),(function(t){return t.formae})))}},hasInitialText:function(){var t=this,e=!1;return m.opt(this.rootForma_,(function(n){return n.visitAll(g.FormaTraversal.PreOrder,(function(n){var o,r;(o=m.as(n,C.GroupForma))&&(r=m.as(o.controller,P.TypeLockupController))&&r.text==t.initialText_&&(e=!0)}))})),e},hasFinalText:function(){var t=this,e=!1;return m.opt(this.rootForma_,(function(n){return n.visitAll(g.FormaTraversal.PreOrder,(function(n){var o,r;(o=m.as(n,C.GroupForma))&&(r=m.as(o.controller,P.TypeLockupController))&&r.text==t.finalText_&&(e=!0)}))})),e},populateActionSequence:function(t,e,n){var o=this;return T.CorePromise.resolve(t.concat([function(){return new A.AddTextContentAction(o.initialText_)},function(){return new R.SetTextAction(o.finalText_,o.textForma)}]))},setUpActionSequence:function(t,e,n){this.rootForma_=n.firstPage.root},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasFinalText()),XCTAssertFalse(this.hasInitialText())},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasFinalText()),XCTAssertFalse(this.hasInitialText())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasFinalText()),XCTAssertFalse(this.hasInitialText())}}}),r),f.AddImageTest=(i=function(){this.actionSequence_AddImage=[],this.imageURL_="",this.imageMimeType_="",this.imageWidth_=0,this.imageHeight_=0,this.rootForma_=null,_.ActionTestBase.call(this)},m.defineClass({name:"AddImageTest",ctor:i,superName:"ActionTestBase",props:{hasImage:function(){var t=this,e=!1;return m.opt(this.rootForma_,(function(n){return n.visitAll(g.FormaTraversal.PreOrder,(function(n){var o,r;(o=m.as(n,v.ImageForma))&&(r=o.contentNode)&&r.url==t.imageURL_&&r.mimeType==t.imageMimeType_&&r.pixelWidth==t.imageWidth_&&r.pixelHeight==t.imageHeight_&&(e=!0)}))})),e},populateActionSequence:function(t,e,n){var o=this,r=n.firstPage;return this.imageDataForAsset("dog1.jpeg").then((function(t){var e;if(e=m.as(t,S.ActionTestImageData)){var n=new p.AddFormaParams(d.ControllerSettingsBehaviorEnum.SetControllerSettings);return o.imageURL_=e.url,o.imageMimeType_="image/jpeg",o.imageWidth_=e.width,o.imageHeight_=e.height,T.CorePromise.resolve([function(){return new A.AddImageContentAction(r,o.imageURL_,o.imageMimeType_,o.imageWidth_,o.imageHeight_,!1,E.MediaMetadata.init_36a2(),null,null,n)}])}return XCTFail("Could not get image data for AddImageTest"),T.CorePromise.resolve([])}))},setUpActionSequence:function(t,e,n){this.rootForma_=n.firstPage.root},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasImage())},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasImage())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasImage())}}}),i),f.ReplaceImageTest=(a=function(){this.originalImageURL_="",this.originalImageMimeType_="",this.originalImageWidth_=0,this.originalImageHeight_=0,this.replacementImageURL_="",this.replacementImageMimeType_="",this.replacementImageWidth_=0,this.replacementImageHeight_=0,this.rootForma_=null,this.testPage_=null,this.actionSequence_ReplaceImage=[],_.ActionTestBase.call(this)},m.defineClass({name:"ReplaceImageTest",ctor:a,superName:"ActionTestBase",props:{imageForma:{get:function(){return m.first(m.opt(m.as(this.getActionResult(0),d.FormaActionResult),(function(t){return t.formae})))}},hasImage:function(){var t=this,e=!1;return m.opt(this.rootForma_,(function(n){return n.visitAll(g.FormaTraversal.PreOrder,(function(n){var o,r;(o=m.as(n,v.ImageForma))&&(r=o.contentNode)&&(XCTAssertNotEqual(t.originalImageURL_,r.url),r.url==t.replacementImageURL_&&r.mimeType==t.replacementImageMimeType_&&r.pixelWidth==t.replacementImageWidth_&&r.pixelHeight==t.replacementImageHeight_&&(e=!0))}))})),e},populateActionSequence:function(t,e,n){var o,r=this,i=n.firstPage;return this.imageDataForAsset("dog1.jpeg").then((function(e){var n;return(n=m.as(e,S.ActionTestImageData))?(r.originalImageURL_=n.url,r.originalImageMimeType_="image/jpeg",r.originalImageWidth_=n.width,r.originalImageHeight_=n.height,r.imageDataForAsset("bird_in_snow.jpg").then((function(e){var n;return(n=m.as(e,S.ActionTestImageData))?(r.replacementImageURL_=n.url,r.replacementImageMimeType_="image/jpeg",r.replacementImageWidth_=n.width,r.replacementImageHeight_=n.height,T.CorePromise.resolve(t.concat([function(){var t=new p.AddFormaParams(d.ControllerSettingsBehaviorEnum.SetControllerSettings);return new A.AddImageContentAction(i,r.originalImageURL_,r.originalImageMimeType_,r.originalImageWidth_,r.originalImageHeight_,!1,E.MediaMetadata.init_36a2(),null,null,t)},function(){XCTAssertTrue(!(!(o=m.opt(m.opt(r.imageForma,(function(t){return t.controller})),(function(t){return t.replaceable})))&&null==o)&&o);var t=new p.AddFormaParams(d.ControllerSettingsBehaviorEnum.SetControllerSettings,!1,r.imageForma);return new A.AddImageContentAction(i,r.replacementImageURL_,r.replacementImageMimeType_,r.replacementImageWidth_,r.replacementImageHeight_,!1,E.MediaMetadata.init_36a2(),null,null,t)}]))):(XCTFail("Could not get image data for second image in ReplaceImageTest"),T.CorePromise.resolve([]))}))):(XCTFail("Could not get image data for first image in ReplaceImageTest"),T.CorePromise.resolve([]))}))},setUpActionSequence:function(t,e,n){this.rootForma_=n.firstPage.root,this.testPage_=n.firstPage},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasImage())},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasImage())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasImage())}}}),a),f.AddIconTest=(s=function(){this.actionSequence_AddIcon=[],this.iconURL_="",this.rootForma_=null,_.ActionTestBase.call(this)},m.defineClass({name:"AddIconTest",ctor:s,superName:"ActionTestBase",props:{hasIcon:function(){var t=this,e=!1;return m.opt(this.rootForma_,(function(n){return n.visitAll(g.FormaTraversal.PreOrder,(function(n){var o,r;(o=m.as(n,I.ShapeForma))&&(r=m.as(o.contentNode,y.VectorContentNode))&&r.url==t.iconURL_&&(e=!0)}))})),e},populateActionSequence:function(t,e,n){var o,r=this;return null!=(o=this.urlForAsset("dog1.svg"))?(this.iconURL_=o,T.CorePromise.resolve([function(){return new A.AddIconContentAction(r.iconURL_,E.MediaMetadata.init_36a2(),null)}])):(XCTFail("Could not get Icon URL for AddIconTest"),T.CorePromise.resolve([]))},setUpActionSequence:function(t,e,n){this.rootForma_=n.firstPage.root},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasIcon())},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasIcon())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasIcon())}}}),s),f.ReplaceIconTest=(l=function(){this.actionSequence_ReplaceIcon=[],this.rootForma_=null,this.iconForma_=null,_.ActionTestBase.call(this)},m.defineClass({name:"ReplaceIconTest",ctor:l,superName:"ActionTestBase",statics:{originalIconURL_:"",replacementIconURL_:""},props:{hasIcon:function(){var t=!1;return m.opt(this.rootForma_,(function(e){return e.visitAll(g.FormaTraversal.PreOrder,(function(e){var n,o;(n=m.as(e,I.ShapeForma))&&(o=m.as(n.contentNode,y.VectorContentNode))&&o.url==l.replacementIconURL_&&(t=!0)}))})),t},populateActionSequence:function(t,e,n){var o,r=this;return T.CorePromise.resolve(t.concat([function(){return XCTAssertTrue(!(!(o=m.opt(m.opt(r.iconForma_,(function(t){return t.controller})),(function(t){return t.replaceable})))&&null==o)&&o),new A.AddIconContentAction(l.replacementIconURL_,E.MediaMetadata.init_36a2(),r.iconForma_)}]))},prepareDocument:function(t,e){var n,o;return this.rootForma_=t.firstPage.root,null!=(n=this.urlForAsset("dog1.svg"))&&null!=(o=this.urlForAsset("fork_and_spoon.svg"))&&(l.originalIconURL_=n,l.replacementIconURL_=o,XCTAssertNotEqual(l.originalIconURL_,l.replacementIconURL_)),T.CorePromise.resolve([function(){return new A.AddIconContentAction(l.originalIconURL_,E.MediaMetadata.init_36a2(),null)}])},setUpActionSequence:function(t,e,n){this.iconForma_=m.first(m.opt(m.as(this.lastActionResult,d.FormaActionResult),(function(t){return t.formae})))},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasIcon())},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasIcon())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasIcon())}}}),l),f.AddVideoTest=(u=function(){this.actionSequence_AddVideo=[],this.videoURL_="",this.trackWidth_=0,this.trackHeight_=0,this.duration_=D.TheoTime.Zero,this.times_=[],this.posterURL_=null,this.posterWidth_=0,this.posterHeight_=0,this.posterParams_=null,this.rootForma_=null,_.ActionTestBase.call(this)},m.defineClass({name:"AddVideoTest",ctor:u,superName:"ActionTestBase",props:{hasVideo:function(){var t=this,e=!1;return m.opt(this.rootForma_,(function(n){return n.visitAll(g.FormaTraversal.PreOrder,(function(n){var o,r;(o=m.as(n,N.VideoForma))&&(r=o.videoContentNode)&&r.url==t.videoURL_&&(e=!0)}))})),e},populateActionSequence:function(t,e,n){var o,r=this,i=n.firstPage;if(null!=(o=this.urlForAsset("spokes.gif"))){this.videoURL_=o,this.posterURL_=o;var a=this.posterURL_.split(".");a.length>0&&(a.pop(),this.posterURL_=a.join(".")+".png"),this.trackWidth_=480,this.trackHeight_=480,this.posterWidth_=480,this.posterHeight_=480;for(var s,l=7,u=m.iter(m.range(1,34,!0));!u.done;u.next())this.times_.push(new D.TheoTime(l,100)),l+=7;return this.duration_=new D.TheoTime(l,100),null!=(s=this.posterURL_)&&(this.posterParams_=new A.VideoPosterParams(s,"image/jpeg",this.posterWidth_,this.posterHeight_)),T.CorePromise.resolve([function(){return new A.AddVideoContentAction(i,r.videoURL_,"image/gif",r.trackWidth_,r.trackHeight_,r.duration_,m.clone(r.times_),r.posterParams_,!1,E.MediaMetadata.init_36a2(),null,null,null,p.AddFormaParams.DEFAULTS)}])}return XCTFail("Could not get Video URL for AddVideoTest"),T.CorePromise.resolve([])},setUpActionSequence:function(t,e,n){this.rootForma_=n.firstPage.root},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasVideo())},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasVideo())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasVideo())}}}),u),f.AddLogoTest=(c=function(){this.actionSequence_AddLogo=[],this.primaryLogoID_="",this.rootForma_=null,_.ActionTestBase.call(this)},m.defineClass({name:"AddLogoTest",ctor:c,superName:"ActionTestBase",props:{hasLogo:function(){var t=!1;return m.opt(this.rootForma_,(function(e){return e.visitAll(g.FormaTraversal.PreOrder,(function(e){var n;(n=m.as(e,v.ImageForma))&&n.contentNode&&n.isLogo()&&(t=!0)}))})),t},hasLogoWithID:function(t){var e=!1;return m.opt(this.rootForma_,(function(n){return n.visitAll(g.FormaTraversal.PreOrder,(function(n){var o,r;(o=m.as(n,v.ImageForma))&&(r=o.contentNode)&&r.sparkElementID==t&&o.isLogo()&&(e=!0)}))})),e},populateActionSequence:function(t,e,n){var o=this;return this.installBrandkit(n),T.CorePromise.resolve(t.concat([function(){var t=F.Host.brandkitManager.fakeBrandkitForElementsForTesting.logos[0];return o.primaryLogoID_=t.id,new A.AddLogoContentAction(n.firstPage,t,null,null)}]))},setUpActionSequence:function(t,e,n){this.rootForma_=n.firstPage.root},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasLogoWithID(this.primaryLogoID_))},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasLogo())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasLogoWithID(this.primaryLogoID_))},shutdown:function(t,e,n){_.ActionTestBase.prototype.shutdown.call(this,m.clone(t),e,n),this.removeBrandkit(n)}}}),c),f.ReplaceLogoTest=(h=function(){this.actionSequence_ReplaceLogo=[],this.primaryLogoID_="",this.secondaryLogoID_="",this.rootForma_=null,_.ActionTestBase.call(this)},m.defineClass({name:"ReplaceLogoTest",ctor:h,superName:"ActionTestBase",props:{logoForma:{get:function(){return m.first(m.opt(m.as(this.getActionResult(0),d.FormaActionResult),(function(t){return t.formae})))}},hasLogo:function(){var t=!1;return m.opt(this.rootForma_,(function(e){return e.visitAll(g.FormaTraversal.PreOrder,(function(e){var n;(n=m.as(e,v.ImageForma))&&n.contentNode&&n.isLogo()&&(t=!0)}))})),t},hasLogoWithID:function(t){var e=!1;return m.opt(this.rootForma_,(function(n){return n.visitAll(g.FormaTraversal.PreOrder,(function(n){var o,r;(o=m.as(n,v.ImageForma))&&(r=o.contentNode)&&r.sparkElementID==t&&o.isLogo()&&(e=!0)}))})),e},populateActionSequence:function(t,e,n){var o=this;return this.installBrandkit(n),T.CorePromise.resolve(t.concat([function(){var t=F.Host.brandkitManager.fakeBrandkitForElementsForTesting.logos[0];o.primaryLogoID_=t.id;var e=F.Host.brandkitManager.fakeBrandkitForElementsForTesting.logos[1];return o.secondaryLogoID_=e.id,new A.AddLogoContentAction(n.firstPage,t,null,null)},function(){var t=F.Host.brandkitManager.fakeBrandkitForElementsForTesting.logos[1];return new A.AddLogoContentAction(n.firstPage,t,o.logoForma,null)}]))},setUpActionSequence:function(t,e,n){this.rootForma_=n.firstPage.root},validateAfterActionSequence:function(t,e){XCTAssertFalse(this.hasLogoWithID(this.primaryLogoID_)),XCTAssertTrue(this.hasLogoWithID(this.secondaryLogoID_))},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasLogo())},validateAfterRedo:function(t,e){XCTAssertFalse(this.hasLogoWithID(this.primaryLogoID_)),XCTAssertTrue(this.hasLogoWithID(this.secondaryLogoID_))},shutdown:function(t,e,n){_.ActionTestBase.prototype.shutdown.call(this,m.clone(t),e,n),this.removeBrandkit(n)}}}),h)},zIaq:function(t,e,n){var o,r,i,a,s=e,l=n("oAGj"),u=n("c9Jm"),c=n("hJqd"),h=n("kYI4"),f=n("yGNn"),m=n("ascj"),d=n("iCxV"),A=n("DP9v"),_=n("Vm85");s.BrandifyTest=(o=function(){this.actionSequence_Brandify=[],this.testDoc_=null,this.page_=null,this.initialRootColor_=null,this.docHasText_=!1,u.ActionTestBase.call(this)},l.defineClass({name:"BrandifyTest",ctor:o,superName:"ActionTestBase",props:{hasText:function(t){for(var e=!1,n=l.iter(t.firstPage.root.filterWithCallback((function(t){return t.isTypeLockup()})));!n.done;n.next()){e=!0;break}return e},allTextBranded:function(t){for(var e,n=!0,o=l.iter(t.firstPage.root.filterWithCallback((function(t){return t.isTypeLockup()})));!o.done;o.next()){var r=o.value,i=_.TextFacade.getFontForForma(r);if(!(e=l.isEmpty(l.opt(i,(function(t){return t.getSparkFontRole()}))))&&null==e||e){n=!1;break}}return n},verifyColors:function(){var t=this.page_.root.style.colors.color(m.ColorRole.FieldPrimary);XCTAssertTrue(null!=t);for(var e=0,n=0,o=0,r=l.clone(this.page_.colorLibraryController.getTheoColorsUsedInDocument()),i=l.iter(r);!i.done;i.next()){var a=i.value;a.isBrandkitPrimaryColor()&&(e+=1),a.isBrandkitSecondaryColor()&&(n+=1),a.isBrandkitShade()&&(o+=1)}XCTAssertEqual(e,0),XCTAssertEqual(n,0),XCTAssertTrue(r.length>0),XCTAssertTrue(o>0);var s=l.clone(h.BrandingFacade.getDocumentBrandedElementsUsage(this.testDoc_,!1,!0));XCTAssertTrue(s.includes("color"))},populateActionSequence:function(t,e,n){var o=this;return this.docHasText_=this.hasText(n),this.installBrandkit(n),f.CorePromise.resolve(t.concat([function(){return new c.BrandifyAction(d.Host.brandkitManager.fakeBrandkitForElementsForTesting,o.docHasText_,!0,!0)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.page_=n.firstPage,this.initialRootColor_=this.page_.root.style.colors.color(m.ColorRole.FieldPrimary)},validateAfterActionSequence:function(t,e){XCTAssertTrue(h.BrandingFacade.areSparkLogosInUse(this.testDoc_,[this.FAKE_LOGO_ELEMENT_STAMP_ID])),XCTAssertFalse(h.BrandingFacade.areSparkLogosInUse(this.testDoc_,[this.FAKE_LOGO_ELEMENT_PRIMARY_ID])),this.docHasText_?(XCTAssertTrue(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID])),XCTAssertTrue(this.allTextBranded(this.testDoc_))):XCTAssertFalse(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID])),this.verifyColors()},validateAfterUndo:function(t,e){XCTAssertFalse(h.BrandingFacade.areSparkLogosInUse(this.testDoc_,[this.FAKE_LOGO_ELEMENT_PRIMARY_ID,this.FAKE_LOGO_ELEMENT_STAMP_ID])),XCTAssertFalse(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID,this.FAKE_FONT_ELEMENT_BODY_ID]))},validateAfterRedo:function(t,e){XCTAssertTrue(h.BrandingFacade.areSparkLogosInUse(this.testDoc_,[this.FAKE_LOGO_ELEMENT_STAMP_ID])),XCTAssertFalse(h.BrandingFacade.areSparkLogosInUse(this.testDoc_,[this.FAKE_LOGO_ELEMENT_PRIMARY_ID])),this.docHasText_?(XCTAssertTrue(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID])),XCTAssertTrue(this.allTextBranded(this.testDoc_))):XCTAssertFalse(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID])),this.verifyColors()},shutdown:function(t,e,n){u.ActionTestBase.prototype.shutdown.call(this,l.clone(t),e,n),this.removeBrandkit(n)}}}),o),s.AddBrandTest=(r=function(){this.actionSequence_AddBrand=[],this.testDoc_=null,this.page_=null,this.initialRootColor_=null,this.docHasText_=!1,u.ActionTestBase.call(this)},l.defineClass({name:"AddBrandTest",ctor:r,superName:"ActionTestBase",props:{hasText:function(t){for(var e=!1,n=l.iter(t.firstPage.root.filterWithCallback((function(t){return t.isTypeLockup()})));!n.done;n.next()){e=!0;break}return e},allTextBranded:function(t){for(var e,n=!0,o=l.iter(t.firstPage.root.filterWithCallback((function(t){return t.isTypeLockup()})));!o.done;o.next()){var r=o.value,i=_.TextFacade.getFontForForma(r);if(!(e=l.isEmpty(l.opt(i,(function(t){return t.getSparkFontRole()}))))&&null==e||e){n=!1;break}}return n},verifyColors:function(){var t=this.page_.root.style.colors.color(m.ColorRole.FieldPrimary);XCTAssertTrue(null!=t),XCTAssertFalse(t.isEqual(this.initialRootColor_));for(var e=0,n=0,o=0,r=l.clone(this.page_.colorLibraryController.getTheoColorsUsedInDocument()),i=l.iter(r);!i.done;i.next()){var a=i.value;a.isBrandkitPrimaryColor()&&(e+=1),a.isBrandkitSecondaryColor()&&(n+=1),a.isBrandkitShade()&&(o+=1)}XCTAssertEqual(e,0),XCTAssertEqual(n,0),XCTAssertTrue(r.length>0),XCTAssertTrue(o>0);var s=l.clone(h.BrandingFacade.getDocumentBrandedElementsUsage(this.testDoc_,!1,!0));XCTAssertTrue(s.includes("color"))},populateActionSequence:function(t,e,n){var o=this;return this.docHasText_=this.hasText(n),this.installBrandkit(n),f.CorePromise.resolve(t.concat([function(){return new c.BrandifyAction(d.Host.brandkitManager.fakeBrandkitForElementsForTesting,o.docHasText_,!0,!0)},function(){return o.installSecondBrandkit(o.testDoc_),new c.AddBrandingAction(d.Host.brandkitManager.fakeBrandkitForElementsForTesting)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.page_=n.firstPage,this.initialRootColor_=this.page_.root.style.colors.color(m.ColorRole.FieldPrimary)},validateAfterActionSequence:function(t,e){XCTAssertTrue(h.BrandingFacade.areSparkLogosInUse(this.testDoc_,[this.FAKE_LOGO_ELEMENT_PRIMARY_ID_2])),this.docHasText_?(XCTAssertTrue(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID_2])),XCTAssertTrue(this.allTextBranded(this.testDoc_))):XCTAssertFalse(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID_2])),this.verifyColors()},validateAfterUndo:function(t,e){XCTAssertFalse(h.BrandingFacade.areSparkLogosInUse(this.testDoc_,[this.FAKE_LOGO_ELEMENT_PRIMARY_ID,this.FAKE_LOGO_ELEMENT_STAMP_ID])),XCTAssertFalse(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID,this.FAKE_FONT_ELEMENT_BODY_ID]))},validateAfterRedo:function(t,e){XCTAssertTrue(h.BrandingFacade.areSparkLogosInUse(this.testDoc_,[this.FAKE_LOGO_ELEMENT_PRIMARY_ID_2])),this.docHasText_?(XCTAssertTrue(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID_2])),XCTAssertTrue(this.allTextBranded(this.testDoc_))):XCTAssertFalse(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID_2])),this.verifyColors()},shutdown:function(t,e,n){u.ActionTestBase.prototype.shutdown.call(this,l.clone(t),e,n),this.removeBrandkit(n)}}}),r),s.RemoveBrandingTest=(i=function(){this.actionSequence_RemoveBranding=[],this.testDoc_=null,this.page_=null,u.ActionTestBase.call(this)},l.defineClass({name:"RemoveBrandingTest",ctor:i,superName:"ActionTestBase",props:{verifyColors:function(t){for(var e=0,n=0,o=0,r=l.clone(this.page_.colorLibraryController.getTheoColorsUsedInDocument()),i=l.iter(r);!i.done;i.next()){var a=i.value;a.isBrandkitPrimaryColor()&&(e+=1),a.isBrandkitSecondaryColor()&&(n+=1),a.isBrandkitShade()&&(o+=1)}if(XCTAssertEqual(e,0),XCTAssertEqual(n,0),t){var s=l.clone(h.BrandingFacade.getDocumentBrandedElementsUsage(this.testDoc_,!1,!0));XCTAssertTrue(s.includes("color"))}else XCTAssertEqual(o,0);XCTAssertTrue(r.length>0)},populateActionSequence:function(t,e,n){return this.installBrandkit(n),f.CorePromise.resolve(t.concat([function(){return new c.BrandifyAction(d.Host.brandkitManager.fakeBrandkitForElementsForTesting,!0,!0,!0)},function(){return new c.RemoveBrandingAction}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.page_=n.firstPage},validateAfterActionSequence:function(t,e){var n=h.BrandingFacade.isDocumentBranded(this.testDoc_,!0);XCTAssertTrue(0==n),this.verifyColors(!0)},validateAfterUndo:function(t,e){var n=h.BrandingFacade.isDocumentBranded(this.testDoc_,!0);XCTAssertTrue(0==n),this.verifyColors(!1)},validateAfterRedo:function(t,e){var n=h.BrandingFacade.isDocumentBranded(this.testDoc_,!0);XCTAssertTrue(0==n),this.verifyColors(!0)},shutdown:function(t,e,n){u.ActionTestBase.prototype.shutdown.call(this,l.clone(t),e,n),this.removeBrandkit(n)}}}),i),s.ChangeBrandingTestToNone=(a=function(){this.actionSequence_ChangeBrandingToNone=[],this.testDoc_=null,this.page_=null,u.ActionTestBase.call(this)},l.defineClass({name:"ChangeBrandingTestToNone",ctor:a,superName:"ActionTestBase",props:{verifyColors:function(t){for(var e=0,n=0,o=0,r=l.clone(this.page_.colorLibraryController.getTheoColorsUsedInDocument()),i=l.iter(r);!i.done;i.next()){var a=i.value;a.isBrandkitPrimaryColor()&&(e+=1),a.isBrandkitSecondaryColor()&&(n+=1),a.isBrandkitShade()&&(o+=1)}if(XCTAssertEqual(e,0),XCTAssertEqual(n,0),t){var s=l.clone(h.BrandingFacade.getDocumentBrandedElementsUsage(this.testDoc_,!1,!0));XCTAssertTrue(s.includes("color"))}else XCTAssertEqual(o,0);XCTAssertTrue(r.length>0)},populateActionSequence:function(t,e,n){return this.installBrandkit(n),f.CorePromise.resolve(t.concat([function(){return new c.BrandifyAction(d.Host.brandkitManager.fakeBrandkitForElementsForTesting,!0,!0,!0)},function(){return new c.ChangeBrandingAction(null,d.Host.brandkitManager.fakeBrandkitForElementsForTesting.id,A.MultiBrandFacade.activeBrandkitID)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.page_=n.firstPage},validateAfterActionSequence:function(t,e){var n=h.BrandingFacade.isDocumentBranded(this.testDoc_,!0);XCTAssertTrue(0==n),this.verifyColors(!0),XCTAssertTrue(null==A.MultiBrandFacade.getBrand(this.testDoc_))},validateAfterUndo:function(t,e){var n=h.BrandingFacade.isDocumentBranded(this.testDoc_,!0);XCTAssertTrue(0==n),this.verifyColors(!1)},validateAfterRedo:function(t,e){var n=h.BrandingFacade.isDocumentBranded(this.testDoc_,!0);XCTAssertTrue(0==n),this.verifyColors(!0),XCTAssertTrue(null==A.MultiBrandFacade.getBrand(this.testDoc_))},shutdown:function(t,e,n){u.ActionTestBase.prototype.shutdown.call(this,l.clone(t),e,n),this.removeBrandkit(n)}}}),a)}}]);
//# sourceMappingURL=vendors_npm_spark_4679d780-ad777c08.js.map