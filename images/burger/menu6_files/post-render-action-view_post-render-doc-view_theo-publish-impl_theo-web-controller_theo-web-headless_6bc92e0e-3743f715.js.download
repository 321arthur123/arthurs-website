(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[40],{"14LO":function(e,t,n){"use strict";n.r(t),n.d(t,"DCXDocumentComposite",(function(){return i}));var o=n("uTW7");function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i{constructor(e){r(this,"dcxComposite",void 0),r(this,"current",void 0),r(this,"localStoragePath",void 0),this.dcxComposite=e.composite,this.current=new o.DCXDocumentBranch({branch:e.composite.current,componentURLfn:e.componentURLfn,overrideIDfn:e.overrideIDfn}),this.localStoragePath="local-storage://"}}},"1tmr":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n("UzQk");function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i{constructor(e,t){r(this,"branch",void 0),r(this,"node",void 0),this.branch=e,this.node=t}reparent(e){if(e!==this.node){const t=this.node.childComponents.indexOf(this);t>=0?(e.childComponents.push(this),this.node.childComponents.splice(t,1),this.node=e,this.attachToNode()):o.CoreAssert.fail("internal error: component isn't attached to the node we think it is")}}update(e){const t=this.node.childComponents.indexOf(this);t<0?o.CoreAssert.fail("replaceWith: component isn't attached to the node we think it is"):e.node===this.node?(this.detachFromNode(),this.node.childComponents.splice(t,1,e),e.attachToNode()):o.CoreAssert.fail("replaceWith: only supports same-node replacement")}}},"3xdQ":function(e,t,n){var o,r;function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}o=[n("YLtl"),n("UFvF"),n("MGCh"),n("9gt3"),n("a8ov"),n("r3b0"),n("U44B"),n("UzQk"),n("mwMu"),n("qnb0"),n("TdwW"),n("O0ct"),n("ZLL8"),n("hEO4"),n("KpqY"),n("6lgp")],void 0===(r=function(e,t,n,o,r,c,l,s,u,d,p,h,m,f,g,v){const y=r.default,C=g.default,S=n.channel("core-wrapper");return function(n){n=n||{};var r={};r.events=new o,r.ActionError=v.default;var g,F=null,b=!1,I=null,k=!1,T=null,w=null,D=null,P=null,A=[],x=null,L=0,O=s.TheoPoint.ZERO,N=!1,M=function(){var e=!0;return F.content.root.visitAll((function(t){"image"===t.kind?t.url&&"data:"!==t.url.substr(0,"data:".length)||(e=!1):"vector"===t.kind&&"uploading svg"===t.url&&(e=!1)})),e};r.monitorTransactions=function(){f.monitorTransactionsForDocument(F)},r.validateDoc=function(e){const t=s.TheoDocumentUtils.validateDoc(F,e);t&&S.error("validateDoc: ".concat(t.errorMsg),t)},r.getManifestData=function(){return F.encodeToJSON()},r.getDocumentCCID=function(){return F.uuid||" "};var U=function(e){var t=new c({makeComponentUrl:function(){return y.encodeDesignFilterComponentUrl()},trackAbsolutePath:!1,branch:e});return s.TheoDocument.newDocumentFromDataObject(t,null)};r.getTemporaryDocumentWithFontsLoaded=function(e){var n=U(e),o=n.missingFontList;return o.length?h.loadMissingFonts(o).then((function(){return U(e)})):t.resolve(n)};var E=e.throttle((function(){k&&M()&&r.events.publish("save-requested")}),500),R=[];function B(){R.forEach((function(e){e.unsubscribe()}));var t={};(R=[]).push(F.firstPage.subscribeWithCallback((function(n){0===--L&&(e.each(t,(function(e){(e.transform||e.geometry||e.style)&&r.events.publish("forma-dirty",e)})),r.events.publish("document-in-new-renderable-state"))}),s.FormaEndUpdateMessage.TYPE)),R.push(F.firstPage.subscribeWithCallback((function(e){if(0===L&&(t={}),e.event.forma){var n=e.event.forma.formaID,o=t[n];o||(t[n]=o={formaID:n}),e.event instanceof s.FormaTransformChangedEvent?o.transform=!0:e.event instanceof s.FormaGeometryChangedEvent?o.geometry=!0:e.event instanceof s.FormaStyleChangedEvent&&(o.style=!0)}L++}),s.FormaBeginUpdateMessage.TYPE)),R.push(F.controller.subscribeWithCallback((function(e){r.inCharStyleMode&&r.handleTapped({x:e.state.clickLocation.x,y:e.state.clickLocation.y,forma:e.state.forma})}),s.ClickMessage.TYPE)),R.push(F.controller.subscribeWithCallback((function(e){r.events.publish("layer-double-tapped")}),s.DoubleClickMessage.TYPE)),R.push(F.controller.model.subscribeWithCallback((function(e){e.changes.indexOf("snaplines")>=0&&r.events.publish("update-snap-lines",{lines:F.controller.model.snapLines.getAll()}),e.changes.indexOf("handles")>=0&&r.events.publish("update-handles"),e.changes.indexOf("swapState")>=0&&r.events.publish("update-swap-state")}),s.EditorModelChangedMessage.TYPE))}function W(e){return e?e.contentNode&&e.contentNode.url?y.decodeUrl(e.contentNode.url):(S.error("image forma has no contentNode or url"),null):(S.error("image forma is not defined"),null)}function _(e){if(e){var t=e.bounds;return e.controller&&(t=e.controller.size||e.bounds),{width:t.width,height:t.height}}}function G(){for(var e=F.controller.model.handles.getAll(),t=!1,n=null,o=[],i=null,a=null,c=null,l=null,u=null,d=!1,p=null,h=0;h<e.length;h++){var m=e[h];if(m instanceof s.BoxTransformHandles){if(m instanceof s.BoxTransformMultipleFormae){n=[];for(var f=0;f<m.formaIDs.length;f++){var g=m.formaIDs[f],v=r.getFormaById(g);null!=v&&n.push({formaID:g,bounds:v.bounds,placement:v.totalPlacement,isGroup:!(!v.controller||!v.controller.userGroup)})}if(0===n.length&&(n=[{formaID:"group",placement:m.reference.placement,bounds:m.reference.bounds,isGroup:!0}]),d=m.displayHints.includes(s.BoxHandleDisplayHint.GroupOutlineColor),u=m.displayHints.includes(s.BoxHandleDisplayHint.WideOutline),null!=i)continue}m.activeTransform===s.TransformType.Translate&&(t=!0),t||m.allowedTransforms.forEach((function(e){var t=J(e);t&&o.push(t)})),c=m.allowedTransforms.includes(s.TransformType.RotateAboutCenter)&&!m.displayHints.includes(s.BoxHandleDisplayHint.SuppressRotationHandle)&&(m.activeTransform===s.TransformType.None||m.activeTransform===s.TransformType.RotateAboutCenter),i=m.reference.placement,a=m.reference.bounds,l=m.displayHints.includes(s.BoxHandleDisplayHint.ThinOutline),d=m.displayHints.includes(s.BoxHandleDisplayHint.GroupOutlineColor),p=m.displayHints.includes(s.BoxHandleDisplayHint.TextFrame)}}if(null===i)return null;var y=r.getDocumentSize();return{documentSize:new s.TheoSize(y.width,y.height),matrix2d:i,bounds:a,enablePips:o.length>0,rotateable:c,handlePoints:o,thinOutline:l,wideOutline:u,transparentOutline:t,textFrame:p,highlightRects:n,groupOutlineColor:d,inCropMode:r.inCropMode()}}function j(e){if(e){var t=r.getDocumentSize(),n=e.totalPlacement,o=_(e);return{forma:e,matrix2d:[n.a,n.b,n.c,n.d,n.tx,n.ty],documentWidth:t.width,documentHeight:t.height,width:o.width,height:o.height,showLeftLine:e.isRangeStart(),showRightLine:e.isRangeEnd()}}}function H(){var t=F.firstPage.colorLibraryController.getColorThemeAsArrayOfSolidColors();return e.map(t,(function(e){return e.red+":"+e.green+":"+e.blue})).join(":")}function z(t){return e.map(t,(function(e){var t=e.sprkElemId||e.id||null,n=e.sprkRoles||e.roles||null,o=p.rgb2SolidColor(e);return p.solidColor2TheoColor(o,t,n)}))}function V(t){return e.map(t,(function(e){var t;return"string"==typeof e?(t=p.hex2SolidColor(e),p.solidColor2TheoColor(t,null,null)):(t=p.hex2SolidColor(e.color),p.solidColor2TheoColor(t,e.id,e.roles))}))}function K(){return t.Promise((function(e){g.invalidatePatches(e)}))}var X=[{type:s.TransformType.TopLeftCornerTranslate,spot:new s.TheoPoint(0,0)},{type:s.TransformType.TopRightCornerTranslate,spot:new s.TheoPoint(1,0)},{type:s.TransformType.BottomLeftCornerTranslate,spot:new s.TheoPoint(0,1)},{type:s.TransformType.BottomRightCornerTranslate,spot:new s.TheoPoint(1,1)},{type:s.TransformType.TopSideTranslate,spot:new s.TheoPoint(.5,0)},{type:s.TransformType.BottomSideTranslate,spot:new s.TheoPoint(.5,1)},{type:s.TransformType.LeftSideTranslate,spot:new s.TheoPoint(0,.5)},{type:s.TransformType.RightSideTranslate,spot:new s.TheoPoint(1,.5)}];function Y(e){const t=X.find(t=>t.spot.x===e.x&&t.spot.y===e.y);return t?t.type:null}function J(e){const t=X.find(t=>t.type===e);return t?t.spot:null}function q(e){return e.catch((function(e){let t=e;e.errorMsg&&(t=e.errorMsg),S.error("doAction",t||"Unknown error!"),r.forceReloadEditor()}))}function Q(e,t){let n=C.doAction(F,e);return!t&&r.shouldReloadOnActionFailure()&&(n=q(n)),n}function Z(e,t,n){let o=C.doActionWithCompletion(F,e,t);return!n&&r.shouldReloadOnActionFailure()&&(o=q(o)),o}function $(){var e=r.getAllSelectedFormas();!1===F.controller.selection.inCharStyleMode&&!0===r.inCharStyleMode&&r.exitCharStyleMode(),0!==e.length&&e[0].isTypeLockup()||r.events.publish("text-forma-selected",{id:null,forma:null,selectionBoxes:[]}),e.length>0?r.events.publish("forma-selected",{id:e[0].formaID,forma:e[0],selectionBox:G()}):r.events.publish("forma-selected",{id:null,forma:null})}function ee(e,t){e&&r.events.publish("forma-updated",{id:e.formaID,selected:r.getSelectedForma()&&e.formaID===r.getSelectedFormaId(),snapLines:t,selectionBox:G(),data:{forma:e}})}function te(e){null==e&&(e=!0),r.events.publish("design-updated",{formaAdded:e})}function ne(e){for(var t=e.controller,n=[],o=1;o<t.owner.selection.selectedCount;o++){var i=t.owner.selection.formaAt(o);n.push(j(i))}r.events.publish("text-forma-selected",{id:e.formaID,forma:e,selectionBoxes:n})}function oe(e,t){e&&t&&(e.selectCharStyleForma(),e.updateGroup(),te(!1),e.selectCharStyleForma(),ne(t))}function re(t){return t&&"image"===t.kind&&(!t.url||e.startsWith(t.url,"data:"))}return r.inCharStyleMode=!1,r.getGraph=function(e){return F.firstPage.pgm.getGraph(e?s.PGMExportSettings.DYNAMIC:s.PGMExportSettings.STATIC)},r.postDocumentHasHighResImageSaveableState=function(){var e=t.defer();return function t(){if(M()){var n=F.stateID;e.resolve(n)}else setTimeout(t,1e3)}(),e.promise},r.saveWithRenditions=function(e,t,n){return P.saveWithRenditions(F,e,t,n)},r.saveCopyWithRenditions=function(e,t,n){return e.saveWithRenditions(F,t,n)},r.saveImageComponent=function(e,t,n,o,r){return P.saveImageComponent(e,t,n,o,r)},r.initializeNewPost=function(n){var o,i=s.TypeLockupUtils.fixUpQuotes(n.text,""),a=n.palette,c=r.imageFormas(),l=t.defer(),u=r.hostImages(),d=e.map(u,(function(e){return e.imgLoadedPromise}));if(c.length>=1)Promise.all(d).then((function(){const e=r.beginTransaction("create_initial_theme_from_image");F.firstPage.colorLibraryController.createInitialThemeFromImage(),l.resolve(),r.endTransaction(e)}));else{if(n.defaultBackgroundColor){var p=F.firstPage.root.filterByKind(s.ShapeForma.KIND),h=p&&p[0];h&&(o={shape:h,color:n.defaultBackgroundColor})}r.setColorPalette({colors:a,id:"0"},{shuffle:!o}).then(l.resolve)}return l.promise.then((function(){if(o){var e=r.beginTransaction("set_color_id");o.shape.style.colors.setColorId(s.ColorRole.FieldPrimary,o.color),r.endTransactionAndMergeWithPrevious(e,!0)}return 0===r.lockupFormas().length?i.length?(r.downloadNewLockupRandomFontsAsync(),r.addNewLockup(i,{silent:!0,select:!!n.selectText})):t.resolve():(S.error("initializeNewPost error. We shouldn't be adding multiple lockups. Probably git issue 2093."),t.resolve())})).then((function(){return c.length>1?Q(new s.CreatePaddedCollageAction).then((function(){te(!1)})):t.resolve()})).then((function(){return r.retrieveAndApplyASuggestedGridStyle()})).then((function(){E()}))},r.resetUserActions=function(){g.reset()},r.undoToInitialState=function(){return t.Promise((function(e,t){g.setCurrentTimelineIndex(0,e)}))},r.beginBranch=function(){g.beginBranch()},r.endBranch=function(e){g.endBranch(e)},r.beginGesture=function(){return g.beginGesture(),g.gestureScope},r.endGesture=function(e){g.endGesture(e)},r.undo=function(){return t.Promise((function(e,t){g.undo((function(){r.events.publish("undo-finished"),e()}))}))},r.redo=function(){return t.Promise((function(e,t){g.redo((function(){r.events.publish("redo-finished"),e()}))}))},r.canUndo=function(){return g.getCurrentTimelineIndex()>0&&0===g.getActionDepth()},r.canRedo=function(){return g.getCurrentTimelineIndex()<g.getTimelineLength()-1&&0===g.getActionDepth()},r.getUndoDescription=function(){return g.getUndoDescription()},r.getRedoDescription=function(){return g.getRedoDescription()},r.getCurrentTimelineIndex=function(){return g.getCurrentTimelineIndex()},r.documentId=function(){return D.documentId()},r.backgroundColor=function(){return F.firstPage.root.style.colors.color(s.ColorRole.FieldPrimary)},r.getFormaBackgroundColor=function(e){var t=e.style.colors.fieldPrimary;return t?F.firstPage.colorLibraryController.getTheoColorForSolidColor(t):null},r.triggerEnteredPalette=function(){F.firstPage.colorLibraryController.enteredPalettePicker()},r.triggerTextSidebarDisplayed=function(){F.firstPage.colorLibraryController.enteredPalettePicker()},r.isBackgroundVisible=function(){var e=r.getGridForma();return e?e.controller.isBackgroundVisible():0===r.imageFormas().length},r.getImageFormaForURL=function(e){for(var t=r.imageFormas(),n=0;n<t.length;n++){var o=t[n];if(null!=o.contentNode&&o.contentNode.url===e)return o}return null},r.getImagePreviewData=function(e){if(e&&e.isImage()){var t=s.ImageFacade.getImageFormaForForma(e);if(t&&t.contentNode)return S.info("image preview placement:",t.placement),{colorThemeKey:H(),formaID:t.formaID,forma:t,url:W(t),styleFilter:t.style,placement:t.placement,width:t.contentNode.pixelWidth,height:t.contentNode.pixelHeight}}return{}},r.getFormaRenderList=function(){var e=[];let t=!1;const n=V(["FF0000"])[0];var o=F.firstPage.root.visitAsArray(s.FormaTraversal.PreOrder);const c=(t,n)=>e.push(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{type:n}));for(var l=0;l<o.length;l++){const i=o[l],{controller:a,formaID:u,kind:d}=i;if(a){const o={forma:i,formaID:u};if("Root"===d&&c(o,"background"),"Shape"===d&&c(o,"shape"),"Frame"===d)continue;if(i.isTypeLockup()&&c(o,"lockup"),d===s.ImageForma.KIND||d===s.VideoForma.KIND){const o=W(i);null==o?(S.error("no image url, cleaning up the document",{docId:F.uuid,imageFormaId:i.uuid}),t=!0,r.replaceImagesWithColors([i],[n]).done()):e.push({forma:i.parent,type:"image",formaID:i.parent.formaID,url:o,logo:i.isLogo(),colorThemeKey:H()})}}}return t&&(r.events.publish("show-image-forma-corrupted-modal",{backgroundColor:n.rgbColor.rgbHex}),r.validateDoc("missingContentCleanup")),e},r.imageFormas=function(){return F.firstPage.root.filterByKind(s.ImageForma.KIND)},r.canAddMoreImages=function(e){return r.imageFormas().length+e<=s.GridController.MAX_IMAGE_COUNT},r.hostImages=function(){var e=[];return r.imageFormas().forEach((function(t){void 0!==t.contentNode.image&&e.push(t.contentNode.image)})),e},r.iconFormas=function(){return F.firstPage.root.filterWithCallback((function(e){return e.hasIntent(s.Forma.INTENT_ICON)}))},r.lockupFormas=function(){return F.firstPage.root.filterByControllerKind(s.TypeLockupController.KIND)},r.logoFormas=function(){return r.imageFormas().filter((function(e){return e.isLogo()}))},r.backgroundImageFormas=function(){return F.firstPage.root.filterWithCallback((function(e){return e.kind===s.FrameForma.KIND&&e.isBackgroundImage()}))},r.getLockupWordCount=function(){for(var e=[],t=r.lockupFormas(),n=0;n<t.length;n++)e.push(t[n].controller.text.trim().split(/ |\n/).length);return e},r.getIconCount=function(){return r.iconFormas().length},r.getImageCount=function(){return r.imageFormas().length},r.getPotentialBackgroundImageCount=function(){return F.firstPage.root.filterWithCallback(e=>s.ImageFacade.isPotentialBackgroundImage(e)).length},r.documentSize=function(){return{width:F.firstPage.pageSize.width,height:F.firstPage.pageSize.height}},r.getDocumentSize=function(){return{width:F.firstPage.pageSize.width,height:F.firstPage.pageSize.height}},r.getImageSizeIfFullBleed=function(){var e=r.imageFormas();if(1===e.length){var t=e[0],n=r.getDocumentSize(),o=t.parent;if(o.finalFrame.width===n.width&&o.finalFrame.height===n.height&&t.contentNode)return{width:t.contentNode.pixelWidth,height:t.contentNode.pixelHeight}}return null},r.forceReloadEditor=function(e){r.events.publish("force-reload-editor",e)},r.shouldReloadOnActionFailure=function(){return l.isFeatureEnabled("post-reload-on-action-failure")},r.doAction=Q,r.flipForma=function(e,t){Q(new s.FlipAction(e,[t])).then((function(){r.events.publish("forma-flipped",{id:t.formaID,isImage:t.isImage()})}))},r.canDuplicateFormae=function(e){return s.DuplicateAction.canAddImages(e)},r.duplicateFormae=function(e){return g.currentlyExecutingAction()?t.reject():Q(new s.DuplicateAction(e,!0,!0)).then((function(t){for(var n=!1,o=0;o<e.length;o++)if(e[o].isImage()){n=!0;break}return r.events.publish("formae-duplicated",{duplicatedImage:n}),t}))},r.inCropMode=function(){return F.controller.selection.inCropMode},r.enterCropMode=function(){return N&&S.error("probable error. cropModeBranchStarted shouldn't be true"),N||g.currentlyExecutingAction()||r.inCropMode()?t():(N=!0,r.beginBranch(),Q(new s.EnterCropModeAction(r.getSelectedForma())))},r.exitCropMode=function(){return r.events.publish("exit-crop-mode"),g.currentlyExecutingAction()?t():Q(new s.ExitCropModeAction).then(()=>{N&&(r.endBranch(!0),N=!1)})},r.inSpecialSelectionMode=function(){return!0===r.inCropMode()||!0===r.inCharStyleMode},r.exitSpecialSelectionMode=function(){!0===r.inCropMode()&&r.exitCropMode().done(),!0===r.inCharStyleMode&&r.exitCharStyleMode()},r.setImageAsBackground=function(){return g.currentlyExecutingAction()?t():Q(new s.SetImageAsBackgroundAction).then(e=>(r.events.publish("image-set-background",{}),e))},r.setImageAsForeground=function(){return g.currentlyExecutingAction()?t():Q(new s.SetImageAsFloatingAction).then(e=>(r.events.publish("image-set-foreground",{}),e))},r.deleteFormae=function(e){for(var t=[],n=r.getSelectedForma(),o=0;o<e.length;o++)t.push(r.getFormaById(e[o].formaID));return e=t,r.inCharStyleMode&&null!=n&&n.isTypeLockup()&&r.exitCharStyleMode(),r.deselect(),Q(new s.DeleteAction(e)).then((function(){for(var t=[],n=!1,o=0;o<e.length;o++)t.push(e[o].formaID),n||(n=e[o].isImage());r.events.publish("formae-deleted",{ids:t,deletedImage:n})}))},r.groupItems=function(e,t,n){return Q(new s.GroupAction(e,t,n))},r.ungroupItems=function(e,t,n){return Q(new s.UngroupAction(e,t,n))},r.cleanupInvalidImageSync=function(e,t){if(e){const n=s.ImageFacade.getFrameFormaForForma(r.getFormaById(e)),o=r.beginTransaction("CleanUpCorruptImage");n&&s.CreationFacade.deleteFormae([n]),r.removeContentForCorruptImageFrame(t),r.endTransactionAndMergeWithPrevious(o),r.events.publish("formae-deleted",{ids:[e],deletedImage:n.isImage()})}},r.cleanupInvalidImageWithColorSync=function(e,t,n){if(e){const o=e&&r.getFormaById(e),i=r.beginTransaction("CleanUpCorruptImageWithColor");o&&s.ImageFacade.replaceImageWithColors(o,n),r.removeContentForCorruptImageFrame(t),r.endTransactionAndMergeWithPrevious(i)}},r.replaceImagesWithColors=function(e,t){return Q(new s.ReplaceImagesWithColorsAction(e,t))},r.getDeleteInfo=function(e){for(var t=r.getGridForma(),n=t&&1===t.style.numBackgroundCells,o=!1,i=!0,a=0;a<e.length;a++)if(e[a]&&e[a].isImage()&&e[a].isBackgroundImage()){o=!0,i=t.controller.canDeleteCellForForma(e[a])&&!n;break}return{isDeleteable:i,isBackgroundImage:o}},r.getSelectedBoundingBox=function(){return G()},r.getSwapState=function(){return F.controller.model.activeSwap.getActive()},r.isMultiSelect=function(){return s.SelectionFacade.isMultiSelect(F.controller.selection)},r.isGroupSelect=function(){const e=F.controller.selection.asFormaArray(),t=1===e.length&&e[0];return t&&t.kind===s.GroupForma.KIND&&t.intent===s.Forma.INTENT_USER_GROUP},r.getSelectedForma=function(){const e=F.controller.selection.asFormaArray();return e.length?e[0]:null},r.getAllSelectedFormas=function(){return F.controller.selection.asFormaArray()},r.getSelectedFormaId=function(){var e=r.getSelectedForma();return e?e.formaID:null},r.getSelectableFormaeIntersectingRect=function(e){return F.firstPage.selectableFormaeIntersectingRect(e)},r.removeStaleSelections=function(){F.controller.selection.removeStaleSelections()},r.getRootForma=function(){return F.firstPage.root},r.getDocument=function(){return F},r.getFormaById=function(e){return F.firstPage.formaByID(e)},r.selectFormaById=function(e){if(e.forma=r.getFormaById(e.formaId),e.forma)return r.selectForma(e),e.forma},r.marqueeSelectFormae=function(e,t){s.SelectionFacade.marqueeSelectFormae(e,t)},r.selectAll=function(){s.SelectionFacade.selectAllOnPage(F.firstPage)},r.deselectAll=function(){s.SelectionFacade.deselectAllOnPage(F.firstPage)},r.canSelectSibling=function(){return!r.inSpecialSelectionMode()&&s.SelectionFacade.canSelectSibling(F.firstPage)},r.selectSibling=function(e){s.SelectionFacade.selectSibling(F.firstPage,e)},r.canSelectParent=function(){return!r.inSpecialSelectionMode()&&s.SelectionFacade.canSelectParent(F.firstPage)},r.selectParent=function(){s.SelectionFacade.selectParent(F.firstPage)},r.canSelectChild=function(){return!r.inSpecialSelectionMode()&&s.SelectionFacade.canSelectChild(F.firstPage)},r.selectChild=function(){s.SelectionFacade.selectChild(F.firstPage)},r.deselect=function(e){e=e||{};var t=r.getSelectedForma();r.inCharStyleMode&&null!=t&&t.isTypeLockup()&&r.exitCharStyleMode(),r.inCropMode()&&r.exitCropMode().done(),F.controller.selection.clearSelection(!e.silent)},r.deselectForma=function(e){F.controller.selection.deselectForma(e)},r.formaIsSelected=function(e){return F.controller.selection.isSelected(e)},r.formaIsGroupSelected=function(e){return F.controller.selection.isGroupSelected(e)},r.selectForma=function(e){var t=r.getSelectedForma(),n=e.forma,o=e.silent,i=!e.multiselect;if(n&&(e.multiselect||r.getSelectedFormaId()!==n.formaID))if(e.multiselect&&r.formaIsSelected(e.forma))r.deselectForma(e.forma);else{if(r.inCharStyleMode&&null!=t&&t.isTypeLockup()&&r.exitCharStyleMode(),"Root"===n.kind&&!r.isBackgroundVisible())return S.error("error in selection. background is not visible, so don't allow selection"),void r.deselect();i&&r.deselect({silent:!0}),F.controller.selection.selectForma(n,!o)}},r.ensureBackgroundFormaSelected=function(){var e=r.getSelectedForma(),t=e&&!e.isTypeLockup()&&!e.isLogo()&&e.controller.moveable;if(!e||!(e.isBackgroundImage()||e.isShape()||"Root"===e.kind||e.isGridCell()||t)){var n=r.backgroundImageFormas();if(n.length>0)r.selectForma({forma:n[0]});else{var o=F.firstPage.root.filterByControllerKind("shape");o.length>0?r.selectForma({forma:o[0]}):r.selectForma({forma:F.firstPage.root})}}},r.ensureLockupSelected=function(){var e=r.getSelectedForma();if(!e||!e.isTypeLockup()){var t=r.lockupFormas();t.length>0&&r.selectForma({forma:t[0]})}},r.handleNudge=function(e){var t=e.translate;return Q(new s.NudgeAction(new s.TheoPoint(t.x,t.y)))},r.handleHandleFeedback=function(e){for(var t=F.controller.model.handles.getAll(),n=null,o=0;o<t.length;o++)!(t[o]instanceof s.BoxTransformHandles)||n&&t[o]instanceof s.BoxTransformMultipleFormae||(n=t[o]);if(n){var i;switch(e.action){case"begin":i=s.HandleTransformStage.Begin;break;case"update":i=s.HandleTransformStage.Update;break;case"end":i=s.HandleTransformStage.End;break;default:return void S.error("handleHandleFeedback: params.action wasn't an expected value; it was "+e.action)}var a,c=null;switch(e.part){case"rotate":c=new s.RotateAboutCenterTransformEvent(n,i,e.totalDeltaRadians||0);break;case"corner":a=Y(e.spot),c=new s.CornerTranslateTransformEvent(n,i,a,new s.TheoPoint(e.location.x,e.location.y));break;case"side":a=Y(e.spot),c=new s.SideTranslateTransformEvent(n,i,a,new s.TheoPoint(e.location.x,e.location.y));break;default:return void S.error("handleHandleFeedback: params.part wasn't an expected value; it was "+e.part)}c.viewportScale=r.getViewScale(),F.controller.designController.handles.handleTransformEvent(c)}},r.getSelectedFormaRotation=function(){var e=r.getSelectedForma();if(!e)return null;var t=e;return"Frame"===e.kind&&(t=t.childAt(0)),180*Math.atan2(t.placement.transformValues.rotSine,t.placement.transformValues.rotCosine)/Math.PI},r.getSelectedFormaHasShapeMask=function(){return s.ImageFacade.formaHasShapeMask(r.getSelectedForma())},r.getSelectedFormaScale=function(){var e=r.getSelectedForma();if(!e)return null;var t=e;return"Frame"===e.kind&&(t=t.childAt(0)),t.placement.extractedScale.scale.x},r.getSelectedFormaPlacement=function(){var e=r.getSelectedForma();if(!e)return null;var t=e,n="";return"Frame"===e.kind&&(n=(t=t.childAt(0)).contentNode.pixelWidth+"_"+t.contentNode.pixelHeight),{placement:t.placement,id:n}},r.getSelectedFormaScaleRange=function(){var e={},t=r.getSelectedForma();if(t&&"Frame"===t.kind&&!t.controller.moveable){var n=t.childAt(0),o=.1;if(n.contentNode){var i=t.finalFrame.size,a=n.contentNode.pixelWidth,c=n.contentNode.pixelHeight,l=a/c,s=i.width/i.height,u=i.width/a,d=i.height/c;o=l>s?d:u}n.hasAlpha()?(e.min=.1,e.max=2):(e.min=o,e.max=10*o)}return e},r.scaleSelectedForma=function(e,t){var n=r.getSelectedForma();"Frame"!==n.kind||n.controller.moveable&&!r.inCropMode()||(n=n.childAt(0));var o=e/n.placement.extractedScale.scale.x;return Q(new s.ScaleAction(o,[n]))},r.changeImageAdjustments=function(e){var t=r.getSelectedForma(),n=t;return t&&"Frame"===t.kind&&(n=t.childAt(0)),Q(s.ChangeImageAdjustmentsAction.ActionWithDictionary(e,[n]))},r.resetImageAdjustments=function(e){return r.changeImageAdjustments(e)},r.getImageAdjustments=function(e){var t=e||r.getSelectedForma();return t&&"Frame"===t.kind&&(t=t.childAt(0)),t.style.adjustments},r.rotateSelectedForma=function(e,t){var n=e/180*Math.PI,o=r.getSelectedForma();return"Frame"!==o.kind||o.controller.moveable&&!r.inCropMode()||(o=o.childAt(0)),Q(new s.RotateAction(n,t,[o],!0))},r.handleTextFormaBeginResize=function(e){if(e=e||r.getSelectedForma()){r.beginGesture();null!=e&&e.isTypeLockup()&&(e.controller.beginTouches(null),w=null)}},r.handleTextFormaEndResize=function(e){(e=e||r.getSelectedForma())&&r.endGesture(!0)},r.handleTextFormaResize=function(e,n){if(e&&e.isTypeLockup()&&null!=n.startForma){var o=new s.TheoPoint(n.touchPoint.x,n.touchPoint.y),r=0===n.spot.x&&.5===n.spot.y;return Q(new s.CharRangeHandleAction(e,o,n.startForma,r,w)).then((function(){w=o,ne(e)}))}return t.resolve(!1)},r.handleTapped=function(e){var t=e.forma||r.getFormaById(e.id);if(r.inCharStyleMode){null!=t&&t.isTypeLockup()&&t.controller.owner.selection.isSelected(t)&&t.controller.selectCharStyleForma();var n=new s.TheoPoint(e.x,e.y),o=F.firstPage.formaAtPointInSelection(n,F.controller.selection);if(null!=o&&null!=o.lockupForma)!function(e){if(!e||!e.lockupForma)return;Q(new s.ApplyCharStyleAction(e,s.TypeLockupController.HIGHLIGHT_STYLE,s.CharStyleApplyMode.Toggle,e.rangeInLockup)).done()}(o);else{var i=r.getSelectedForma();i.formaID&&e.forma.formaID!==i.formaID&&(r.exitCharStyleMode(),r.selectForma({forma:t}))}}else void 0!==t&&r.selectForma({forma:t});return!r.inCharStyleMode},r.getOriginalImageSize=function(){if(!r.inVisibleGridLayout()){var e=r.backgroundImageFormas();if(1===e.length){var t=e[0];return{width:t.childAt(0).contentNode.pixelWidth,height:t.childAt(0).contentNode.pixelHeight}}return null}},r.recordOriginalSize=function(){return Q(new s.RecordOriginalPageSizeAction(F.firstPage))},r.setPageSizeFromDesignSize=function(e,t){return t=t||{},Z(new s.ChangePageSizeAction(F.firstPage,e),(function(){var e=r.getDocumentSize(),n={width:e.width,height:e.height};return r.events.publish("document-size-changed",n),m.delay(t.delay||100)}))},r.getPageAspectRatio=function(){var e=r.getDocumentSize();return e.width/e.height},r.getDocumentSizeId=function(){return F.firstPage.sizeID},r.getDocumentOriginalSizeId=function(){return F.firstPage.originalSizeID},r.getPageCustomSizeFormat=function(){return F.firstPage.customSizeFormat},r.getPageCustomSizePPI=function(){return F.firstPage.customSizePPI},r.getPageExportData=function(){return F.firstPage.getPageExportData()},r.getExportData=function(){return F.firstPage.getExportData()},r.lockupFormaIDs=function(){var t=r.lockupFormas();return e.map(t,(function(e){return e.formaID}))},r.downloadNewLockupRandomFontsAsync=function(){if(!x){x=t.defer();h.loadMissingFonts(["Lato-Light","Lora-Regular","Montserrat-Regular","PlayfairDisplay-Regular","CantataOne-Regular","FuturaPT-Medium"]).then((function(){x.resolve()}))}},r.addNewLockup=function(e,n){S.assert(!!x,"Invalid random fonts loading promise."),n=n||{};var o=r.imageFormas();return(o.length>0?o[0].contentNode.image.getImageLoadedPromise():t.resolve()).then((function(){return Q(new s.AddTextContentAction(e))}))},r.addBadge=function(e,t){return r.getTemporaryDocumentWithFontsLoaded(e).then((function(e){return Q(new s.AddBadgeAction(e,t))}))},r.applyDesignTheme=function(e,n){var o=t.defer();return r.getTemporaryDocumentWithFontsLoaded(e).done((function(e){n=n||0;var t=F.firstPage.root;Q(s.ApplyTemplateAction.init_e1db(e,t,n,t)).then((function(){m.delay(40).done(o.resolve)}))})),o.promise},r.applyRetargetSuggestion=function(e,t){return Q(new s.ApplyTemplateAction.init_e1db(e,F.firstPage.root,t,F.firstPage.root)).then((function(){return m.delay(10)}))},r.getThemeId=function(){return F.content.root.getTag("theme:id")},r.getColorPaletteId=function(){return F.firstPage.colorLibrary.paletteID},r.getColorPalette=function(){var t=F.firstPage.colorLibraryController.getColorThemeAsArrayOfTheoColors();return e.map(t,(function(e){return{color:p.rgb2hex({r:255*e.rgbColor.red,g:255*e.rgbColor.green,b:255*e.rgbColor.blue}),roles:e.sparkRoles,id:e.sparkElementID}}))},r.setColorPalette=function(e,t){if(!e||!e.colors)return;t=t||{};const n=V(e.colors);return Q(new s.ApplyColorThemeAction(n,e.id,F.firstPage,!!t.shuffle))},r.applyAspectRatioCropToImage=function(e){var t=s.ImageFacade.getImageFormaForForma(r.getSelectedForma());if(e.id===s.CropRatioPresetLibrary.FREEFORM_ID)return Q(new s.SetImageCropToFreeformAction(t));var n=e.id===s.CropRatioPresetLibrary.ORIGINAL_ID?0:e.aspectRatio;return Q(new s.CropImageToRatioAction(t,n,e.cropToRatioUsingFrameBounds))},r.applyShapeMaskToImage=function(e){return Q(new s.ApplyShapeMaskToImageAction(r.getSelectedForma(),e.shapeId,e.cropToRatioUsingFrameBounds))},r.shuffleColorPalette=function(){return Q(new s.ShuffleColorThemeAction(F.firstPage))},r.getImageFilters=function(){for(var e=F.firstPage.imageFilterLibrary.getImageStyles(),t=e.length-1;t>=0;t--)e[t].colors.library=F.firstPage.colorLibrary;return e},r.setImageFilterForSelection=function(e,n,o){var i=r.getSelectedForma();return i&&i.isImage()?Q(0===n?new s.SetImageFilterAction(e,o):new s.ShuffleImageFilterAction(e,F.firstPage,o)):t.resolve(!1)},r.getTextForSelectedLockup=function(){var e=r.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller.contentNode;return t?t.text:null}},r.shouldSuggestTransparentBackground=function(){return F.firstPage.root.controller.suggestTransparentBackground()},r.setBackgroundTransparency=function(e){return Q(new s.SetBackgroundOpacityAction(e,F.firstPage))},r.getFullCanvasColor=function(){var e=s.TypeLockupUtils.getFullCanvasLockups(F.firstPage.root);return e.length>0&&1===e[0].lockupStyle.backingOpacity?e[0].lockupStyle.colors.fieldSecondary:null},r.setTextForSelectedLockup=function(e){var n=r.getSelectedForma();if(!n)return t.resolve();var o=n&&n.formaID;return Z(new s.SetTextAction(e,n),(function(){return n=r.getFormaById(o),r.events.publish("forma-text-updated",{forma:n}),m.delay(10)}))},r.getDominantColorRoleOfLockup=function(e){if(!e||!e.isTypeLockup())return s.ColorRole.FieldPrimary;var t=e.controller.styleController.targetedLockupStyle;return t.textLook===s.LockupTextLook.KnockoutOnly||t.textLook===s.LockupTextLook.OutlineOnly?s.ColorRole.FieldSecondary:s.ColorRole.FieldPrimary},r.setColorsForSelectedLockup=function(e,n){var o=r.getSelectedForma();if(o&&o.isTypeLockup()&&o.formaID){var i=z(e);return Q(new s.ApplyColorAction(null,i,r.inCharStyleMode,n))}return t.resolve(!1)},r.getShapeFormaTheoColor=function(e){if((e=e||r.getSelectedForma())&&e.isShape()){var t=e.style.colors.color(s.ColorRole.FieldPrimary);return F.firstPage.colorLibraryController.getTheoColorForSolidColor(t)}},r.getLockupFormaColors=function(e,t){if((e=e||r.getSelectedForma())&&e.isTypeLockup()){t="boolean"!=typeof t||t;var n=e.controller,o=t?n.styleController.targetedLockupStyle.colors:n.lockupStyle.colors,i=o.fieldPrimary||new s.SolidColor(1,1,1,1),a=o.fieldSecondary||new s.SolidColor(1,1,1,1),c=F.firstPage.colorLibraryController.getTheoColorForSolidColor(i),l=F.firstPage.colorLibraryController.getTheoColorForSolidColor(a),u=[{red:Math.round(255*c.rgbColor.red),green:Math.round(255*c.rgbColor.green),blue:Math.round(255*c.rgbColor.blue),alpha:1,id:c.sparkElementID,roles:c.sparkRoles},{red:Math.round(255*l.rgbColor.red),green:Math.round(255*l.rgbColor.green),blue:Math.round(255*l.rgbColor.blue),alpha:1,id:l.sparkElementID,roles:l.sparkRoles}];return r.selectedLockupHasOnlyOneColor(e)&&(r.getDominantColorRoleOfLockup(e)===s.ColorRole.FieldSecondary?u.splice(0,1):u.splice(1)),u}},r.selectedLockupHasOnlyOneColor=function(e){if(!(e=e||r.getSelectedForma())||!e.isTypeLockup())return!0;var t="none"!==r.getShapeOfSelectedLockup(e),n=e.controller.styleController.targetedLockupStyle.textLook;return t?n===s.LockupTextLook.KnockoutOnly||n===s.LockupTextLook.OutlineOnly:n===s.LockupTextLook.OutlineOnly||n===s.LockupTextLook.Fill||s.LockupTextLook.UNSET},r.setFontForSelectedLockup=function(e){var n=l.fontProvider.descriptorForPostScriptName(e.postScriptName);if(n.postScriptName===e.postScriptName){var o=h.getFontData(e.postScriptName),i=s.TheoFont.init_9e5c(n,o.sparkElementId,o.acRoles);return Z(new s.SetFontAction(i,r.inCharStyleMode),(function(){var e=r.getSelectedForma();e&&ee(e)}))}return t.reject("cannot find font with PostScriptName: "+e.postScriptName)},r.updataDocForTypekitFontDeactivated=function(e){F&&e&&(s.TypeLockupUtils.replaceFontsInDocument(F,[e]),te(!1),E())},r.getLockupFontOfSelectedLockup=function(e,t){if((e=e||r.getSelectedForma())&&e.isTypeLockup()){t="boolean"!=typeof t||t;var n=e.controller;return t?n.styleController.targetedLockupStyle.font:n.lockupStyle.font}},r.setShapeForSelectedLockup=function(e){return r.getSelectedForma()?isNaN(e)?r.applyBackingToLockup(7,e,r.getSelectedFormaId()):r.applyBackingToLockup(e,null,r.getSelectedFormaId()):t.resolve()},r.getEffectForSelectedLockup=function(e){if((e=e||r.getSelectedForma())&&e.isTypeLockup())return e.controller.styleController.getTextLookForUI()},r.setEffectForSelectedLockup=function(e){return r.getSelectedForma()?Q(new s.SetTextLookAction(e)):t.resolve()},r.toggleFillOfSelectedLockup=function(e){if(r.getSelectedForma()&&r.getSelectedForma().isTypeLockup()){var t,n=r.getSelectedForma().controller.styleController;return t=e?s.LockupTextLook.OutlineOnly:n.targetedStrokeWeight>.12?s.LockupTextLook.FillAndOutline2:s.LockupTextLook.FillAndOutline,Q(new s.SetTextLookAction(t))}},r.isLockupOutlineOnly=function(e){if((e=e||r.getSelectedForma())&&e.isTypeLockup())return e.controller.styleController.targetedLockupStyle.textLook===s.LockupTextLook.OutlineOnly},r.getStrokeWeightOfSelectedLockupForUI=function(e){if((e=e||r.getSelectedForma())&&e.isTypeLockup())return Math.round(e.controller.styleController.getStrokeWeightPercentForUI())},r.setStrokeWeightSelectedLockup=function(e,t){t=t||r.getSelectedForma();var n=function(e){return(e-1)/99}(e);return Q(new s.SetTextEffectsAttributesAction(n,NaN,NaN))},r.getShadowOffsetOfSelectedLockupForUI=function(e){if((e=e||r.getSelectedForma())&&e.isTypeLockup())return Math.round(e.controller.styleController.getShadowOffsetPercentForUI())},r.setShadowOffsetOfSelectedLockup=function(e,t){t=t||r.getSelectedForma();var n=function(e){return(e-1)/99}(e);return Q(new s.SetTextEffectsAttributesAction(NaN,n,NaN))},r.getShadowAngleOfSelectedLockup=function(e){if((e=e||r.getSelectedForma())&&e.isTypeLockup()){var t=e.controller.styleController.targetedShadowAngle;return t>180?t-360:t}},r.setShadowAngleOfSelectedLockup=function(e,t){return t=t||r.getSelectedForma(),e=e<0?e+360:e,Q(new s.SetTextEffectsAttributesAction(NaN,NaN,e))},r.applyBackingToLockup=function(e,t,n){var o=r.getFormaById(n),i=e;if(9===e){var a=o.controller.size;i=a.width>a.height?9:8}return Q(new s.ChangeBackgroundShapeAction([o],i,t,r.inCharStyleMode))},r.getShapeOfSelectedLockup=function(e){if((e=e||r.getSelectedForma())&&e.isTypeLockup()){var t,n=e.controller.styleController.targetedLockupStyle.backing;if(7===n)t=e.controller.styleController.targetedLockupStyle.backingArtworkID;else{t={0:"none",2:"row",4:"shadow",8:"banner",9:"banner",11:"knockout"}[n]}return t}},r.setLetterSpacingForSelectedLockup=function(e){var n=r.getSelectedForma();return n&&n.isTypeLockup()?Q(new s.SetTrackingAction(e,O)):t.resolve(!1)},r.setCurrentPin=function(){if(O=s.TheoPoint.ZERO,r.getSelectedForma()&&r.getSelectedForma().isTypeLockup()){var e=r.getSelectedForma().controller.getPin(!0,!0);null!=e&&(O=e.pinPoint)}},r.setSpacingForSelectedLockup=function(e){var n=r.getSelectedForma();return n&&n.isTypeLockup()?Q(new s.SetLeadingAction(e,O)):t.resolve(!1)},r.setPaddingForSelectedLockup=function(e){var n=r.getSelectedForma();return n&&n.isTypeLockup()?Q(new s.SetPaddingAction(e,O)):t.resolve(!1)},r.getSpacingAndPaddingOfSelectedLockup=function(){var e=r.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller.styleController,n=t.targetedLockupStyle.spacing,o=t.targetedLockupStyle.padding;return{spacing:"number"==typeof n?n:parseFloat(n),padding:"number"==typeof o?o:parseFloat(o)}}},r.getLetterSpacingSelectedLockup=function(){var e=r.getSelectedForma();if(e&&e.isTypeLockup())return e.controller.styleController.targetedLockupStyle.tracking},r.areSpacingAndPaddingAvailableForSelectedLockup=function(){var e=r.getSelectedForma();return!(!e||!e.isTypeLockup())&&e.controller.styleController.areSpacingAndPaddingOptionsAvailable()},r.isSpacingAvailableForSelectedLockup=function(){var e=r.getSelectedForma();return!(!e||!e.isTypeLockup())&&e.controller.styleController.hasSpacingOptions()},r.isPaddingAvailableForSelectedLockup=function(){var e=r.getSelectedForma();return!(!e||!e.isTypeLockup())&&e.controller.styleController.hasPaddingOptions()},r.setLayoutAndAlignmentForSelectedLockup=function(e,n){var o=r.getSelectedForma();return o&&o.isTypeLockup()&&o.formaID?(L++,Q(new s.ChangeTextLayoutAndAlignmentAction(e,n)).then((function(){L--}))):t.resolve(!1)},r.getSuggestedColorsForLockup=function(t){if((t=t||r.getSelectedForma())&&t.isTypeLockup()){var n=t.controller.styleController.getSuggestableColors();return e.map(n,(function(t){return e.map(t,(function(e){return{red:255*e.rgbColor.red,green:255*e.rgbColor.green,blue:255*e.rgbColor.blue,id:e.sparkElementID,roles:e.sparkRoles}}))}))}},r.getBrandKitColorsPalettesForSelectedLockup=function(t){if(!r.getSelectedForma()||!r.getSelectedForma().isTypeLockup()||!t)return{colors:[]};var n=s.TheoBrandkitUtils.getBrandkitColorsForUI(t,r.getSelectedForma()),o=e.map(n,(function(t){return e.map(t,(function(e){return{red:255*e.rgbColor.red,green:255*e.rgbColor.green,blue:255*e.rgbColor.blue,id:e.sparkElementID,roles:e.sparkRoles}}))}));return{name:t.name,id:t.id,colors:o}},r.createFormaFromSVG=function(e,t,n){var o=e.original.link,i=new XMLHttpRequest;i.open("GET",o,!0),i.onload=function(a){var c=i.responseText,u=s.SVGParserUtils.theoArtworkFromSVGData(c,!0);l.pathUtils.cacheArtworkForURL(o,u),Z(new s.AddIconContentAction(o,t,n),(function(t){var n="";if(!(t.formae&&t.formae.length&&t.formae[0]instanceof s.ShapeForma))throw new Error("AddIconContentAction did not return a shapeForma");{const e=t.formae[0];n=e.contentID;var o=r.beginTransaction("temp_svg_content_node_url");e.contentNode.url="uploading svg",r.endTransactionAndMergeWithPrevious(o)}var i=new Blob([c],{type:e.mimeType});r.saveImageComponent(i,e.mimeType).then((function(e){var t={contentNodeID:n,url:e.encodedUrl,componentID:e.component.id};r.updateVectorContentNodeWithComponent(t)})).catch((function(e){S.error("failed to upload SVG file",e)})).done()})).done()},i.onerror=function(){S.error("failed to download SVG icon file")},i.send()},r.getLayoutOfSelectedLockup=function(){var e=r.getSelectedForma();if(e&&e.isTypeLockup())return s.TextFacade.getLayoutForForma(e)},r.getAlignmentOfSelectedLockup=function(){var e=r.getSelectedForma();if(e&&e.isTypeLockup())return s.TextFacade.getAlignmentForForma(e)},r.getAllowedAlignmentStates=function(){var e=r.getSelectedForma();return e?e.controller.styleController.layoutSelector.values:[]},r.getUserFontSizesInDocument=function(){return s.TypeLockupUtils.sizesInDocument(F,void 0,!0).map(e=>s.TextFacade.toUserFontSize(e,F.firstPage))},r.getUserFontSizeOfSelectedForma=function(){var e,t=r.getSelectedForma();if(t&&t.isTypeLockup()){const n=t.controller.getCurrentFontSize();e=s.TextFacade.toUserFontSize(n,t.page)}return e},r.setFontSize=function(e){return Q(new s.SetFontSizeAction(e))},r.getOpacitySliderValueOfSelectedForma=function(){var e=r.getSelectedForma();return e&&e.controller?s.OpacityFacade.getOpacityForForma(e):1},r.setLayerForSelectedForma=function(e){var t=r.getSelectedForma(),n=t.controller.getMinLayerIndex()+e;return Q(new s.ChangeZOrderAction(n)).then((function(){r.updateLayers(t)}))},r.getLayerSliderValueOfSelectedForma=function(){var e=r.getSelectedForma();if(e)return e.controller.getZOrder()-e.controller.getMinLayerIndex()},r.getNumLayers=function(){var e=r.getSelectedForma();if(e)return e.controller.getReorderableLayerCount()},r.updateLayers=function(){r.events.publish("forma-layer-changed")},r.canSave=function(){return k&&M()},r.setColorForSelection=function(e){return Q(new s.ApplyColorAction(null,z(e)))},r.addLogo=function(e){var t=F.content.root.visit(t=>t instanceof s.URLBasedContentNode&&t.sparkElementID===e.id);return Q(t?new s.AddContentAction(t):new s.AddLogoContentAction(F.firstPage,e,null,null,e.componentId))},r.addOrReplaceImage=function(n){S.info("adding image. is low res? "+String(n.isLowResImage));var o=n.replacementForma;if(null!=n.replacementFrame&&null==o.parent)for(var i=F.firstPage.root.filterByKind(s.FrameForma.KIND),a=0;a<i.length;a++)i[a].finalFrame.equalWithAccuracy(n.replacementFrame,.001)&&(o=i[a],S.info("matched by frame"));o&&o.isShape()&&o.controller.moveable&&(S.error("Assertion fail. We shouldn't be asking to replace a moveable shape (at this point)."),o=null),l.imageAnalysis.updateHostImageCacheKey(n.metadata.sourceURL,n.url);var c=t.defer(),u=n.floatingImageStrategy||s.FloatingImageStrategy.IfHasAlphaOrIsLogo,d=new s.AddFormaParams(s.ControllerSettingsBehaviorEnum.IgnoreControllerSettings,!0,o,u);return Z(new s.AddImageContentAction(F.firstPage,n.url,n.mimeType,n.width,n.height,n.hasAlpha,n.metadata,null,null,d,s.ActionUndoability.useDefault,n.id,!0),(function(t,o){if(o)c.reject(new r.ActionError(o));else{var i=r.getImageFormaForURL(n.url),a=i.parent.isBackgroundImage()?i.parent:i;n.formaId=a.formaID,n.contentNodeId=a.contentID,r.events.publish("forma-added",{id:a.contentID,isLowResImage:n.isLowResImage}),e.delay((function(){c.resolve(n)}),10)}})),c.promise},r.replaceImageWithHighRes=function(t){S.assert("string"==typeof t.contentNodeId,"can not patch content node with contentNodeId"),S.assert("string"==typeof t.lowResImageUrl,"can not patch content node without lowResImageUrl");return A.push((function(){var n=F.content.nodeByID(t.contentNodeId);if(n&&n.url===t.lowResImageUrl){var o=s.Matrix2D.uniformScaling(t.width>t.height?n.pixelWidth/t.width:n.pixelHeight/t.height),i=!1;if(e.each(r.imageFormas(),(function(e){e.contentNode.id===t.contentNodeId&&(g.beginPatch(),n.mediaMetadata=t.metadata,n.url=t.url,n.pixelWidth=t.width,n.pixelHeight=t.height,n.mimeType=t.mimeType,n.hasAlpha=t.hasAlpha,l.imageAnalysis.updateHostImageCacheKey(t.lowResImageUrl,t.url),e.placement=o.concat(e.placement),e.invalidateCachedBounds(),i=!0,g.endPatch())})),!i)F.firstPage.formaByID(t.id)||(g.beginPatch(),n.mediaMetadata=t.metadata,n.url=t.url,n.pixelWidth=t.width,n.pixelHeight=t.height,n.mimeType=t.mimeType,n.hasAlpha=t.hasAlpha,l.imageAnalysis.updateHostImageCacheKey(t.lowResImageUrl,t.url),i=!0,g.endPatch())}})),K()},r.updateVectorContentNodeWithComponent=function(e){return A.push((function(){var t=F.content.nodeByID(e.contentNodeID);t&&"uploading svg"===t.url&&"vector"===t.kind&&(g.beginPatch(),t.url=e.url,t.componentID=e.componentID,g.endPatch())})),K()},r.textLockupHighlight=function(){const e=r.beginTransaction("apply_lockup_highlight_box");var t=r.getSelectedForma();(new s.FormaCalloutUtils).applyLockupHighlightBox(t),r.endTransaction(e)},r.getLockupStyleStringWithRole=function(e){var t="";null!=e&&e.style.wheelUsed&&(t=e.style.getCompressedStringOfFeatures(),t+="{role:"+(new s.RoleSuggester).getRole(e).role+"|id:"+e.formaID+"|docId:"+F.uuid+"}");return t},r.getStyleServiceMetaDataString=function(e){var t=null;if(null!=e){const{controller:n}=e,{text:o,size:{width:r,height:i}}=n,{tracking:a,spacing:c}=n.lockupStyle,{width:l,height:s}=e.page.pageSize,u=o.replace(/^\W+|\W+$/g,"").split(/\W+/g).length,d=n.numLines();t="trng:".concat(a,",spng:").concat(c,",w:").concat(Math.round(r),",h:").concat(Math.round(i))+",page_w:".concat(Math.round(l),",page_h:").concat(Math.round(s))+",words:".concat(u,",lines:").concat(d)}return t},r.getAllStringForFormaUsedWheelSuggestions=function(){var e=[];return r.lockupFormas().forEach((function(t){var n=r.getLockupStyleStringWithRole(t);n.length>0&&e.push(n)})),e},r.getCurrentDocumentSynthesizedName=function(){return F.getSynthesizedTitle()},r.getCurrentDocumentDescription=function(){return F.getSynthesizedDescription()},r.getGridForma=function(e){var t=F.firstPage.root.filterByControllerKind(s.GridController.KIND);return t.length>0?t[0]:e?F.firstPage.root.controller.createGridControllerIfNone().forma:null},r.getAllGridStyles=function(){var e=t.defer();return setTimeout((function(){try{var t=F.firstPage.layoutLibrary.getLayoutsForRoot(F.firstPage.root);e.resolve(t)}catch(t){e.reject(t)}}),0),e.promise},r.retrieveAndApplyASuggestedGridStyle=function(){var e=s.LayoutSuggester.createContentAwareSuggestions(F.firstPage.root);return e.length?r.applyGridStyle({name:e[0].name,gridStyle:e[0].gridStyle,silent:!1},0):t.resolve()},r.applyGridStyle=function(e,t){return Q(new s.SetGridStyleAction(e.gridStyle,t))},r.inAutomaticLayoutMode=function(){return F.controller.inAutomaticLayoutInteractionMode},r.enableAutomaticLayoutMode=function(){F.controller.setAutomaticLayoutInteractionMode();var e=r.getGridForma();if(e){var t=r.beginTransaction("inferGridCellAssignment");e.controller.inferGridCellAssignment(),r.endTransactionAndMergeWithPrevious(t),e.style.moveableShift=!0}},r.disableAutomaticLayoutMode=function(){F.controller.setDefaultInteractionMode()},r.enterCharStyleMode=function(){var e=r.getSelectedForma();e&&e.isTypeLockup()&&(r.inCharStyleMode=!0,Z(new s.EnterCharStyleModeAction(e),(function(){ne(e),r.events.publish("enter-char-style-mode")})).done())},r.exitCharStyleMode=function(){if(r.inCharStyleMode){var e=r.getSelectedForma();e&&e.isTypeLockup()&&(r.inCharStyleMode=!1,Z(new s.ExitCharStyleModeAction(e),(function(){r.events.publish("text-forma-selected",{id:e.formaID,forma:e,selectionBoxes:[]}),r.events.publish("exit-char-style-mode")})).done())}},r.exitCharStyleModeAndSelect=function(){if(r.inCharStyleMode){var e=r.getAllSelectedFormas();0!==e.length&&e[0].isTypeLockup()&&(r.exitCharStyleMode(),r.deselect({silent:!0}),r.selectForma({forma:e[0]}),r.events.publish("forma-selected",{id:e[0].formaID,forma:e[0],selectionBox:G()}))}},r.toggleCharStyleLinesMethods=function(){var e=r.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller;switch(t.highlightMethod){case s.HighlightMethod.EvenRows:t.highlightMethod=s.HighlightMethod.OddRows;break;case s.HighlightMethod.OddRows:t.highlightMethod=s.HighlightMethod.Bracket;break;case s.HighlightMethod.Bracket:t.highlightMethod=s.HighlightMethod.InsideBracket;break;default:t.highlightMethod=s.HighlightMethod.EvenRows}oe(t,e)}},r.toggleCharStyleWordsMethods=function(){var e=r.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller;t.highlightMethod===s.HighlightMethod.EvenWords?t.highlightMethod=s.HighlightMethod.OddWords:t.highlightMethod=s.HighlightMethod.EvenWords,oe(t,e)}},r.clearStyleRanges=function(){var e=r.getSelectedForma();if(e&&e.isTypeLockup())return Q(new s.SetHighlightMethodAction(s.HighlightMethod.Manual))},r.getLayoutMargin=function(){var e=r.getGridForma();return null!=e?e.controller.margin:0},r.getLayoutSpacing=function(){var e=r.getGridForma();return null!=e?e.controller.spacing:0},r.setLayoutSpacing=function(e){return Q(new s.SetGridParametersAction(e,NaN))},r.setLayoutMargin=function(e){return Q(new s.SetGridParametersAction(NaN,e))},r.setLayoutSpacingAndMargin=function(e,t){var n=NaN,o=NaN;return e>=0&&(n=e),t>=0&&(o=t),Q(new s.SetGridParametersAction(n,o))},r.prepareForGridLayouts=function(){Q(new s.EnterGridLayoutModeAction)},r.inVisibleGridLayout=function(){var e=r.getGridForma();return null!=e&&e.style.gridCells.length>1},r.spacingChangesVisible=function(){var e=r.getGridForma();return null!=e&&e.controller.spacingChangesVisible},r.allowFlip=function(e){return e.controller.flippable},r.allowDuplication=function(e){return e.controller.duplicatable},r.allowCrop=function(e){return s.ImageFacade.canCropImage(e)},r.allowSetForeground=function(e){return s.ImageFacade.canSetFloatingImage(e)},r.allowSetBackground=function(e){return s.ImageFacade.canSetBackgroundImage(e)},r.allowDeletion=function(e){for(var t=!0,n=0;n<e.length;n++)if(!e[n].controller.deleteable){t=!1;break}return t},r.hasImageAttribution=function(t){if((t=t||r.getSelectedForma()).hasIntent(s.Forma.INTENT_ICON)||t.isImage()&&!t.isLogo()){var n=r.getImageFormaAttributionInfo(t);if(e.isEmpty(n))return!1;var o=n.sourceName;if(o&&-1!==["unsplash","pixabay","flickr","adobe stock","the noun project","giphy"].indexOf(o.toLowerCase()))return!0}return!1},r.isIcon=function(e){return!!(e=e||r.getSelectedForma()).hasIntent(s.Forma.INTENT_ICON)},r.isGiphy=function(e){return r.getImageFormaAttributionInfo(e).sourceName===s.MediaMetadata.kMediaGiphySourceName},r.formaOpacityChangeable=function(){var e=r.getSelectedForma();return!!e&&e.controller.opacityChangeable},r.getFormaOpacity=function(){return r.getSelectedForma().style.opacity},r.setFormaOpacity=function(e){return Q(new s.SetOpacityAction(e))},r.isFormaSwappable=function(e){return!!r.getGridForma()&&(e.controller&&!e.controller.moveable&&"Root"!==e.kind)},r.getSwappableForma=function(){for(var e=[],t=F.firstPage.root.visitAsArray(s.FormaTraversal.PreOrder),n=0;n<t.length;n++){var o=t[n];if(r.isFormaSwappable(o)){var i={forma:o,formaID:o.formaID};"Shape"===o.kind&&(i.type="shape",e.push(i)),"Frame"===o.kind&&(i.type="frame",e.push(i))}}return e},r.setSwapMode=function(e,t){b=e;var n=r.getSelectedForma();if(n&&"Frame"===n.kind){var o=n.childAt(0);!b&&t&&I&&(S.info("disable swap mode ",I),o.placement=I,I=null)}},r.getPointInDocumentSpace=function(e,t){var n=r.getDocumentSize(),o=n.width*e,i=n.height*t;return new s.TheoPoint(o,i)},r.getDesignHeight=function(){return r.getSelectedForma().root.finalFrame.height},r.getFormaSize=function(e){return _(e)},r.getDocumentMetadataEvents=function(){return s.TheoDocumentUtils.getMetadataEvents(F,!1)},r.getAllDesignIngredientIDsAndTypes=function(){return s.TheoDocumentUtils.getAllDesignIngredientIDsAndTypes(F)},r.getContentCountsString=function(){return s.TheoDocumentUtils.getContentCountsString(F)},r.getExtendedContentCountsString=function(){return s.TheoDocumentUtils.getExtendedContentCountsString(F)},r.getAppliedVariationTemplateId=function(){return s.TheoDocumentUtils.getAppliedVariationTemplateId(F)},r.getAppliedLayoutId=function(){return s.TheoDocumentUtils.getAppliedLayoutId(F)},r.getMaxGridCells=function(){return s.GridController.MAX_CELL_COUNT},r.setPersistSave=function(e){return(P=e).initialize()},r.whenInitialized=function(){return T},r.updateColorInTheme=function(e,t){var n=p.solidColor2TheoColor(p.hex2SolidColor(e.color),e.id,e.roles),o=p.solidColor2TheoColor(p.hex2SolidColor(t.color),t.id,t.roles),r=F.firstPage.colorLibraryController.getKeyOfColorInTheme(n);return Q(new s.ModifyColorThemeAction(o,r))},r.isSparkColorInUse=function(e){return F.firstPage.colorLibraryController.isSparkColorInUse(e)},r.updateSparkColor=function(e){if(F.firstPage.colorLibraryController.isSparkColorInUse(e.sparkElementID)){const t=r.beginTransaction("update_spark_color");F.firstPage.colorLibraryController.updateSparkColor(e),r.endTransaction(t)}return t.resolve()},r.areSparkFontsInUse=function(e){return s.TheoBrandkitUtils.areSparkFontsInUse(F,e)},r.updateSparkFont=function(e){if(s.TheoBrandkitUtils.areSparkFontsInUse(F,[e.id])){const t=r.beginTransaction("update_spark_font");s.TheoBrandkitUtils.updateSparkFont(F,e),r.endTransaction(t)}return t.resolve()},r.relinkSparkFont=function(e,n){if(s.TheoBrandkitUtils.areSparkFontsInUse(F,[e])){const t=r.beginTransaction("relink_spark_font");s.TheoBrandkitUtils.relinkSparkFont(F,e,n),r.endTransaction(t)}return t.resolve()},r.areSparkLogosInUse=function(e){return s.TheoBrandkitUtils.areSparkLogosInUse(F,e)},r.updateSparkLogo=function(e){if(s.TheoBrandkitUtils.areSparkLogosInUse(F,[e.id])){const t=r.beginTransaction("update_spark_logo");s.TheoBrandkitUtils.updateSparkLogo(F,e),r.endTransaction(t)}return t.resolve()},r.relinkSparkLogo=function(e,n){if(s.TheoBrandkitUtils.areSparkLogosInUse(F,e)){const t=r.beginTransaction("relink_spark_logo");s.TheoBrandkitUtils.relinkSparkLogo(F,e,n),r.endTransaction(t)}return t.resolve()},r.brandDocument=function(e){var t=e.fonts&&e.fonts.length,n=e.logos&&e.logos.length,o=e.colors&&e.colors.length;return Q(new s.BrandifyAction(e,t,n,o))},r.changeBranding=function(e){const t=F.authoringContextID,n=s.MultiBrandFacade.activeBrandkitID;return Q(new s.ChangeBrandingAction(e,t,n))},r.handleCurrentBrandChanged=function(e){r.events.publish("current-brand-changed",e)},r.addBranding=function(e){return l.setCoreWrapper(this),Q(new s.AddBrandingAction(e))},r.stripBranding=function(){return Q(new s.RemoveBrandingAction)},r.getBrandedElementsUsage=function(){return s.TheoBrandkitUtils.getDocumentBrandedElementsUsage(F,!0,!1)},r.includesUploadedFonts=function(){return r.getBrandedElementsUsage().indexOf(s.TheoBrandkitUtils.kBrandUsageCustomFont)>-1},r.getFontsUsed=function(){return s.TheoDocumentUtils.getFontsUsed(F)},r.getDocFontSourceUsage=function(){return s.TheoDocumentUtils.getFontSourceUsage(F)},r.getWatermarkEnabledForDoc=function(){return F?!("watermarkEnabled"in F)||F.watermarkEnabled:(S.error("Attempting to set watermarkEnabled with no document loaded."),!1)},r.setWatermarkEnabledForDoc=function(e){F?Q(new s.SetWatermarkAction(e)).done():S.error("Attempting to set watermarkEnabled with no document loaded.")},r.getImageFormaAttributionInfo=function(e){return e&&(t=e.kind===s.ImageForma.KIND||e.hasIntent(s.Forma.INTENT_ICON)?e.contentNode:e.childAt(0).contentNode)&&t.mediaMetadata||{};var t},r.setAuthoringContextThemeId=function(e){const t=r.beginTransaction("set branded template ID");F.authoringContextThemeID=e,r.endTransactionAndMergeWithPrevious(t)},r.getAuthoringContextThemeId=function(){return F.authoringContextThemeID},r.updateConstrainedImages=function(){s.TheoDocumentUtils.updateConstrainedImageInfo(F)},r.getConstrainedImages=function(){return F.constrainedImages},r.getUnreportedNounProjectIds=function(){return s.TheoDocumentUtils.getUnreportedUsedIcons(F)||[]},r.setNounProjectIdsReported=function(e){var t=r.beginTransaction("setNounProjectIdsReported");s.TheoDocumentUtils.reportedIconUsage(F,e),r.endTransactionAndMergeWithPrevious(t)},r.getHighlightMethodEnum=function(){return s.HighlightMethod},r.synthesizeEmptyImages=function(){F.content.root.visitAll((function(e){if("image"===e.kind&&null==e.url){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.pixelWidth,t.height=e.pixelHeight;var o=n.createLinearGradient(0,0,t.width,t.height),r=e.imageColorData;r.sort((function(e,t){return e.coverage<t.coverage?1:e.coverage>t.coverage?-1:0})),r.length>1?(o.addColorStop(0,"#"+r[0].rgbColor.hex.substring(0,6)),o.addColorStop(1,"#"+r[1].rgbColor.hex.substring(0,6))):(o.addColorStop(0,"#000"),o.addColorStop(1,"#fff")),n.fillStyle=o,n.fillRect(0,0,t.width,t.height),e.componentID=s.GUIDUtils.makeGUID(),e.url=t.toDataURL()}}))},r.setRemixParentCpId=function(e){F.setRemixParentCpId(e)},r.getRemixParentsCpIds=function(){return F.remixAncestorsCpAssetIDs},r.getRemixAncestorsIntoMachineTags=function(t){return t=(t=t||[]).filter((function(e){return-1===e.indexOf("_REMIX_")})),t=e.union(t,F.getRemixAncestorsCpMachineTags())},r.getEditorModelColorSelection=function(){var e=F.controller.model.attributes.find(s.ColorAttribute.KEY);return e?e.colors:[]},r.handlePointerChanged=function(e){var t=new s.TheoPoint(e.x,e.y),n="touch"===e.pointerType?1:0,o=l.async.getSystemUptimeInSeconds(),r=new s.PointerUpdate(""+e.pointerId,n,F.firstPage,t,o);r.tapCount=e.tapCount,r.modifierKeys=e.modifierKeys,"pointerDown"===e.updateType?F.controller.pointers.onPointersDown([r]):"pointerMove"===e.updateType?F.controller.pointers.onPointersMoved([r]):"pointerUp"===e.updateType&&F.controller.pointers.onPointersUp([r])},r.setViewScale=function(e){F.controller.viewScale=e},r.getViewScale=function(){return F.controller.viewScale},r.getGroupFeatures=function(){var e=F.controller.model.featureSets.find(s.FormaEditFeature.KEY);return{canGroup:e&&e.canGroup,canUngroup:e&&e.canUngroup}},r.getSettableFeatures=function(){var e={},t=F.controller.model.featureSets.find(s.AlignSpacingAttributesFeature.KEY);e.canAlign=t&&t.canAlign,e.canDistribute=t&&t.canDistribute;var n=F.controller.model.featureSets.find(s.OpacityAttributesFeature.KEY);e.opacity=!!n;var o=F.controller.model.featureSets.find(s.ImageFeature.KEY);return e.imageFilter=!!o&&o.canApplyFilter,e},r.getAlignmentTypes=function(){return s.AlignmentType},r.getDistributeTypes=function(){return s.DistributeType},r.setOpacityForSelectedFormae=function(e){return Q(new s.SetOpacityAction(e))},r.getOpacityValuesForSelectedFormae=function(){return F.controller.model.attributes.find(s.OpacityAttribute.KEY).opacities},r.setAlignmentForSelectedFormae=function(e){return Q(new s.AlignFormaeAction(e))},r.distributeSelectedFormae=function(e){return Q(new s.DistributeFormaeAction(e))},r.animate=function(){r.events.publish("animate")},r.downloadAnimation=function(){r.events.publish("download-animation")},r.beginTransaction=function(e){if(e)return C.beginTransaction(F,e);S.error("no name provided for transaction.")},r.endTransactionAndMergeWithPrevious=function(e){C.endTransaction(e,!0)},r.endTransaction=function(e){C.endTransaction(e,!1)},r.containsBrandedContent=function(){return s.BrandingFacade.doesDocumentContainBrandedElements(F,!1)},r.updateCharStyleRanges=function(e,t){return Q(new s.UpdateCharStyleRangeAction(r.getSelectedForma(),e,t))},r.missingFontListInDoc=function(){return F.missingFontList},r.setCPProjectID=function(e){if(F){const t=r.beginTransaction("setCPProjectID");F.publishedResourcePath=e,r.endTransactionAndMergeWithPrevious(t)}},r.setCommunityPlatformAlias=function(e){if(F){const t=r.beginTransaction("setCommunityPlatformAlias");F.communityPlatformAlias=e,r.endTransactionAndMergeWithPrevious(t)}},r.setCommunityPlatformAssetID=function(e){if(F){const t=r.beginTransaction("setCommunityPlatformAssetID");F.communityPlatformAssetID=e,r.endTransactionAndMergeWithPrevious(t)}},r.setPublishedEtag=function(e){if(F){const t=r.beginTransaction("setPublishedEtag");F.publishedEtag=e,r.endTransactionAndMergeWithPrevious(t)}},r.getIsExported=function(){return F?F.isExported:null},r.setIsExported=function(e){if(F){const t=r.beginTransaction("setIsExported");F.isExported=e,r.endTransactionAndMergeWithPrevious(t)}},r.removeContentForCorruptImageFrame=function(e){const t=F.content.root.nodeByID(e);if(re(t)){const e=r.beginTransaction("removeCorruptContentNode");t.parent&&t.parent.removeChild(t),t.releaseResources(),r.endTransactionAndMergeWithPrevious(e)}},r.replaceCorruptImageFrames=function(){const e=[];let t;F.content.root.visitAll(n=>{re(n)&&(t||(t=r.beginTransaction("removeCorruptContentNodes")),e.push(n.id),n.parent&&n.parent.removeChild(n),n.releaseResources())});const n=e.length>0;if(0===e.length)return n;const o=r.imageFormas().filter(t=>e.indexOf(t.contentID)>=0);if(o.length){const e=p.solidColor2TheoColor(p.hex2SolidColor("FF0000"),null,null);s.ImageFacade.replaceImagesWithColors(o,[e])}return t&&(t=r.endTransactionAndMergeWithPrevious(t)),n},function(){D=n.persistSource||u.fromDocument(n.dcxDoc),P=n.persistSave||d.toDocument(n.dcxDoc);var t=!1;T=D.open().then((function(e){return(t=e.hadMissingFontsWhenOpened)?h.loadMissingFonts(e.missingFontList):e})).then((function(e){return t?D.open():e})).then((function(e){return t=e.hadMissingFontsWhenOpened,(F=e).controller.selection.subscribeWithCallback($,s.SelectionStateChangedMessage.TYPE),P.initialize()})).then((function(){const n=r.beginTransaction("create-grid-controller");if(F.firstPage.root.controller.createGridControllerIfNone(),r.endTransactionAndMergeWithPrevious(n),t){var o=r.beginTransaction("update missing fonts");r.lockupFormas().forEach((function(e){e.controller.updateGroup(),e.controller.updateScoring()})),r.endTransactionAndMergeWithPrevious(o)}return(g=F.controller.undoRedoMgr).reset(),F.controller.designControllerHandlesPointers=!0,F.controller.enableMoveableChildren=!0,g.subscribeWithCallback((function(e){if("state-changed"===e.changeType||"state-clean"===e.changeType){if(!g.gestureScope){te();var t=r.getSelectedForma(),n=r.getSelectedFormaId();n&&(r.inCharStyleMode&&t.isTypeLockup()?(t.controller.selectCharStyleForma(),ne(t)):(r.exitCharStyleMode(),r.events.publish("forma-selected",{id:n,forma:t,selectionBox:G()}))),s.MultiBrandFacade.handleUndoRedoMessage(e),r.events.publish("undo-redo-state-changed"),B(),E()}}else"state-updated"===e.changeType?(te(!1),E()):"timeline-changed"===e.changeType&&r.events.publish("undo-redo-state-changed")}),s.UndoRedoMessage.TYPE),g.registerPatch((function(t){e.each(A,(function(e){e()})),t()})),r.events.publish("undo-redo-state-changed"),k=!0,B(),!0}))}(),r}}.apply(t,o))||(e.exports=r)},"6lgp":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));class o extends Error{}},"7the":function(e,t,n){var o,r;o=[n("xeH2"),n("YLtl"),n("UFvF"),n("MOGj"),n("a8ov")],void 0===(r=function(e,t,n,o,r){var i=r.default,a={},c=window.location.protocol+"//"+window.location.host;return a.loadFile=function(e,t){var r=n.defer();return o.dcxService.invoke("GET",c+i.decodeUrl(e),{},null,t,(function(e,t){e?r.reject(e):r.resolve(t.response)})),r.promise},a}.apply(t,o))||(e.exports=r)},"8VGm":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return h}));var o=n("MGCh"),r=n.n(o),i=n("b3Wv"),a=n.n(i),c=n("a8ov"),l=n("UzQk"),s=n("14LO");function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const d=n("UFvF"),p=r.a.channel("SourceCPAsset");class h{constructor(e){u(this,"assetId",void 0),u(this,"cpServiceDomain",void 0),this.assetId=e.assetId,this.cpServiceDomain=e.cpServiceDomain}documentId(){return this.assetId}open(){return d(this.openAsync())}async openAsync(){const e=await a.a.loadComposite(this.assetId,this.cpServiceDomain);e.name="";const t=new s.DCXDocumentComposite({composite:e,componentURLfn:e=>c.default.encodeCPUrl(this.assetId,e.absolutePath),overrideIDfn:e=>l.GUIDUtils.makeGUID()});var n,o=t.current;if(l.DocumentPersistenceFactory.usesJsonDocumentEncoding(o)){const e=l.JSONDocumentDecoder.getRequiredSynchronousComponents(o);await Promise.all(e.map(async e=>{const t=c.default.encodeCPUrl(this.assetId,e),n=await a.a.loadFile(t,{});var r=JSON.parse(n);o.registerContentForComponent(e,r)}))}try{n=l.TheoDocument.decodeDocument(t,(function(e){throw o.releaseRegisteredContent(),new Error(e.join(";"))})),o.releaseRegisteredContent()}catch(e){throw p.error("decoding from CP",e),n=l.TheoDocument.createDefault(),e}return n.history.postEntry("open,src=CP,was-vers="+n.versionDecoded.rawValue),n}}},FGv1:function(e,t,n){"use strict";n.r(t),n.d(t,"DCXDocumentComponentDeferred",(function(){return a}));var o=n("1tmr"),r=n("UzQk"),i=n("nNj6");class a extends o.a{constructor(e,t,n){var o,r,i;super(e,t),i=void 0,(r="params")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,this.params=n}attachToNode(){}detachFromNode(){}get absolutePath(){return""}get componentId(){return this.params.componentId||""}get name(){return this.params.name}get path(){return this.params.path}get type(){return this.params.type}get etag(){return""}get relationship(){return this.params.relationship}get sourceHref(){return this.params.sourceHref}get mutableCopy(){return new a(this.branch,this.node,this.params)}replaceWithReal(e){if(!e||!e.etag)return r.CoreAssert.fail("replaceWithReal: you need to pass an AdobeDCXComponent"),null;const t=new i.a(this.branch,this.node,e);return this.update(t),t}}},KpqY:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var o=n("6lgp"),r=n("UFvF"),i=n.n(r);class a{static doAction(e,t){return a.doActionWithCompletion(e,t)}static doActionWithCompletion(e,t,n){if(!e||!e.controller)return i.a.reject("No document or controller");var r=i.a.defer();return e.controller.doActionWithCompletion(t,(function(e,t){if(n)try{n(e,t)}catch(e){t||(t=e)}t?(t instanceof o.default||(t=new o.default(t)),r.reject(t)):r.resolve(e)})),r.promise}static beginTransaction(e,t){return e.beginTransaction(t)}static endTransaction(e,t){t?e.mergeWithPrevious():e.end()}}},LI3u:function(e,t,n){var o,r=n("MOGj"),i=n("yAe2"),a=n("YLtl"),c=n("MGCh").channel("ManifestEncoder");function l(e,t){for(var n=0;n<e.length;n++){var o=e[n];if(o.id===t)return o}}(o=function(e,t){if(this.config=a.extend({},e),this.branch=e.branch,this.rootNode=e.rootNode||this.branch.rootNode,this.node=t||this.rootNode,this.componentBranch=e.componentBranch||this.branch,this.componentRootNode=e.componentRootNode||this.componentBranch.rootNode,this.componentNode=e.componentNode||this.node,this.isRoot=this.node==this.rootNode,this._nodes=[],this._components=[],this._stashedComponents=[],this._childMetadataEncoders={},this.isRoot){var n=this.componentBranch.getComponentsOf(this.componentRootNode),o=function e(t,n,o){if(!n)return t.allComponents();o=o||[];var r=t.getComponentsOf(n);return r&&r.length>0&&(o=o.concat(r)),t.getChildrenOf(n).forEach((function(n){o=e(t,n,o)})),o}(this.componentBranch,this.componentRootNode);c.info("stashing: begin (".concat(o.length," components, ").concat(o.length-n.length," not at root)"));for(var r=0;r<o.length;r++){var i=o[r];if(!l(n,i.id)){this._stashedComponents.push(i),c.info("stashing: moving component ".concat(i.id," to node ").concat(this.componentRootNode.absolutePath));try{this.componentBranch.moveComponent(i,this.componentRootNode)}catch(e){e&&e.message.indexOf("Component not found in this branch.")>=0?this._stashedComponents.pop():c.warn(e)}}}c.info("stashing: complete"),this.config.stashedComponents=this._stashedComponents;var s=this.branch.getChildrenOf(this.node);for(c.info("removing all ".concat(s.length," root nodes")),r=0;r<s.length;r++){var u=s[r];this.branch.removeChild(u)}}else this._stashedComponents=this.config.stashedComponents})._implements=function(e){return"IExportDataObject"==e||"IExportDataObjectDocument"==e},o.prototype=Object.create(Object.prototype,{_implements:{value:function(e){return"IExportDataObject"===e||"IExportDataObjectDocument"===e}},setName:{value:function(e){this.node?this.node.name=e:this.branch.name=e}},setType:{value:function(e){this.node.setValue("type",e)}},setPath:{value:function(e){this.node.setValue("path",e)}},setProperty:{value:function(e,t){e.indexOf("#")<0&&(e="theo#"+e),this._childMetadataEncoders[e]&&delete this._childMetadataEncoders[e],this.node.setValue(e,t)}},setOptionalStringProperty:{value:function(e,t){t&&this.setProperty(e,t)}},setStringProperty:{value:function(e,t){this.setProperty(e,t)}},setNumberProperty:{value:function(e,t){this.setProperty(e,t)}},setIntProperty:{value:function(e,t){this.setProperty(e,t)}},setBooleanProperty:{value:function(e,t){this.setProperty(e,t)}},setOptionalBooleanProperty:{value:function(e,t){this.setProperty(e,t)}},appendMetadata:{value:function(e){var t="theo#"+e;this.node.getValue(t)&&this.node.removeValue(t);var n=new i;return this._childMetadataEncoders[t]=n,n}},appendChild:{value:function(e){var t=(new r.AdobeDCXBranch).addChild(null,e),n=new o(this.config,t);return this._nodes.push(n),n}},appendComponent:{value:function(e,t,n,o){var r={parentId:e,id:t,url:n,mimeType:o,confirmed:!0};this._components.push(r)}},setManifestFormatVersion:{value:function(e){}},setManifestProperty:{value:function(e,t){this.setProperty(e,t)}},setDocumentSize:{value:function(e,t){}},setCompositeID:{value:function(e){}},prepareForAttachment:{value:function(){for(var e in this._childMetadataEncoders){var t=this._childMetadataEncoders[e].encodeData();this.node.setValue(e,t)}}},finalizeAfterAttachment:{value:function(e){this.isRoot&&c.info("unstashing: begin");for(var t=0;t<this._components.length;t++){var n=this._components[t];c.assert(n.id,"finalizeAfterAttachment: A recorded component has no ID.");var o=l(this._stashedComponents,n.id),r=!1;if(this.config.finalizingComponent&&(r=this.config.finalizingComponent(e,n)),o)if(this.componentNode==this.componentRootNode);else try{var i=this.node==this.componentNode?e:this.componentNode;c.info("unstashing: moving stashed component ".concat(o.id," to node ").concat(i.absolutePath)),this.componentBranch.moveComponent(o,i)}catch(e){c.warn("moveComponent to node failed: "+e)}else c.assert(r,"finalizeAfterAttachment: no existing component, and finalizingComponent not provided or did not indicate that's OK.")}for(t=0;t<this._nodes.length;t++){var a=this._nodes[t];a.prepareForAttachment();try{var s=a.node,u=this.branch.copyChild(s,e||this.node,t,s.path,s.id);a.finalizeAfterAttachment(u)}catch(e){c.warn("addChild to node failed: "+e)}}if(this.isRoot){c.info("unstashing: complete");var d=this.componentBranch.getComponentsOf(this.componentRootNode);for(t=0;t<this._stashedComponents.length;t++){var p=l(d,(n=this._stashedComponents[t]).id);p&&(c.info("dumping unused component "+p.path),this.config.removeUnusedComponent?this.config.removeUnusedComponent(n,p):this.componentBranch.removeComponent(p))}}}}}),o.prototype.constructor=o,e.exports=o},SdaB:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));n("kSzJ");var o=n("Lkow"),r=n("a8ov");const i=new o.PixiJSRenderer;function a(e,t,n){return i.liveViewService.createView(e,t,n)}i.assetLoader=new o.WebAssetLoader(r.default)},SxBq:function(e,t,n){var o,r;o=[n("k99a"),n("SdaB"),n("UzQk")],void 0===(r=function(e,t,n){var o,r=function(e){this.coreWrapper=e},i=null;function a(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return i||(i=t.default(1,!0)),Promise.resolve().then(()=>i.setWatermark(e)).then(()=>(function(e){return new Promise(t=>{setTimeout(t,e)})})(0)).then(()=>i)}return r.initialize=function(t){var r=!!(t=t||{}).skipLoadingAuthenticatedFeatures;if(!o){var i=new e;o=i.loadFeatures({skipLoadingAuthenticatedFeatures:r}).then((function(){return n.Host.setFeatureController(i),this}))}return o},r.prototype.renderToCanvas=function(e,t){const n=t.height||t.longestSide,o=t.width||t.longestSide;let r;return a(t.honorDocWatermarkProp&&this.coreWrapper.getWatermarkEnabledForDoc()).then(e=>(r=e,e.asyncRender(this.coreWrapper.getGraph(),o,n))).then(()=>r.headless.getExportCanvas()).then(t=>{const n=e.canvas;return n.width=t.width,n.height=t.height,e.drawImage(t,0,0)})},r.prototype.renderToBlob=function(e){const t=e.height||e.longestSide,n=e.width||e.longestSide;let o;return a(e.honorDocWatermarkProp&&this.coreWrapper.getWatermarkEnabledForDoc()).then(e=>(o=e,e.asyncRender(this.coreWrapper.getGraph(),n,t))).then(()=>o.getRenditionBlob(e.outputFormat,e.imageQuality))},r.prototype.render=function(e){const t=e.height||e.longestSide,n=e.width||e.longestSide;let o;return a(e.honorDocWatermarkProp&&this.coreWrapper.getWatermarkEnabledForDoc()).then(e=>(o=e,e.asyncRender(this.coreWrapper.getGraph(),n,t))).then(()=>o.getRenditionDataUrl(e.outputFormat,e.imageQuality))},r.prototype.renderStack=function(e){},r}.apply(t,o))||(e.exports=r)},ZLL8:function(e,t,n){var o,r;o=[n("YLtl"),n("UFvF")],void 0===(r=function(e,t){var n={doSerial:function(e){var n=[];return e.forEach((function(e){t.isPromise(e)?n.push((function(){return t.promise((function(t){e.then(t)}))})):n.push(e)})),n.reduce(t.when,t([]))},delay:function(n){var o=[].slice.apply(arguments);o.shift();var r=t.defer();return e.delay((function(){r.resolve.apply(r,o)}),n),r.promise},delayThen:function(n){return function(){var o=[].slice.apply(arguments),r=t.defer();return e.delay((function(){r.resolve.apply(r,o)}),n),r.promise}}};return n}.apply(t,o))||(e.exports=r)},b2xK:function(e,t,n){var o,r;o=[n("YLtl"),n("UFvF")],void 0===(r=function(e,t){var n=function(e){e=e||{};var n={initialize:function(){return t.resolve(!0)},saveWithRenditions:function(e,n,o,r){return t.resolve(!0)},saveImageComponent:function(e){return t.resolve(null)}};return n};return n.toBlackHole=function(){return new n({})},n}.apply(t,o))||(e.exports=r)},b3Wv:function(e,t,n){var o,r;o=[n("xeH2"),n("YLtl"),n("UFvF"),n("MOGj"),n("a8ov")],void 0===(r=function(e,t,n,o,r){var i,a,c=r.default,l={},s=window.location.protocol+"//"+window.location.host,u=s+"/api/post/v1/cp/";function d(){!i&&o.dcx&&(i=o.dcx.createHTTPService((function(e){}))),!a&&o.dcx&&(a=o.dcx.createCommunitySession(i,u))}return d(),l.loadComposite=function(e,t){var r=n.defer(),i=t?"host/".concat(t,"/"):"",c="".concat(u).concat(i,"dcx/").concat(e,"/"),l=o.dcx.newCompositeWithHref(c);return d(),o.dcx.compositeXfer.pullCompositeManifestOnly(l,a,(function(e,t){!e&&t?(l.resolvePullWithBranch(t),r.resolve(l)):r.reject(e)})),r.promise},l.loadFile=function(e,t){var o=n.defer(),r=c.decodeUrl(e);return i.invoke("GET",s+r,{},null,t,(function(e,t){e?o.reject(e):o.resolve(t.response)})),o.promise},l}.apply(t,o))||(e.exports=r)},hEO4:function(e,t,n){var o,r;o=[n("MGCh"),n("UzQk")],void 0===(r=function(e,t){const n=e.channel("Diagnostics"),o={truncateEncodedDOM:function(e){const t=["theo#placement","theo#bounds","theo#style","theo#color-library","theo#saliency-data","theo#artwork","theo#image-color-data","theo#edge-data"],n=["type-lockup"];return function e(o){const r={},i=o["theo#controller-kind"];try{Object.keys(o).forEach(a=>{let c=o[a];t.indexOf(a)>=0?c="…".concat(JSON.stringify(c).length,"…"):"children"===a?c=i&&n.indexOf(i)>=0?"…".concat(JSON.stringify(c).length,"…"):c.map(t=>e(t)):"string"==typeof c&&(c=c.replace(/(.{8})-.{4}-.{4}-.{4}-.{12}/g,"$1…")),r[a]=c})}catch(e){r.error="threw "+e}return r}(e)},validateDOM:function(e){try{if(!e.children)return"no root children";4!==e.children.length&&n.warn("expected 4 root children");const t=e.children.find(e=>"forma-document"===e.path);if(!t)return"no forma document";if("application/vnd.adobe.theo.forma+dcx"!==t.type&&n.warn("forma doc did not have correct type",t.type),!t.children||1!==t.children.length)return"expected exactly one forma root";const o=t.children[0];if("Root"!==o["theo#kind"])return"root forma did not have kind Root";if("root"!==o["theo#controller-kind"])return"root forma did not have controller kind root";if(!o.children||0===o.children.length)return"root forma did not have children";if(window.simulate_bad_dom){delete o.children.find(e=>"group"===e["theo#kind"]&&"grid"===e["theo#controller-kind"])["theo#controller-kind"]}const r=o.children.find(e=>"group"===e["theo#kind"]&&"grid"===e["theo#controller-kind"]);if(!r)return"root forma did not have a grid child";if(!r.path)return"grid is missing path property"}catch(e){return"validation threw: "+e}return null},findGrid:function(e){if(!e)return n.error("findGrid: document is null"),null;const t=e.firstPage.root;if(!t||0===t.childCount)return n.error("findGrid: root has no children"),null;const o=t.children_.find(e=>"group"===e.kind&&e.controller&&"grid"===e.controller.kind);return o||(1===t.children_.length?(n.error("findGrid: assuming the sole child of the root is the grid; it's not the correct kind"),t.children_[0]):(n.error("findGrid: root unexpectedly had more than one child and none looked like a grid"),null))},dumpPostDOM:function(e){return function e(n){try{const o={id:n.formaID,kind:n.kind},r=n.controller;if(r&&(o.ckind=r.kind),n instanceof t.GroupForma){const r=n.visitAsArray(t.FormaTraversal.JustChildren);o.children=r.map(t=>e(t))}return o}catch(e){return{error:"threw"+e}}}(e.firstPage.root)},dumpStateDelta:function(e,t,n){t=t||10,n=n||1e4;const o=[];try{const r=e.database;let i=0,a=r.currentState.state;for(;a&&i<t;){const e={guid:a.guid,gen:a.generation_};try{e.deltas=Object.keys(a.objectStates).map(e=>{const t=a.objectStates[e];return{id:e,cls:t.className,props:Object.keys(t.properties||{}).join(",")}})}catch(t){e.error="threw "+t}if(o.push(e),JSON.stringify(o).length>n&&(e.summary="".concat(e.deltas.length," objects mutated"),delete e.deltas,JSON.stringify(o).length>n)){o.pop();break}a=a.basedOn,i++}}catch(e){o.push({error:"state enumeration threw "+e})}return o},dumpUndoRedo:(e,t)=>{t=t||80;const n={states:[]};try{e.controller.undoRedoMgr.timeline.states.forEach(e=>{const o={};e.action&&(o.action=e.action.description),e.state&&e.state.state&&(o.guid=e.state.state.guid),e.beginSelectedFormaIDs&&(o.bfids=e.beginSelectedFormaIDs.concat()),e.endSelectedFormaIDs&&(o.efids=e.endSelectedFormaIDs.concat()),n.states.push(o),n.states.length>t&&n.states.shift()})}catch(e){n.error="throw: ".concat(e)}return n},snapshotFormaHistory:(e,t)=>{if(!t)return{error:"nil object"};const n=[];try{let o=t.state;for(;o;){const r={};Object.keys(o.properties).forEach(e=>{const t=o.properties[e];t.isArray?r[e]="array(".concat(t.value.length,")"):t.isDictionary?r[e]="object(".concat(Object.keys(t.value).join(","),")"):r[e]="".concat(t.schemaType,"(").concat(t.value,")")});const i=[];let a=e.database.currentState.state;for(;a;)a.objectStates[t.id]===o&&i.push(a),a=a.basedOn;n.push({props:r,dbStates:i.map(e=>e.guid)}),o=o.basedOn}}catch(e){n.push("throw ".concat(e))}return{kind:t.kind,id:t.formaID,ckind:t.controller?t.controller.kind:"no controller",states:n}},monitorTransactionsForDocument:function(e){const t=[];let r=!1;const i=(e,o)=>{try{r=!0;const i={msg:e,recent:t.concat()};void 0!==o&&(i.err=o);try{throw new Error}catch(e){i.stack=e.stack}n.error("grid validation failed",i)}catch(e){n.error("monitorTransactionsForDocument throw",e)}},a=n=>{try{if(r)return;if(t.push({event:n,history:o.snapshotFormaHistory(e,e.firstPage.root.childAt(0))}),t.length>10&&t.shift(),window.simulate_db_validation_failure)i("simulated failure"),r=!1;else if(1!==e.firstPage.root.childCount)i("root has ".concat(e.firstPage.root.childCount," children"));else{const t=e.firstPage.root.childAt(0);"group"!==t.kind?i("grid has kind ".concat(t.kind)):t.controller?"grid"!==t.controller.kind&&i("grid has controller kind ".concat(t.controller.kind)):i("grid has kind ".concat(t.kind))}}catch(n){i("throw validating",n)}};e.database.addListener({onBeginTransaction:(e,t)=>a("beginT ".concat(t.name)),onEndTransaction:(e,t)=>a("endT ".concat(t.name)),onStateChanged:(e,t)=>{},onObjectStateChanged:(e,t)=>{}})}};return o}.apply(t,o))||(e.exports=r)},jiRT:function(e,t,n){var o;(o=function(e){this.data=e}).prototype=Object.create(Object.prototype,{id:{get:function(){return this.property("id")}},type:{get:function(){return this.property("type")}},name:{get:function(){return this.property("name")}},path:{get:function(){return this.property("path")}},property:{value:function(e){return this.data[e]}},optionalStringProperty:{value:function(e){return this.data[e]}},stringProperty:{value:function(e,t){var n=this.data[e];return null==n?t:n}},numberProperty:{value:function(e,t){var n=this.data[e];return null==n?t:n}},intProperty:{value:function(e,t){var n=this.data[e];return null==n?t:n}},booleanProperty:{value:function(e,t){var n=this.data[e];return null==n?t:n}},optionalBooleanProperty:{value:function(e){return this.property(e)}},metadata:{value:function(e){var t=this.data[e];if(t)return new o(t)}},forEachChild:{value:function(e,t){}},forEachComponent:{value:function(e,t){}}}),o.prototype.constructor=o,e.exports=o},mwMu:function(e,t,n){var o,r;o=[n("YLtl"),n("UFvF"),n("2ofD"),n("MGCh"),n("a8ov"),n("UzQk"),n("r3b0"),n("14LO")],void 0===(r=function(e,t,n,o,r,i,a,c){var l=r.default,s=c.DCXDocumentComposite,u=o.channel("SourceCCStorage"),d=["id","local","manifest-format-version","name","projectContext#npwMethod","state","type","authctx#ctxid"],p=function(e){var o={},r=(e=e||{}).dcxDoc||n.currentDoc,c=e.branch||r.getDCXComposite().current,p=e.rootNode||c.root,h=e.domComponentPath;return o.open=function(){return(h?r.getComponent(p.absolutePath+"/"+h).then((function(e){var t,n=JSON.parse(e),o=new a({makeComponentUrl:function(e){return l.encodeComponentUrl(r.id,e.id,e.type)},manufactureComponentsForNode:function(e){var t=e&&e["theo#external-url"];return t?[{id:i.GUIDUtils.makeGUID(),url:t,mimeType:e["theo#mimetype"]}]:null},trackAbsolutePath:!0,branch:n});try{(t=new i.TheoDocument.newDocumentFromDataObject(o,(function(e){const t=e&&"function"==typeof e.join?e.join(";"):"No error array found for err: ".concat(e);throw new Error(t)}))).history.postEntry("open,src=AC,was-vers="+t.versionDecoded.rawValue),p.name&&(t.documentName=p.name)}catch(e){throw u.error("acOpen",e),t=new i.TheoDocument.createDefault,e}return t})):c===r.getDCXComposite().current?function(){var e,n,o=r.getDCXRoot();if(o._data.children)e=new s({composite:r.getDCXComposite()});else{for(var a in o._data)o._data.hasOwnProperty(a)&&-1===d.indexOf(a)&&console.error("unexpecte property: "+a+" found when creating a new doc.");e=null}n=e&&e.current;let c=t.resolve();return n&&i.DocumentPersistenceFactory.usesJsonDocumentEncoding(n)&&(c=c.then(()=>{const e=i.JSONDocumentDecoder.getRequiredSynchronousComponents(n);return t.all(e.map(e=>r.getComponent(e).then((function(t){var o=JSON.parse(t);n.registerContentForComponent(e,o)}))))})),c.then(()=>{var t;try{t=e?i.TheoDocument.decodeDocument(e,(function(e){throw n.releaseRegisteredContent(),new Error(e.join(";"))})):new i.TheoDocument.createDefault,n&&n.releaseRegisteredContent(),t.history.postEntry("open,src=CC,was-vers="+t.versionDecoded.rawValue)}catch(e){throw u.error("coreOpen",e),e}return t})}():function(){var e,n=c._data,o=new a({makeComponentUrl:function(e){return l.encodeComponentUrl(r.id,e.id,e.type)},trackAbsolutePath:!1,branch:n,rootNode:p});try{e=new i.TheoDocument.newDocumentFromDataObject(o,(function(e){throw new Error(e.join(";"))}))}catch(e){return u.error("decoding from nodes",e),t.reject(e)}return t.resolve(e)}()).then(e=>e)},o.documentId=function(){return r.id},o};return p.fromDocument=function(e){return new p({dcxDoc:e})},p.fromTemplate=function(e,t){return new p({dcxDoc:e.composite,rootNode:t,domComponentPath:"dom.json"})},p}.apply(t,o))||(e.exports=r)},nNj6:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n("1tmr"),r=n("UzQk");class i extends o.a{constructor(e,t,n){var o,r,i;super(e,t),i=void 0,(r="dcxComponent")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,this.dcxComponent=n}attachToNode(){if(this.branch.dcxBranch.getComponentsOf(this.node.dcxNode).indexOf(this.dcxComponent)<0)try{this.branch.dcxBranch.moveComponent(this.dcxComponent,this.node.dcxNode)}catch(e){r.CoreAssert.fail("attachToNode: moveComponent() failed",e)}}detachFromNode(){this.branch.dcxBranch.getComponentsOf(this.node.dcxNode).indexOf(this.dcxComponent)>=0&&this.branch.retireComponent(this.dcxComponent)}get absolutePath(){return this.dcxComponent.absolutePath||""}get componentId(){return this.dcxComponent.id||""}get name(){return this.dcxComponent.name}get path(){return this.dcxComponent.path}get type(){return this.dcxComponent.type}get etag(){return this.dcxComponent.etag}get relationship(){return this.dcxComponent.relationship}get sourceHref(){return null}get mutableCopy(){return new i(this.branch,this.node,this.dcxComponent)}}},qnb0:function(e,t,n){var o,r;o=[n("YLtl"),n("UFvF"),n("MOGj"),n("2ofD"),n("MGCh"),n("a8ov"),n("UzQk"),n("b3Wv"),n("7the"),n("LI3u"),n("DIoP"),n("uTW7"),n("FGv1"),n("hEO4")],void 0===(r=function(e,t,n,o,r,i,a,c,l,s,u,d,p,h){var m=i.default,f=r.channel("SaveCCStorage"),g=function(e,t){var n=e&&e.absolutePath;return n&&"/"!==n?n+"/"+t:"/"+t},v=function r(i){var v={},y=(i=i||{}).dcxDoc||o.currentDoc,C=i.branch||y.getDCXComposite().current,S=i.rootNode||C.rootNode,F=i.domComponentPath,b=i.isAuthoringContext||!!F,I=i.copyExternalImages,k=i.commitChanges||r.CommitChanges.AUTO,T=C.addElement("retirement","foo","retirement"),w=C.getChildWithAbsolutePath("/retirement");C.removeChild(w);var D={};function P(e,t){return"".concat(e,":").concat(t)}var A=[];function x(e,n){var o=b?e:e+".jpg";f.info("saving rendition "+o);var r=g(S,o);return y.pushComponentWithRetry({name:e,path:o,absolutePath:r,isUpdate:A.indexOf(r)>=0,relationship:"rendition",file:n,type:n.type,parent:S}).then((function(e){return f.info("finished saving rendition "+o),e})).catch((function(e){return f.error("error while saving image rendition",e),u.publish("post:saveCCStorageAttempt",{contextualData1:"path:"+o,contextualData2:"success:"+!1}),t.reject(e)}))}function L(){var e=C.getChildWithAbsolutePath(g(S,"assets"));return e||((e=C.addChild(void 0,void 0,0,S)).path="assets"),e}function O(e,o,i){f.info("legacyACSave: begin"),f.assert(i,"legacyACSave: expected a thumbnail rendition"),f.assert(F,"legacyACSave: expect to get here only with a domComponentPath"),f.assert(b,"legacyACSave: expect to get here only for legacy AC saving");var c,l=[],d=y.getDCXComposite().current,p={finalizingComponent:function(e,t){var n=D[P(t.id,t.url)]||t.url;return m.isEncodedCPUrl(n)||m.isEncodedAuthoringContextUrl(n)||(n.indexOf("theo-web/images")>=0?f.warn("legacyACSave: recording this url as external",n):f.error("legacyACSave: recording this url as external",n)),e.setValue("theo#external-url",n),!0},removeUnusedComponent:function(e,t){T.getComponentWithId(t.id)?f.info("not retiring component ".concat(t.id," because we already have a")):(f.info("retiring component ".concat(t.id)),T.copyComponent(t)),d.removeComponent(t)}};c=new n.AdobeDCXBranch,p.branch=c,p.componentBranch=d,p.componentRootNode=S,p.componentNode=L();try{f.info("encoding composite"),e.history.postEntry("save,dst=AC");var h=new s(p);e.encode(h),h.prepareForAttachment(),h.finalizeAfterAttachment()}catch(e){throw f.error("error during encoding",e),err}const v=[];return o&&l.push(x("preview",o).then((function(e){v.push(e)}))),i&&l.push(x("thumbnail",i).then((function(e){v.push(e)}))),c&&l.push(function(e,n,o){f.info("saving dom "+n);var r=g(S,n);return y.pushComponentWithRetry({name:e,path:n,absolutePath:r,isUpdate:A.indexOf(r)>=0,relationship:"dom",type:"application/vnd.adobe.adobesparkpost.dom+json",file:JSON.stringify(o),parent:S}).then((function(e){return f.info("finished saving dom "+n),e})).catch((function(e){return f.error("error while saving dom",e),u.publish("post:saveCCStorageAttempt",{contextualData1:"path:"+n,contextualData2:"success:"+!1}),t.reject(e)}))}("dom",F,c._data)),t.all(l).then((function(){S.setValue("theo#last-modified",(new Date).toISOString());var n=e.documentName;return S.name=n===a.TheoDocument.DEFAULT_NAME?"":n,N(v),k===r.CommitChanges.NEVER?(f.info("legacyACSave: complete; not saving, per client"),t.resolve()):(f.info("legacyACSave: saving changes"),y.saveChanges((function(){})).then(()=>f.info("legacyACSave: complete")))}))}function N(t){e.each(e.filter(y.getDCXComposite().current.getComponentsOf(S),(function(e){return"rendition"===e.relationship&&t.indexOf(e)<0})),(function(e){f.info("removing stale rendition component",e.id),y.getDCXComposite().current.removeComponent(e)}))}function M(e,n,o,i){f.info("coreSave() begin");var c=new d.DCXDocumentBranch({branch:y.getDCXComposite().current,retiredElement:T}),l=a.DocumentPersistenceFactory.encoderFor(c);try{"string"==typeof i?e.encodeStateByID(i,l):e.encode(l),l.finish()}catch(e){throw f.error("coreSave() threw during encoding process",e),e}const s=[],m=[],v=c.getDeferredComponents(),C=v.find(e=>"dom"===e.relationship);if(C){const n=C.params.content,o=h.validateDOM(n);if(o){f.error("validation failure '".concat(o,"'; encoded="),h.truncateEncodedDOM(n)),f.error("validation failure '".concat(o,"'; document="),h.dumpPostDOM(e)),f.error("validation failure '".concat(o,"'; delta="),h.dumpStateDelta(e)),f.error("validation failure '".concat(o,"'; undoredo="),h.dumpUndoRedo(e));const r=h.findGrid(e);return f.error("validation failure '".concat(o,"'; gridhist="),h.snapshotFormaHistory(e,r)),t.reject(o)}}return v.forEach(e=>{s.push(function(e){f.assert(e instanceof p.DCXDocumentComponentDeferred);var n=e.params,o=g(n.node,n.path);return f.info("saving deferred component ".concat(n.name," at ").concat(o)),y.pushComponentWithRetry({name:n.name,path:n.path,absolutePath:o,isUpdate:A.indexOf(o)>=0,relationship:n.relationship,file:JSON.stringify(n.content),type:n.type,parent:n.node.dcxNode}).then((function(t){return f.info("finished saving component "+n.path),e.replaceWithReal(t),t})).catch((function(e){return f.error("error while saving component",e),u.publish("post:saveCCStorageAttempt",{contextualData1:"path:".concat(path),contextualData2:"success:".concat(!1)}),t.reject(e)}))}(e))}),n&&s.push(x("preview",n).then((function(e){m.push(e)}))),o&&s.push(x("thumbnail",o).then((function(e){m.push(e)}))),f.info("coreSave waiting on ".concat(s.length," asynchronous operations")),t.all(s).then(()=>(N(m),k==r.CommitChanges.NEVER?t.resolve():(f.info("coreSave: requesting doc.saveChanges()"),y.saveChanges((function(){}))))).then(()=>{f.info("coreSave() finished")})}return v.initialize=function(){return t.resolve(!0)},v.documentId=function(){return y.id},v.saveImageComponent=function(e,n,o,r,i){n=n||"image/jpeg",o=o||L();var c="";"image/jpeg"===n?c=".jpg":"image/png"===n?c=".png":"image/svg"!==n&&"image/svg+xml"!==n||(c=".svg");var l=a.GUIDUtils.makeGUID()+c,s={name:i||"image",relationship:"image",type:n,path:l,absolutePath:g(o,l),parent:o};return r&&(s.id=r),e instanceof Blob?s.file=e:(s.copyFrom={source:e.source,assetId:e.assetId},e.source||f.error("save-ccstorage saveImageComponent imageFile.source is falsy, assetId:  "+e.assetId)),f.info("pushing component "+l),y.pushComponentWithRetry(s).then((function(e){return f.info("pushed component "+l),{component:e,encodedUrl:b?m.encodeAuthoringContextUrl(y.id,e.id,null,n):m.encodeComponentUrl(y.id,e.id,n)}})).catch((function(e){return f.error("save-ccstorage saveImageComponent failed with",e),u.publish("post:saveCCStorageAttempt",{contextualData1:"path:"+l,contextualData2:"success:"+!1}),t.reject(e)}))},v.saveWithRenditions=function(n,o,r,i){var s,u=n.beginTransaction("prune_orphaned_content");return a.TheoDocumentUtils.pruneOrphanedContent(n),u.end(),s=y.getDCXComposite().current.allComponents()||[],A=s.map(e=>e.absolutePath),(I?function(n){const o=[];return n.content.root.visitAll((function(e){e instanceof a.URLBasedContentNode&&o.push(e)})),t.all(e.map(o,(function(e){let t=e.url;if(!t||!e.componentID){const n=e instanceof a.VectorContentNode;return f.assert(n||t,"doCopyExternalImages: should have a valid url"),f.assert(n||e.componentID,"doCopyExternalImages: should have a valid componentID"),null}t=D[P(e.componentID,t)]||t,t!=e.url&&f.info("doCopyExternalImages: applying domain-map of ".concat(e.url," to ").concat(t));let n=null;if(m.isEncodedCPUrl(t))"all"===I?(f.info("pulling CP image ".concat(t," for componentID ").concat(e.componentID)),n=c.loadFile(t,{responseType:"blob"})):f.info("not pulling CP image ".concat(t," because caller didn't ask us to"));else if(m.isEncodedAuthoringContextUrl(t)){m.decodeAuthoringContextUrlParameters(t).assetId!==y.id?(f.info("pulling AC image",t),n=l.loadFile(t,{responseType:"blob"})):f.info("not pulling AC image ".concat(t," because it's already in this AC"))}else if(m.isEncodedComponentUrl(t)){const e=m.decodeComponentUrlParameters(t);e.docId!==y.id&&(t=m.encodeComponentUrl(e.docId,e.componentId,e.mimeType),f.info("pulling doc image ".concat(t)),n=l.loadFile(t,{responseType:"blob"}))}if(n)return n.then((function(n){return f.info("pushing pulled image",t),v.saveImageComponent(n,e.mimeType,L(),e.componentID,e.componentID)})).then((function(t){return f.assert(t.component.id===e.componentID),f.info("image pushed as component id ".concat(t.component.id,"; aliasing from ").concat(e.url," to ").concat(t.encodedUrl)),D[P(e.componentID,e.url)]=t.encodedUrl,null})).catch((function(e){f.error("error while saving dom",e)}))}))).catch((function(e){throw f.error("error while copying images",e),e}))}(n):t.resolve(null)).then((function(){if(!o){var e=g(S,"preview.jpg"),t=y.getComponentWithAbsolutePath(e);t&&y.removeComponent(t)}return b?O(n,o,r):M(n,o,r,i)}))},v};return v.CommitChanges={AUTO:"AUTO",NEVER:"NEVER"},v.toDocument=function(e){return new v({dcxDoc:e,copyExternalImages:"all",commitChanges:v.CommitChanges.AUTO})},v.toTemplateLocal=function(e,t,n){return new v({dcxDoc:e.composite,rootNode:t,domComponentPath:"dom.json",commitChanges:n})},v.toTemplateExternal=function(e,t,n){return new v({dcxDoc:e.composite,rootNode:t,domComponentPath:"dom.json",copyExternalImages:"template",commitChanges:n})},v}.apply(t,o))||(e.exports=r)},r3b0:function(e,t,n){var o,r,i=n("jiRT");!function(){function e(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}function t(e,t){return e=e||"/",t?("/"!=e.substring(e.length-1)&&(e+="/"),e+t):e}(r=function(t,n){this.config=t,this.branch=t.branch,this.node=n,t.remix&&(this.node?this.node.id=e():this.branch.id=e())})._implements=function(e){return"IImportDataObject"==e||"IImportDataObjectDocument"==e},r.prototype=Object.create(Object.prototype,{id:{get:function(){return this.node?this.node.id:this.branch.id}},name:{get:function(){return this.node?this.node.name:this.branch.name}},path:{get:function(){return this.node?this.node.path:this.branch.path}},property:{value:function(e){return e.indexOf("#")<0&&(e="theo#"+e),this.node?this.node[e]:this.branch[e]}},stringProperty:{value:function(e,t){var n=this.property(e);return null==n?t:n}},numberProperty:{value:function(e,t){var n=this.property(e);return null==n?t:n}},intProperty:{value:function(e,t){var n=this.property(e);return null==n?t:n}},booleanProperty:{value:function(e,t){var n=this.property(e);return null==n?t:n}},optionalBooleanProperty:{value:function(e){return this.property(e)}},optionalStringProperty:{value:function(e){return this.property(e)}},metadata:{value:function(e){var t=this.property(e);if(t)return new i(t)}},forEachChild:{value:function(e){var n=this.node?this.node.children:this.branch.children;if(n)for(var o=0;o<n.length;o++){var i=n[o];this.config.trackAbsolutePath&&(i.absolutePath=t(this.node?this.node.absolutePath:null,i.path)),e(new r(this.config,i),o)}}},forEachComponent:{value:function(e){var n=this.node?this.node.components:this.branch.components;if(n)for(var o=0;o<n.length;o++){var r=n[o];this.config.trackAbsolutePath&&(r.absolutePath=t(this.node?this.node.absolutePath:null,r.path)),e({id:r.id,mimeType:r.type,url:this.config.makeComponentUrl(r)},o)}if(this.config.manufactureComponentsForNode){var i=this.config.manufactureComponentsForNode(this.node);if(i)for(o=0;o<i.length;o++)e(i[o],(n?n.length:0)+o)}}}}),r.prototype.constructor=r}(),void 0!==e.exports?e.exports=r:void 0===(o=function(){return r}.apply(t,[]))||(e.exports=o)},uTW7:function(e,t,n){"use strict";n.r(t);var o=n("UzQk"),r=n("nNj6");function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class a{constructor(e,t,n){i(this,"overrideID",void 0),i(this,"dcxNode",void 0),i(this,"parent",void 0),i(this,"branch",void 0),i(this,"childNodes",void 0),i(this,"childComponents",void 0),this.dcxNode=e,this.branch=t,this.parent=n,this.overrideID=t.getOverrideIDForNode(e),this.childNodes=t.dcxBranch.getChildrenOf(this.dcxNode).map(e=>new a(e,t,this)),this.childComponents=t.dcxBranch.getComponentsOf(this.dcxNode).map(e=>new r.a(t,this,e))}get absolutePath(){return this.dcxNode.absolutePath}get nodeId(){return this.overrideID||this.dcxNode.id}get name(){return this.dcxNode.name}set name(e){this.dcxNode.name=e}get path(){return this.dcxNode.path}set path(e){this.dcxNode.path=e}get type(){return this.dcxNode.type}set type(e){this.dcxNode.type=e}getValue(e){return this.dcxNode.getValue(e)}setValue(e,t){this.dcxNode.setValue(e,t)}removeValue(e){this.dcxNode.removeValue(e)}visit(e){let t=e(this);if(t)return t;for(var n=0;n<this.childNodes.length;n++)if(t=this.childNodes[n].visit(e),t)return t;return null}findComponent(e){return this.visit(t=>t.childComponents.find(t=>e(t))||null)}findNode(e){return this.visit(t=>e(t)?t:null)}setManifestFormatVersion(e){}setCompositeID(e){}setManifestProperty(e,t){}setDocumentSize(e,t){}}var c=n("1tmr"),l=n("A+mC"),s=n("a8ov"),u=n("FGv1"),d=n("MGCh"),p=n.n(d);function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"DCXDocumentBranch",(function(){return f}));const m=p.a.channel("DCXDocumentBranch");class f{constructor(e){h(this,"dcxBranch",void 0),h(this,"_root",void 0),h(this,"_retiredElement",void 0),h(this,"_componentPaths",{}),h(this,"_componentURLfn",void 0),h(this,"_overrideIDfn",void 0),this.dcxBranch=e.branch,this._retiredElement=e.retiredElement||null,this._componentURLfn=e.componentURLfn||null,this._overrideIDfn=e.overrideIDfn||null,this._root=new a(e.branch.rootNode,this,null)}getOverrideIDForNode(e){return this._overrideIDfn&&this._overrideIDfn(e)}registerContentForComponent(e,t){this._componentPaths[e]=o.Host.persistUtils.writeJsonContentToTempFile(t)}releaseRegisteredContent(){if(o.Host.persistUtils instanceof l.HostPersistUtilsImpl)for(var e in this._componentPaths)o.Host.persistUtils.deleteTempFile(this._componentPaths[e]);else o.CoreAssert.warning("persist utils is not of a known type; releasing temp files won't happen");this._componentPaths={}}getDeferredComponents(){let e=[];return this._root.visit(t=>e.push.apply(e,t.childComponents.filter(e=>e instanceof u.DCXDocumentComponentDeferred))),e}get root(){return this._root}getValue(e){return this.dcxBranch.rootNode.getValue(e)}get allComponents(){let e=[];return this._root.visit(t=>{e.push.apply(e,t.childComponents)}),e}appendNode(e,t,n){if(e=e||o.GUIDUtils.makeGUID(),!n||n instanceof a){let o=n||this._root,r=this.dcxBranch.addChild("",e,void 0,o.dcxNode);t&&(r.path=t);let i=new a(r,this,o);return o.childNodes.push(i),i}return m.error("appendNode: foreign node"),null}removeNode(e){if(e instanceof a)if(e.branch!==this)m.error("trying to remove a node from a branch it doesn't belong to");else if(e.parent){let t=e.parent.childNodes.indexOf(e);t<0?m.error("trying to remove a node from a parent it doesn't belong to"):(e.visit(e=>e.childComponents.forEach(e=>{e instanceof r.a&&this.retireComponent(e.dcxComponent)})),e.parent.childNodes.splice(t,1),this.dcxBranch.removeChild(e.dcxNode))}else m.error("can't remove the root node");else m.error("trying to remove a node that isn't really a node")}getChildrenOfNode(e){return o.CoreAssert.isTrue(!e||e instanceof a),e instanceof a?e.childNodes.concat():this._root.childNodes.concat()}getComponentsOfNode(e){return o.CoreAssert.isTrue(!e||e instanceof a),e instanceof a?e.childComponents.concat():this._root.childComponents.concat()}getComponentWithId(e){return this._root.findComponent(t=>t.componentId===e)}getPathForComponent(e){if(e instanceof c.a){const t=this._componentPaths[e.absolutePath];if(t)return t;if(this._componentURLfn){const t=this._componentURLfn(e);if(null!==t)return t}return o.CoreAssert.isTrue(!!e.componentId&&!!e.type),s.default.encodeComponentUrl(this.root.nodeId,e.componentId,e.type)}return m.error("passed in component isn't our type of component"),null}getComponentWithAbsolutePath(e){return this._root.findComponent(t=>t.absolutePath===e)}getNodeWithAbsolutePath(e){return this._root.findNode(t=>t.absolutePath===e)}addComponent(e,t,n,i,c,l,s,d,p){let h=l instanceof a?l.dcxNode:this.dcxBranch.rootNode,f=l&&l instanceof a?l:this._root;if(this._retiredElement){let e=this._retiredElement.getComponentsOf(this._retiredElement.rootNode).find(e=>e.id===t);if(e){m.info("copying component ".concat(e.id," from retirement zone")),this.dcxBranch.copyComponent(e,h);let t=new r.a(this,f,e);return f.childComponents.push(t),t}}if(s&&o.Host.persistUtils&&o.Host.persistUtils.fileExists(s)){m.info("creating deferred content component for ID ".concat(t," from source ").concat(s));const r={name:e,componentId:t||"",type:n,relationship:i,path:c,sourceFile:s,copy:d,sourceHref:p,node:f,content:o.Host.persistUtils.readJsonContentFromFile(s)};let a=new u.DCXDocumentComponentDeferred(this,f,r);return f.childComponents.push(a),a}return m.error("addComponent: on web we can't add arbitrary components.."),null}moveComponent(e,t){return e instanceof c.a?(m.info("moveComponent ".concat(e.componentId," to node ").concat(t instanceof a?t.absolutePath:"root")),e.reparent(t||this._root),e):(m.error("updateComponent: requires a DCXDocumentComponent"),null)}retireComponent(e){"rendition"!==e.relationship&&"dom"!==e.relationship?this._retiredElement.allComponents().find(t=>t.id===e.id)?m.info("not retiring component ".concat(e.id," (already have a copy of it in retirement zone)")):(m.info("retiring ".concat(e.id)),this._retiredElement.copyComponent(e)):m.info("not retiring ".concat(e.id," because it's a rendition or dom component"))}updateComponent(e,t,n){if(!(e instanceof c.a))return m.error("updateComponent: requires a DCXDocumentComponent"),null;const r=this.getComponentWithId(e.componentId);if(!r)return m.error("updateComponent: passed component's ID isn't in the branch; can only update existing components"),null;let i=e;if(t){if(!o.Host.persistUtils||!o.Host.persistUtils.fileExists(t))return m.error("updateComponent: sourceFile can't be used because it's not a faux-temp-file"),null;m.info("updating component ".concat(e.componentId," with new source file ").concat(t)),i=new u.DCXDocumentComponentDeferred(this,i.node,{name:i.name,componentId:i.componentId||"",type:i.type||"",relationship:i.relationship,path:i.path||"",sourceHref:i.sourceHref,node:i.node,sourceFile:t,copy:n,content:o.Host.persistUtils.readJsonContentFromFile(t)})}else r!==i?m.info("updating component ".concat(e.componentId," with new metadata only")):m.warn("updating component ".concat(e.componentId," but nothing has changed!"));return r!==i&&r.update(i),i}}},yAe2:function(e,t,n){var o;(o=function(){this.data={},this._childMeta={}}).prototype=Object.create(Object.prototype,{setPath:{value:function(e){this.data.path=e}},setName:{value:function(e){this.data.name=e}},setType:{value:function(e){this.data.type=e}},setProperty:{value:function(e,t){this.data[e]=t}},setOptionalStringProperty:{value:function(e,t){t&&(this.data[e]=t)}},setStringProperty:{value:function(e,t){this.data[e]=t}},setNumberProperty:{value:function(e,t){this.data[e]=t}},setIntProperty:{value:function(e,t){this.data[e]=t}},setBooleanProperty:{value:function(e,t){this.data[e]=t}},appendMetadata:{value:function(e){var t=new o;return this._childMeta[e]=t,t}},appendChild:{value:function(e){return console.warn("Someone's trying to nest a child data object in metadata, which isn't supported."),new o}},appendComponent:{value:function(e,t,n){console.warn("Someone's trying to add a component to metadata, which isn't supported.")}},encodeData:{value:function(){for(var e in this._childMeta)this.data[e]=this._childMeta[e].encodeData();return this.data}}}),o.prototype.constructor=o,e.exports=o}}]);
//# sourceMappingURL=post-render-action-view_post-render-doc-view_theo-publish-impl_theo-web-controller_theo-web-headless_6bc92e0e-3743f715.js.map