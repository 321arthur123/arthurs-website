(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[36],{"8/a0":function(t,e,o){var i,a=e,r=o("oAGj"),n=o("SpAV"),l=o("JgVS"),s=o("cEEQ"),c=o("c+uM"),u=o("tGKA"),h=o("hgLm"),g=o("oKlP"),p=o("sIWg"),d=o("1NAc");a.BannerDecorationStrategy=(i=function(){this.spacingScalar=.75,l.BaseDecorationStrategy.call(this)},r.defineClass({name:"BannerDecorationStrategy",ctor:i,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{easeOutQuad:function(t,e,o,i){var a=t/i;return-o*a*(a-2)+e},easeOut:function(t,e,o){return this.easeOutQuad(o,t,e-t,1)},supportsConfiguration:function(t){return t.style.backing==c.LockupBacking.Banner},decorate:function(t,e){function o(t,e){return new g.TheoPoint(t,e)}var i=t.style,a=i.padding;e.numberOfLines>1&&(a+=i.spacing*this.spacingScalar);var f=e.avgTextPointSize*a,y=[],k=p.TheoRect.fromSize(e.size).transform(e.placement),S=!1;t.style.backing==c.LockupBacking.BannerHorizontal?S=!1:t.style.backing==c.LockupBacking.BannerVertical?S=!0:n.CoreAssert.isTrue(!1,"Invalid backing shape.","BannerDecorationStrategy.decorate","BannerDecorationStrategy.swift",99);var L=l.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(e.avgLinePointSize*e.typographicBoundingRatios.heightFromBaselineRatio,t.style.font.fontData.italicAngle),m=e.typographicBoundingRatios.backingVerticalOffsetRatio*e.avgLinePointSize,C=this.easeOut(0,m,Math.min(1,a)),v=S?k.minX-f:-4093,A=S?-4093:k.minY-f+C,b=h.TheoPathBuilder.init_d41d(),R=L+(S?k.size.width+2*f:8186),w=S?8186:k.size.height+2*f,D=new d.TheoSize(R,w),T=u.Matrix2D.translationXY(v,A),x=function(t,e,i){var a=h.TheoPathBuilder.init_d41d(),n=e.transformPoint(t.eval(o(0,0)));a.moveTo(n.x,n.y);var l=new p.TheoRect(n.x,n.y,n.x,n.y);if(i)for(var s=r.iter([o(0,1),o(1,1),o(1,0)]);!s.done;s.next()){var c=s.value;n=e.transformPoint(t.eval(c)),a.lineTo(n.x,n.y),l=l.expandToFit(n)}else for(var u=r.iter([o(1,0),o(1,1),o(0,1)]);!u.done;u.next())c=u.value,n=e.transformPoint(t.eval(c)),a.lineTo(n.x,n.y),l=l.expandToFit(n);return a.closePath(),{path:a.path,bounds:l}}(p.TheoRect.fromSize(D),u.Matrix2D.Identity,!0).path;b.addPath(x,e.placement);var I=b.path,O=new d.TheoSize(r.opt(I.bounds,(function(t){return t.width})),r.opt(I.bounds,(function(t){return t.height})));return y.push(r.clone(s.LockupItem.init_708e(!1,O,T,I))),new l.DecorationResults(r.clone(y))}}}),i)},"9kak":function(t,e,o){var i,a=e,r=o("oAGj");a.LockupRowInfo=(i=function(){this.aspectRatio=0,this.words=[],this.text="",this.appendable=!0,this.rowHeightAdjustRatio=1,this.colOffsetLeft=0,this.colOffsetRight=0},r.defineClass({name:"LockupRowInfo",ctor:i,props:{init_d97e:function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!0),null!=t)for(var o=r.iter(t);!o.done;o.next()){var i=o.value;this.addWord(r.clone(i))}this.appendable=e},addWord:function(t){if(this.words.length>0){var e=r.clone(this.words[this.words.length-1]);this.aspectRatio+=e.spaceAspectRatio,this.text+=" "}this.text+=t.text,this.words.push(r.clone(t)),this.aspectRatio+=t.aspectRatio,1!=this.words.length&&t.characterHeightRatio!=this.rowHeightAdjustRatio?this.rowHeightAdjustRatio=1:this.rowHeightAdjustRatio=t.characterHeightRatio},init_implicit:function(t,e,o,i,a,n,l){void 0===t&&(t=0),void 0===e&&(e=[]),void 0===o&&(o=""),void 0===i&&(i=!0),void 0===a&&(a=1),void 0===n&&(n=0),void 0===l&&(l=0),this.aspectRatio=t,this.words=r.clone(e),this.text=o,this.appendable=i,this.rowHeightAdjustRatio=a,this.colOffsetLeft=n,this.colOffsetRight=l},clone:function(){return i.init_implicit(this.aspectRatio,this.words,this.text,this.appendable,this.rowHeightAdjustRatio,this.colOffsetLeft,this.colOffsetRight)}}}),i)},EDIN:function(t,e,o){var i,a=e,r=o("oAGj"),n=o("JgVS"),l=o("cEEQ"),s=o("c+uM"),c=o("8t9B");a.NoDecorationStrategy=(i=function(){n.BaseDecorationStrategy.call(this)},r.defineClass({name:"NoDecorationStrategy",ctor:i,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.backing==s.LockupBacking.None},decorate:function(t,e){var o,i=t.style,a=!1;if((o=t.style.characterStyles[c.TypeLockupController.HIGHLIGHT_STYLE])&&(a=o.textLook==s.LockupTextLook.FillAndOutline2),i.textLook!=s.LockupTextLook.FillAndOutline2&&!a)return new n.DecorationResults([]);for(var u=[],h=r.iter(r.range(0,e.items.length,!1));!h.done;h.next()){var g=h.value,p=r.clone(e.items[g]);if(p.type==l.LockupItemType.Text){var d,f,y=i.textLook==s.LockupTextLook.FillAndOutline2;null!=(d=p.characterStyle)&&(f=t.style.characterStyles[d])&&(y=f.textLook==s.LockupTextLook.FillAndOutline2||f.textLook==s.LockupTextLook.UNSET&&y),y&&(p.hasPrimaryColor=!1,u.push(r.clone(p)))}}return new n.DecorationResults(r.clone(u))}}}),i)},GFAD:function(t,e,o){var i,a=e,r=o("oAGj");a.LockupUtils=(i=function(){},r.defineClass({name:"LockupUtils",ctor:i,statics:{percentageDiff:function(t,e){return 100*Math.abs((t-e)/((t+e)/2))}}}),i)},JEnV:function(t,e,o){var i,a=e,r=o("oAGj"),n=o("SpAV"),l=o("cEEQ"),s=o("9kak"),c=o("c+uM"),u=o("GFAD"),h=o("tGKA"),g=o("8t9B"),p=o("3UhB"),d=o("uUew"),f=o("1NAc");a.EvenRowHeightsLayoutStrategy=(i=function(t){this.paddingScalar=.6,this.spacingScalar=.75,t==c.LockupAlignment.Left||t==c.LockupAlignment.Right||t==c.LockupAlignment.Center?this.alignment=t:(n.CoreAssert.fail("Unexpected alignment: "+t,"EvenRowHeightsLayoutStrategy.init","EvenRowHeightsLayoutStrategy.swift",22),this.alignment=c.LockupAlignment.Left)},r.defineClass({name:"EvenRowHeightsLayoutStrategy",ctor:i,superName:"BaseLockupLayoutStrategy",statics:{_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.layout==c.LockupLayout.Standard&&t.style.alignment==this.alignment},layout:function(t){var e=t.text,o=t.style,i=o.font.fontData,a=t.containerSize,n=a.width,s=a.height,c=o.spacing*this.spacingScalar,u=n,y=s,k=u/y,S=l.getTypographicBoundingRatiosOfString(e,i,!1),L=g.TypeLockupController.HIGHLIGHT_STYLE,m=r.opt(r.opt(o.characterStyles[L],(function(t){return t.font})),(function(t){return t.fontData})),C=p.TypeLockupUtils.getCharFontAdjust(o,S.hasUppercase),v=!1,A=t.characterStyleRanges.length>0&&null!=o.characterStyles[L]&&-1!=o.characterStyles[L].spacing&&0!=o.characterStyles[L].spacing;A&&o.characterStyles[L].spacing>1&&((o=t.style.clone()).characterStyles[L].spacing=C,v=!0,null!=m&&(m=i,i=o.characterStyles[L].font.fontData,o.characterStyles[L].font=o.font));var b=r.clone(this.getCompactedRows(t,k,t.highlightMethod,null!=t.preferredFontSize,S));if(0==b.length)return l.LayoutResults.init_8322([],new f.TheoSize(0,0),h.Matrix2D.Identity,S,0);var R,w,D,T=this.getAspectRatioOfAllRows(r.clone(b),c),x=r.clone(this.getWidestRowAspectRatio(r.clone(b)));if(0==x.aspectRatio)return l.LayoutResults.init_8322([],new f.TheoSize(0,0),h.Matrix2D.Identity,S,0);null!=(D=t.preferredFontSize)?y=(u=(R=(w=D)*S.heightRatio)*x.aspectRatio)/T:(T<k?u=y*T:y=u/T,w=(R=u/x.aspectRatio)/S.heightRatio);for(var I=y,O=u,B=u/(x.aspectRatio/c),_=w*C,F=w*i.capRatio,E=w*S.textVerticalOffsetRatio-F,P=p.TypeLockupUtils.getCharFontYAdjust(o,w,_),W=E,U=0,M=[],N=0,V=r.iter(r.range(0,b.length,!1));!V.done;V.next()){var H=V.value,K=r.clone(b[H]),G=K.words.length>20||e.length>300&&b.length>5?0:3;if(N=w,A){for(var z=!0,Y=r.iter(K.words);!Y.done;Y.next()){var j=Y.value;if(r.isEmpty(j.characterStyle)||w==_){z=!1;break}}N=z?_:w}H>0&&(W+=B);var q=K.aspectRatio*R;switch(this.alignment){case 0:U=0;break;case 1:U=u-q+0;break;case 2:U=0+(u-q)/2}for(var X=0,J=0,Q=r.iter(K.words);!Q.done;Q.next()){j=Q.value;var Z=r.isEmpty(j.characterStyle)||N==_?0:P,$=r.isEmpty(j.characterStyle)?w:_,tt=j.aspectRatio*R,et=U,ot=W+0+Z,it=r.isEmpty(j.characterStyle)?null:j.characterStyle;v&&(it=r.isEmpty(j.characterStyle)?L:null);var at,rt=r.clone(l.LockupItem.init_e7b2(!0,it,new f.TheoSize(tt,F),h.Matrix2D.translationXY(et,ot),j.text,r.isEmpty(j.characterStyle)?i:m||i,$,w,S,H,j.rangeInLockup));if(at=r.last(M)){var nt=at.font.spaceWidthRatio*at.pointSize;if((Math.abs(nt-X)<.001||0==X)&&t.useOptimization&&at.characterStyle==rt.characterStyle&&at.placement.ty==ot&&J>G&&J<K.words.length-G&&!t.forceLetterForma){var lt=r.clone(at);lt.text=0!=X?lt.text+" "+rt.text:lt.text+rt.text,lt.rangeInLockup=new d.TextRange(at.rangeInLockup.start,rt.rangeInLockup.end),lt.size=new f.TheoSize(lt.size.width+X+rt.size.width,F),M.pop(),M.push(r.clone(lt))}else M.push(r.clone(rt))}else M.push(r.clone(rt));J+=1,U+=tt+(X=j.spaceAspectRatio*R)}W+=N*S.heightRatio}return l.LayoutResults.init_8322(r.clone(M),new f.TheoSize(O,I),h.Matrix2D.translationXY(0,0),S,x.aspectRatio)},calculateTracking:function(t,e){var o=t.text,i=t.style.font.fontData,a=t.containerSize.width,n=t.style.spacing*this.spacingScalar,s=l.getTypographicBoundingRatiosOfString(o,i,!1),c=0,u=e.width,h=e.height,g=u/h,p=r.clone(this.getCompactedRows(t,g,t.highlightMethod,!0,s));if(0==p.length)return t.style.tracking;var d=this.getAspectRatioOfAllRows(r.clone(p),n),f=r.clone(this.getWidestRowAspectRatio(r.clone(p))),y=f.aspectRatio;if(0==y)return t.style.tracking;var k=(u=h*d)/y,S=y*k;if(S<a){c=this.getSpacing(r.clone(p),r.clone(f),k,a,!1).letterSpacing;for(var L=r.iter(p);!L.done;L.next()){var m=L.value;if(m.words.length>1){var C=this.getSpacing(r.clone(p),r.clone(m),k,a,!1);C.letterSpacing<c&&(c=C.letterSpacing)}}(c/=k/s.heightRatio)<.01&&(c=0)}else c=-S;return c},calculateLeading:function(t,e){var o=t.containerSize,i=o.width,a=o.height,n=0,s=e.width,c=e.height,u=s/c,h=l.getTypographicBoundingRatiosOfString(t.text,t.style.font.fontData,!1),g=r.clone(this.getCompactedRows(t,u,t.highlightMethod,!1,h));if(g.length<=1)return t.style.spacing;var p=this.getAspectRatioOfAllRows(r.clone(g),n),d=r.clone(this.getWidestRowAspectRatio(r.clone(g)));c=s/p;var f=s/d.aspectRatio,y=d.aspectRatio*f;if(c<a){var k=i/((a-c)/(r.toDouble(g.length)-1));n=d.aspectRatio/k/this.spacingScalar}else r.info("fits in width. old tracking is :",t.style.tracking,y,"CW:",i,a,s,c),n=-c;return n},getSpacing:function(t,e,o,i,a){var n=0,l=0,s=0,c=0;if(e.words.length<=1)return{letterSpacing:s,wordSpacing:c};for(var u=r.iter(e.words);!u.done;u.next()){var h=u.value;n+=h.aspectRatio*o+h.spaceAspectRatio*o,0!=h.spaceAspectRatio&&h.canBreak&&(l+=1)}return n-=r.last(e.words).spaceAspectRatio*o,a?c=(i-n)/(r.toDouble(l)-1):(s=(i-n)/(r.toDouble(e.words.length)-1),l>1&&s>0&&(s=(i-n-(c=s)*(r.toDouble(l)-1))/(r.toDouble(e.words.length)-1))),{letterSpacing:s,wordSpacing:c}},getWidestRowAspectRatio:function(t){for(var e=r.clone(t[0]),o=r.iter(t);!o.done;o.next()){var i=o.value;i.aspectRatio>e.aspectRatio&&(e=r.clone(i))}return e},getAspectRatioOfAllRows:function(t,e){var o=t.length-1,i=r.clone(this.getWidestRowAspectRatio(r.clone(t)));if(0==i.aspectRatio)return 0;for(var a=i.aspectRatio/e,n=0,l=r.iter(t);!l.done;l.next()){var s=l.value;n+=1/i.aspectRatio*s.rowHeightAdjustRatio}return 1/(n+1/a*r.toDouble(o))},rowsForTargetRowAspectRatio:function(t,e,o){var i=[];i.push(r.clone(s.LockupRowInfo.init_d97e()));for(var a=0,n=0,l=!0,c=t.length,h=0;h<c;){var g=r.clone(i[a]),p=r.clone(t[h]);if(p.isNewLine)g.appendable=!1,i[a]=r.clone(g),h+=1;else{for(var d=g.aspectRatio,f=p.aspectRatio+p.spaceAspectRatio,y=h;y+1<c&&!t[y].canBreak;)f+=t[y+=1].aspectRatio+t[y].spaceAspectRatio;var k=d+f,S=u.LockupUtils.percentageDiff(e,d),L=u.LockupUtils.percentageDiff(e,k);if(n>0&&S<L||0==g.appendable||!l&&h>0&&t[h-1].canBreak){a+=1,n=1;var m=r.clone(s.LockupRowInfo.init_d97e());if(o)l=!(h>0&&!t[h-1].canBreak);else for(;!p.canBreak&&h<c;)m.addWord(r.clone(p)),(h+=1)<c&&(p=r.clone(t[h]));m.addWord(r.clone(p)),i.push(r.clone(m))}else{if(!o)for(;!p.canBreak&&h<c;)g.addWord(r.clone(p)),(h+=1)<c&&(p=r.clone(t[h]));g.addWord(r.clone(p)),n+=1,i[a]=r.clone(g)}h+=1}}return i},getCompactedRows:function(t,e,o,i,a){var n=t.text,l=t.style,c=l.font.fontData,u=l.spacing*this.spacingScalar,h=l.tracking,f=i||t.forceLetterForma,y=r.clone(t.characterStyleRanges),k=g.TypeLockupController.HIGHLIGHT_STYLE,S=r.opt(r.opt(l.characterStyles[k],(function(t){return t.font})),(function(t){return t.fontData})),L=p.TypeLockupUtils.getCharFontAdjust(l,a.hasUppercase);t.characterStyleRanges.length>0&&null!=l.characterStyles[k]&&-1!=l.characterStyles[k].spacing&&0!=l.characterStyles[k].spacing&&l.characterStyles[k].spacing>1&&((l=t.style.clone()).characterStyles[k].spacing=L,y=r.clone(p.TypeLockupUtils.invertRanges(r.clone(t.characterStyleRanges),n.length)),null!=S&&(S=c,c=l.characterStyles[k].font.fontData,l.characterStyles[k].font=l.font));var m=r.clone(p.TypeLockupUtils.computeLockupMeasurements(n,c,a.heightRatio,!1,f,h,r.clone(y),r.clone(l.characterStyles),L,t.forceLetterForma)),C=m.length;if(0==C)return[];var v,A=s.LockupRowInfo.init_d97e(r.clone(m)).aspectRatio,b=.5,R=.6+1.6*A;if(null!=(v=t.preferredFontSize)){var w=v*a.heightRatio,D=t.containerSize.width/w;b=D,R=D}for(var T=r.clone(this.getOptimalCompactedRows(r.clone(m),A,e,u,b,R,!1,i)),x=0,I=r.iter(m);!I.done;I.next())x+=I.value.isNewLine?0:1;if(null!=t.rowWordLengths&&t.rowWordLengths.reduce((function(t,e){return t+e}),0)==x&&(!t.allowFewerLineBreaks||T.length>=t.rowWordLengths.length)&&(T=r.clone(this.getPrecomputedRows(r.clone(m),r.clone(t.rowWordLengths)))),null!=l.characterStyles[k]&&null!=l.characterStyles[k].font&&(C>1&&!f||f&&T.length>1)&&(o==g.HighlightMethod.EvenRows||o==g.HighlightMethod.OddRows||o==g.HighlightMethod.Bracket||o==g.HighlightMethod.InsideBracket)){var O=r.clone(p.TypeLockupUtils.computeLockupMeasurements(n,c,a.heightRatio,!1,f,h,r.clone([]),r.clone({}),void 0,t.forceLetterForma)),B=[new d.TextRange(0,r.chars(n).length)],_=r.clone(p.TypeLockupUtils.computeLockupMeasurements(n,S,a.heightRatio,!1,f,h,r.clone(B),r.clone(l.characterStyles),L,t.forceLetterForma));T=r.clone(this.getOptimalCompactedAutoRows(r.clone(O),r.clone(_),A,e,u,.5,.6+1.6*A,!1,!1,o))}if(i&&l.tracking>0)for(var F=r.iter(r.range(0,T.length,!1));!F.done;F.next()){var E=F.value;T[E].aspectRatio=0;for(var P=r.iter(r.range(0,T[E].words.length,!1));!P.done;P.next()){var W=P.value;T[E].aspectRatio+=T[E].words[W].aspectRatio,T[E].words[W].canBreak&&W!=T[E].words.length-1?(T[E].words[W].spaceAspectRatio=c.spaceWidthRatio/a.heightRatio,T[E].aspectRatio+=T[E].words[W].spaceAspectRatio):T[E].words[W].spaceAspectRatio=0}}return T},getOptimalCompactedRows:function(t,e,o,i,a,n,l,s){var c=n-a,h=.25*c,g=a+.5*c,p=a+h,d=n-h,f=r.clone(this.rowsForTargetRowAspectRatio(r.clone(t),p,l)),y=r.clone(this.rowsForTargetRowAspectRatio(r.clone(t),d,l)),k=this.getAspectRatioOfAllRows(r.clone(f),i),S=this.getAspectRatioOfAllRows(r.clone(y),i),L=u.LockupUtils.percentageDiff(o,k),m=u.LockupUtils.percentageDiff(o,S);return c<.2?L<m?f:y:L<=m?this.getOptimalCompactedRows(r.clone(t),e,o,i,a,g,l,s):this.getOptimalCompactedRows(r.clone(t),e,o,i,g,n,l,s)},getWordForAutoMethod:function(t,e,o,i,a){var n=a==g.HighlightMethod.EvenRows?0:1,l=r.clone(o%2==n?e:t);return a!=g.HighlightMethod.Bracket&&a!=g.HighlightMethod.InsideBracket||(l=0==o||i?r.clone(a==g.HighlightMethod.Bracket?e:t):r.clone(a==g.HighlightMethod.InsideBracket?e:t)),l},rowsForTargetRowAspectRatioAutoRows:function(t,e,o,i,a,n){var l=[];l.push(r.clone(s.LockupRowInfo.init_d97e()));for(var c=0,h=0,p=!0,d=t.length,f=0,y=0;f<d;){var k=r.clone(l[c]),S=r.clone(this.getWordForAutoMethod(r.clone(t[f]),r.clone(e[f]),c,f==d-1,n));if(S.isNewLine)k.appendable=!1,l[c]=r.clone(k),f+=1;else{for(var L=k.aspectRatio,m=S.aspectRatio+S.spaceAspectRatio,C=f;C+1<d&&!t[C].canBreak;)m+=t[C+=1].aspectRatio+t[C].spaceAspectRatio;var v=L+m,A=u.LockupUtils.percentageDiff(i,L),b=u.LockupUtils.percentageDiff(i,v);if(h>0&&A<b||0==k.appendable||!p&&f>0&&t[f-1].canBreak){c+=1,y=f,S=r.clone(this.getWordForAutoMethod(r.clone(t[f]),r.clone(e[f]),c,f==d-1,n)),h=1;var R=r.clone(s.LockupRowInfo.init_d97e());if(a)p=!(f>0&&!t[f-1].canBreak);else for(;!S.canBreak&&f<d;)R.addWord(r.clone(S)),(f+=1)<d&&(S=r.clone(this.getWordForAutoMethod(r.clone(t[f]),r.clone(e[f]),c,f==d-1,n)));R.addWord(r.clone(S)),l.push(r.clone(R))}else{if(!a)for(;!S.canBreak&&f<d;)k.addWord(r.clone(S)),(f+=1)<d&&(S=r.clone(this.getWordForAutoMethod(r.clone(t[f]),r.clone(e[f]),c,f==d-1,n)));k.addWord(r.clone(S)),h+=1,l[c]=r.clone(k)}f+=1}}if(n==g.HighlightMethod.Bracket||n==g.HighlightMethod.InsideBracket){for(var w=r.clone(s.LockupRowInfo.init_d97e()),D=r.iter(r.range(y,d,!1));!D.done;D.next()){f=D.value;var T=r.clone(n==g.HighlightMethod.Bracket?e[f]:t[f]);w.addWord(r.clone(T))}l[l.length-1]=r.clone(w)}return l},getOptimalCompactedAutoRows:function(t,e,o,i,a,l,s,c,h,g){n.CoreAssert.isTrue(t.length==e.length,void 0,"EvenRowHeightsLayoutStrategy.getOptimalCompactedAutoRows","EvenRowHeightsLayoutStrategy.swift",905);var p=s-l,d=.25*p,f=l+.5*p,y=l+d,k=s-d,S=r.clone(this.rowsForTargetRowAspectRatioAutoRows(r.clone(t),r.clone(e),a,y,c,g)),L=r.clone(this.rowsForTargetRowAspectRatioAutoRows(r.clone(t),r.clone(e),a,k,c,g)),m=this.getAspectRatioOfAllRows(r.clone(S),a),C=this.getAspectRatioOfAllRows(r.clone(L),a);if(h){if(m>i&&C<i)return L;if(C>i&&m<i)return S}var v=u.LockupUtils.percentageDiff(i,m),A=u.LockupUtils.percentageDiff(i,C);return p<.2?v<A?S:L:v<=A?this.getOptimalCompactedAutoRows(r.clone(t),r.clone(e),o,i,a,l,f,c,h,g):this.getOptimalCompactedAutoRows(r.clone(t),r.clone(e),o,i,a,f,s,c,h,g)}}}),i)},JgVS:function(t,e,o){var i,a,r=e,n=o("oAGj"),l=o("SpAV");r.DecorationResults=(i=function(t){this.items=n.clone(t)},n.defineClass({name:"DecorationResults",ctor:i}),i),r.LockupDecorationStrategy=n.defineProtocol("LockupDecorationStrategy",{supportsConfiguration:"(LockupConfiguration) -> Boolean",decorate:"(LockupConfiguration, LayoutResults) -> DecorationResults"}),r.BaseDecorationStrategy=(a=function(){},n.defineClass({name:"BaseDecorationStrategy",ctor:a,statics:{getHorizontalOffsetForItalicAngle:function(t,e){var o=Math.abs(e),i=(180-o-90)*Math.PI/180,a=o*Math.PI/180,r=t/Math.sin(i)*Math.sin(a);return(r>t||r<0)&&(r=t/2),r},_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return l.CoreAssert.fail("Implement in subclass","BaseDecorationStrategy.supportsConfiguration","LockupDecorationStrategy.swift",31),!1},decorate:function(t,e){return l.CoreAssert.fail("Implement in subclass","BaseDecorationStrategy.decorate","LockupDecorationStrategy.swift",36),new r.DecorationResults([])}}}),a)},KdeS:function(t,e,o){var i,a=e,r=o("oAGj"),n=o("1NAc");a.LockupWordInfo=(i=function(){},r.defineClass({name:"LockupWordInfo",ctor:i,props:{init_e9d6:function(t,e,o,i,a,r,l,s,c){void 0===c&&(c=n.TheoSize.Zero),this.text=t,this.aspectRatio=e,this.spaceAspectRatio=o,this.characterStyle=i,this.characterHeightRatio=a,this.isNewLine=r,this.canBreak=l,this.rangeInLockup=s,this.relativeMargins=c},init_implicit:function(t,e,o,i,a,r,n,l,s){this.text=t,this.aspectRatio=e,this.spaceAspectRatio=o,this.characterStyle=i,this.characterHeightRatio=a,this.isNewLine=r,this.canBreak=n,this.rangeInLockup=l,this.relativeMargins=s},clone:function(){return i.init_implicit(this.text,this.aspectRatio,this.spaceAspectRatio,this.characterStyle,this.characterHeightRatio,this.isNewLine,this.canBreak,this.rangeInLockup,this.relativeMargins)}}}),i)},PXlJ:function(t,e,o){var i,a=e,r=o("oAGj"),n=o("JgVS"),l=o("cEEQ"),s=o("c+uM"),c=o("tGKA"),u=o("JKVa"),h=o("8t9B"),g=o("sIWg");a.LetterDecorationStrategy=(i=function(){n.BaseDecorationStrategy.call(this)},r.defineClass({name:"LetterDecorationStrategy",ctor:i,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return s.LockupStyle.isLetterGrid(t.style.layout)},decorate:function(t,e){var o,i,a=[];if(0==e.items.length)return new n.DecorationResults(r.clone(a));var u,p,d,f,y=t.style,k=r.opt(y.font,(function(t){return t.fontData}));y.backing==s.LockupBacking.SVGBackground&&(u=y.backingArtworkID);var S,L,m,C=null;if(0==!t.characterStyleRanges.length&&(S=y.characterStyles[h.TypeLockupController.HIGHLIGHT_STYLE])&&(p=r.opt(S.font,(function(t){return t.fontData})),(d=S.backing)!=s.LockupBacking.UNSET&&(C=S.padding),d==s.LockupBacking.SVGBackground&&(f=S.backingArtworkID)),null==u&&null==f)return new n.DecorationResults(r.clone(a));for(var v=r.iter(r.toSequence(e.items));!v.done;v.next()){var A=v.value,b=A.offset,R=A.element,w=k,D=null,T=!1;if(R.characterStyle==h.TypeLockupController.HIGHLIGHT_STYLE?(T=!0,w=p||w,D=d==s.LockupBacking.UNSET?u:f):D=u,null!=D){var x,I,O,B,_=g.TheoRect.fromXYWH(R.placement.tx,R.placement.ty,R.size.width,R.size.height).outsetXY((o=r.opt(R.margins,(function(t){return t.width})))||null!=o?o:0,(i=r.opt(R.margins,(function(t){return t.height})))||null!=i?i:0),F=T?m:L;if(null==F&&(F=this.getSVGConfig(t.style,T?C:null,r.clone(e),D,r.clone(R),_),T?m=F:L=F),null!=(x=r.opt(w,(function(t){return t.capRatio})))&&null!=(I=R.pointSize)&&null!=(O=F)&&null!=(B=D)){var E=(e.typographicBoundingRatios.textVerticalOffsetRatio-x)*I,P=c.Matrix2D.translation(O.frame.origin).translate(_.origin).translateXY(0,-E);a.push(r.clone(l.LockupItem.init_9cc6(!1,O.frame.size,P,B,O.preScale,b+e.numberOfLines,R.characterStyle)))}}}return new n.DecorationResults(r.clone(a))},getSVGConfig:function(t,e,o,i,a,n){var c,h,g=r.clone(l.LayoutResults.init_8322([a],n.size,o.placement,o.typographicBoundingRatios,o.avgRowAspect)),p=t;return null!=(c=e)&&(h=r.as(p.clone(),s.LockupStyle))&&(h.padding=c,p=h),new u.SVGBackgroundDecorationStrategy(i).calcSVGConfiguration(p,r.clone(g))}}}),i)},TkOd:function(t,e,o){var i,a,r,n,l,s,c,u,h,g,p,d,f,y,k=e,S=o("oAGj"),L=o("0wFF"),m=o("cZuM"),C=o("6h7+"),v=o("SpAV"),A=o("yhkb"),b=o("gXiO"),R=o("C42b"),w=o("YSlt"),D=o("Ohrj"),T=o("ascj"),x=o("FNB+"),I=o("lq1z"),O=o("G1DZ"),B=o("iCxV"),_=o("3lr5"),F=o("VDg0"),E=o("c+uM"),P=o("hb8m"),W=o("3DEm"),U=o("jcfx"),M=o("Zifs"),N=o("35Q0"),V=o("p+tC"),H=o("UqVc"),K=o("EoOi"),G=o("umUn"),z=o("T6jX"),Y=o("8t9B"),j=o("3UhB"),q=o("oKlP"),X=o("oKI3");k.kColorPairDistanceThreshold=10,k.kPuffyTextThreshold=.12,S.gvar(k,"BACKING_SHAPES_BASIC",(function(){return N.ShapeLibrary.NonSvgBackingShapeIDs})),S.gvar(k,"BACKING_SHAPES_SVG",(function(){return N.ShapeLibrary.BrowsableBackingShapes})),S.gvar(k,"ALLOWED_BACKING_VALUES",(function(){return k.BACKING_SHAPES_BASIC.concat(k.BACKING_SHAPES_SVG)})),S.gvar(k,"BACKING_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_BACKING_VALUES.length)})),S.gvar(k,"ALLOWED_LAYOUT_VALUES",(function(){return["left","right","center","fill"]})),S.gvar(k,"LAYOUT_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_LAYOUT_VALUES.length)})),S.gvar(k,"ALLOWED_OPACITY_VALUES",(function(){return["full","mediumBacking","faintBacking","medium","faint"]})),S.gvar(k,"OPACITY_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_OPACITY_VALUES.length)})),S.gvar(k,"ALLOWED_SHADOWANGLE_VALUES",(function(){return[45,135,225,315]})),S.gvar(k,"SHADOWANGLE_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_SHADOWANGLE_VALUES.length)})),S.gvar(k,"ALLOWED_PADDING_VALUES",(function(){return[0,.33,.66,1]})),S.gvar(k,"PADDING_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_PADDING_VALUES.length)})),S.gvar(k,"ALLOWED_SPACING_VALUES",(function(){return[0,.5,1]})),S.gvar(k,"SPACING_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_SPACING_VALUES.length)})),S.gvar(k,"ALLOWED_TRACKING_VALUES",(function(){return[-.1,0,.5]})),k.LockupStyleAttributes=(i=function(t,e,o,i,a,r,n,l,s,c,u,h,g,p,d,f,y){this.font=0,this.layout="fill",this.backing="none",this.opacity="useLockupOpacities",this.textOpacity=1,this.backingOpacity=1,this.primaryColor="themeColor0",this.secondaryColor="themeColor1",this.shadowAngle=135,this.spacing=.35,this.tracking=0,this.padding=.35,this.textLook="fill",this.shadowOffset=E.LockupStyle.DEFAULT_SHADOWOFFSET,this.strokeWeight=E.LockupStyle.DEFAULT_STROKEWEIGHT,this.layoutVariation=K.TypographyVariation.Unset,this.wheelUsed=!1,void 0===t&&(t=0),void 0===e&&(e="fill"),void 0===o&&(o="none"),void 0===i&&(i="useLockupOpacities"),void 0===a&&(a=1),void 0===r&&(r=1),void 0===n&&(n="themeColor0"),void 0===l&&(l="themeColor1"),void 0===s&&(s=135),void 0===c&&(c=.35),void 0===u&&(u=0),void 0===h&&(h=.35),void 0===g&&(g="fill"),void 0===p&&(p=E.LockupStyle.DEFAULT_SHADOWOFFSET),void 0===d&&(d=E.LockupStyle.DEFAULT_STROKEWEIGHT),void 0===f&&(f=K.TypographyVariation.Unset),void 0===y&&(y=!1),this.font=t,this.layout=e,this.backing=o,this.opacity=i,this.textOpacity=a,this.backingOpacity=r,this.primaryColor=n,this.secondaryColor=l,this.shadowAngle=s,this.spacing=c,this.tracking=u,this.padding=h,this.textLook=g,this.shadowOffset=p,this.strokeWeight=d,this.layoutVariation=f,this.wheelUsed=y},S.defineClass({name:"LockupStyleAttributes",ctor:i,props:{clone:function(){return new i(this.font,this.layout,this.backing,this.opacity,this.textOpacity,this.backingOpacity,this.primaryColor,this.secondaryColor,this.shadowAngle,this.spacing,this.tracking,this.padding,this.textLook,this.shadowOffset,this.strokeWeight,this.layoutVariation,this.wheelUsed)}}}),i),k.getFontPairingMatrix=function(t){for(var e={},o=t.count,i=S.iter(S.range(0,o,!1));!i.done;i.next()){for(var a=i.value,r=t.fontAt(a),n=r.postScriptName,l={},s=S.iter(S.range(0,o,!1));!s.done;s.next()){var c=s.value,u=t.fontAt(c),h=u.postScriptName,g=a==c,p=1;p+=1+S.toDouble(10-W.MathUtils.absInt(r.formality-u.formality)),p+=1+S.toDouble(10-W.MathUtils.absInt(r.width-u.width)),p+=1+S.toDouble(W.MathUtils.absInt(r.blackness-u.blackness));var d=S.toDouble(r.drama-u.drama);p+=d,d<-1&&(p*=.1),r.square==u.square&&(p*=2),r.geometric==u.geometric&&(p*=2),r.italic==u.italic&&(p*=2),r.handdrawn&&u.handdrawn&&(p*=2);var f=r.slab&&u.slab,y=0==(r.slab||u.slab);f&&(p*=2);var k=r.serif&&u.serif;k&&y&&(p*=2),0==(r.serif||u.serif)&&(p*=2),k&&r.slab!=u.slab&&(p*=0);var L=r.decorative&&u.decorative;0==g&&L&&(p*=0),r.calligraphic&&u.calligraphic&&0==g&&(p*=0),l[h]=p}e[n]=S.clone(l)}return e},k.getFontPairScore=function(t,e,o){var i,a;if((i=t[e])&&null!=(a=i[o]))return a;return 0},k.hasSufficientLegibilityContrast=function(t,e){return t.contrasts(e,!1)},k.needsContrastingColor=function(t,e,o){return e!=E.LockupTextLook.Fill&&e!=E.LockupTextLook.KnockoutOnly||o},k.getTextOpacity=function(t){switch(t.opacity){case"medium":return F.kOpacityRuleMediumAlpha;case"faint":return F.kOpacityRuleFaintAlpha;case"useLockupOpacities":return t.textOpacity;default:return 1}},k.getBackingOpacity=function(t){switch(t.opacity){case"medium":case"mediumBacking":return F.kOpacityRuleMediumAlpha;case"faint":case"faintBacking":return F.kOpacityRuleFaintAlpha;case"useLockupOpacities":return t.backingOpacity;default:return 1}},k.getTextLook=function(t){var e;switch(t.textLook){case"fill":e=E.LockupTextLook.Fill;break;case"knockoutOnly":e=E.LockupTextLook.KnockoutOnly;break;case"knockoutAndOutline":e=E.LockupTextLook.KnockoutAndOutline;break;case"outlineOnly":e=E.LockupTextLook.OutlineOnly;break;case"fillAndOutline":e=E.LockupTextLook.FillAndOutline;break;case"fillAndOutline2":e=E.LockupTextLook.FillAndOutline2;break;case"shadow":e=E.LockupTextLook.Shadow;break;case"shadowAndOutline":e=E.LockupTextLook.ShadowAndOutline;break;case"knockoutAndShadow":e=E.LockupTextLook.KnockoutAndShadow;break;default:e=E.LockupTextLook.Fill}return e},k.InterestingLockupData=(a=function(){},S.defineClass({name:"InterestingLockupData",ctor:a,props:{init_a05b:function(t){var e,o,i,a,r,n,l,s,c,u,h,g,p,d,f,y,L,m,C,v,A,b,R;(A=S.as(t.style,E.LockupStyle))&&(g=S.clone(k.lockupStyleToLockupStyleAttributes(A,t.page.document)),u=S.opt(A.font,(function(t){return t.fontData.postScriptName})),(b=S.as(t.controller,Y.TypeLockupController))&&(h=b.getCurrentFontSize()),v=k.lockupStyleToLockupStyleAttributes(A,t.page.document).backing),(b=S.as(t.controller,Y.TypeLockupController))&&((R=b.size)&&(m=R.width,C=R.height,p=S.toDouble(R.width/R.height)),d=S.clone(t.totalPlacement.transformPoints(S.clone(t.bounds.points))),f=b.text.length,y=b.text,L=b.wordCount()),this.id=t.formaID,this.width=(e=m)||null!=e?e:100,this.height=(o=C)||null!=o?o:100,this.font=(i=u)||null!=i?i:"BebasNeue",this.lineHeight=(a=h)||null!=a?a:1,this.styleAttributes=S.clone(g||new k.LockupStyleAttributes),this.aspectRatio=(r=p)||null!=r?r:1,this.pts=S.clone(d||[]),this.wordCount=(n=L)||null!=n?n:1,this.charCount=(l=f)||null!=l?l:1,this.originalBacking=(s=v)||null!=s?s:"",this.lockupString=(c=y)||null!=c?c:""},init_implicit:function(t,e,o,i,a,r,n,l,s,c,u,h){this.id=t,this.font=e,this.lineHeight=o,this.styleAttributes=S.clone(i),this.aspectRatio=a,this.pts=S.clone(r),this.charCount=n,this.lockupString=l,this.wordCount=s,this.width=c,this.height=u,this.originalBacking=h}}}),a),k.InterestingPageData=(r=function(){this.colorsBehindSelectedLockup=[],this.numImages=0,this.shapeCount=0},S.defineClass({name:"InterestingPageData",ctor:r,props:{init_a05b:function(t){this.selectedLockup=k.InterestingLockupData.init_a05b(t);var e=this.selectedLockup,o=[this.selectedLockup],i=10,a=1e3,r=1e3;if(t.page.hasRoot()){var n,l;a=t.page.pageSize.width,r=t.page.pageSize.height,(n=S.as(t.controller,Y.TypeLockupController))&&(this.colorsBehindSelectedLockup=S.clone(n.getBackgroundColors()),i=n.getBackgroundLightnessSpread(S.clone(this.colorsBehindSelectedLockup)),this.shapeCount=n.shapeCount()),0==this.colorsBehindSelectedLockup.length&&(l=t.page.root.style.colors.fieldPrimary)&&this.colorsBehindSelectedLockup.push(l);for(var s=S.clone(t.page.root.filterWithCallback((function(t){return t.isTypeLockup()}))),c=S.iter(s);!c.done;c.next())if((t=c.value).formaID!=this.selectedLockup.id){var u=k.InterestingLockupData.init_a05b(t);u.lineHeight>e.lineHeight&&(e=u),o.push(u)}}this.height=r,this.width=a,this.numImages=t.root.filterWithCallback((function(t){return t.isBackgroundImage()})).length,this.lockups=S.clone(o),this.largestLineHeightLockup=e,0==this.colorsBehindSelectedLockup.length&&this.colorsBehindSelectedLockup.push(M.SolidColor.BLACK),this.lightnessSpreadBehindSelectedLockup=i},isColorVisibleAgainstBackground:function(t){for(var e=S.iter(this.colorsBehindSelectedLockup);!e.done;e.next()){var o=e.value;if(!k.hasSufficientLegibilityContrast(t,o))return!1}return!0},ensureCorrectBackgroundColors:function(t){var e,o,i=[];(e=S.as(t.controller,Y.TypeLockupController))&&(i=S.clone(e.getBackgroundColors())),0==i.length&&(o=t.page.root.style.colors.fieldPrimary)&&i.push(o),i.length>0&&(this.colorsBehindSelectedLockup=S.clone(i))},init_implicit:function(t,e,o,i,a,r,n,l,s){void 0===i&&(i=[]),void 0===l&&(l=0),void 0===s&&(s=0),this.largestLineHeightLockup=t,this.selectedLockup=e,this.lockups=S.clone(o),this.colorsBehindSelectedLockup=S.clone(i),this.lightnessSpreadBehindSelectedLockup=a,this.width=r,this.height=n,this.numImages=l,this.shapeCount=s},clone:function(){return r.init_implicit(this.largestLineHeightLockup,this.selectedLockup,this.lockups,this.colorsBehindSelectedLockup,this.lightnessSpreadBehindSelectedLockup,this.width,this.height,this.numImages,this.shapeCount)}}}),r),k.getBackingStringForBackingEnumAndArtworkId=function(t,e){var o="none";switch(t){case 0:o="none";break;case 2:o="row";break;case 9:o="bannerHorizontal";break;case 8:o="bannerVertical";break;case 11:o="knockout";break;case 4:o="none";break;default:null!=e&&(o=e)}return o},k.getBackingEnumAndArtworkIdForBackingString=function(t){var e,o=null;switch(t){case"none":e=E.LockupBacking.None;break;case"row":e=E.LockupBacking.Rows;break;case"bannerHorizontal":e=E.LockupBacking.BannerHorizontal;break;case"bannerVertical":e=E.LockupBacking.BannerVertical;break;case"knockout":e=E.LockupBacking.Knockout;break;default:e=E.LockupBacking.SVGBackground,o=t}return{backing:e,artworkID:o}},k.lockupStyleToLockupStyleAttributes=function(t,e){var o,i=S.clone(new k.LockupStyleAttributes),a=B.Host.fontProvider.getIncludedFonts(e);i.shadowAngle=t.shadowAngle;var r,n,l,s,c,u=-1;switch((r=t.font)&&(u=(o=a.indexOf(r.fontData))||null!=o?o:-1),i.font=u,i.spacing=t.spacing,i.tracking=t.tracking,i.padding=t.padding,i.textLook=t.textLookAsString,i.shadowOffset=t.shadowOffset,i.strokeWeight=t.strokeWeight,null!=(n=t.colors.colorID(T.ColorRole.FieldPrimary))&&(i.primaryColor=n),null!=(l=t.colors.colorID(T.ColorRole.FieldSecondary))&&(i.secondaryColor=l),t.opacityRule){case 1:s="mediumBacking";break;case 2:s="faintBacking";break;case 3:s="medium";break;case 4:s="faint";break;case 0:s="full";break;default:s="useLockupOpacities"}i.opacity=s,i.textOpacity=t.textOpacity,i.backingOpacity=t.backingOpacity,i.layoutVariation=t.layoutVariation;var h=t.layout;if(E.LockupStyle.isLetterGrid(h)||h==E.LockupLayout.Standard){var g=E.LockupStyle.isLetterGrid(h)?"letter-grid-":"";switch(t.alignment){case 0:c=g+"left";break;case 1:c=g+"right";break;case 2:c=g+"center";break;default:v.CoreAssert.fail("Unexpected alignment: "+t.alignment,"lockupStyleToLockupStyleAttributes","LockupStyleController.swift",640),c=g+"left"}}else if(E.LockupStyle.isAutoLayout(h))c="auto";else if(E.LockupStyle.isPath(h)){c="path"+t.pathID}else c="fill";return i.layout=c,i.backing=k.getBackingStringForBackingEnumAndArtworkId(t.backing,t.backingArtworkID),i.wheelUsed=t.wheelUsed,i},k.lockupStyleAttributesToLockupStyle=function(t,e,o){var i,a,r=null,n=t.font;(v.CoreAssert.isTrue(n>-1,"lockupStyleAttributesToLockupStyle called with no font. It is valid for a character style to have no font but this function doesn't work for character styles ","lockupStyleAttributesToLockupStyle","LockupStyleController.swift",681),n>-1)&&((a=B.Host.fontProvider.getIncludedFonts(o).fontAt(n))&&(r=j.TypeLockupUtils.createTheoFont(a,B.Host.brandkitManager.brandkitForDocument(o))));var l,s,c=T.ColorTable.init_25f6([{key:T.ColorRole.FieldPrimary,value:t.primaryColor},{key:T.ColorRole.FieldSecondary,value:t.secondaryColor}]);switch(t.opacity){case"mediumBacking":l=E.OpacityRule.MediumBacking;break;case"faintBacking":l=E.OpacityRule.FaintBacking;break;case"medium":l=E.OpacityRule.Medium;break;case"faint":l=E.OpacityRule.Faint;break;case"full":l=E.OpacityRule.Full;break;default:l=E.OpacityRule.UseLockupOpacities}var u,h,g=E.LockupAlignment.UNSET,p=X.TextPathID.UNSET,d=null;if(t.layout.startsWith("path"))s=E.LockupLayout.Path,null!=(u=S.toInt(t.layout.substr("path".length)))&&(p=(i=X.TextPathID.toCaseValue(u))||null!=i?i:X.TextPathID.UNSET)==X.TextPathID.Custom&&(h=e.customPath)&&(d=h);else switch(t.layout){case"auto":s=E.LockupLayout.Auto,g=E.LockupAlignment.Auto;break;case"left":s=E.LockupLayout.Standard,g=E.LockupAlignment.Left;break;case"right":s=E.LockupLayout.Standard,g=E.LockupAlignment.Right;break;case"center":s=E.LockupLayout.Standard,g=E.LockupAlignment.Center;break;case"letter-grid-left":s=E.LockupLayout.LetterGrid,g=E.LockupAlignment.Left;break;case"letter-grid-right":s=E.LockupLayout.LetterGrid,g=E.LockupAlignment.Right;break;case"letter-grid-center":s=E.LockupLayout.LetterGrid,g=E.LockupAlignment.Center;break;case"fill":default:s=E.LockupLayout.FitJustified}var f=k.getBackingEnumAndArtworkIdForBackingString(t.backing),y=k.getTextLook(S.clone(t)),L=t.wheelUsed,m=E.LockupStyle.init_2885(t.textOpacity,t.backingOpacity,c,r,t.spacing,t.tracking,t.padding,f.backing,f.artworkID,t.shadowAngle,s,g,t.layoutVariation,l,y,t.shadowOffset,t.strokeWeight,p,d,L);return m.setCharacterStyles(S.clone(e.characterStyles)),m},k.randomDbl=function(){return S.toDouble(R.CoreRandom.nextInt)/S.toDouble(R.CoreRandom.randMax)},k.getWeightedIndex=function(t,e){for(var o=t.length,i=e*k.randomDbl(),a=0,r=0,n=S.iter(S.range(0,o,!1));!n.done;n.next()){var l=n.value;if((a+=t[l])>=i){r=l;break}}return r},k.selectWeightedValue=function(t,e,o,i,a){var r,n=i,l=S.clone(o);return null!=(r=S.indexOf(e,t))&&o[r]>0&&(l[r]+=n*a,n+=n*a),e[k.getWeightedIndex(S.clone(l),n)]},k.WeightedAttributeSelector=S.defineProtocol("WeightedAttributeSelector",{inertiaRatio:"Double",forma:"Forma",pageData:"InterestingPageData",values:"Array<TypeAlias>",weights:"Array<Double>",weightSum:"Double",scoreValue:"(TypeAlias) -> Double",updateWeights:"(InterestingPageData) -> Void",select:"(LockupStyleAttributes, Boolean, Boolean, Boolean, Boolean) -> TypeAlias"}),k.WeightedFontSelector=(n=function t(e,o){this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.machineRecommend=!0;var i=this;this.forma=e,this.pageData=S.clone(o),this.listOfFonts=B.Host.fontProvider.getIncludedFonts(e.page.document),this.values=S.toArray(S.range(0,this.listOfFonts.count,!1));var a=this.listOfFonts.revisionNumber,r=this.listOfFonts.fontSetID;a==t.cacheRevisionNumber&&r==t.cacheFontSetID?this.fontPairingMatrix=S.clone(t.fontPairingMatrixCache):(this.fontPairingMatrix={},t.fontPairingMatrixCache={},S.each(k.getFontPairingMatrix(this.listOfFonts),(function(e,o){i.fontPairingMatrix[e]=S.clone(o),t.fontPairingMatrixCache[e]=S.clone(o)})),t.cacheRevisionNumber=a,t.cacheFontSetID=r)},S.defineClass({name:"WeightedFontSelector",ctor:n,statics:{cacheRevisionNumber:0,cacheFontSetID:"charlie",_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=S.clone(t);var e=!1;if(this.values.length!=B.Host.fontProvider.getIncludedFonts(this.forma.page.document).count&&(this.listOfFonts=B.Host.fontProvider.getIncludedFonts(this.forma.page.document),this.values=S.toArray(S.range(0,this.listOfFonts.count,!1)),e=!0),this.machineRecommend){var o,i=new I.FontSuggester;(o=i.getFontFeatures(S.clone(t),this.forma))?(e&&i.clearCache(),this.weights=S.clone(i.getScores(this.listOfFonts,o))):this.weights=this.values.map(this.scoreValue,this)}0!=this.machineRecommend&&1!=(new H.SuggestionUtils).weightsEqualNaNOrEmpty(S.clone(this.weights))||(this.weights=this.values.map(this.scoreValue,this)),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},getTopFonts:function(t){v.CoreAssert.isTrue(t<this.listOfFonts.count,"cannot get top fonts more than total number","WeightedFontSelector.getTopFonts","LockupStyleController.swift",982);for(var e=[],o=S.iter(S.toSequence(this.weights));!o.done;o.next()){var i=o.value,a=i.offset,r=i.element;e.push([r,a])}e=S.sort(e,(function(t,e){return t[0]>e[0]}));for(var n=[],l=0,s=S.iter(e);!s.done;s.next()){var c=s.value;if(!(l<t))break;n.push(this.listOfFonts.fontAt(c[1])),l+=1}return n},scoreValue:function(t){return this.manuallyScoreValue(t)},manuallyScoreValue:function(t){var e=this.listOfFonts.fontAt(t),o=e.postScriptName,i=B.Host.fontProvider.descriptorForPostScriptName(o,_.ANY_DOCUMENT),a=this.pageData.selectedLockup.lineHeight;if(!B.Host.fontProvider.getSuggestableFonts(S.opt(this.forma,(function(t){return t.page.document}))).contains(e))return 0;for(var r=.1,n=S.iter(this.pageData.lockups);!n.done;n.next()){var l=n.value;if(l.id!=this.pageData.selectedLockup.id){var s=W.MathUtils.absDouble(a-l.lineHeight)/a,c=l.lineHeight>a,u=c?l.font:o,h=c?o:l.font;r+=k.getFontPairScore(S.clone(this.fontPairingMatrix),u,h),o==l.font&&(r*=2,s<.5&&(r*=2))}}return r*=i.popularity,j.TypeLockupUtils.createTheoFont(e,B.Host.brandkitManager.brandkitForDocument(this.forma.page.document)).isSparkFont()&&(r*=2),a<40&&0==i.bodyAllowed&&(r=0),a>150&&0==i.displayAllowed&&(r=0),r},select:function(t,e,o,i,a){void 0===i&&(i=!1),void 0===a&&(a=!0);var r=t.font,n=o?this.inertiaRatio:0;return k.selectWeightedValue(r,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),n),k.WeightedLayoutSelector=(l=function(t,e){this.inertiaRatio=0,this.values=k.ALLOWED_LAYOUT_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=S.clone(e)},S.defineClass({name:"WeightedLayoutSelector",ctor:l,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=S.clone(t),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=this.pageData.selectedLockup.aspectRatio,i=this.pageData.selectedLockup.wordCount,a=this.pageData.selectedLockup.id;"left"!=t&&"right"!=t||(i<=1||o>4?e=0:e*=.05),0==this.pageData.lockups.length&&("fill"==t&&(e*=5),"center"==t&&(e*=4)),"fill"==t&&this.pageData.selectedLockup.wordCount>10&&(e*=4/S.toDouble(this.pageData.selectedLockup.wordCount));var r=[];z.TheoDocumentUtils.enableFastHeuristicsForComplexPage(this.forma.page)||(r=S.clone(m.AlignmentDetector.init_a05b(this.forma).detectFormaAlignments(20)));for(var n=!1,l=!1,s=S.iter(r);!s.done;s.next()){var c=s.value;c.line.type==m.AlignmentType.Left&&(n=!0),c.line.type==m.AlignmentType.Right&&(l=!0)}n&&!l&&"left"==t&&(e=2.5),l&&!n&&"right"==t&&(e=2.5);for(var u=S.iter(this.pageData.lockups);!u.done;u.next()){var h=u.value;h.id!=a&&t==h.styleAttributes.layout&&(e*=k.LAYOUT_COUNT_SCALE/2)}return e},select:function(t,e,o,i,a){void 0===i&&(i=!1),void 0===a&&(a=!0);var r=t.layout,n=o?this.inertiaRatio:0;return k.selectWeightedValue(r,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),l),k.WeightedBackingSelector=(s=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_BACKING_VALUES,this.weights=[],this.weightSum=0,this.machineRecommend=!0,this.forma=t,this.pageData=S.clone(e)},S.defineClass({name:"WeightedBackingSelector",ctor:s,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){if(this.pageData=S.clone(t),1==this.machineRecommend){var e=new V.ShapeSuggester,o=S.clone(e.getShapeSuggesterFeatures(S.clone(t),this.forma));this.weights=S.clone(e.getScores(S.clone(this.values),S.clone(o)))}0!=this.machineRecommend&&1!=(new H.SuggestionUtils).weightsEqualNaNOrEmpty(S.clone(this.weights))||(this.weights=this.values.map(this.scoreValue,this)),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=this.pageData.selectedLockup,o=this.pageData.largestLineHeightLockup,i=e.lineHeight,a=o.id==e.id,r=N.ShapeLibrary.shapeDictionary[t]||N.ShapeLibrary.shapeDictionary.none,n=1;if(r.premium)return 0;if(N.ShapeLibrary.NonSuggestableBackingShapes.includes(t))return 0;this.pageData.lockups.length>0&&k.BACKING_SHAPES_SVG.includes(t)&&(n*=.1);for(var l=S.iter(this.pageData.lockups);!l.done;l.next()){var s,c=l.value;c.id!=e.id&&(W.MathUtils.absDouble(i-c.lineHeight)/i<.4&&(n*=3),(s=N.ShapeLibrary.shapeDictionary[c.styleAttributes.backing])&&(n*=(11-S.toDouble(W.MathUtils.absInt(r.formality-s.formality)))/2,n*=(11-S.toDouble(W.MathUtils.absInt(r.drama-s.drama)))/2))}var u,h=W.MathUtils.maxDouble(e.width/this.pageData.width,e.height/this.pageData.height);if(r.maxScale<1&&h>r.maxScale&&(n=0),(r.maxAspect<e.aspectRatio||r.minAspect>e.aspectRatio)&&(n=0),0==a&&(u=N.ShapeLibrary.shapeDictionary[o.styleAttributes.backing])){var g=u.drama;r.drama<g&&(n*=2)}return"none"==t&&(n*=10),"row"==t&&(n*=10),this.pageData.lightnessSpreadBehindSelectedLockup>=20&&0==r.filled&&(n*=.01),n},select:function(t,e,o,i,a){void 0===i&&(i=!1),void 0===a&&(a=!0);var r=this.values.length,n=S.clone(this.weights),l=t.layout,s="center"==l||"fill"==l,c=!1,u=B.Host.fontProvider.getIncludedFonts(this.forma.page.document).fontAt(t.font),h=this.pageData.selectedLockup.width/this.pageData.selectedLockup.height,g=!0,p=this.pageData.selectedLockup.originalBacking;"none"!=p&&"shadow"!=p&&"row"!=p||(g=!1),"knockout"==t.backing&&(g=!1);for(var d=S.iter(this.pageData.lockups);!d.done;d.next()){var f,y=d.value,L=y.styleAttributes.backing;y.id!=this.pageData.selectedLockup.id&&("none"!=L&&(c=!0),t.font==y.styleAttributes.font&&null!=(f=S.indexOf(k.ALLOWED_BACKING_VALUES,L))&&(n[f]*=5))}for(var m=S.iter(S.range(0,r,!1));!m.done;m.next()){var C,v=m.value,A=this.values[v];if(C=N.ShapeLibrary.shapeDictionary[A]){s&&1==C.centered&&(n[v]*=5),h>4&&C.category==N.ShapeCategory.Circle&&(n[v]*=0),h<4&&C.category==N.ShapeCategory.Banner&&(n[v]*=0),C.category!=N.ShapeCategory.Cutout&&C.category!=N.ShapeCategory.Avoid||(n[v]*=0),"knockoutOnly"!=t.textLook||"none"!=A&&"shadow"!=A||(n[v]*=0);var b=S.toDouble(10-W.MathUtils.absInt(u.formality-C.formality));n[v]*=b/5;var R=S.toDouble(10-W.MathUtils.absInt(u.drama-C.drama));n[v]*=R/5,c&&"row"!=A&&"none"!=A&&(n[v]/=5)}}var w=t.backing,D=o?this.inertiaRatio:0,T=n.reduce((function(t,e){return t+e}),0);return w=1==g?k.selectWeightedValue(w,S.clone(this.values),S.clone(n),T,D):p}}}),s),k.WeightedShadowAngleSelector=(c=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_SHADOWANGLE_VALUES,this.weights=[],this.weightSum=0,this.foo=4,this.forma=t,this.pageData=S.clone(e)},S.defineClass({name:"WeightedShadowAngleSelector",ctor:c,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=S.clone(t),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return 1},select:function(t,e,o,i,a){void 0===i&&(i=!1),void 0===a&&(a=!0);var r=t.shadowAngle,n=o?this.inertiaRatio:0;return k.selectWeightedValue(r,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),c),k.WeightedOpacitySelector=(u=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_OPACITY_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=S.clone(e)},S.defineClass({name:"WeightedOpacitySelector",ctor:u,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=S.clone(t),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=this.pageData.selectedLockup.width*this.pageData.selectedLockup.height,i=this.pageData.width*this.pageData.height;return"full"==t&&o>.5*i&&(e*=.1),"faint"==t&&(o<.5*i?e=0:e*=.5),e},select:function(t,e,o,i,a){void 0===i&&(i=!1),void 0===a&&(a=!0);var r=t.opacity,n=S.clone(this.weights);(N.ShapeLibrary.shapeDictionary[t.backing]||N.ShapeLibrary.shapeDictionary.none).filled?(n[S.indexOf(k.ALLOWED_OPACITY_VALUES,"faint")]=0,n[S.indexOf(k.ALLOWED_OPACITY_VALUES,"medium")]=0):(n[S.indexOf(k.ALLOWED_OPACITY_VALUES,"faintBacking")]=0,n[S.indexOf(k.ALLOWED_OPACITY_VALUES,"mediumBacking")]=0);var l=o?this.inertiaRatio:0,s=n.reduce((function(t,e){return t+e}),0);return k.selectWeightedValue(r,S.clone(this.values),S.clone(n),s,l)}}}),u),k.WeightedPaddingSelector=(h=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_PADDING_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=S.clone(e)},S.defineClass({name:"WeightedPaddingSelector",ctor:h,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=S.clone(t),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=this.pageData.selectedLockup,o=1,i=1;if(0==this.pageData.lockups.length)i=W.MathUtils.absDouble(t-E.LockupStyle.DEFAULT_PADDING);else for(var a=S.iter(this.pageData.lockups);!a.done;a.next()){var r=a.value;i=W.MathUtils.minDouble(i,W.MathUtils.absDouble(t-r.styleAttributes.padding))}o*=W.MathUtils.maxDouble(1/(i+.1),.05);var n=W.MathUtils.maxDouble(e.width/this.pageData.width,e.height/this.pageData.height)+t;return o/=4*W.MathUtils.absDouble(n-1)},select:function(t,e,o,i,a){void 0===i&&(i=!1),void 0===a&&(a=!0);var r=t.padding,n=o?this.inertiaRatio:0;return k.selectWeightedValue(r,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),h),k.WeightedSpacingSelector=(g=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_SPACING_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=S.clone(e)},S.defineClass({name:"WeightedSpacingSelector",ctor:g,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=S.clone(t),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=1;if(0==this.pageData.lockups.length)o=W.MathUtils.absDouble(t-E.LockupStyle.DEFAULT_SPACING);else for(var i=S.iter(this.pageData.lockups);!i.done;i.next()){var a=i.value;o=W.MathUtils.minDouble(o,W.MathUtils.absDouble(t-a.styleAttributes.spacing))}return e*=W.MathUtils.maxDouble(1/(o+.1),.05)},select:function(t,e,o,i,a){void 0===i&&(i=!1),void 0===a&&(a=!0);var r=t.spacing,n=o?this.inertiaRatio:0;return k.selectWeightedValue(r,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),g),k.PrimaryColorSelector=(p=function(t,e){this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=S.clone(e),this.values=t.page.colorLibraryController.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS).concat(t.page.colorLibraryController.getProfilingColorKeys())},S.defineClass({name:"PrimaryColorSelector",ctor:p,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=S.clone(t),this.values=this.forma.page.colorLibraryController.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS).concat(this.forma.page.colorLibraryController.getProfilingColorKeys()),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return"themeDerivedDark"==t?.1:1},select:function(t,e,o,i,a){void 0===i&&(i=!1),void 0===a&&(a=!0);for(var r=(N.ShapeLibrary.shapeDictionary[t.backing]||N.ShapeLibrary.shapeDictionary.none).filled||"fill"!=t.textLook,n=this.values.length,l=t.primaryColor,s=S.clone(this.weights),c=new w.ColorRankSuggester,u=[],h=S.iter(S.range(0,n,!1));!h.done;h.next()){var g,p=h.value;(g=this.forma.page.colorLibraryController.getSolidColorForKey(this.values[p]))&&u.push(g)}if(v.CoreAssert.isTrue(n==u.length,"not all value colors were added.","PrimaryColorSelector.select","LockupStyleController.swift",2058),n!=u.length)return l;var d=[];if(0==r){this.pageData.ensureCorrectBackgroundColors(this.forma);for(var f=S.iter(this.pageData.colorsBehindSelectedLockup);!f.done;f.next()){var y=f.value;d.push(S.clone(w.ColorForComparison.init_c063(y,1)))}}else{var L;(L=this.forma.page.colorLibraryController.getSolidColorForKey(t.secondaryColor))&&d.push(S.clone(w.ColorForComparison.init_c063(L,1)))}i&&(L=this.forma.page.colorLibraryController.getSolidColorForKey(t.primaryColor))&&d.push(S.clone(w.ColorForComparison.init_c063(L,.33))),s=S.clone(c.weightedColorContrastRanker(S.clone(d),S.clone(u),a));var m=(s=S.clone((new H.SuggestionUtils).normalizedWeights(S.clone(s)))).reduce((function(t,e){return t+e}),0),C=o?this.inertiaRatio:0;return k.selectWeightedValue(l,S.clone(this.values),S.clone(s),m,C)}}}),p),k.SecondaryColorSelector=(d=function(t,e){this.inertiaRatio=0,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=S.clone(e),this.values=t.page.colorLibraryController.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS)},S.defineClass({name:"SecondaryColorSelector",ctor:d,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=S.clone(t),this.values=this.forma.page.colorLibraryController.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return 1},select:function(t,e,o,i,a){void 0===i&&(i=!1),void 0===a&&(a=!0);for(var r=t.secondaryColor,n=(N.ShapeLibrary.shapeDictionary[t.backing]||N.ShapeLibrary.shapeDictionary.none).filled,l=this.values.length,s=S.clone(this.weights),c=new w.ColorRankSuggester,u=[],h=S.iter(S.range(0,l,!1));!h.done;h.next()){var g,p=h.value;(g=this.forma.page.colorLibraryController.getSolidColorForKey(this.values[p]))?u.push(g):v.CoreAssert.isTrue(!1,"failed to get SolidColor for key "+this.values[p]+". colorCount:"+l+". num color keys:"+this.forma.page.colorLibraryController.getNumThemeColorKeys(),"SecondaryColorSelector.select","LockupStyleController.swift",2169)}if(v.CoreAssert.isTrue(l==u.length,"not all value colors were added.","SecondaryColorSelector.select","LockupStyleController.swift",2172),l!=u.length)return r;var d=[];if(i&&n){var f;(f=this.forma.page.colorLibraryController.getSolidColorForKey(t.secondaryColor))&&d.push(S.clone(w.ColorForComparison.init_c063(f,1)))}else{this.pageData.ensureCorrectBackgroundColors(this.forma);for(var y=S.iter(this.pageData.colorsBehindSelectedLockup);!y.done;y.next()){var L=y.value;d.push(S.clone(w.ColorForComparison.init_c063(L,1)))}}s=S.clone(c.weightedColorContrastRanker(S.clone(d),S.clone(u),a));var m=(s=S.clone((new H.SuggestionUtils).normalizedWeights(S.clone(s)))).reduce((function(t,e){return t+e}),0),C=o?this.inertiaRatio:0;return k.selectWeightedValue(r,S.clone(this.values),S.clone(s),m,C)}}}),d),k.LockupStyleController=(f=function(t){this._sessionAttrs=new k.SessionAttrs,this.hasScoresForAttributes=!1,this.loggedDesignIngredientColorChanged=!1,this.forma=t,this.targetedLockupStyleName_="",this.pageData=S.clone(k.InterestingPageData.init_a05b(t)),this.fontSelector=new k.WeightedFontSelector(t,S.clone(this.pageData)),this.layoutSelector=new k.WeightedLayoutSelector(t,S.clone(this.pageData)),this.backingSelector=new k.WeightedBackingSelector(t,S.clone(this.pageData)),this.opacitySelector=new k.WeightedOpacitySelector(t,S.clone(this.pageData)),this.primaryColorSelector=new k.PrimaryColorSelector(t,S.clone(this.pageData)),this.profilingBackgroundColorSelector=new D.ProfilingBackgroundColorSelector(t,!0),this.profilingPrimaryColorSelector=new D.ProfilingPrimaryColorSelector(t,!1),this.secondaryColorSelector=new k.SecondaryColorSelector(t,S.clone(this.pageData)),this.shadowAngleSelector=new k.WeightedShadowAngleSelector(t,S.clone(this.pageData)),this.spacingSelector=new k.WeightedSpacingSelector(t,S.clone(this.pageData)),this.paddingSelector=new k.WeightedPaddingSelector(t,S.clone(this.pageData)),b.CoreObject.call(this)},S.defineClass({name:"LockupStyleController",ctor:f,superName:"CoreObject",props:{targetedLockupStyleName:{get:function(){var t;return((t=S.opt(S.opt(S.opt(this.forma,(function(t){return t.page.document})),(function(t){return t.controller})),(function(t){return t.selection.inCharStyleMode})))||null!=t)&&t?Y.TypeLockupController.HIGHLIGHT_STYLE:""}},targetedLockupStyle:{get:function(){return""!=this.targetedLockupStyleName?this.forma.controller.getCharacterStyle(this.targetedLockupStyleName):this.forma.style}},targetedFont:{get:function(){var t;return(t=this.targetedLockupStyle.font)?t:this.forma.style.font}},targetedShadowAngle:{get:function(){return this.forma.style.shadowAngle},set:function(t){this.forma.style.shadowAngle=t}},targetedShadowOffset:{get:function(){return this.forma.style.shadowOffset},set:function(t){this.forma.style.shadowOffset=t}},targetedStrokeWeight:{get:function(){return this.forma.style.strokeWeight},set:function(t){this.forma.style.strokeWeight=t}},targetedTextLook:{get:function(){return this.targetedLockupStyle.textLook!=E.LockupTextLook.UNSET?this.targetedLockupStyle.textLook:this.forma.style.textLook}},updateScoring:function(){this.pageData=S.clone(k.InterestingPageData.init_a05b(this.forma)),this.fontSelector.updateWeights(S.clone(this.pageData)),this.layoutSelector.updateWeights(S.clone(this.pageData)),this.backingSelector.updateWeights(S.clone(this.pageData)),this.opacitySelector.updateWeights(S.clone(this.pageData)),this.primaryColorSelector.updateWeights(S.clone(this.pageData)),this.secondaryColorSelector.updateWeights(S.clone(this.pageData)),this.shadowAngleSelector.updateWeights(S.clone(this.pageData)),this.spacingSelector.updateWeights(S.clone(this.pageData)),this.paddingSelector.updateWeights(S.clone(this.pageData)),this.profilingPrimaryColorSelector.updateBackgroundColors(S.clone(this.pageData.colorsBehindSelectedLockup)),this.profilingBackgroundColorSelector.updateBackgroundColors(S.clone(this.pageData.colorsBehindSelectedLockup)),this.hasScoresForAttributes=!0},getRecommendedFonts:function(){return this.fontSelector.getTopFonts(10)},onlineLearning:function(t){var e,o=new I.FontSuggester;(e=o.getFontFeatures(S.clone(this.pageData),this.forma))&&o.onlineLearning(t,e)},getDominantColorRole:function(){var t,e=S.clone(k.lockupStyleToLockupStyleAttributes(this.targetedLockupStyle,this.forma.page.document)).backing,o=T.ColorRole.FieldPrimary;return(t=N.ShapeLibrary.shapeDictionary[e])&&1==t.filled&&(o=T.ColorRole.FieldSecondary),o},fixUpSecondaryColor:function(){var t;if((t=S.as(this.forma.controller,Y.TypeLockupController))&&t.secondaryColorVisible()&&this.targetedLockupStyle.textBacked&&this.targetedLockupStyle.backing!=E.LockupBacking.UNSET){var e=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldPrimary),o=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldSecondary),i=this.calculateContrastingSecondaryColorID();null!=i&&i!=o&&i!=e&&null!=this.forma.page.colorLibraryController.getSolidColorForKey(i)&&this.targetedLockupStyle.colors.setColorId(T.ColorRole.FieldSecondary,i)}},calculateContrastingSecondaryColorID:function(){var t,e=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldPrimary),o=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldSecondary);if(null!=e&&e==o&&(t=this.forma.page.colorLibraryController.getSolidColorForKey(e)))for(var i=S.iter(this.forma.page.colorLibraryController.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!i.done;i.next()){var a,r=i.value;if(r!=e&&(a=this.forma.page.colorLibraryController.getSolidColorForKey(r))&&a.contrasts(t,!1)){o=r;break}}return o},fixUpBackingShape:function(){var t,e,o=this.forma.style;if((t=N.ShapeLibrary.shapeDictionary[k.getBackingStringForBackingEnumAndArtworkId(o.backing,o.backingArtworkID)])&&(e=N.ShapeLibrary.shapeDictionary[k.getBackingStringForBackingEnumAndArtworkId(this.targetedLockupStyle.backing,this.targetedLockupStyle.backingArtworkID)])){if(E.LockupStyle.isKnockoutLook(this.targetedLockupStyle.textLook)){(this.targetedLockupStyle===this.forma.style?t.filled:E.LockupStyle.isLetterGrid(o.layout)?(this.targetedLockupStyle.backing!=E.LockupBacking.None?e:t).filled:t.filled||e.filled)||(S.opt(S.as(this.forma.controller,Y.TypeLockupController),(function(t){return t.beginBlockedUpdate()})),this.targetedLockupStyle.backing=E.LockupBacking.SVGBackground,this.targetedLockupStyle.backingArtworkID="square_001",S.opt(S.as(this.forma.controller,Y.TypeLockupController),(function(t){return t.endBlockedUpdate()})),S.opt(S.as(this.forma.controller,Y.TypeLockupController),(function(t){return t.styleChanged()})))}!e.filled||this.targetedLockupStyle.textLook!=E.LockupTextLook.Shadow&&this.targetedLockupStyle.textLook!=E.LockupTextLook.ShadowAndOutline&&this.targetedLockupStyle.textLook!=E.LockupTextLook.FillAndOutline&&this.targetedLockupStyle.textLook!=E.LockupTextLook.FillAndOutline2&&this.targetedLockupStyle.textLook!=E.LockupTextLook.OutlineOnly||1!=this.targetedLockupStyle.backingOpacity||(this.targetedLockupStyle.opacityRule=E.OpacityRule.UseLockupOpacities,this.targetedLockupStyle.backingOpacity=.5)}},getKnockoutColor:function(){var t,e,o=this.forma.style;return this.targetedLockupStyle!==this.forma.style&&(t=N.ShapeLibrary.shapeDictionary[k.getBackingStringForBackingEnumAndArtworkId(o.backing,o.backingArtworkID)])&&(e=N.ShapeLibrary.shapeDictionary[k.getBackingStringForBackingEnumAndArtworkId(this.targetedLockupStyle.backing,this.targetedLockupStyle.backingArtworkID)])&&(e.filled||!t.filled)?this.targetedLockupStyle.colors.fieldSecondary:o.colors.fieldSecondary},getTextLookForUI:function(){return this.targetedTextLook==E.LockupTextLook.FillAndOutline2||this.targetedTextLook==E.LockupTextLook.OutlineOnly?E.LockupTextLook.FillAndOutline:this.targetedTextLook},getStrokeWeightPercentForUI:function(){return 99*this.targetedStrokeWeight+1},getShadowOffsetPercentForUI:function(){return 99*this.targetedShadowOffset+1},setTextLook:function(t){this.targetedLockupStyle!==this.forma.style&&t==this.forma.style.textLook?this.targetedLockupStyle.textLook=E.LockupTextLook.UNSET:(this.targetedLockupStyle.textLook=t,this.targetedLockupStyle.textLook==E.LockupTextLook.KnockoutAndShadow&&(135==this.targetedShadowAngle&&225==this.targetedShadowAngle||(this.targetedShadowAngle=135)),this.targetedLockupStyle.textLook==E.LockupTextLook.ShadowAndOutline?this.targetedShadowOffset=E.LockupStyle.DEFAULT_SHADOWOFFSET/2:this.targetedShadowOffset=E.LockupStyle.DEFAULT_SHADOWOFFSET,this.targetedLockupStyle.textLook==E.LockupTextLook.KnockoutAndOutline?this.targetedStrokeWeight=0:this.targetedStrokeWeight=E.LockupStyle.DEFAULT_STROKEWEIGHT),this.fixUpSecondaryColor(),this.fixUpBackingShape(),this.forma.controller.styleChanged()},applyBacking:function(t,e){var o,i,a,r,n,l;if((o=this.forma)&&(i=o.parent)&&(a=o.root)&&(r=o.page.document)&&(n=S.as(o.style,E.LockupStyle))&&(l=S.as(o.controller,Y.TypeLockupController))){l.beginBlockedUpdate();var s,c=k.getBackingStringForBackingEnumAndArtworkId(t,e);if(null!=(s=o.source)&&O.FormaSourceUtils.isDesignIngredient(s)){var u=C.BadgeFacade.getDesignIngredientIDAndType(s),h=u.id,g=u.type;S.opt(B.Host.logging,(function(t){return t.logToAnalytics(L.AnalyticsConstants.kDesignIngredientBackingShapeChanged,{contextualData1:"designIngredientId:"+h,contextualData2:"designIngredientType:"+g,contextualData12:"shapeName:"+c})}))}var p,d=S.clone(k.lockupStyleToLockupStyleAttributes(this.targetedLockupStyle,r)),f=!1,y=!1,m=this.targetedLockupStyle.currentBackingOpacity,A=this.targetedLockupStyle.textLook;if(t==E.LockupBacking.Knockout){E.LockupStyle.isKnockoutLook(A)||(A=E.LockupTextLook.KnockoutOnly,d.textLook="knockoutOnly"),a.visitAll(x.FormaTraversal.PreOrder,(function(t){var e;(e=S.as(t.style,E.LockupStyle))&&e.backing==E.LockupBacking.Knockout&&(e.backing=E.LockupBacking.None,e.textLook=E.LockupTextLook.Fill)}));var b=S.clone(i.filterWithCallback((function(t){return(t.isBackgroundImage()||t.isShape())&&S.opt(t.controller,(function(t){return 0==t.floating}))}),x.FormaTraversal.JustChildren));i.insertChildAt(o,b.length)}this.targetedLockupStyle!==n&&((V=this.targetedLockupStyle).backing==E.LockupBacking.UNSET&&(v.CoreAssert.isTrue(E.LockupStyle.isLetterGrid(n.layout),"LockupBacking.UNSET in secondary styles for non-letter-grid layouts?","LockupStyleController.applyBacking","LockupStyleController.swift",2795),V.padding=n.padding),t==E.LockupBacking.None||t==E.LockupBacking.Rows||t==E.LockupBacking.SVGBackground?(V.backing=t,V.backingArtworkID=e):t==E.LockupBacking.Knockout&&(V.backing=E.LockupBacking.UNSET,A=E.LockupTextLook.KnockoutOnly),d=S.clone(k.lockupStyleToLockupStyleAttributes(V,r)),c=k.getBackingStringForBackingEnumAndArtworkId(V.backing,V.backingArtworkID),A=V.textLook),d.backing!=c&&(p=N.ShapeLibrary.shapeDictionary[c])&&(f=k.needsContrastingColor(c,A,p.filled),p.filled||A==E.LockupTextLook.FillAndOutline||A==E.LockupTextLook.FillAndOutline2||(y=!0),p.filled||(m=1)),d.backing=c,t!=E.LockupBacking.None||A!=E.LockupTextLook.KnockoutOnly&&A!=E.LockupTextLook.KnockoutAndOutline||(d.textLook="none");var R=S.clone(this.updateOpacityAttributes(m,S.clone(d)));if(f&&(P=o.page.colorLibraryController.getSolidColorForKey(d.secondaryColor))&&(F=o.page.colorLibraryController.getSolidColorForKey(d.primaryColor))){var w=k.getBackingOpacity(S.clone(d));w==E.LockupStyle.OPACITY_UNSET&&(w=k.getBackingOpacity(S.clone(k.lockupStyleToLockupStyleAttributes(n,r))));for(var D=!0,T=S.iter(this.pageData.colorsBehindSelectedLockup);!T.done;T.next()){var I=T.value.blend(P,w);if(!k.hasSufficientLegibilityContrast(F,I)){D=!1;break}}if(!D){var _=this.getContrastingColorKey(d.secondaryColor,d.primaryColor);R.secondaryColor=_}}if(y){var F,P,W,U=d.primaryColor,M=d.secondaryColor;(F=o.page.colorLibraryController.getSolidColorForKey(U))&&(this.pageData.isColorVisibleAgainstBackground(F)||(P=o.page.colorLibraryController.getSolidColorForKey(M))&&(this.pageData.isColorVisibleAgainstBackground(P)&&!S.opt(N.ShapeLibrary.shapeDictionary[c],(function(t){return t.category==N.ShapeCategory.Cutout}))?(R.primaryColor=M,R.secondaryColor=U):null!=(W=this.getThemeColorContrastingWithBackground())&&(R.primaryColor=W)))}if(this.targetedLockupStyle!==n){var V;(V=this.targetedLockupStyle).textOpacity!=E.LockupStyle.OPACITY_UNSET&&(V.textOpacity=R.textOpacity),V.backingOpacity!=E.LockupStyle.OPACITY_UNSET&&(V.backingOpacity=R.backingOpacity),this.pickVisibleColorsForCharStyle()}else{var H=k.lockupStyleAttributesToLockupStyle(S.clone(R),n,r);if(H.shapeSupportsKnockout)E.LockupStyle.doesLookColorMatchShapeColor(H.textLook)&&1==H.backingOpacity&&(H.backingOpacity=.5);else{E.LockupStyle.isKnockoutLook(H.textLook)&&(H.textLook=E.LockupTextLook.Fill);for(var K=S.iter(H.characterStyles);!K.done;K.next()){var G=K.value;!G.shapeSupportsKnockout&&E.LockupStyle.isKnockoutLook(G.textLook)&&(G.textLook=E.LockupTextLook.UNSET)}}o.applyStyle(H)}l.endBlockedUpdate(),l.styleChanged(),this.onBackingShapeChanged()}},switchPrimaryColorAndSecondaryColor:function(){var t,e=!1;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),E.LockupStyle)){var o=S.clone(k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document)),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),a=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);if(null!=i&&null!=a){var r=o.primaryColor;o.primaryColor=o.secondaryColor,o.secondaryColor=r;var n=k.lockupStyleAttributesToLockupStyle(S.clone(o),this.forma.style,this.forma.page.document);this.forma.applyStyle(n),e=!0}}return e},getContrastingThemeColorBasedOnSolidColor:function(t,e){if(void 0===e&&(e=null),null==t)return null;for(var o=this.forma.page.colorLibraryController,i=S.iter(o.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!i.done;i.next()){var a,r=i.value;if((a=o.getSolidColorForKey(r))&&a.contrasts(t,!1)&&!a.isEqual(e))return r}return null},getThemeColorContrastingWithBackground:function(t){void 0===t&&(t=null);for(var e=this.forma.page.colorLibraryController,o=S.iter(e.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!o.done;o.next()){var i,a=o.value;if((i=e.getSolidColorForKey(a))&&(null==t||!i.isEqual(t))){for(var r=!0,n=S.iter(this.pageData.colorsBehindSelectedLockup);!n.done;n.next()){var l=n.value;if(!i.contrasts(l,!1)){r=!1;break}}if(r)return a}}return null},doesLockupContrastWithBackground:function(){var t,e=!0;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),E.LockupStyle)){var o=S.clone(k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document)),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),a=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);t.secondaryColorVisible?t.textBacked?null!=i&&null!=a&&(e=this.pageData.isColorVisibleAgainstBackground(a)&&i.contrasts(a,!1)):null!=i&&null!=a&&(e=this.pageData.isColorVisibleAgainstBackground(i)&&this.pageData.isColorVisibleAgainstBackground(a)):null!=i&&(e=this.pageData.isColorVisibleAgainstBackground(i))}return e},pickVisibleColorsForLockup:function(){var t=this.pickVisibleColorsForTextAndShape(),e=this.pickVisibleColorsForCharStyle(),o=t||e;return o&&this.forma.controller.styleChanged(),o},pickVisibleColorsForTextAndShape:function(){if(this.doesLockupContrastWithBackground())return!1;if(this.switchPrimaryColorAndSecondaryColor()){if(this.doesLockupContrastWithBackground())return!0;this.switchPrimaryColorAndSecondaryColor()}var t,e=!1;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),E.LockupStyle)){var o=S.clone(k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document)),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),a=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);if(t.secondaryColorVisible){if(t.textBacked){if(null!=i&&null!=a)if(this.pageData.isColorVisibleAgainstBackground(a))i.contrasts(a,!1)||null!=(r=this.getContrastingThemeColorBasedOnSolidColor(a))&&(o.primaryColor=r,e=!0);else if(null!=(l=this.getThemeColorContrastingWithBackground())){o.secondaryColor=l;var r,n=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);e=!0,k.hasSufficientLegibilityContrast(i,n)||null!=(r=this.getContrastingThemeColorBasedOnSolidColor(n))&&(o.primaryColor=r)}}else if(null!=i&&null!=a){var l;this.pageData.isColorVisibleAgainstBackground(i)||null!=(l=this.getThemeColorContrastingWithBackground())&&(o.primaryColor=l,e=!0),this.pageData.isColorVisibleAgainstBackground(a)||(i.isEqual(a)?(o.secondaryColor=o.primaryColor,e=!0):null!=(l=this.getThemeColorContrastingWithBackground(i))?(o.secondaryColor=l,e=!0):(o.secondaryColor=o.primaryColor,e=!0))}}else null!=i&&(this.pageData.isColorVisibleAgainstBackground(i)||null!=(l=this.getThemeColorContrastingWithBackground())&&(o.primaryColor=l,e=!0));if(e){var s=k.lockupStyleAttributesToLockupStyle(S.clone(o),this.forma.style,this.forma.page.document);this.forma.applyStyle(s)}}return e},pickVisibleColorsForCharStyle:function(){var t,e=!1;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),E.LockupStyle)){if(0==S.count(t.characterStyles))return e;for(var o=E.LockupStyle.isKnockoutLook(t.textLook)?"":t.colors.colorID(T.ColorRole.FieldPrimary),i=t.textBacked?t.colors.colorID(T.ColorRole.FieldSecondary):"",a=this.forma.page.colorLibraryController,r=[],n=S.iter(a.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!n.done;n.next()){var l,s=n.value;(l=a.getSolidColorForKey(s))&&this.pageData.isColorVisibleAgainstBackground(l)&&r.push(s)}for(var c=S.iter(t.characterStyles);!c.done;c.next()){var u=c.value,h=u.colors.colorID(T.ColorRole.FieldPrimary),g=u.secondaryColorVisible?u.colors.colorID(T.ColorRole.FieldSecondary):"";if(u.secondaryColorVisible&&u.backing!=E.LockupBacking.UNSET){var p,d=!1;if(""==i&&(p=a.getSolidColorForKey(g))&&(this.pageData.isColorVisibleAgainstBackground(p)||(d=!0)),d)for(var f=S.iter(r);!f.done;f.next())(w=f.value)!=i&&(u.colors.setColorId(T.ColorRole.FieldSecondary,w),e=!0);else if(g==i)for(var y=S.iter(a.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!y.done;y.next())(s=y.value)!=i&&(u.colors.setColorId(T.ColorRole.FieldSecondary,s),e=!0)}var k=!1,L=h!=o,m=a.getSolidColorForKey(t.colors.colorID(T.ColorRole.FieldPrimary));if(null==m)return e;if(!u.textBacked){var C=a.getSolidColorForKey(h);L&&""!=o&&(L=C.contrasts(m,!1)),""!=i||this.pageData.isColorVisibleAgainstBackground(C)||(k=!0)}if((u.backing!=E.LockupBacking.None&&u.backing!=E.LockupBacking.UNSET||L&&h!=i)&&!k){if(u.textBacked&&h==u.colors.colorID(T.ColorRole.FieldSecondary))for(var v=S.iter(a.getThemeColorKeys());!v.done;v.next())if((s=v.value)!=u.colors.colorID(T.ColorRole.FieldSecondary)){u.colors.setColorId(T.ColorRole.FieldPrimary,s),e=!0;break}}else for(var b=S.iter(r);!b.done;b.next()){var R=b.value,w=a.getSolidColorForKey(R),D=""==o||w.contrasts(m,!1);if(R!=o&&R!=i&&(!D&&e||u.colors.setColorId(T.ColorRole.FieldPrimary,R),e=!0,D))break}}}return e},getBrandkitColorsInUse:function(){for(var t=[],e=this.forma.page.colorLibraryController,o=S.iter(e.getColorThemeAsArrayOfTheoColors());!o.done;o.next()){var i=o.value;i.isBrandkitColor()&&t.push(i)}return t},getAllColorsFromDocumentBrandkit:function(){var t=[],e=B.Host.brandkitManager.brandkitForDocument(this.forma.page.document);if(null!=e)for(var o=S.iter(e.colors);!o.done;o.next()){var i=o.value,a=G.TheoColor.init_bb45(i);t.push(a)}return t},getBaseSuggestableColors:function(){for(var t=this.forma.page.colorLibraryController,e=S.clone(t.getColorThemeAsArrayOfTheoColors()),o=S.clone(t.getThemeDerivedColorsAsArrayOfTheoColors()),i=S.clone(t.getSuggestedColorsAsArraysOfTheoColors()),a=e.concat(i).concat(o),r=[],n=S.clone(this.getAllColorsFromDocumentBrandkit()),l=S.iter(a);!l.done;l.next()){var s=l.value;if(!s.isBrandkitColor()){for(var c=!0,u=S.iter(r);!u.done;u.next()){var h=u.value;if(s.rgbColor.distanceTo(h)<20){c=!1;break}}for(var g=S.iter(n);!g.done;g.next()){var p=g.value;if(s.rgbColor.distanceTo(p.rgbColor)<20){c=!1;break}}if(c&&r.push(s.rgbColor),r.length>=10)break}}return r},getSuggestableSingleColors:function(){for(var t=S.clone(this.getBaseSuggestableColors()),e=k.getTextOpacity(S.clone(this.pageData.selectedLockup.styleAttributes)),o=[],i=S.iter(t);!i.done;i.next()){for(var a=i.value,r=a.withAlphaOf(e),n=!0,l=S.iter(this.pageData.colorsBehindSelectedLockup);!l.done;l.next()){var s=l.value;if(!k.hasSufficientLegibilityContrast(r,s)){n=!1;break}}n&&o.push(a)}return o},getSuggestableColors:function(){var t=S.clone(this.getSuggestableColorPairs());if(0==t.length)for(var e=S.clone(this.getSuggestableSingleColors()),o=S.iter(e);!o.done;o.next()){var i=o.value;t.push([i])}for(var a=[],r=S.iter(t);!r.done;r.next()){for(var n=r.value,l=[],s=S.iter(n);!s.done;s.next()){var c=s.value;l.push(this.forma.page.colorLibraryController.getTheoColorForSolidColor(c))}a.push(S.clone(l))}return a},isCurrentlyShowingMultipleColors:function(){var t;return!((t=S.as(this.forma.controller,Y.TypeLockupController))&&(!t.secondaryColorVisible()||this.targetedLockupStyle.textLook==E.LockupTextLook.KnockoutOnly||this.targetedLockupStyle.textLook==E.LockupTextLook.OutlineOnly))},getSuggestableColorPairs:function(){var t=[];if(!this.isCurrentlyShowingMultipleColors())return t;var e=this.targetedLockupStyle,o=S.clone(k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=(N.ShapeLibrary.shapeDictionary[o.backing]||N.ShapeLibrary.shapeDictionary.none).filled,a=k.getBackingOpacity(S.clone(o));a==E.LockupStyle.OPACITY_UNSET&&(a=k.getBackingOpacity(S.clone(k.lockupStyleToLockupStyleAttributes(this.forma.style,this.forma.page.document))));var r=S.clone(this.getBaseSuggestableColors()),n=r.length;if(0==n)return t;for(var l={},s=S.toArray(S.range(0,n,!1)),c=S.clone(S.shuffle(s)),u=S.iter(this.pageData.lockups);!u.done;u.next()){var h=u.value;if(h.id!=this.forma.formaID&&"none"!=h.styleAttributes.backing){var g=this.forma.page.colorLibraryController.getSolidColorForKey(h.styleAttributes.primaryColor),p=this.forma.page.colorLibraryController.getSolidColorForKey(h.styleAttributes.secondaryColor);if(null!=g&&null!=p&&k.hasSufficientLegibilityContrast(g,p)){for(var d=-1,f=-1,y=S.iter(S.range(0,r.length,!1));!y.done;y.next()){var L=y.value;r[L].distanceTo(g)<.1&&(d=L),r[L].distanceTo(p)<.1&&(f=L)}null==l[b=S.toString(W.MathUtils.maxInt(d,f))+" "+S.toString(W.MathUtils.minInt(d,f))]&&(t.push([g,p]),l[b]=!0)}}}for(var m=S.iter(S.range(0,2,!0));!m.done;m.next()){for(var C=S.iter(c);!C.done;C.next()){d=C.value;for(var v=S.clone(S.shuffle(s)),A=S.iter(v);!A.done;A.next()){var b;if(f=A.value,t.length>=10)break;if(null==l[b=S.toString(W.MathUtils.maxInt(d,f))+" "+S.toString(W.MathUtils.minInt(d,f))]){var R=r[d],w=r[f],D=R,T=w;R.lightness<w.lightness&&(D=w,T=R);var x=[];x=this.pageData.colorsBehindSelectedLockup[0].lightness>D.lightness?[T,D]:[D,T],i&&(x=S.reverse(x));for(var I=x[0],O=!0,B=S.iter(this.pageData.colorsBehindSelectedLockup);!B.done;B.next()){var _=B.value.blend(x[1],a),F=I.distanceTo(x[1]);if(!k.hasSufficientLegibilityContrast(I,_)||F<k.kColorPairDistanceThreshold){O=!1;break}}O&&(l[b]=!0,t.push(S.clone(x)))}}if(t.length>=10)break}if(t.length>=10)break}return t},applyColors:function(t,e){var o=this.targetedLockupStyle,i=this.forma.page.colorLibraryController;if(0!=t.length){var a;if(null!=(a=S.opt(this.forma,(function(t){return t.source})))&&!this.loggedDesignIngredientColorChanged&&O.FormaSourceUtils.isDesignIngredient(a)){var r=C.BadgeFacade.getDesignIngredientIDAndType(a),n=r.id,l=r.type;S.opt(B.Host.logging,(function(t){return t.logToAnalytics(L.AnalyticsConstants.kDesignIngredientColorChanged,{contextualData1:"designIngredientId:"+n,contextualData2:"designIngredientType:"+l})})),this.loggedDesignIngredientColorChanged=!0}var s=S.clone(i.addColorsToTheme(S.clone(t),this.targetedLockupStyle!==this.forma.style?null:this.forma));if(1==t.length)this.applyColor(e,s[0]);else{var c=e==T.ColorRole.FieldPrimary?T.ColorRole.FieldSecondary:T.ColorRole.FieldPrimary;o.colors.setColorIDs([{key:e,value:s[0]},{key:c,value:s[1]}])}this.targetedLockupStyle!==this.forma.style&&(this.forma.style.colorTableBeforeChanged(),this.forma.style.colorTableAfterChanged(),this.forma.controller.styleChanged())}},applyColor:function(t,e){var o=this.targetedLockupStyle,i=S.clone(k.lockupStyleToLockupStyleAttributes(o,this.forma.page.document)),a=(N.ShapeLibrary.shapeDictionary[i.backing]||N.ShapeLibrary.shapeDictionary.none).filled,r=k.needsContrastingColor(i.backing,o.textLook,a),n=this.getContrastingColorKey(e,null);switch(t){case 1:i.primaryColor=e,i.secondaryColor=r?n:e;break;case 2:i.secondaryColor=e,i.primaryColor=r?n:e;break;default:return}o.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:i.primaryColor},{key:T.ColorRole.FieldSecondary,value:i.secondaryColor}])},getContrastingColorKey:function(t,e){var o,i=this.forma.page.colorLibraryController.getTheoColorForKey(t);if(null==i)return"";null!=e&&(o=this.forma.page.colorLibraryController.getTheoColorForKey(e));var a=this.forma.page.colorLibraryController,r="";if(i.isBrandkitColor())for(var n=S.clone(this.getBrandkitColorsInUse()),l=i.getBrandkitShadeRole(),s=S.iter(n);!s.done;s.next()){var c=s.value,u=c.getBrandkitShadeRole();if((null==l&&(u==G.TheoColor.SPARK_COLOR_ROLE_SHADE0||u==G.TheoColor.SPARK_COLOR_ROLE_SHADE6)||null!=l&&(u==G.TheoColor.SPARK_COLOR_ROLE_SHADE1||u==G.TheoColor.SPARK_COLOR_ROLE_SHADE5))&&c.rgbColor.distanceTo(i.rgbColor)>30&&(null==o||c.rgbColor.distanceTo(o.rgbColor)>30)){r=a.getKeyOfColorInTheme(c);break}}return""==r&&null!=i&&(r=a.setLightnessContrastColorAndReturnKey(t,i)),r},setContrastingColor:function(t,e,o,i,a){var r=t.contrastWithColor(e),n=A.ColorLibraryController.getBackgroundContrastKey(i);return this.forma.page.colorLibraryController.setTheoColorToLibrary(G.TheoColor.init_5344(r,null,null),n),a.colors.setColorIDs([{key:o,value:n}]),n},backgroundContrastCheck:function(t){void 0===t&&(t=!0),0==this.hasScoresForAttributes&&this.updateScoring();var e=this.targetedLockupStyle,o=S.clone(k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=N.ShapeLibrary.shapeDictionary[o.backing],a=S.count(e.characterStyles)>0;if(null!=i){var r=i.filled;if(!r||e.textLook==E.LockupTextLook.KnockoutOnly||a){for(var n,l,s=e.textLook==E.LockupTextLook.KnockoutOnly,c=e.strokeWeight>.15,u=s||c?T.ColorRole.FieldSecondary:T.ColorRole.FieldPrimary,h=!1,g=S.iter(this.forma.style.characterStyles);!g.done;g.next())(L=g.value).colors.colorID(u)==e.colors.colorID(u)&&(h=!0);if((n=S.as(this.forma.controller,Y.TypeLockupController))&&(l=n.getBackgroundColor())){var p=e.colors.color(u);if(null!=p&&!p.contrasts(l,t)){var d=this.getContrastingColorKey(e.colors.colorID(u),null);e.colors.setColorId(u,d),this.forma.controller.styleChanged()}if(a&&!h)for(var f=S.iter(this.forma.style.characterStyles);!f.done;f.next()){var y,L=f.value;if(y=r?e.colors.color(T.ColorRole.FieldSecondary):l){var m=L.colors.color(u);if(null!=m&&!m.contrasts(y,t)){var C=L.colors.colorID(u);d=this.getContrastingColorKey(C,null),L.colors.setColorId(u,d)}}}}}}else v.CoreAssert.fail("shape is not set up in ShapeLibrary.shapeDictionary","LockupStyleController.backgroundContrastCheck","LockupStyleController.swift",3801)},shuffleColorAssignment:function(){this.updateScoring();var t=S.as(this.forma.controller,Y.TypeLockupController);null!=t&&t.beginBlockedUpdate();var e=this.targetedLockupStyle,o=S.clone(k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=E.LockupStyle.isOutlineLook(e.textLook)||E.LockupStyle.isShadowLook(e.textLook),a=!1;i||(a=N.ShapeLibrary.shapeDictionary[o.backing].filled),("none"!=o.backing||i)&&(o.secondaryColor=this.profilingBackgroundColorSelector.selectColorForGlobalRecolor(!0));var r,n=null;(a||i)&&(r=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor))&&(n=S.clone(w.ColorForComparison.init_c063(r,i?.7:1)));var l=!a;l&&this.pageData.lockups.length<=2?o.primaryColor=this.profilingPrimaryColorSelector.selectColorForIndividualRecolor(l,S.clone(n),!1):o.primaryColor=this.profilingPrimaryColorSelector.selectColorForGlobalRecolor(l,S.clone(n),!0),this.setSecondaryMultiStyleLockupColors(e,S.clone(o)),e.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:o.primaryColor},{key:T.ColorRole.FieldSecondary,value:o.secondaryColor}]),null!=t&&t.endBlockedUpdate(),this.forma.controller.styleChanged()},shuffleMultiStyleLockupColors:function(){this.pageData=S.clone(k.InterestingPageData.init_a05b(this.forma)),this.profilingPrimaryColorSelector.updateBackgroundColors(S.clone(this.pageData.colorsBehindSelectedLockup)),this.profilingBackgroundColorSelector.updateBackgroundColors(S.clone(this.pageData.colorsBehindSelectedLockup));var t=this.targetedLockupStyle,e=S.clone(k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document));this.setSecondaryMultiStyleLockupColors(t,S.clone(e))},setSecondaryMultiStyleLockupColors:function(t,e,o){void 0===o&&(o=!0);for(var i=S.iter(t.characterStyles);!i.done;i.next()){var a=i.value,r=S.eq(M._equality_SolidColor_SolidColor,t.colors.fieldPrimary,t.colors.fieldSecondary);if(a.backing!=E.LockupBacking.None&&a.backing!=E.LockupBacking.UNSET&&!r&&S.eq(M._equality_SolidColor_SolidColor,a.colors.fieldPrimary,t.colors.fieldSecondary)&&S.eq(M._equality_SolidColor_SolidColor,a.colors.fieldSecondary,t.colors.fieldPrimary)&&o)a.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:e.secondaryColor},{key:T.ColorRole.FieldSecondary,value:e.primaryColor}]);else{for(var n=S.clone(this.getStylePrimarySecondaryColorForMSL(S.clone(e),a,!0)),l=S.iter(S.range(0,5,!0));!l.done&&n[0]==n[1];l.next())n=S.clone(this.getStylePrimarySecondaryColorForMSL(S.clone(e),a,!0));a.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:n[0]},{key:T.ColorRole.FieldSecondary,value:n[1]}])}}},getStylePrimarySecondaryColor:function(t){var e=S.clone(t);e.secondaryColor=this.secondaryColorSelector.select(S.clone(e),!1,!0,!1,!1),e.primaryColor=this.primaryColorSelector.select(S.clone(e),!1,!0,!1,!1);for(var o=S.iter(S.range(0,5,!0));!o.done&&e.primaryColor==e.secondaryColor;o.next())e.secondaryColor=this.secondaryColorSelector.select(S.clone(e),!1,!0,!1,!1),e.primaryColor=this.primaryColorSelector.select(S.clone(e),!1,!0,!1,!1);return[e.primaryColor,e.secondaryColor]},getStylePrimarySecondaryColorForMSL:function(t,e,o){var i,a=this.secondaryColorSelector.select(S.clone(t),!0,!1,!0,o),r=!0;if(e.backing!=E.LockupBacking.None||E.LockupStyle.isOutlineLook(e.textLook)||E.LockupStyle.isShadowLook(e.textLook)){var n=S.clone(k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document));n.secondaryColor=a,i=this.primaryColorSelector.select(S.clone(n),!0,!1,!1,o)}else r=!1,i=this.primaryColorSelector.select(S.clone(t),!1,!1,!0,o);var l,s,c=(new U.ProfilingColorMap).overridePaletteMappingDueToContrast(a,this.forma.formaID+U.ProfilingColorMap.lockupMSLBackingColorKey),u=(new U.ProfilingColorMap).overridePaletteMappingDueToContrast(i,this.forma.formaID+U.ProfilingColorMap.lockupMSLPrimaryColorKey);return(l=this.forma.page.colorLibraryController.getSolidColorForKey(u))&&(s=this.forma.page.colorLibraryController.getSolidColorForKey(c))&&(r&&!s.contrasts(l)||(a=c,i=u)),[i,a]},generateAndApplyInitialStyleAttributes:function(){0==this.hasScoresForAttributes&&this.updateScoring();for(var t=this.forma.style,e=S.clone(k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document)),o=["Lato-Light","Lora-Regular","Montserrat-Regular","PlayfairDisplay-Regular","CantataOne-Regular","FuturaPT-Medium"],i=["square_001","row"],a=o[R.CoreRandom.nextIntUniform(o.length)],r=B.Host.fontProvider.getIncludedFonts(this.forma.page.document),n=S.iter(S.range(0,r.count,!1));!n.done;n.next()){var l=n.value;S.opt(r.fontAt(l),(function(t){return t.postScriptName==a}))&&(e.font=l)}e.layout=this.layoutSelector.select(S.clone(e),!1,!1,!1,!1),"fill"!=e.layout&&"right"!=e.layout||(e.layout="center");var s=R.CoreRandom.nextIntUniform(i.length);e.backing=i[s],e.padding=0,"row"==e.backing&&(e.spacing=1,e.padding=.33),e.textOpacity=1,e.backingOpacity=1,e=S.clone(this.setNewStyleColors(S.clone(e),t));var c=k.lockupStyleAttributesToLockupStyle(S.clone(e),this.forma.style,this.forma.page.document);this.forma.applyStyle(c)},setNewStyleColors:function(t,e){var o,i=S.clone(t),a=N.ShapeLibrary.shapeDictionary[i.backing].filled,r=E.LockupStyle.isOutlineLook(e.textLook)||E.LockupStyle.isShadowLook(e.textLook),n=null,l=!a;return("none"!=i.backing||r)&&(i.secondaryColor=this.profilingBackgroundColorSelector.selectColorForGlobalRecolor(!0,void 0,!0),(o=this.forma.page.colorLibraryController.getSolidColorForKey(i.secondaryColor))&&(n=S.clone(w.ColorForComparison.init_c063(o,r?.7:1)))),i.primaryColor=this.profilingPrimaryColorSelector.selectColorForIndividualRecolor(l,S.clone(n),!0),i},getNewStyleAttributes:function(t,e,o){void 0===t&&(t=!0),0==this.hasScoresForAttributes&&this.updateScoring();var i,a,r=this.forma.style,n=S.clone(k.lockupStyleToLockupStyleAttributes(r,this.forma.page.document));return n.font=this.fontSelector.select(S.clone(n),!1,t,!1,!1),n.layout=this.layoutSelector.select(S.clone(n),!1,t,!1,!1),n.backing=this.backingSelector.select(S.clone(n),!1,t,!1,!1),o||(n.secondaryColor=this.secondaryColorSelector.select(S.clone(n),!1,t,!1,!1),n.primaryColor=this.primaryColorSelector.select(S.clone(n),!1,t,!1,!1),this.setSecondaryMultiStyleLockupColors(r,S.clone(n),!1)),n.shadowAngle=this.shadowAngleSelector.select(S.clone(n),!1,t,!1,!1),n.spacing=this.spacingSelector.select(S.clone(n),!1,t,!1,!1),n.wheelUsed=!0,o?(i=k.lockupStyleAttributesToLockupStyle(S.clone(n),r,this.forma.page.document),i=this.updateLockupStyleWithNewColors(i),(a=e)&&(i=a.lockupStyleEvaluator.styleEvaluatedWithReadability(i))):(i=k.lockupStyleAttributesToLockupStyle(S.clone(n),r,this.forma.page.document),(a=e)&&a.lockupStyleEvaluator.initializeReadabilityInformation(i)),i},evaluateLockupStyleWithReadability:function(t){return new P.LockupStyleEvaluator(this.forma).styleEvaluatedWithReadability(t)},updateLockupStyleWithNewColors:function(t){(new U.ProfilingColorMap).eraseCurrentPaletteMappingDictionary();var e=S.clone(k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document)),o=S.clone(this.getStylePrimarySecondaryColor(S.clone(e)));return e.primaryColor=o[0],e.secondaryColor=o[1],t.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:o[0]},{key:T.ColorRole.FieldSecondary,value:o[1]}]),this.setSecondaryMultiStyleLockupColors(t,S.clone(e),!1),t},updateOpacityAttributes:function(t,e){var o=(N.ShapeLibrary.shapeDictionary[e.backing]||N.ShapeLibrary.shapeDictionary.none).filled,i=S.clone(e);return i.opacity="useLockupOpacities",o?(k.getTextLook(S.clone(i))==E.LockupTextLook.KnockoutAndOutline?i.textOpacity=t:i.textOpacity=1,i.backingOpacity=t):(i.textOpacity=t,i.backingOpacity=t),i},setOpacity:function(t){var e=this.targetedLockupStyle,o=S.clone(k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=S.clone(this.updateOpacityAttributes(t,S.clone(o)));this.targetedLockupStyle===this.forma.style?this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(S.clone(i),this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.opacityRule=E.OpacityRule.UseLockupOpacities,this.targetedLockupStyle.textOpacity=i.textOpacity,this.targetedLockupStyle.backingOpacity=i.backingOpacity,this.forma.controller.styleChanged())},getOpacityValue:function(){return this.targetedLockupStyle.opacityRule!=E.OpacityRule.UNSET?this.targetedLockupStyle.currentBackingOpacity:this.forma.style.currentBackingOpacity},hasSpacingOptions:function(){var t,e;return!(!(t=S.opt(S.opt(this.forma,(function(t){return t.controller})),(function(t){return t.enableChildMove})))&&null==t||!t||this.targetedLockupStyle!==this.forma.style||!(e=S.as(this.forma.controller,Y.TypeLockupController))||!(e.numLines()>1||0==e.numLines()))},hasPaddingOptions:function(){var t;if(!(t=S.opt(S.opt(this.forma,(function(t){return t.controller})),(function(t){return t.enableChildMove})))&&null==t||!t)return!1;var e=this.targetedLockupStyle;return e.backing!=E.LockupBacking.None&&e.backing!=E.LockupBacking.Knockout&&e.backing!=E.LockupBacking.UNSET},areSpacingAndPaddingOptionsAvailable:function(){return this.hasSpacingOptions()||this.hasPaddingOptions()},setNextSpacingAndPaddingOption:function(){var t,e;if(this.targetedLockupStyle===this.forma.style){var o=this.hasPaddingOptions(),i=this.hasSpacingOptions();if(o||i){var a=this.forma.style,r=S.clone(k.lockupStyleToLockupStyleAttributes(a,this.forma.page.document)),n=k.ALLOWED_PADDING_VALUES.length,l=k.ALLOWED_SPACING_VALUES.length,s=n*l,c=(t=S.indexOf(k.ALLOWED_PADDING_VALUES,r.padding))||null!=t?t:0,u=(e=S.indexOf(k.ALLOWED_SPACING_VALUES,r.spacing))||null!=e?e:0,h=(o?u*n+c:c*l+u)+1;h%=s;var g=o?S.toInt(h/n):h%l,p=o?h%n:S.toInt(h/l);r.padding=k.ALLOWED_PADDING_VALUES[p],r.spacing=k.ALLOWED_SPACING_VALUES[g],this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(S.clone(r),this.forma.style,this.forma.page.document))}}else this.setNextPaddingOption()},setNextSpacingOption:function(){var t,e=this.forma.style,o=S.clone(k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=((t=S.indexOf(k.ALLOWED_SPACING_VALUES,o.spacing))||null!=t?t:0)+1;i>=k.ALLOWED_SPACING_VALUES.length&&(i=0),o.spacing=k.ALLOWED_SPACING_VALUES[i],this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(S.clone(o),this.forma.style,this.forma.page.document))},setSpacingFromSlider:function(t){this.setSpacing(z.TheoDocumentUtils.sliderToSpacingPaddingMapping(t))},setSpacing:function(t){var e,o=this.forma.style,i=S.clone(k.lockupStyleToLockupStyleAttributes(o,this.forma.page.document)),a=((e=S.indexOf(k.ALLOWED_SPACING_VALUES,i.spacing))||null!=e?e:0)+1;a>=k.ALLOWED_SPACING_VALUES.length&&(a=0),i.spacing=t,this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(S.clone(i),this.forma.style,this.forma.page.document))},setNextPaddingOption:function(){var t;if(this.hasPaddingOptions()){var e=this.targetedLockupStyle;this.targetedLockupStyle!=this.forma.style&&this.targetedLockupStyle.backing==E.LockupBacking.Rows&&this.forma.style.backing==E.LockupBacking.Rows&&(e=this.forma.style);var o=S.clone(k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=((t=S.indexOf(k.ALLOWED_PADDING_VALUES,o.padding))||null!=t?t:0)+1;i>=k.ALLOWED_PADDING_VALUES.length&&(i=0),o.padding=k.ALLOWED_PADDING_VALUES[i],e===this.forma.style?this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(S.clone(o),this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.padding=o.padding,this.forma.controller.styleChanged())}},setPaddingFromSlider:function(t){this.setPadding(z.TheoDocumentUtils.sliderToSpacingPaddingMapping(t))},setPadding:function(t){if(this.hasPaddingOptions()){var e=this.targetedLockupStyle;this.targetedLockupStyle!=this.forma.style&&this.targetedLockupStyle.backing==E.LockupBacking.Rows&&this.forma.style.backing==E.LockupBacking.Rows&&(e=this.forma.style);var o=S.clone(k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document));o.padding=t,e===this.forma.style?this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(S.clone(o),this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.padding=o.padding,this.forma.controller.styleChanged())}},setNextTrackingOption:function(){var t=this.forma.style,e=S.clone(k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document));e.tracking+=.2,e.tracking>.9&&(e.tracking=0),this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(S.clone(e),this.forma.style,this.forma.page.document))},setTrackingFromSlider:function(t){var e;if(e=S.as(S.opt(this.forma,(function(t){return t.controller})),Y.TypeLockupController)){var o=e.getCurrentFontSize();this.targetedLockupStyle.tracking=t;var i=S.opt(e.getPin(!0,!0),(function(t){return t.pinPoint}))||q.TheoPoint.ZERO;e.setSizeSliderValue(o,[],i)}},setNextShadowAngle:function(){var t;if(E.LockupStyle.isShadowLook(this.targetedLockupStyle.textLook)){var e=this.forma.style,o=S.clone(k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=((t=S.indexOf(k.ALLOWED_SHADOWANGLE_VALUES,o.shadowAngle))||null!=t?t:0)+1;i>=k.ALLOWED_SHADOWANGLE_VALUES.length&&(i=0),o.shadowAngle=k.ALLOWED_SHADOWANGLE_VALUES[i],this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(S.clone(o),this.forma.style,this.forma.page.document))}},legacyColorConversion:function(){if(null==this.forma)return B.Host.logging.info("forma has been de-alloc'd"),void v.CoreAssert.isTrue(!1,void 0,"LockupStyleController.legacyColorConversion","LockupStyleController.swift",4541);for(var t=this.forma.style,e=[T.ColorRole.FieldPrimary,T.ColorRole.FieldSecondary],o=S.iter(e);!o.done;o.next()){var i=o.value,a=t.colors.color(i),r=t.colors.colorID(i),n=null!=r&&A.ColorLibraryController.keyFromImage(r);if(null!=a&&null==r||n){var l=this.forma.page.colorLibraryController.addUnlinkedColor(a);t.colors.setColorId(i,l)}}},onTrackingChanged:function(){var t;(t=S.as(S.opt(this.forma,(function(t){return t.style})),E.LockupStyle))&&this._sessionAttrs.setTracking(t.tracking,t.layout)},onSpacingChanged:function(){var t;(t=S.as(S.opt(this.forma,(function(t){return t.style})),E.LockupStyle))&&this._sessionAttrs.setSpacing(t.spacing,t.layout)},onBackingShapeChanged:function(){var t;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),E.LockupStyle)){var e=k.getBackingStringForBackingEnumAndArtworkId(t.backing,t.backingArtworkID);this._sessionAttrs.setBackingShape(e,t.layout,t.pathID)}},onLayoutChanged:function(t){var e=t.layout,o=t.pathID,i=this.forma.style,a=i.layout,r=i.pathID;if(this._sessionAttrs.needsUpdate(e,o,a,r)){var n,l;this._sessionAttrs.setTracking(i.tracking,e),this._sessionAttrs.setSpacing(i.spacing,e),null!=(n=this._sessionAttrs.getTracking(a))&&(i.tracking=n),null!=(l=this._sessionAttrs.getSpacing(a))&&(i.spacing=l);var s=k.getBackingStringForBackingEnumAndArtworkId(i.backing,i.backingArtworkID);this._sessionAttrs.recordInitialBackingShape(s,e,o);for(var c=!1,u=S.iter(this._sessionAttrs.getPotentialBackingShapes(a,r,s));!u.done;u.next()){var h=u.value,g=k.getBackingEnumAndArtworkIdForBackingString(h),p=g.backing,d=g.artworkID;if(N.ShapeLibrary.isBackingShapeStyleCompatible(i,p,d)){i.backing=p,i.backingArtworkID=d,c=!0;break}}c||(i.backing=E.LockupBacking.None,i.backingArtworkID=null)}},endSession:function(){this._sessionAttrs.reset()}}}),f),k.SessionAttrs=(y=function(){this._attrsDict={},this._hasBackingShapeEntry=!1,this.reset()},S.defineClass({name:"SessionAttrs",ctor:y,statics:{TRACKING_KEY:"tracking",SPACING_KEY:"spacing",BACKING_KEY:"backing"},props:{reset:function(){this._attrsDict={},this._hasBackingShapeEntry=!1,this.setTracking(0,E.LockupLayout.Standard),this.setSpacing(.35,E.LockupLayout.Standard),this.setTracking(.35,E.LockupLayout.LetterGrid),this.setSpacing(.35,E.LockupLayout.LetterGrid),this.setTracking(.15,E.LockupLayout.Path),this.setSpacing(.35,E.LockupLayout.Path),this.setTracking(0,E.LockupLayout.Auto),this.setSpacing(.35,E.LockupLayout.Auto)},needsUpdate:function(t,e,o,i){return this.getLayoutClass("",t,e)!=this.getLayoutClass("",o,i)},getTracking:function(t){return S.as(this._attrsDict[this.getSessionAttrsKey(y.TRACKING_KEY,t)],"Double")},setTracking:function(t,e){this._attrsDict[this.getSessionAttrsKey(y.TRACKING_KEY,e)]=t},getSpacing:function(t){return S.as(this._attrsDict[this.getSessionAttrsKey(y.SPACING_KEY,t)],"Double")},setSpacing:function(t,e){this._attrsDict[this.getSessionAttrsKey(y.SPACING_KEY,e)]=t},getBackingShape:function(t,e,o){return void 0===o&&(o=null),S.as(this._attrsDict[this.getSessionAttrsKey(y.BACKING_KEY,e,o)],"String")},setBackingShape:function(t,e,o){void 0===o&&(o=null),this._attrsDict[this.getSessionAttrsKey(y.BACKING_KEY,e,o)]=t,this._hasBackingShapeEntry=!0},recordInitialBackingShape:function(t,e,o){void 0===o&&(o=null),this._hasBackingShapeEntry||this.setBackingShape(t,e,o)},getPotentialBackingShapes:function(t,e,o){void 0===e&&(e=null);for(var i=this,a=[],r=[],n=S.iter(this._attrsDict);!n.done;n.next()){var l=n.key,s=n.value;l.includes(y.BACKING_KEY)&&(S.as(s,"String")==o?a.push(o):r.push(l))}return S.sortInPlace(r,(function(o,a){return i.getBackingShapeKeyDistance(o,t,e)<i.getBackingShapeKeyDistance(a,t,e)})),a.concat(r.map((function(t){return i._attrsDict[t]}),this))},getBackingShapeKeyDistance:function(t,e,o){var i;if(void 0===o&&(o=null),null!=(i=this.extractLayoutClass(y.BACKING_KEY,t))){var a=this.getLayoutClass(y.BACKING_KEY,e,o);return i==a?0:i==k.LayoutClass.PathDefault&&a==k.LayoutClass.PathAsymmetric||i==k.LayoutClass.PathAsymmetric&&a==k.LayoutClass.PathDefault?1:i==k.LayoutClass.Default?2:3+a}return 1e4},getLayoutClass:function(t,e,o){var i;return void 0===o&&(o=null),E.LockupStyle.isLetterGrid(e)?k.LayoutClass.LetterGrid:E.LockupStyle.isAutoLayout(e)?k.LayoutClass.Auto:E.LockupStyle.isPath(e)?t==y.SPACING_KEY||t==y.TRACKING_KEY?k.LayoutClass.PathDefault:X.TextPathLibrary.isPathSymmetric((i=o)||null!=i?i:X.TextPathID.Circle)?k.LayoutClass.PathDefault:k.LayoutClass.PathAsymmetric:k.LayoutClass.Default},extractLayoutClass:function(t,e){if(e.startsWith(t)){var o,i=e.substr(t.length);if(null!=(o=S.toInt(i)))return k.LayoutClass.toCaseValue(o)}return null},getSessionAttrsKey:function(t,e,o){return void 0===o&&(o=null),t+this.getLayoutClass(t,e,o)}}}),y),k.LayoutClass=S.defineEnum("LayoutClass",{Default:0,LetterGrid:1,PathDefault:2,PathAsymmetric:3,Auto:4})},UB0O:function(t,e,o){var i,a=e,r=o("oAGj"),n=o("SpAV"),l=o("cEEQ"),s=o("9kak"),c=o("c+uM"),u=o("GFAD"),h=o("tGKA"),g=o("8t9B"),p=o("3UhB"),d=o("uUew"),f=o("1NAc");a.EvenRowWidthsLayoutStrategy=(i=function(){this.paddingScalar=.6,this.spacingScalar=.75,l.BaseLockupLayoutStrategy.call(this)},r.defineClass({name:"EvenRowWidthsLayoutStrategy",ctor:i,superName:"BaseLockupLayoutStrategy",statics:{getCombinedAspectOfAllRows:function(t,e){for(var o=0,i=r.iter(t);!i.done;i.next())o+=1/i.value.aspectRatio;return e>0?1/(r.toDouble(t.length-1)*(1/e)+o):1/o},getCombinedAspectOfAllRowsFinal:function(t,e){for(var o=0,i=r.iter(t);!i.done;i.next()){var a=i.value,n=a.rowHeightAdjustRatio<1?a.rowHeightAdjustRatio:1;o+=1/a.aspectRatio*(n*n)}return 0!=e?1/(r.toDouble(t.length-1)*(1/e)+o):1/o},getAverageRowAspect:function(t){for(var e=0,o=r.iter(r.range(0,t.length,!1).reversed());!o.done;o.next())e+=t[o.value].aspectRatio;return e/r.toDouble(t.length)},getTallestRowPairIndex:function(t){for(var e=5e3,o=t.length,i=null,a=r.iter(r.range(0,o-1,!1));!a.done;a.next()){var n=a.value,l=r.clone(t[n]);if(l.appendable){var s=n+1,c=r.clone(t[s]),u=l.aspectRatio+c.aspectRatio;u<e&&(e=u,i=n)}}return i},aspectDifference:function(t,e){return 1/(1/t-1/e)},aspectStacked:function(t,e){return 1/(1/t+1/e)},mergeRows:function(t,e,o){var i=r.clone(t);n.CoreAssert.isTrue(e<o,void 0,"EvenRowWidthsLayoutStrategy.mergeRows","EvenRowWidthsLayoutStrategy.swift",592);var a=i[e].words.concat(i[o].words),l=r.clone(s.LockupRowInfo.init_d97e(r.clone(a),i[o].appendable));return i.splice(o,1),i.splice(e,1),i.splice(e,0,r.clone(l)),i},mergeAutoRows:function(t,e,o,a,n,l){for(var s=r.clone(i.mergeRows(r.clone(t),e,o)),c=l==g.HighlightMethod.EvenRows?0:1,u=0,h=r.iter(r.range(0,s.length,!1));!h.done;h.next()){for(var p=h.value,d=0,f=r.iter(r.range(0,s[p].words.length,!1));!f.done;f.next()){for(var y=f.value;a[u].isNewLine;)u+=1;var k=r.clone(p%2==c?n[u]:a[u]);s[p].words[y]=r.clone(k),d+=k.aspectRatio,y-1>=0&&(d+=r.clone(s[p].words[y-1]).spaceAspectRatio),u+=1}s[p].aspectRatio=d}return s},compactRowsIntoAspect:function(t,e,o){var a=t.length;if(a<=1)return t;var n=i.getCombinedAspectOfAllRows(r.clone(t),0),l=i.getTallestRowPairIndex(r.clone(t));if(null==l)return t;for(var s=l+1,c=r.clone(t[l]),h=r.clone(t[s]),g=c.aspectRatio,p=h.aspectRatio,d=g+p,f=0,y=0,k=r.iter(r.toSequence(t));!k.done;k.next()){var S=k.value,L=S.offset,m=S.element;f+=m.aspectRatio,L==l?y+=d:L!=s&&(y+=m.aspectRatio)}var C=f/r.toDouble(a),v=y/r.toDouble(a)/o,A=C/o/r.toDouble(a-1),b=v/r.toDouble(a-2),R=i.aspectStacked(i.aspectDifference(n,i.aspectStacked(p,g)),d),w=i.aspectStacked(b,R),D=i.aspectStacked(A,n);if(u.LockupUtils.percentageDiff(e,D)<=u.LockupUtils.percentageDiff(e,w))return t;var T=r.clone(i.mergeRows(r.clone(t),l,s));return i.compactRowsIntoAspect(r.clone(T),e,o)},compactAutoRowsIntoAspect:function(t,e,o,a,n,l){var s=t.length;if(s<=1)return t;var c=i.getCombinedAspectOfAllRows(r.clone(t),0),h=i.getTallestRowPairIndex(r.clone(t));if(null==h)return t;for(var g=h+1,p=r.clone(t[h]),d=r.clone(t[g]),f=p.aspectRatio,y=d.aspectRatio,k=f+y,S=0,L=0,m=r.iter(r.toSequence(t));!m.done;m.next()){var C=m.value,v=C.offset,A=C.element;S+=A.aspectRatio,v==h?L+=k:v!=g&&(L+=A.aspectRatio)}var b=S/r.toDouble(s),R=L/r.toDouble(s)/o,w=b/o/r.toDouble(s-1),D=R/r.toDouble(s-2),T=i.aspectStacked(i.aspectDifference(c,i.aspectStacked(y,f)),k),x=i.aspectStacked(D,T),I=i.aspectStacked(w,c);if(u.LockupUtils.percentageDiff(e,I)<=u.LockupUtils.percentageDiff(e,x))return t;var O=r.clone(i.mergeAutoRows(r.clone(t),h,g,r.clone(a),r.clone(n),l));return i.compactAutoRowsIntoAspect(r.clone(O),e,o,r.clone(a),r.clone(n),l)},getOptimalCompactedAutoRows:function(t,e,o,a,n,l){var s=t.length;if(s<=1)return t;var c=i.getCombinedAspectOfAllRows(r.clone(t),0),h=i.getTallestRowPairIndex(r.clone(t));if(null==h)return t;for(var g=h+1,p=r.clone(t[h]),d=r.clone(t[g]),f=p.aspectRatio,y=d.aspectRatio,k=f+y,S=0,L=0,m=r.iter(r.toSequence(t));!m.done;m.next()){var C=m.value,v=C.offset,A=C.element;S+=A.aspectRatio,v==h?L+=k:v!=g&&(L+=A.aspectRatio)}var b=S/r.toDouble(s),R=L/r.toDouble(s)/n,w=b/n/r.toDouble(s-1),D=R/r.toDouble(s-2),T=i.aspectStacked(i.aspectDifference(c,i.aspectStacked(y,f)),k),x=i.aspectStacked(D,T),I=i.aspectStacked(w,c);if(u.LockupUtils.percentageDiff(a,I)<=u.LockupUtils.percentageDiff(a,x))return t;var O=r.clone(i.mergeAutoRows(r.clone(t),h,g,r.clone(e),r.clone(o),l));return i.compactAutoRowsIntoAspect(r.clone(O),a,n,r.clone(e),r.clone(o),l)},_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.layout==c.LockupLayout.FitJustified},layout:function(t){var e=t.text,o=t.style.font.fontData,a=t.containerSize,s=a.width,u=a.height,y=t.style,k=y.spacing*this.spacingScalar,S=s,L=u,m=S/L,C=r.clone(t.characterStyleRanges);y.alignment!=c.LockupAlignment.UNSET&&n.CoreAssert.warning("Unexpected alignment "+y.alignment+" for fit-justified text");var v=o.allCapsAllowed?e.toUpperCase():e,A=l.getTypographicBoundingRatiosOfString(v,o),b=g.TypeLockupController.HIGHLIGHT_STYLE,R=r.opt(r.opt(y.characterStyles[b],(function(t){return t.font})),(function(t){return t.fontData})),w=p.TypeLockupUtils.getCharFontAdjust(y,A.hasUppercase),D=!1;t.characterStyleRanges.length>0&&null!=y.characterStyles[b]&&-1!=y.characterStyles[b].spacing&&0!=y.characterStyles[b].spacing&&y.characterStyles[b].spacing>1&&((y=t.style.clone()).characterStyles[b].spacing=w,C=r.clone(p.TypeLockupUtils.invertRanges(r.clone(t.characterStyleRanges),e.length)),D=!0,null!=R&&(R=o,o=y.characterStyles[b].font.fontData,y.characterStyles[b].font=y.font));for(var T=r.clone(p.TypeLockupUtils.computeLockupMeasurements(v,o,A.heightRatio,o.allCapsAllowed,t.forceLetterForma,y.tracking,r.clone(C),r.clone(y.characterStyles),w,t.forceLetterForma)),x=r.clone(this.getUncompactedRows(r.clone(T),!1)),I=r.clone(i.compactRowsIntoAspect(r.clone(x),m,k)),O=0,B=r.iter(T);!B.done;B.next())O+=(ct=B.value).isNewLine?0:1;if(null!=t.rowWordLengths&&t.rowWordLengths.reduce((function(t,e){return t+e}),0)==O&&(!t.allowFewerLineBreaks||I.length>=t.rowWordLengths.length)&&(I=r.clone(this.getPrecomputedRows(r.clone(T),r.clone(t.rowWordLengths)))),T.length>1&&(t.highlightMethod==g.HighlightMethod.EvenRows||t.highlightMethod==g.HighlightMethod.OddRows)&&""!=b&&null!=y.characterStyles[b]&&null!=R){var _=r.clone(p.TypeLockupUtils.computeLockupMeasurements(v,o,A.heightRatio,o.allCapsAllowed,!1,y.tracking,r.clone([]),r.clone({}))),F=[new d.TextRange(0,r.chars(e).length)],E=r.clone(p.TypeLockupUtils.computeLockupMeasurements(v,R,A.heightRatio,o.allCapsAllowed,!1,y.tracking,r.clone(F),r.clone(y.characterStyles),w)),P=r.clone(this.getUncompactedAutoRows(r.clone(_),r.clone(E),!1,t.highlightMethod));I=r.clone(i.getOptimalCompactedAutoRows(r.clone(P),r.clone(_),r.clone(E),m,k,t.highlightMethod))}if(0==I.length)return l.LayoutResults.init_8322([],new f.TheoSize(0,0),h.Matrix2D.Identity,A,0);var W=i.getAverageRowAspect(r.clone(I)),U=W/k,M=i.getCombinedAspectOfAllRowsFinal(r.clone(I),U);M<m?S=L*M:L=S/M;for(var N=S/U,V=L,H=S,K=0,G=0,z=[],Y=r.iter(r.range(0,I.length,!1));!Y.done;Y.next()){var j=Y.value,q=r.clone(I[j]),X=q.rowHeightAdjustRatio<1?q.rowHeightAdjustRatio:1,J=S/(isFinite(q.aspectRatio)?q.aspectRatio:1)*X,Q=l.getTypographicBoundingRatiosOfString(q.text,o);G=0,X<1&&(G+=(S-q.aspectRatio*J)/2);for(var Z=J/A.heightRatio,$=Z*w,tt=Z*o.capRatio,et=A.textVerticalOffsetRatio,ot=A.heightRatio,it=Q.textVerticalOffsetRatio,at=et-(ot/2-Q.heightRatio/2)-it,rt=p.TypeLockupUtils.getCharFontYAdjust(y,Z,$),nt=(A.textVerticalOffsetRatio-o.capRatio-at)*Z,lt=K+0,st=r.iter(r.range(0,q.words.length,!1));!st.done;st.next()){var ct,ut=st.value,ht=(ct=r.clone(q.words[ut])).aspectRatio*J,gt=ct.spaceAspectRatio*J,pt=G,dt=o.allCapsAllowed?ct.text.toUpperCase():ct.text,ft=r.isEmpty(ct.characterStyle)?Z:$,yt=r.isEmpty(ct.characterStyle)||1!=X?0:rt,kt=r.isEmpty(ct.characterStyle)?null:ct.characterStyle;D&&(kt=r.isEmpty(ct.characterStyle)?b:null);var St=r.clone(l.LockupItem.init_e7b2(!0,kt,new f.TheoSize(ht,tt),h.Matrix2D.translationXY(pt,lt+nt+yt),dt,r.isEmpty(ct.characterStyle)?o:R||o,ft,Z,Q,j,ct.rangeInLockup));z.push(r.clone(St)),G+=ht+gt}K+=X<1?$*A.heightRatio+N:J+N}return l.LayoutResults.init_8322(r.clone(z),new f.TheoSize(H,V),h.Matrix2D.translationXY(0,0),A,W)},calculateTracking:function(t,e){var o=t.text,a=t.style.font.fontData,n=t.containerSize,s=n.width,c=n.height,u=t.style,h=u.spacing*this.spacingScalar,f=c,y=a.allCapsAllowed?o.toUpperCase():o,k=l.getTypographicBoundingRatiosOfString(y,a),S=0,L=g.TypeLockupController.HIGHLIGHT_STYLE,m=r.opt(r.opt(u.characterStyles[L],(function(t){return t.font})),(function(t){return t.fontData})),C=1;null!=m&&(C=k.hasUppercase?a.capRatio/m.capRatio:a.meanRatio/m.meanRatio);var v=r.clone(p.TypeLockupUtils.computeLockupMeasurements(y,a,k.heightRatio,!1,!0,u.tracking,r.clone(t.characterStyleRanges),r.clone(u.characterStyles),C,t.forceLetterForma));if(0==v.length)return t.style.tracking;var A=r.clone(this.getUncompactedRows(r.clone(v),!1)),b=e.width/e.height,R=r.clone(i.compactRowsIntoAspect(r.clone(A),b,h));if(v.length>1&&(t.highlightMethod==g.HighlightMethod.EvenRows||t.highlightMethod==g.HighlightMethod.OddRows)&&""!=L&&null!=u.characterStyles[L]&&null!=m){var w=r.clone(p.TypeLockupUtils.computeLockupMeasurements(y,a,k.heightRatio,a.allCapsAllowed,!0,u.tracking,r.clone([]),r.clone({}),void 0,t.forceLetterForma)),D=[new d.TextRange(0,r.chars(o).length)],T=r.clone(p.TypeLockupUtils.computeLockupMeasurements(y,m,k.heightRatio,a.allCapsAllowed,!0,u.tracking,r.clone(D),r.clone(u.characterStyles),C,t.forceLetterForma)),x=r.clone(this.getUncompactedAutoRows(r.clone(w),r.clone(T),!1,t.highlightMethod));R=r.clone(i.getOptimalCompactedAutoRows(r.clone(x),r.clone(w),r.clone(T),b,h,t.highlightMethod))}if(0==R.length)return t.style.tracking;if(u.tracking>0)for(var I=r.iter(r.range(0,R.length,!1));!I.done;I.next()){var O=I.value;R[O].aspectRatio=0;for(var B=r.iter(r.range(0,R[O].words.length,!1));!B.done;B.next()){var _=B.value;R[O].aspectRatio+=R[O].words[_].aspectRatio,R[O].words[_].canBreak&&_!=R[O].words.length-1?(R[O].words[_].spaceAspectRatio=a.spaceWidthRatio/k.heightRatio,R[O].aspectRatio+=R[O].words[_].spaceAspectRatio):R[O].words[_].spaceAspectRatio=0}}var F=i.getAverageRowAspect(r.clone(R))/h,E=f*i.getCombinedAspectOfAllRows(r.clone(R),F)/(isFinite(R[0].aspectRatio)?R[0].aspectRatio:1),P=R[0].aspectRatio*E;if(P<s)if(R[0].words.length<=1)S=0;else{var W=(s-P)/r.toDouble(R[0].words.length-1);S=W<1?0:W/(E/k.heightRatio)}else S=-P;return S},calculateLeading:function(t,e){var o=t.text,a=t.style.font.fontData,n=t.containerSize,s=n.width,c=n.height,u=t.style,h=0,f=a.allCapsAllowed?o.toUpperCase():o,y=l.getTypographicBoundingRatiosOfString(f,a),k=u.tracking,S=g.TypeLockupController.HIGHLIGHT_STYLE,L=r.opt(r.opt(u.characterStyles[S],(function(t){return t.font})),(function(t){return t.fontData})),m=1;null!=L&&(m=y.hasUppercase?a.capRatio/L.capRatio:a.meanRatio/L.meanRatio);var C=r.clone(p.TypeLockupUtils.computeLockupMeasurements(f,a,y.heightRatio,!1,!0,k,r.clone(t.characterStyleRanges),r.clone(u.characterStyles),m,t.forceLetterForma));if(0==C.length)return t.style.spacing;var v=r.clone(this.getUncompactedRows(r.clone(C),!1)),A=e.width,b=e.height,R=A/b,w=r.clone(i.compactRowsIntoAspect(r.clone(v),R,t.style.spacing));if(C.length>1&&(t.highlightMethod==g.HighlightMethod.EvenRows||t.highlightMethod==g.HighlightMethod.OddRows)&&""!=S&&null!=u.characterStyles[S]&&null!=L){var D=r.clone(p.TypeLockupUtils.computeLockupMeasurements(f,a,y.heightRatio,a.allCapsAllowed,!0,u.tracking,r.clone([]),r.clone({}),void 0,t.forceLetterForma)),T=[new d.TextRange(0,r.chars(o).length)],x=r.clone(p.TypeLockupUtils.computeLockupMeasurements(f,L,y.heightRatio,a.allCapsAllowed,!0,u.tracking,r.clone(T),r.clone(u.characterStyles),m,t.forceLetterForma)),I=r.clone(this.getUncompactedAutoRows(r.clone(D),r.clone(x),!1,t.highlightMethod));w=r.clone(i.getOptimalCompactedAutoRows(r.clone(I),r.clone(D),r.clone(x),R,h,t.highlightMethod))}if(w.length<=1)return u.spacing;var O=i.getAverageRowAspect(r.clone(w))/h;if((b=A/i.getCombinedAspectOfAllRows(r.clone(w),O))<c){var B=s/((c-b)/(r.toDouble(w.length)-1));h=w[0].aspectRatio/B/this.spacingScalar}else h=-b;return h},getUncompactedRows:function(t,e){for(var o=[],i=0;i<t.length;){var a=r.clone(t[i]),n=r.clone(s.LockupRowInfo.init_d97e());if(a.isNewLine)o.length>0&&(o[o.length-1].appendable=!1);else{if(!e)for(;!a.canBreak&&i<t.length;)n.addWord(r.clone(a)),(i+=1)<t.length&&(a=r.clone(t[i]));n.addWord(r.clone(a)),o.push(r.clone(n))}i+=1}return o},getUncompactedAutoRows:function(t,e,o,i){n.CoreAssert.isTrue(t.length==e.length,void 0,"EvenRowWidthsLayoutStrategy.getUncompactedAutoRows","EvenRowWidthsLayoutStrategy.swift",812);for(var a=[],l=0,c=i==g.HighlightMethod.EvenRows?0:1,u=0;u<t.length;){var h=r.clone(l%2==c?e[u]:t[u]),p=r.clone(s.LockupRowInfo.init_d97e());if(h.isNewLine)a.length>0&&(a[a.length-1].appendable=!1);else{if(!o)for(;!h.canBreak&&u<t.length;)p.addWord(r.clone(h)),(u+=1)<t.length&&(h=r.clone(t[u]));p.addWord(r.clone(h)),a.push(r.clone(p)),l+=1}u+=1}return a}}}),i)},VDg0:function(t,e,o){var i,a=e,r=o("oAGj"),n=o("8t9B");a.kOpacityRuleFaintAlpha=.5,a.kOpacityRuleMediumAlpha=.7,a.LockupConfiguration=(i=function(t,e,o,i,a,r,l,s){this.characterStyleRanges=[],this.highlightMethod=n.HighlightMethod.Manual,this.rowWordLengths=null,this.allowFewerLineBreaks=!1,this.preferredFontSize=null,void 0===i&&(i=null),void 0===a&&(a=null),void 0===r&&(r=!1),void 0===l&&(l=!1),void 0===s&&(s=null),this.text=t,this.style=e,this.containerSize=o,this.placement=i,this.parentBounds=a,this.useOptimization=r,this.forceLetterForma=l,this.preferredFontSize=s},r.defineClass({name:"LockupConfiguration",ctor:i}),i)},Zc5V:function(t,e,o){var i,a=e,r=o("oAGj");a.GridArrangementUtils=(i=function(){},r.defineClass({name:"GridArrangementUtils",ctor:i,statics:{MAX_COLS:100,ASPECT_RATIO_EPSILON:.005,getArrangement:function(t,e,o,a){var n=r.max(a),l=t*r.toDouble(o)/r.toDouble(n),s=i.getBestFittingArrangement(l,e,n),c=s.numCols,u=i.evaluateAllSegments(t,e,o,r.clone(a),c),h=u.penalty,g=u.aspectRatioDelta;if(0!=h)for(var p=i.getColumnCountSearchRange(o,c),d=r.iter(r.range(p.start,p.end,!0));!d.done;d.next()){var f=d.value;if(f!=s.numCols){var y=(u=i.evaluateAllSegments(t,e,o,r.clone(a),f)).penalty,k=u.aspectRatioDelta;(y<h||y==h&&k<g)&&(c=f,h=y,g=k)}}return{numRows:i.getNumRows(o,c),numCols:c}},getNumRows:function(t,e){return r.toInt(t/e)+(t%e==0?0:1)},getGridAspectRatio:function(t,e,o){var a=i.getNumRows(e,o);return r.toDouble(o)/r.toDouble(a)*t},getBestFittingArrangement:function(t,e,o,a,n){var l,s;void 0===a&&(a=1),void 0===n&&(n=i.MAX_COLS);var c=Math.min(o,n);if(a<c){l=r.toInt((a+c)/2),s=i.getGridAspectRatio(e,o,l);var u=Math.abs(t-s);if(u>i.ASPECT_RATIO_EPSILON){var h,g=(h=s<t?i.getBestFittingArrangement(t,e,o,l+1,c):i.getBestFittingArrangement(t,e,o,a,l-1)).numCols,p=h.aspectRatio;Math.abs(t-p)<u&&(l=g,s=p)}}else s=i.getGridAspectRatio(e,o,l=a);return{numCols:l,aspectRatio:s}},evaluateAllSegments:function(t,e,o,a,n){for(var l=0,s=0,c=r.iter(a);!c.done;c.next()){var u=c.value;i.evaluateOneSegment(u,n)||(l+=1),s+=1/i.getGridAspectRatio(e,u,n)}return s=1/s,{penalty:l,aspectRatioDelta:Math.abs(t-s)}},evaluateOneSegment:function(t,e){if(t<=e)return!0;var o=t%e;0==o&&(o=e);var a=r.toDouble(o)/r.toDouble(e),n=.5;return e>4&&i.getNumRows(t,e)>2&&(n=.25),a>=n},getColumnCountSearchRange:function(t,e){var o=Math.min(2,r.toInt(t/6));return{start:Math.max(1,e-o),end:Math.min(e+o,t)}}}}),i)},cEEQ:function(t,e,o){var i,a,r,n,l=e,s=o("oAGj"),c=o("SpAV"),u=o("9kak"),h=o("tGKA"),g=o("1NAc");l.LockupItemType=s.defineEnum("LockupItemType",{Text:0,Path:1,Artwork:2}),l.LockupItem=(i=function(){this.isFullCanvas=!1},s.defineClass({name:"LockupItem",ctor:i,props:{init_e7b2:function(t,e,o,i,a,r,n,s,c,u,h,g){void 0===g&&(g=null),this.type=l.LockupItemType.Text,this.hasPrimaryColor=t,this.characterStyle=e,this.size=o,this.placement=i,this.text=a,this.font=r,this.pointSize=n,this.rowPointSize=s,this.typographicBoundingRatios=c,this.rowIndex=u,this.rangeInLockup=h,this.margins=g},init_708e:function(t,e,o,i,a,r,n){void 0===a&&(a=null),void 0===r&&(r=!1),void 0===n&&(n=null),this.type=l.LockupItemType.Path,this.hasPrimaryColor=t,this.size=e,this.placement=o,this.path=i,this.rowIndex=a,this.isFullCanvas=r,this.characterStyle=n},init_9cc6:function(t,e,o,i,a,r,n){void 0===r&&(r=null),void 0===n&&(n=null),this.type=l.LockupItemType.Artwork,this.hasPrimaryColor=t,this.size=e,this.placement=o,this.artworkID=i,this.preScale=a,this.rowIndex=r,this.characterStyle=n},init_implicit:function(t,e,o,i,a,r,n,l,s,c,u,h,g,p,d,f,y){void 0===y&&(y=!1),this.type=t,this.hasPrimaryColor=e,this.size=o,this.placement=i,this.text=a,this.font=r,this.pointSize=n,this.rowPointSize=l,this.rowIndex=s,this.margins=c,this.typographicBoundingRatios=u,this.characterStyle=h,this.rangeInLockup=g,this.path=p,this.artworkID=d,this.preScale=f,this.isFullCanvas=y},clone:function(){return i.init_implicit(this.type,this.hasPrimaryColor,this.size,this.placement,this.text,this.font,this.pointSize,this.rowPointSize,this.rowIndex,this.margins,this.typographicBoundingRatios,this.characterStyle,this.rangeInLockup,this.path,this.artworkID,this.preScale,this.isFullCanvas)}}}),i),l.descenderCharacters="gjqpyQ",l.shortCharacters=" qweryuopasg;zxcvnm,.*-~",l.tallSpecialsThatAreNotCaps="!^'",l.TypographicBoundingRatios=(a=function(t,e,o,i,a,r){this.sideInsetRatio=t,this.textVerticalOffsetRatio=e,this.backingVerticalOffsetRatio=o,this.heightRatio=i,this.heightFromBaselineRatio=a,this.hasUppercase=r},s.defineClass({name:"TypographicBoundingRatios",ctor:a}),a),l.getTypographicBoundingRatiosOfString=function(t,e,o){void 0===o&&(o=!0);for(var i=t.split("\n").join(),a=!1,r=!1,n=!1,c=!1,u=!1,h=!1,g=!1,p=!1,d=!1,f=e.meanRatio,y=0,k=0,S=0,L=0,m=0,C=0,v=s.iter(s.chars(i));!v.done;v.next()){var A=v.value,b=!1,R=!1;" "!=A&&(k+=1,!b&&e.upperCaseCharsArray.includes(A)?b=!0:!R&&e.lowerCaseCharsArray.includes(A)&&(R=!0),!a&&b?a=!0:!r&&R&&(r=!0),e.meanCharsArray.includes(A)?S+=e.meanRatio:e.capCharsArray.includes(A)?(u=!0,S+=e.capRatio):e.ascentCharsArray.includes(A)?(c=!0,S+=e.ascentRatio):e.meanAccentCharsArray.includes(A)?(h=!0,S+=e.meanAccentRatio):e.capAccentCharsArray.includes(A)?(n=!0,S+=e.capAccentRatio):(u=!0,S+=e.capRatio),b&&(k+=1,S+=e.capRatio),b||R||""==A||""==A||""==A||(d=!0),e.tailCharsArray.includes(A)?(g=!0,L+=e.tailRatio):e.descentCharsArray.includes(A)&&(p=!0,L+=e.descentRatio))}if(d&&(f=1),n&&(f=Math.max(f,e.capAccentRatio)),c&&(f=Math.max(f,e.ascentRatio)),u&&(f=Math.max(f,e.capRatio)),h&&(f=Math.max(f,e.meanAccentRatio)),g&&(y=Math.max(y,e.tailRatio)),p&&(y=Math.max(y,e.descentRatio)),k>0&&(m=S/k,C=L/k),o){var w=f-(a?e.capRatio:e.meanRatio);m=f+=Math.max(0,y-w),C=y}var D=y/2,T=e.baselineOffsetRatio+f,x=.8*(f-m-y+C),I=f+y;return new l.TypographicBoundingRatios(D,T,x,I,f,a)},l.LayoutResults=(r=function(){},s.defineClass({name:"LayoutResults",ctor:r,props:{init_8322:function(t,e,o,i,a){for(var r=0,n=0,c=0,u=1e5,h=0,g=0,p=0,d={},f=s.iter(t);!f.done;f.next()){var y=f.value;y.type==l.LockupItemType.Text&&(r+=y.size.height,n+=y.pointSize,c+=1,y.rowIndex<u&&(u=y.rowIndex),y.rowIndex>h&&(h=y.rowIndex),null==d[y.rowIndex]&&(g+=y.pointSize,d[y.rowIndex]=!0),y.pointSize>p&&(p=y.pointSize))}this.items=s.clone(t),this.size=e,this.placement=o,this.numberOfLines=h<u?0:h-u+1,this.avgLinePointSize=g/s.toDouble(this.numberOfLines),this.avgTextItemHeight=r/c,this.avgTextPointSize=n/c,this.largestPointSize=p,this.typographicBoundingRatios=i,this.avgRowAspect=a},flipForRightToLeft:function(){for(var t=this.size.width,e=[],o=s.iter(this.items);!o.done;o.next()){var i=o.value;i.placement=h.Matrix2D.scalingXY(-1,1).translateXY(i.size.width,0).concat(i.placement.scaleXY(-1,1)).translateXY(t,0),e.splice(0,0,s.clone(i))}this.items=s.clone(e)},init_implicit:function(t,e,o,i,a,r,n,l,c,u){this.items=s.clone(t),this.size=e,this.placement=o,this.avgTextItemHeight=i,this.avgTextPointSize=a,this.avgLinePointSize=r,this.largestPointSize=n,this.typographicBoundingRatios=l,this.numberOfLines=c,this.avgRowAspect=u},clone:function(){return r.init_implicit(this.items,this.size,this.placement,this.avgTextItemHeight,this.avgTextPointSize,this.avgLinePointSize,this.largestPointSize,this.typographicBoundingRatios,this.numberOfLines,this.avgRowAspect)}}}),r),l.LockupLayoutStrategy=s.defineProtocol("LockupLayoutStrategy",{supportsConfiguration:"(LockupConfiguration) -> Boolean",layout:"(LockupConfiguration) -> LayoutResults",reflow:"(TheoSize, LockupConfiguration, LayoutResults) -> LayoutResults",calculateTracking:"(LockupConfiguration, TheoSize) -> Double",calculateLeading:"(LockupConfiguration, TheoSize) -> Double",adjustHeightForLeading:"(TheoRect, LayoutResults, Double, Double) -> Double",adjustWidthForTracking:"(String, LayoutResults, Double, Double) -> Double"}),l.LockupLayoutStrategyFactory=s.defineProtocol("LockupLayoutStrategyFactory",{supportsConfiguration:"(LockupConfiguration) -> Boolean",createForConfiguration:"(LockupConfiguration) -> LockupLayoutStrategy"}),l.BaseLockupLayoutStrategy=(n=function(){},s.defineClass({name:"BaseLockupLayoutStrategy",ctor:n,statics:{_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return c.CoreAssert.fail("Implement in subclass","BaseLockupLayoutStrategy.supportsConfiguration","LockupLayoutStrategy.swift",439),!1},layout:function(t){return c.CoreAssert.fail("implement in subclass","BaseLockupLayoutStrategy.layout","LockupLayoutStrategy.swift",444),l.LayoutResults.init_8322([],new g.TheoSize(0,0),h.Matrix2D.Identity,new l.TypographicBoundingRatios(0,1,0,1,1,!1),0)},reflow:function(t,e,o){return null},calculateTracking:function(t,e){return c.CoreAssert.fail("implement in subclass","BaseLockupLayoutStrategy.calculateTracking","LockupLayoutStrategy.swift",470),0},calculateLeading:function(t,e){return c.CoreAssert.fail("implement in subclass","BaseLockupLayoutStrategy.calculateLeading","LockupLayoutStrategy.swift",477),0},adjustHeightForLeading:function(t,e,o,i){var a=i-o;return s.toDouble(e.numberOfLines-1)*(t.width/e.avgRowAspect)*(.75*a)},adjustWidthForTracking:function(t,e,o,i){var a=0,r=i-o;if(0!=r){for(var n=-1,l=0,c=0,u=0,h=0,g=t,p=s.iter(e.items);!p.done;p.next()){var d=p.value;d.rowIndex!=n?(u>h&&(h=u,a=l),c=d.placement.tx,l=0):l+=r*d.pointSize,l+=r*d.pointSize*s.toDouble(d.text.length-1),u=d.placement.tx+d.size.width-c,d.rangeInLockup.start>0&&" "==g.substr(d.rangeInLockup.start-1,1)&&c!=d.placement.tx&&(i<0?l-=r*d.pointSize:l+=r*d.pointSize),n=d.rowIndex}u>h&&(h=u,a=l)}return a},getPrecomputedRows:function(t,e){var o=[];if(0==t.length||0==e.length)return o;for(var i=s.clone(u.LockupRowInfo.init_d97e()),a=0,r=0,n=s.iter(t);!n.done;n.next()){var l=n.value;l.isNewLine||(r>=e[a]&&(o.push(s.clone(i)),i=s.clone(u.LockupRowInfo.init_d97e()),a+=1,r=0),i.addWord(s.clone(l)),r+=1)}return o.push(s.clone(i)),o}}}),n)},d3iY:function(t,e,o){var i,a,r=e,n=o("oAGj"),l=o("Zc5V"),s=o("iCxV"),c=o("cEEQ"),u=o("9kak"),h=o("c+uM"),g=o("KdeS"),p=o("tGKA"),d=o("8t9B"),f=o("3UhB"),y=o("uUew"),k=o("1NAc");r.LetterGridLayoutStrategy=(i=function(){this.trackingScalar=3,this.spacingScalar=3,c.BaseLockupLayoutStrategy.call(this)},n.defineClass({name:"LetterGridLayoutStrategy",ctor:i,superName:"BaseLockupLayoutStrategy",statics:{_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return h.LockupStyle.isLetterGrid(t.style.layout)},layout:function(t){var e=[],o=0,i=0,a=0,r=this.getWireframeLayout(t),l=r.typographicBoundingRatios,s=n.clone(r.rows);if(0==!s.length){var u,h,g,y,S=r.horizontalPaddingRatio,L=r.verticalPaddingRatio,m=this.getCombinedAspectRatio(n.clone(s),S,L),C=t.style,v=r.font;null!=(y=t.preferredFontSize)?(h=(u=y)*l.heightRatio,g=(i=(o=r.constraintWidth)/m)/n.toDouble(s.length)):(m<r.constraintAspectRatio?(i=r.constraintHeight,o=r.constraintHeight*m):(o=r.constraintWidth,i=r.constraintWidth/m),u=(h=(g=i/n.toDouble(s.length))/(1+L))/l.heightRatio);var A=L*h,b=S*h;r.charFontAdjustRatio>1&&(u/=r.charFontAdjustRatio);for(var R=u*v.capRatio,w=u*l.textVerticalOffsetRatio-R,D=n.opt(n.opt(C.characterStyles[d.TypeLockupController.HIGHLIGHT_STYLE],(function(t){return t.font})),(function(t){return t.fontData}))||v,T=u*r.charFontAdjustRatio,x=f.TypeLockupUtils.getCharFontYAdjust(C,u,T),I=A/2+w,O=n.iter(n.toSequence(s));!O.done;O.next()){var B=O.value,_=B.offset,F=B.element;if(0==!F.words.length)for(var E=n.first(F.words).aspectRatio*h,P=E+b,W=b/2+F.colOffsetLeft*P,U=n.iter(F.words);!U.done;U.next()){var M=U.value,N=M.characterStyle,V=N==d.TypeLockupController.HIGHLIGHT_STYLE,H=V?D:v,K=V?T:u,G=M.relativeMargins.multiply(h),z=G.width,Y=W+z,j=I+(V?x:0),q=n.clone(c.LockupItem.init_e7b2(!0,N,new k.TheoSize(E-2*z,R),p.Matrix2D.translationXY(Y,j),M.text,H,K,u,l,_,M.rangeInLockup,G));e.push(n.clone(q)),W+=P}I+=g}a=this.getWidestRowAndAspectRatio(n.clone(s),S,L).aspectRatio}return c.LayoutResults.init_8322(n.clone(e),new k.TheoSize(o,i),p.Matrix2D.Identity,l,a)},getCharacterStyle:function(t,e,o){for(var i=n.iter(t);!i.done;i.next()){var a=i.value;if(e>=a.start&&e<a.end)return d.TypeLockupController.HIGHLIGHT_STYLE}return""},getWireframeLayout:function(t,e){var o;void 0===e&&(e=null);for(var i=t.text.toUpperCase(),a=t.style,h=a.alignment,p=t.containerSize,S=(e||p).width,L=(e||p).height,m=S/L,C=a.spacing*this.spacingScalar,v=a.tracking*this.trackingScalar,A=a.font.fontData,b=c.getTypographicBoundingRatiosOfString(i,A,!1),R=0,w=0,D=[],T=(o=t.preferredFontSize)||null!=o?o:32,x=n.opt(n.opt(a.characterStyles[d.TypeLockupController.HIGHLIGHT_STYLE],(function(t){return t.font})),(function(t){return t.fontData}))||A,I=f.TypeLockupUtils.getCharFontAdjust(a,b.hasUppercase,!1),O=T*I,B=[],_=n.iter(n.toSequence(n.chars(i)));!_.done;_.next()){var F=_.value,E=F.offset,P=F.element,W=n.toString(P);if(f.TypeLockupUtils.isWhiteSpace(W)){if("\n"==W){var U=w;w=E-R,D.push(w-U)}R+=1}var M=this.getCharacterStyle(n.clone(t.characterStyleRanges),E,E+1)==d.TypeLockupController.HIGHLIGHT_STYLE,N=M?x:A,V=M?O:T,H=s.Host.textModelUtils.measureInkBounds(W,N,V);B.push(H.width)}var K=B.length-R;D.push(K-w);var G,z=Math.max(T,O)*b.heightRatio,Y=n.max(B)/z,j=(Y+v)/(1+C);G=null!=t.preferredFontSize?n.toInt(Math.floor(S/(n.max(B)+v*z))):l.GridArrangementUtils.getArrangement(m,j,K,n.clone(D)).numCols;for(var q=n.clone(u.LockupRowInfo.init_d97e()),X=[],J=(E=0,n.iter(n.chars(i)));!J.done;J.next()){if(P=J.value,W=n.toString(P),f.TypeLockupUtils.isWhiteSpace(W))"\n"==P&&(this.commitRow(X,n.clone(q),G,h),q=n.clone(u.LockupRowInfo.init_d97e()));else{W=n.toString(P);var Q=(Y-B[E]/z)/2,Z=n.clone(g.LockupWordInfo.init_e9d6(W,Y,0,this.getCharacterStyle(n.clone(t.characterStyleRanges),E,E+1),1,!1,!0,new y.TextRange(E,E+1),new k.TheoSize(Q,0)));q.words.length==G&&(this.commitRow(X,n.clone(q),G,h),q=n.clone(u.LockupRowInfo.init_d97e())),q.addWord(n.clone(Z))}E+=1}return this.commitRow(X,n.clone(q),G,h),r.WireframeLayout.init_c604(A,b,I,S,L,m,v,C,n.clone(X),G)},commitRow:function(t,e,o,i){var a=n.toDouble(o-e.words.length);i==h.LockupAlignment.Right?e.colOffsetLeft=a:i==h.LockupAlignment.Center&&(e.colOffsetLeft=a/2,e.colOffsetRight=a/2),t.push(n.clone(e))},calculateTracking:function(t,e){var o=this.getWireframeLayout(t,e),i=n.clone(o.rows);if(0==i.length)return t.style.tracking;var a=this.getCombinedAspectRatio(n.clone(i),0,o.verticalPaddingRatio),r=o.constraintHeight*a,l=t.containerSize.width;if(r<l){var s=n.toDouble(i.length);return(l-r)/n.toDouble(o.numCols)/(o.constraintHeight/s/(1+o.verticalPaddingRatio))/this.trackingScalar}return-r},calculateLeading:function(t,e){var o=this.getWireframeLayout(t,e),i=n.clone(o.rows);if(0==i.length)return t.style.spacing;var a=this.getCombinedAspectRatio(n.clone(i),o.horizontalPaddingRatio,0),r=o.constraintWidth/a,l=t.containerSize.height;if(r<l){var s=n.toDouble(i.length),c=r/s;return(l/s-c)/c/this.spacingScalar}return-r},adjustHeightForLeading:function(t,e,o,i){if(0==!e.items.length){var a=i-o,r=n.clone(n.first(e.items));return n.toDouble(e.numberOfLines)*r.rowPointSize*r.typographicBoundingRatios.heightRatio*a*this.spacingScalar}return 0},adjustWidthForTracking:function(t,e,o,i){var a=this.getNumColsInLayout(n.clone(e));if(a>0){var r=i-o,l=n.clone(n.first(e.items));return l.rowPointSize*l.typographicBoundingRatios.heightRatio*r*this.trackingScalar*n.toDouble(a)}return 0},getNumColsInLayout:function(t){for(var e=0,o=0,i=-1,a=n.iter(t.items);!a.done;a.next()){var r=a.value;i!=r.rowIndex?(i=r.rowIndex,o=1):o+=1,e=Math.max(e,o)}return e},calculateRowAspectRatio:function(t,e,o,i){var a=n.toDouble(t.words.length),r=a+n.toDouble(i),l=t.aspectRatio*r/a;return(l+=r*e)/(1+o)},getWidestRowAndAspectRatio:function(t,e,o){for(var i,a=0,r=n.iter(t);!r.done;r.next()){var l=r.value,s=this.calculateRowAspectRatio(n.clone(l),e,o,n.toInt(l.colOffsetLeft+l.colOffsetRight));s>a&&(i=n.clone(l),a=s)}return{row:i,aspectRatio:a}},getCombinedAspectRatio:function(t,e,o){return this.getWidestRowAndAspectRatio(n.clone(t),e,o).aspectRatio/n.toDouble(t.length)}}}),i),r.WireframeLayout=(a=function(){},n.defineClass({name:"WireframeLayout",ctor:a,props:{init_c604:function(t,e,o,i,a,r,l,s,c,u){this.font=t,this.typographicBoundingRatios=e,this.charFontAdjustRatio=o,this.constraintWidth=i,this.constraintHeight=a,this.constraintAspectRatio=r,this.horizontalPaddingRatio=l,this.verticalPaddingRatio=s,this.rows=n.clone(c),this.numCols=u},init_implicit:function(t,e,o,i,a,r,l,s,c,u){this.font=t,this.typographicBoundingRatios=e,this.charFontAdjustRatio=o,this.constraintWidth=i,this.constraintHeight=a,this.constraintAspectRatio=r,this.horizontalPaddingRatio=l,this.verticalPaddingRatio=s,this.rows=n.clone(c),this.numCols=u}}}),a)},fGVU:function(t,e,o){var i,a=e,r=o("oAGj"),n=o("NkBu"),l=o("RkYL"),s=o("sW6f"),c=o("zjod");a.VideoController=(i=function(t,e,o){n.ImageController.call(this,t,e,o)},r.defineClass({name:"VideoController",ctor:i,superName:"ImageController",statics:{KIND:{get:function(){return"video"}}},props:{replaceable:{get:function(){return!0}},duplicatable:{get:function(){return!1}},canMultiSelect:{get:function(){return!1}},contentNode:{get:function(){var t=r.opt(r.as(this.forma,c.VideoForma),(function(t){return t.videoContentID}));return null==t?null:r.as(r.opt(r.opt(this.forma,(function(t){return t.page.document})),(function(e){return e.content.nodeByID(t)})),s.VideoContentNode)}},videoDuration:{get:function(){return r.opt(this.contentNode,(function(t){return t.duration}))||l.TheoTime.Zero}}}}),i)}}]);
//# sourceMappingURL=vendors_npm_spark_eed0fd33-d5a44143.js.map