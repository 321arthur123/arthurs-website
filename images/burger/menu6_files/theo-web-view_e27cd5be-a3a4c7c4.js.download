(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[82,67,75],{"4pbt":function(e,t,o){var n,a;function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){s(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}n=[o("xeH2"),o("UFvF"),o("YLtl"),o("Uwho"),o("gBAB"),o("2ofD"),o("Na8G"),o("tY4j"),o("zTjw"),o("DIoP"),o("MGCh"),o("vOKO"),o("+Ltv"),o("ZLL8"),o("uRNc"),o("Dcjk"),o("3xdQ"),o("3xm6"),o("Avqh"),o("KFmL"),o("+VG/"),o("WPh2"),o("sggK"),o("2Fsf"),o("0VUy"),o("5eso"),o("TW0n"),o("C8IR"),o("W1Jy"),o("M1RA"),o("NgGw"),o("tpS0"),o("0gXD"),o("z4rR"),o("7LIx"),o("/Elb"),o("r30K"),o("KQv+"),o("FIWz"),o("UXma"),o("mYMA"),o("vdJz"),o("e8qH"),o("wRAw"),o("GN+k"),o("W3p6"),o("mTyn"),o("7VrH"),o("uZvm"),o("ZXGz"),o("jo99"),o("HPKp"),o("7JlS"),o("FpXA"),o("UzQk"),o("k99a"),o("YJFe"),o("Ctaw"),o("Exk9"),o("+gTl"),o("a8ov"),o("TdwW"),o("O0ct"),o("JjOv"),o("mwMu"),o("qnb0"),o("8VGm"),o("b2xK"),o("pVEn"),o("pEL3"),o("/nf9"),o("hSNs"),o("Pbp+"),o("GSfz"),o("fuLW"),o("d/MO"),o("yQjA"),o("WPm+"),o("dO52"),o("kdSY"),o("Ww1C"),o("3Jkv"),o("rjtT"),o("TY/+")],void 0===(a=function(e,t,n,a,r,s,l,d,c,p,u,g,m,b,h,f,w,v,k,T,I,P,C,S,B,x,y,D,A,L,E,M,W,F,N,R,z,O,U,j,G,H,_,K,V,$,X,Y,Q,q,J,Z,ee,te,oe,ne,ae,re,ie,se,le,de,ce,pe,ue,ge,me,be,he,fe,we,ve,ke,Te,Ie,Pe,Ce,Se,Be,xe,ye,De,Ae,Le){const Ee=le.default,Me=me.default,We=Se.default,Fe={STALE_SESSION:"Stale Session"};ke.init();var Ne,Re,ze=xe(),Oe=u.channel("controller"),Ue={},je=!0,Ge=!1,He=!1,_e={errorDialogs:{}},Ke=[],Ve=-1,$e=t.defer(),Xe=t.defer();Xe.resolve();var Ye,Qe,qe,Je,Ze,et,tt,ot,nt,at,rt,it=!1,st=!0,lt=!1,dt=!1,ct=null,pt={DOCUMENT:1,TEMPLATE:2},ut=new ne,gt=new ae(ut),mt="app.kDefaultDocName",bt="app.kDefaultTemplateName",ht=["showFacebookUploadButton","showImageModalPanelOnload","showShareButton","showDownloadButton"],ft={default:{isDefault:!0,showShareButton:!0,showDownloadButton:!0},"facebook-cover-image-design":{showFacebookUpdateCoverButton:!0,showNoProfilePic:!1,showImageModalPanelOnload:!0},"facebook-holiday-ad-design":{showFacebookUploadButton:!0,showImageModalPanelOnload:!0},"twitter-design":{showTwitterUpload:!0}},wt=!1,vt=!1,kt="",Tt="",It="";if(Ue.enabled=!1,window.newrelic&&window.newrelic.setCustomAttribute){const e=window.adobeIMS.getUserProfile().userId;window.newrelic.setCustomAttribute("adobeId",e)}function Pt(){m.inPremiumTemplateOnboardingFlow=!0,Nt()}function Ct(e){_e.collabStatusButton.$el.toggleClass("shared-document",!!e)}function St(e){s.currentDoc===e.composite&&(Ct(e.collab.collaborators.length+e.collab.invitations.length>0),_e.brandIndicator&&_e.brandIndicator.update({collaborationStatus:s.currentDoc.getCollaboration()||"NONE"}))}function Bt(e){wa(e.authContext).then(()=>{_e.brandIndicator.events.publish("brand-switch-complete")}).done()}function xt(){if(tt&&tt.newTemplateId){var e="design-edit-template/post/"+tt.contextId+"/"+tt.newTemplateId;marvel.navigate(e,{trigger:!1,replace:!0})}}function yt(e){var t="design/post/"+e;marvel.navigate(t,{trigger:!1,replace:!0})}var Dt=!1;function At(){_e.addContentPopUp.$el.addClass("slide-right-fade-out"),_e.addContentButton.$el.removeClass("rotate"),Dt=!1,_e.postEditorView.$el.off("click",At),setTimeout((function(){_e.addContentPopUp.hide(),_e.addContentPopUp.$el.removeClass("slide-right-fade-out")}),300)}function Lt(e){Dt?At():(p.publish("editor:addPressed"),_e.addContentPopUp.$el.addClass("slide-left-fade-in"),_e.addContentPopUp.show(),_e.addContentButton.$el.addClass("rotate"),_e.addContentButton.$el.removeClass("large"),Dt=!0,t.resolve().then((function(){_e.postEditorView.$el.on("click",At)})),setTimeout((function(){_e.addContentPopUp.$el.removeClass("slide-left-fade-in")}),300))}async function Et(){He=!0;var e=Qe===pt.TEMPLATE?"template-mode main-toolbar toolbar":"main-toolbar toolbar";if(_e.postEditorView=new A({id:"PostEditorContent",layout:"rows",parent:_e.windowPanel,panels:[{id:"PostTopBar",class:e,size:"66px"},{id:"PostApp",size:"auto"}]}),_e.topColorStrip=new k({parent:"PostTopBar",id:"colorStrip",tag:"DIV"}),Qe!==pt.TEMPLATE?(_e.postAppSection=new A({layout:"columns",panels:[{id:"PostCanvasSection",size:"auto"},{id:"PostControlSection",size:"280px"},{id:"PostNavStrip",size:"80px"}],parent:"PostApp"}),_e.postControlStrip=new A({layout:"rows",panels:[{id:"PostBrandIndicatorContainer",size:"50px"},{id:"PostSidebar",size:"auto"}],parent:"PostControlSection"}),_e.brandIndicator=new F({collaborationStatus:s.currentDoc.getCollaboration(),height:50,id:"PostBrandIndicator",isEntitled:ut.featureEnabled("entitle-brand-kit"),parent:"PostBrandIndicatorContainer",navigateToCreateBrandMethod:xa,width:280})):_e.postAppSection=new A({layout:"columns",parent:"PostApp",panels:[{id:"PostCanvasSection",size:"auto"},{id:"PostSidebar",size:"280px"},{id:"PostNavStrip",size:"80px"}]}),_e.postContentSection=new A({layout:"rows",parent:"PostCanvasSection",panels:[{id:"PostContentSection",size:"auto"},{id:"PostActionsStrip",size:"0px"}]}),_e.canvasInteractionLayer=new B({id:"canvasInteractionLayer",parent:"PostCanvasSection",onPointerDown:function(e){var t=Mt(e.x,e.y);Re.handlePointerChanged({updateType:"pointerDown",x:t.x,y:t.y,pointerType:e.pointerType,pointerId:e.pointerId,tapCount:e.tapCount,modifierKeys:e.modifierKeys})},onPointerUp:function(e){var t=Mt(e.x,e.y);Re.handlePointerChanged({updateType:"pointerUp",x:t.x,y:t.y,pointerType:e.pointerType,pointerId:e.pointerId,tapCount:e.tapCount,modifierKeys:e.modifierKeys})},onPointerMove:function(e){var t=Mt(e.x,e.y);Re.handlePointerChanged({updateType:"pointerMove",x:t.x,y:t.y,pointerType:e.pointerType,pointerId:e.pointerId,tapCount:e.tapCount,modifierKeys:e.modifierKeys})}}),_e.imageWrapper=new D({id:"PosterImageWrapper",parent:_e.canvasInteractionLayer,aspect:1,margin:40,marginLeft:70,marginRight:70,minTop:100}),ut.featureEnabled("post-enable-zendesk-widget")&&(Ie.loadZendeskWidget(),_e.feebackButton=new I({parent:_e.canvasInteractionLayer,class:"feedback-button",width:40,height:40,onClick:function(){window.zE.activate({hideOnClose:!0})}})),Qe===pt.TEMPLATE&&_e.imageWrapper.$el.on("click",(function(){_e.docNameInput.blur()})),_e.poster=await Le.default({featureFlag:"post-pgm-poster",featureEnabled:ut.featureEnabled,parent:_e.imageWrapper,watermarkEnabled:je}).catch(Oe.error),oe.Host.setPosterView(_e.poster),_e.postTopBarLeft=new S({parent:"PostTopBar",id:"PostTopBarLeft",class:"application-options",height:"auto",width:Qe===pt.TEMPLATE?"auto":495}),_e.postTopBarMid=new S({parent:"PostTopBar",id:"PostTopBarMid",class:"document-options",template:"",height:"auto",width:"auto"}),_e.postTopBarRight=new S({parent:"PostTopBar",id:"PostTopBarRight",class:"editor-options",height:"auto",left:"auto",width:360}),Qe===pt.TEMPLATE?(_e.saveTemplateButton=new T({parent:"PostTopBarLeft",class:"pill pill-primary-on-light",hidden:!1,label:"i18n.common.kSave",onClick:Rt}),_e.cancelTemplateButton=new T({parent:"PostTopBarLeft",class:"pill pill-secondary-on-light",hidden:!1,label:"i18n.common.kCancel",onClick:zt})):(_e.hamburgerMenu=new T({parent:"PostTopBarLeft",class:"hamburgerButton mrvl-hamburger-menu",attributes:{"data-auto":"mrvl-hamburger-menu"},label:" ",tag:"div",onClick:function(){window.marvel&&window.marvel.events.trigger("mrvl-show-global-nav")}}),_e.homeButton=new T({parent:"PostTopBarLeft",class:"homeButton",id:"PostHomeButton",label:" ",tag:"div",onClick:Ba}),_e.postLogo=new S({parent:"PostTopBarLeft",id:"PostLogo",template:"i18n.app.kPost",class:"name"}),_e.navCrumbs=new S({parent:"PostTopBarLeft",id:"PostTopBarNavCrumbs"}),_e.backToProjects=new T({class:"post-top-bar-crumb",parent:_e.navCrumbs,label:"i18n.app.kProjects",onClick:ya}),_e.carrotOne=new k({class:"post-top-bar-carrot",parent:_e.navCrumbs})),_e.docNameInput=new he({parent:Qe===pt.TEMPLATE?"PostTopBarLeft":_e.navCrumbs,onFocusOut:function(){var e=_e.docNameInput.getText();if(e.trim().length<1){e="";var t=Qe===pt.TEMPLATE?bt:mt,o=v.translate(t);_e.docNameInput.setText(o),_e.docNameInput.$el.addClass("placeholder"),_e.docNameInput.$el.removeClass("named")}else{(Qe===pt.TEMPLATE?ie.getTemplateName(et):s.currentDoc.getProjectName())!==e?p.publish("renameDocument",{}):p.publish("renameDocumentCancelled",{}),_e.docNameInput.$el.removeClass("placeholder"),_e.docNameInput.$el.addClass("named")}!function(e){Qe===pt.TEMPLATE?ie.setTemplateName(et,e):s.currentDoc.setProjectName(e);$n()}(e),_e.editNameButton.$el.css("visibility","visible")},onFocus:function(){p.publish("renameDocumentClicked",{}),Re.deselect(),_e.editNameButton.$el.css("visibility","hidden"),_e.docNameInput.$el.hasClass("placeholder")&&(_e.docNameInput.setText(""),_e.docNameInput.$el.removeClass("placeholder"),_e.docNameInput.$el.addClass("named"))},attributes:{"data-i18n":"[aria-label]app.kPostNameInputLabel"}}),_e.editNameButton=new I({parent:Qe===pt.TEMPLATE?"PostTopBarLeft":_e.navCrumbs,class:"edit-name-button",width:16,height:16,onClick:function(){_e.docNameInput.focus(),_e.editNameButton.$el.css("visibility","hidden")}}),_e.savingIndicator=new k({id:"PostSavingIndicator",parent:"PostTopBarLeft",template:"i18n.app.kSaving",hidden:!0}),_e.undo=new T({parent:"PostTopBarMid",id:"PostUndoButton",tag:"div",hoverLabel:"i18n.app.kUndo",hoverLabelPosition:"below",label:"i18n.app.kUndo",onClick:Wt}),_e.redo=new T({parent:"PostTopBarMid",id:"PostRedoButton",tag:"div",hoverLabel:"i18n.app.kRedo",hoverLabelPosition:"below",label:"i18n.app.kRedo",onClick:Ft}),ut.featureEnabled("post-enable-debug-menu")&&(_e.debugMenu=new T({parent:"PostTopBarMid",id:"PostDebugMenuButton",tag:"div",label:"Debug",onClick:function(){_e.debugView.show()}}),_e.debugView=new R({id:"PostDebugView",parent:"PostCanvasSection"})),Qe!==pt.TEMPLATE){let e;_e.collabStatusButton=new I({parent:"PostTopBarRight",class:"collabStatusButton",width:50,height:63,onClick:function(){Xt("projectHeader")}}),Ct(s.currentDoc.attributes.collaboration&&"NONE"!==s.currentDoc.attributes.collaboration),e=ut.featureEnabled("post-enable-server-rendering")&&ze?{parent:"PostTopBarRight",class:"button downloadButton",id:"downloadButton",label:"app.kDownload",submitButtonLabel:"app.kStartDownload",optionsList:[{label:"app.downloadOptions.pngImg.kButtonLabel",filetype:"img_png",checked:"true",tooltipMessage:"app.downloadOptions.pngImg.kTooltip"},{label:"app.downloadOptions.jpgImg.kButtonLabel",filetype:"img_jpg",tooltipMessage:"app.downloadOptions.jpgImg.kTooltip"},{label:"app.downloadOptions.pngImgV2.kButtonLabel",filetype:"img_png_v2",betaflag:"true",tooltipMessage:"app.downloadOptions.pngImgV2.kTooltip"},{label:"app.downloadOptions.jpgImgV2.kButtonLabel",filetype:"img_jpeg_v2",betaflag:"true",tooltipMessage:"app.downloadOptions.jpgImgV2.kTooltip"},{label:"app.downloadOptions.printPdf.kButtonLabel",filetype:"pdf",betaflag:"true",tooltipMessage:"app.downloadOptions.printPdf.kTooltip"}],onIMGDownload:Qt,onIMGDownloadV2:qt,onPDFDownload:Jt,onOptionsShown:Zt}:{parent:"PostTopBarRight",class:"button downloadButton",id:"downloadButton",label:"app.kDownload",submitButtonLabel:"app.kStartDownload",optionsList:[{label:"app.downloadOptions.pngImg.kButtonLabel",filetype:"img_png",checked:"true",tooltipMessage:"app.downloadOptions.pngImg.kTooltip"},{label:"app.downloadOptions.jpgImg.kButtonLabel",filetype:"img_jpg",tooltipMessage:"app.downloadOptions.jpgImg.kTooltip"},{label:"app.downloadOptions.printPdf.kButtonLabel",filetype:"pdf",betaflag:"true",tooltipMessage:"app.downloadOptions.printPdf.kTooltip"}],onIMGDownload:Qt,onPDFDownload:Jt,onOptionsShown:Zt},_e.downloadButton=new Pe(e);const t={parent:"PostTopBarRight",class:"postShareMenu",id:"postShareMenu",menutitle:"app.kShare",onClick:Yt,icon:"/images/sp-editor-share.svg",iconHover:"/images/sp-editor-share-hover.svg",menuitems:[{icon:"/marvel-core/images/share/sp-editor-publish.svg",menuItemText:"app.shareMenuItems.publish.kMenuItemText",tooltipMessage:"app.shareMenuItems.publish.kTooltip",id:"sharemenu-publish"},{icon:"/marvel-core/images/share/sp-editor-invite.svg",menuItemText:"app.shareMenuItems.invite.kMenuItemText",tooltipMessage:"app.shareMenuItems.invite.kTooltip",id:"sharemenu-invite"}]};_e.sharePostButton=new Be(t),De.getAccountType().then((function(e){De.shouldShowNewBadge().then((function(o){const n=[...t.menuitems];"teacher"===e&&n.push({icon:"/marvel-core/images/share/sp-editor-canvas-lms.svg",menuItemText:"app.shareMenuItems.lms.kAttachText",id:"sharemenu-lms-attach",menuItemTag:o?"app.shareMenuItems.lms.kMenuItemTag":""}),"student"===e&&n.push({icon:"/marvel-core/images/share/sp-editor-canvas-lms.svg",menuItemText:"app.shareMenuItems.lms.kTurninText",id:"sharemenu-lms-attach",menuItemTag:o?"app.shareMenuItems.lms.kMenuItemTag":""}),_e.sharePostButton.update({menuitems:n,menutitle:t.menutitle,icon:t.icon,iconHover:t.iconHover}),o&&(_e.lmsCoachmark||(_e.lmsCoachmark=new fe({parent:"postShareMenu",id:"lmsCoachmark",message:"i18n.components.coachmarks.lms.kMessage",arrowDirection:"top-right",closeButtonType:"icon",height:52,width:330,top:66,hidden:!0,left:"calc(100% - 330px)",priority:10,anchorElement:_e.sharePostButton})),setTimeout(()=>{_e.lmsCoachmark.show()},0))}))}))}_e.facebookUploadButton=new T({parent:"PostTopBarMid",class:"button uploadButton facebookUploadButton",id:"FacebookUploadButton",hidden:!0,tag:"div",label:"i18n.app.kShareFacebook",onClick:eo}),_e.facebookUpdateCover=new T({parent:"PostTopBarMid",class:"button uploadButton facebookUploadButton",id:"facebookUpdateCoverButton",hidden:!0,tag:"div",label:"i18n.app.kUpdateFacebookCover",onClick:eo}),_e.twitterUpload=new T({parent:"PostTopBarMid",class:"button uploadButton twitterUploadButton",id:"TwitterUploadButton",hidden:!0,tag:"div",label:"i18n.app.kUploadTwitter",onClick:to}),_e.addContentRegion=new S({parent:"PostNavStrip",id:"PostAddContentRegion",height:80,width:80}),_e.addContentButton=new I({parent:"PostAddContentRegion",id:"PostAddContentButton",height:"auto",width:"auto",label:"i18n.components.buttons.kAdd",iconTemplate:"<i class='circle-button'></i>",onClick:Lt}),_e.addContentPopUp=new L({id:"PostAddContentPopUp",parent:"PostAddContentRegion",focusScrim:!1,hidden:!0,iconCount:4,carrot:!0,preventDefaultAnimation:!0}),_e.addContentTextButton=new I({parent:"PostAddContentPopUp",class:"pop-up-icon-left",id:"PostAddContentPopUpText",label:"i18n.components.buttons.kText",width:60,height:60,onClick:Do}),_e.addContentImageButton=new I({parent:"PostAddContentPopUp",class:"pop-up-icon-mid",id:"PostAddContentPopUpImage",width:60,height:60,label:"i18n.components.buttons.kPhoto",onClick:Bo}),_e.colorPicker=new N({id:"colorPicker",parent:_e.postEditorView,top:180,left:10,width:250,height:350,hideBrandkit:!ut.featureEnabled("entitle-brand-kit")}),_e.sidebarGlobal=new E({parent:"PostSidebar",hidden:!1}),_e.sidebarTheme=new _({parent:_e.sidebarGlobal,hidden:!1,visibilityGroup:"main-sidebar",showMerchPopup:!ut.featureEnabled("entitle-brand-kit")}),_e.sidebarPalette=new K({parent:_e.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar",enableColorPicker:ut.featureEnabled("post-color-picker"),colorPicker:_e.colorPicker}),_e.sidebarResize=new H({parent:_e.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar"}),ut.featureEnabled("post-templates-search-enabled")&&Qe!==pt.TEMPLATE&&(_e.sidebarTemplates=new Q({waitForSaveMethod:za,saveDocument:$n,deletingCurrentDoc:Jn,imageWrapper:_e.imageWrapper,parent:_e.sidebarGlobal,poster:_e.poster,hidden:!0,visibilityGroup:"main-sidebar",showResizeOption:ut.featureEnabled("post-templates-show-resize"),getDocSize:na})),_e.sidebarLayout=new G({parent:_e.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar"}),_e.sidebarGlobal.registerSidebarTabWithId(_e.sidebarTheme,"theme"),_e.sidebarGlobal.registerSidebarTabWithId(_e.sidebarPalette,"palette"),_e.sidebarGlobal.registerSidebarTabWithId(_e.sidebarLayout,"layout"),_e.sidebarGlobal.registerSidebarTabWithId(_e.sidebarResize,"resize"),_e.sidebarTemplates&&_e.sidebarGlobal.registerSidebarTabWithId(_e.sidebarTemplates,"templates"),_e.sidebarText=new j({parent:"PostSidebar",hidden:!0,hasNewFonts:ut.featureEnabled("post-new-fonts"),enableColorPicker:ut.featureEnabled("post-color-picker"),entitleBrandKit:ut.featureEnabled("entitle-brand-kit"),wheelImprovementsEnabled:ut.featureEnabled("post-wheel-improvements"),colorPicker:_e.colorPicker}),_e.sidebarBackground=new U({parent:"PostSidebar",hidden:!0,enablePixiRenderer:ut.featureEnabled("post-pgm-poster"),enableColorPicker:ut.featureEnabled("post-color-picker"),colorPicker:_e.colorPicker,disableImageFrames:Ln()}),_e.sidebarLogo=new V({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),_e.sidebarIcon=new $({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar",colorPicker:_e.colorPicker}),_e.sidebarMultiselect=new X({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar",alignmentTypes:Re.getAlignmentTypes(),distributeTypes:Re.getDistributeTypes()}),_e.sidebarGroup=new Y({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),_e.addTextSidebar=new J({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar",onAddText:ro}),_e.sidebarCrop=new Z({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),_e.navStripTabsWrapper=new k({parent:"PostNavStrip",id:"PostNavStripTabsWrapper"}),_e.globalTabsWrapper=new C({parent:"PostNavStripTabsWrapper",id:"PostGlobalTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"global-tabs",defaultActive:!0,rememberLastTab:!0,onShown:Zo}),ut.featureEnabled("post-templates-search-enabled")&&Qe!==pt.TEMPLATE&&(_e.tabButtonTemplates=new P({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kTemplates",id:"sectionTabTemplates",group:"global-sidebar-tabs",defaultSelected:!1,onSelect:bn}),_e.globalTabsWrapper.registerTab(_e.tabButtonTemplates)),Qe!==pt.TEMPLATE&&(_e.tabButtonTheme=new P({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kDesign",id:"sectionTabTheme",group:"global-sidebar-tabs",defaultSelected:!0,onSelect:hn}),_e.globalTabsWrapper.registerTab(_e.tabButtonTheme)),_e.tabButtonPalette=new P({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kColors",id:"sectionTabPalette",group:"global-sidebar-tabs",onSelect:fn}),_e.globalTabsWrapper.registerTab(_e.tabButtonPalette),_e.tabButtonLayout=new P({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kLayout",id:"sectionTabLayout",group:"global-sidebar-tabs",defaultSelected:!1,onSelect:un}),_e.globalTabsWrapper.registerTab(_e.tabButtonLayout),_e.tabButtonResize=new P({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kResize",id:"sectionTabResize",group:"global-sidebar-tabs",defaultSelected:!1,isPremium:ut.featureEnabled("post-resize-is-paid-feature")&&Qe!==pt.TEMPLATE,isEntitled:gt.isEntitledToFeature("postResizeButton"),onTrySelect:gn,onSelect:mn}),_e.globalTabsWrapper.registerTab(_e.tabButtonResize),_e.textTabsWrapper=new C({parent:"PostNavStripTabsWrapper",id:"PostTextTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"text-tabs",defaultActive:!1,onHidden:function(){_e.sidebarText.hide(),Re&&Re.exitCharStyleMode()},onShown:an}),_e.tabButtonTextType=new P({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kType",id:"sectionTabText",group:"text-tabs",onSelect:function(e){wn({tabId:"type"}),e&&p.publish("editor:typePressed")}}),_e.textTabsWrapper.registerTab(_e.tabButtonTextType),_e.tabButtonTextColor=new P({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kColor",id:"sectionTabTextColor",group:"text-tabs",onSelect:function(){wn({tabId:"color"})}}),_e.textTabsWrapper.registerTab(_e.tabButtonTextColor),_e.tabButtonTextShape=new P({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kShape",id:"sectionTabTextShape",group:"text-tabs",onSelect:function(){wn({tabId:"shape"})}}),_e.textTabsWrapper.registerTab(_e.tabButtonTextShape),_e.tabButtonTextEffects=new P({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kEffects",id:"sectionTabTextEffects",group:"text-tabs",onSelect:function(){wn({tabId:"effects"})}}),_e.textTabsWrapper.registerTab(_e.tabButtonTextEffects),_e.tabButtonTextStyle=new P({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kStyle",id:"sectionTabTextStyle",group:"text-tabs",onSelect:function(){wn({tabId:"style"})}}),_e.textTabsWrapper.registerTab(_e.tabButtonTextStyle),_e.addTextTabsWrapper=new C({parent:"PostNavStripTabsWrapper",id:"PostAddTextTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"add-text-tabs",defaultActive:!1,onHidden:en,onShown:tn}),_e.tabButtonAddText=new P({parent:"PostAddTextTabsWrapper",label:"i18n.components.buttons.kText",id:"sectionTabAddText",group:"local-sidebar-tabs"}),_e.addTextTabsWrapper.registerTab(_e.tabButtonAddText),_e.cropTabsWrapper=new C({parent:"PostNavStripTabsWrapper",id:"PostCropTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"crop-tabs",defaultActive:!1,onHidden:on}),_e.tabButtonCrop=new P({parent:"PostCropTabsWrapper",label:"i18n.components.buttons.kImage",id:"sectionTabCrop",group:"local-sidebar-tabs"}),_e.cropTabsWrapper.registerTab(_e.tabButtonCrop),_e.backgroundTabsWrapper=new C({parent:"PostNavStripTabsWrapper",id:"PostBackgroundTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"background-tabs",defaultActive:!1,onHidden:_e.sidebarBackground.hide,onShown:nn}),_e.tabButtonBackgroundImage=new P({parent:"PostBackgroundTabsWrapper",label:"i18n.components.buttons.kImage",id:"sectionTabBackground",group:"local-sidebar-tabs",onSelect:function(){vn({tabId:"image"});var e=Re.getSelectedForma();e&&!e.isImage()&&yo({disallowClose:!0,setHome:!0})}}),_e.backgroundTabsWrapper.registerTab(_e.tabButtonBackgroundImage),_e.tabButtonBackgroundLooks=new P({parent:"PostBackgroundTabsWrapper",label:"i18n.components.buttons.kFilters",id:"sectionTabBackgroundLooks",group:"local-sidebar-tabs",onSelect:function(){vn({tabId:"looks"});var e=Re.getSelectedForma();e&&!e.isImage()&&yo({disallowClose:!0,setHome:!0})}}),_e.backgroundTabsWrapper.registerTab(_e.tabButtonBackgroundLooks),_e.tabButtonBackgroundColor=new P({parent:"PostBackgroundTabsWrapper",label:"i18n.components.buttons.kColorFill",id:"sectionTabBackgroundColor",group:"local-sidebar-tabs",onSelect:function(){vn({tabId:"color"})}}),_e.backgroundTabsWrapper.registerTab(_e.tabButtonBackgroundColor),_e.logoTabsWrapper=new C({parent:"PostNavStripTabsWrapper",id:"PostLogoTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"logo-tabs",defaultActive:!1,onHidden:_e.sidebarLogo.hide,onShown:rn}),_e.tabButtonLogo=new P({parent:"PostLogoTabsWrapper",label:"i18n.components.buttons.kLogo",id:"sectionTabLogo",group:"local-sidebar-tabs",onSelect:kn}),_e.logoTabsWrapper.registerTab(_e.tabButtonLogo),_e.iconTabsWrapper=new C({parent:"PostNavStripTabsWrapper",id:"PostIconTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"icon-tabs",defaultActive:!1,onHidden:_e.sidebarIcon.hide,onShown:sn}),ut.featureEnabled("post-language-switcher")&&(_e.LanguageSwitcher=new ve({parent:"PostNavStrip",id:"PostLanguageSwitcher"}));let t="i18n.components.buttons.kIcon";ke.run("IconShapeExperiment",{shape_for_icon_label:function(e){t="i18n.components.buttons.kShape"},control:function(e){}}).then((function(e){_e.tabButtonIcon=new P({parent:"PostIconTabsWrapper",label:t,id:"sectionTabIcon",group:"local-sidebar-tabs",onSelect:function(){Tn({tabId:"icon"})}}),_e.iconTabsWrapper.registerTab(_e.tabButtonIcon),_e.tabButtonIconColor=new P({parent:"PostIconTabsWrapper",label:"i18n.components.buttons.kColor",id:"sectionTabIconColor",group:"local-sidebar-tabs",onSelect:function(){Tn({tabId:"color"})}}),_e.iconTabsWrapper.registerTab(_e.tabButtonIconColor),_e.addContentIconButton=new I({parent:"PostAddContentPopUp",class:"pop-up-icon-mid",id:"PostAddContentPopUpIcon",width:60,height:60,label:t,onClick:So}),_e.addContentLogoButton=new I({parent:"PostAddContentPopUp",class:"pop-up-icon-right",id:"PostAddContentPopUpLogo",width:60,height:60,label:"i18n.components.buttons.kLogo",onClick:Lo}),aa()})).done(),_e.multiselectTabsWrapper=new C({parent:"PostNavStripTabsWrapper",id:"PostMultiselectTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"multiselect-tabs",defaultActive:!1,onHidden:_e.sidebarMultiselect.hide,onShown:ln}),_e.tabButtonMultiselect=new P({parent:"PostMultiselectTabsWrapper",label:"i18n.components.buttons.kMultipleObjects",id:"sectionTabMultiple",group:"multiselect-tabs",onSelect:function(){var e,t;t=(e=(e={tabId:"multiple"})||{}).tabId||"multiple",_e.sidebarMultiselect.showSidebarWithId(e.tabId),pn({component:_e.sidebarMultiselect}),"multiple"===t&&p.publish("multiselectSidebarDisplayed:align")}}),_e.multiselectTabsWrapper.registerTab(_e.tabButtonMultiselect),_e.groupTabsWrapper=new C({parent:"PostNavStripTabsWrapper",id:"PostGroupTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"group-tabs",defaultActive:!1,onHidden:_e.sidebarGroup.hide,onShown:dn}),_e.tabButtonGroup=new P({parent:"PostGroupTabsWrapper",label:"i18n.components.buttons.kGroup",id:"sectionTabGroup",group:"group-tabs",onSelect:function(){var e,t;t=(e=(e={tabId:"group"})||{}).tabId||"group",_e.sidebarGroup.showSidebarWithId(e.tabId),pn({component:_e.sidebarGroup}),"group"===t&&p.publish("groupSidebarDisplayed:group")}}),_e.groupTabsWrapper.registerTab(_e.tabButtonGroup),_e.changeImageModalPanel=new A({layout:"rows",parent:"PostSidebar",hidden:!0,panels:[{id:"PostImagePicker",size:"auto"}]}),_e.changeImageModalPanel.remove=function(){_e.changeImageModalPanel.$el.hide()};var o=!1;_e.changeImageModalPanel.insert=function(){o?_e.changeImageModalPanel.$el.show():(_e.changeImageModalPanel.parent.$el.append(_e.changeImageModalPanel.$el),o=!0)},_e.imagePicker=new q({parent:"PostImagePicker",waitForSaveMethod:za,onClose:function(){_e.changeImageModalPanel.hide(),!Re.getSelectedForma()&&It.length?(Re.selectFormaById({formaId:It}),It=""):(Re.deselect(),oa())}}),_e.changeIconModalPanel=new A({layout:"rows",parent:"PostSidebar",hidden:!0,panels:[{id:"PostIconPicker",size:"auto"}]}),_e.changeIconModalPanel.remove=function(){_e.changeIconModalPanel.$el.hide()};var n=!1;_e.changeIconModalPanel.insert=function(){n?_e.changeIconModalPanel.$el.show():(_e.changeIconModalPanel.parent.$el.append(_e.changeIconModalPanel.$el),n=!0)},_e.iconPicker=new q({parent:"PostIconPicker",waitForSaveMethod:za,sources:[],assetType:"vector",image_filter:[".svg","image/svg+xml"],label:"Choose icon",onClose:function(){_e.changeIconModalPanel.hide(),!Re.getSelectedForma()&&It.length?(Re.selectFormaById({formaId:It}),It=""):(Re.deselect(),oa())}}),_e.textCapture=new O({parent:_e.windowPanel,hidden:!0,coreWrapper:Re}),_e.posterAdornments=new te({poster:_e.poster,background:_e.postContentSection,pageElement:Ne}),_e.watermarkButton=new y({id:"PostWatermarkButton",parent:_e.imageWrapper,onClick:Ht,hidden:!!je}),je&&function(){_e.watermarkButton.$el.on("mouseover",(function(){je&&at&&_e.watermarkTooltip.show()})),_e.watermarkButton.$el.on("mouseleave",(function(){je&&at&&_e.watermarkTooltip.hide()})),_e.watermarkCoachmark=new fe({parent:_e.imageWrapper,id:"watermarkCoachmark",message:"i18n.components.coachmarks.watermark.kMessage",title:"i18n.components.coachmarks.watermark.kTitle",hidden:!0,arrowDirection:"down",offsetY:-210,priority:0,anchorElement:_e.watermarkButton,userSettingFlag:Te.keys.POST_WATERMARK_COACHMARK_DISMISSED,onHide:function(){at=!0}}),je&&!at&&_e.watermarkCoachmark.show();_e.watermarkTooltip=new we({parent:_e.imageWrapper,id:"watermarkTooltip",message:"i18n.components.coachmarks.watermark.kTooltip",arrowDirection:"down",width:"auto",height:34,hidden:!0})}(),_e.noProfilePic=new y({id:"PostNoProfilePic",parent:_e.imageWrapper,hidden:!0})}function Mt(e,t){var o=_e.poster.getViewScale(),n=_e.poster.$el.offset();return{x:(e-n.left)/o,y:(t-n.top)/o}}function Wt(){if(Re.canUndo()){var e=Re.getUndoDescription();p.publish("undoApplied",{actionDescription:e}),Re.undo()}}function Ft(){if(Re.canRedo()){var e=Re.getRedoDescription();p.publish("redoApplied",{actionDescription:e}),Re.redo()}}function Nt(){_e.premiumTemplateTextTooltip=new fe({parent:"PostApp",id:"textTooltip",message:"i18n.components.coachmarks.premiumText.kMessage",arrowDirection:"left",showCloseButton:!1,anchorElement:_e.imageWrapper,height:"auto",width:130,offsetY:250,offsetX:5,priority:1,hidden:!0}),_e.premiumTemplateTextTooltip.show()}function Rt(){_e.posterAdornments.hideSelectionBox(),za().done((function(){marvel.navigate("/branding/"+tt.contextId,{trigger:!0})}))}function zt(){_e.posterAdornments.hideSelectionBox();var e=t.defer();_e.poster.disable(),_e.posterAdornments.hideSelectionBox(),Re.undoToInitialState(),ie.setTemplateName(et,Je.templateName);var o=Re.getDocumentSize(),a=o.width/o.height;_e.imageWrapper.update({aspect:a}),n.delay((function(){_e.poster.update({core:Re}),_e.poster.enable(),e.resolve()}),250),e.promise.done((function(){qn(),za("Please wait...").done((function(){marvel.navigate("/branding/"+tt.contextId,{trigger:!0})}))}))}function Ot(e){_e.sidebarTheme.setDesigns({aspectRatio:Re.getPageAspectRatio(),wordCount:Re.getLockupWordCount(),iconCount:Re.getIconCount(),imageCount:Re.getPotentialBackgroundImageCount(),isInitialLoad:e||!1,manifest:Re.getManifestData(),docId:Re.getDocumentCCID()})}function Ut(e){var t=Re.getColorPalette();_e.sidebarPalette.setCurrentPalette(t,e)}function jt(e){var t=(e=e||Re).getExportData().pixelDimensions;return{width:t.width,height:t.height,imageQuality:1}}function Gt(e){je=e,_e.poster.setWatermark(je),_e.watermarkButton.show(e)}function Ht(){_e.watermarkCoachmark&&_e.watermarkCoachmark.hide(),at=!0,h.setSetting(Te.keys.POST_WATERMARK_COACHMARK_DISMISSED,!0),p.publish("editor:watermarkPressed"),Ge?l.showMerchPopover({$element:_e.watermarkButton.$el,position:"top",touchpointName:"postWatermarkUpgradeOnly",notify:function(e){"no-selection"===e&&p.publish("editor:watermarkRemoveCancelled",{payToRemove:!0})}}):l.showMerchPopover({$element:_e.watermarkButton.$el,position:"top",touchpointName:"postWatermark",notify:function(e){"secondary"===e?(Re.setWatermarkEnabledForDoc(!1),Gt(!1),qn(),p.publish("editor:watermarkRemoved")):"no-selection"===e&&p.publish("editor:watermarkRemoveCancelled",{payToRemove:!1})}})}function _t(e,o){var n,a=Re.getFullCanvasColor(),r=!!a;return!r&&o&&(n=Re.setBackgroundTransparency(0),je&&_e.poster.setWatermark(!1)),(n||t.resolve()).then(()=>new Promise(e=>setTimeout(()=>e(),0))).then(()=>Ue.getDownloadImageBlobPromise(s.currentDoc,e)).then(e=>{var o=window.URL.createObjectURL(e);if(r){var n=document.createElement("canvas"),i=jt();return n.width=i.width,n.height=i.height,function(e,o,n){var a=t.defer(),r=new Image;return r.onload=function(){var t=e.getContext("2d");t.drawImage(r,0,0);for(var o,i=e.width,s=e.height,l=t.getImageData(0,0,i,s),d=255*n.red,c=255*n.green,p=255*n.blue,u=0===d?0:d-1,g=0===c?0:c-1,m=0===p?0:p-1,b=0;b<s;b++)for(var h=0;h<i;h++)o=4*(b*i+h),l.data[o+0]>=u&&l.data[o+0]<=d+1&&l.data[o+1]>=g&&l.data[o+1]<=c+1&&l.data[o+2]>=m&&l.data[o+2]<=p+1&&255===l.data[o+3]&&(l.data[o+0]=0,l.data[o+1]=0,l.data[o+2]=0,l.data[o+3]=0);t.putImageData(l,0,0),jn(e).then((function(e){a.resolve(e)}))},r.src=o,a.promise}(n,o,a)}return t.resolve(e)}).then(e=>(o&&(Re.setBackgroundTransparency(1).done(),_e.poster.setWatermark(je)),e))}function Kt(e){var o=t.defer(),n=new M({headerText:"i18n.dialogs.transparentBackground.kHeaderText",contentText:"",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.transparentBackground.kPNGButtonLabel",onClick:function(){p.publish("transparentBackgroundButtonPressed"),n.hide(),o.resolve(!0)}},{class:"pill pill-primary-on-light",label:e?"i18n.dialogs.transparentBackground.kPNGSolidButtonLabel":"i18n.dialogs.transparentBackground.kJPEGButtonlabel",onClick:function(){p.publish("solidBackgroundButtonPressed"),n.hide(),o.resolve(!1)}},{class:"pill pill-secondary-on-light",label:"i18n.common.kCancel",onClick:function(){p.publish("backgroundCancelButtonPressed"),n.hide(),o.resolve(null)}}]});return o.promise}function Vt(){for(var e=Re.getDocumentMetadataEvents(),t=0;t<e.length;t++){var o=e[t];p.publish("shareMetadata",{"document:metadata":o[0],"document:metadata2":o[1],"document:metadata3":o[2],"document:metadata4":o[3]})}var n=Re.getDocFontSourceUsage();p.publish("exportFontUsage",{contextualData1:"fontSource:[".concat(n.join(", "),"]")});var a=Re.getAllStringForFormaUsedWheelSuggestions();a.length>0&&p.publish("lockupStyleCaptured",{contextualData1:"styleString:".concat(a),contextualData2:"location:ShareExport"}),Ue.reportNounProjectIds()}function $t(){Vt(),window.marvel.events.trigger("send-theo-editor-download-button-export-analytics",Na())}function Xt(e){window.marvel.events.trigger("spark-invite-collaborators-to-current-doc",{composite:s.currentDoc,source:e,page:"post:editor"})}function Yt(e){_e.lmsCoachmark&&!_e.lmsCoachmark.isHidden()&&_e.lmsCoachmark.hide(),za().done((function(){return"sharemenu-publish"===e?(p.publish("shareButtonPressed"),Vt(),void window.marvel.events.trigger("share-workflow-current-doc")):"sharemenu-invite"===e?Xt("project"):"sharemenu-lms-turnin"===e||"sharemenu-lms-attach"===e?(De.showModal({type:"adobe-theo",id:s.currentDoc.id},{syncInProgress:!1}),null):""===e?(_e.downloadButton.el.hideDownloadList(),null):(console.warn("handleShareMenuClick called with unrecognized menuItemId",e),null)}))}function Qt(o){const n=o.originalEvent.detail.mediaType.split("_")[1];p.publish("downloadButtonPressed"),"string"==typeof n&&p.publish("downloadImgButtonPressed:"+n),$t(),("jpg"!==n&&Re.shouldSuggestTransparentBackground()?Kt("png"===n):t(!1)).done(t=>{if("boolean"==typeof t){const o=!(t||n&&"jpg"!==n);return _t(o?"image/jpeg":"image/png",t).catch((function(e){Oe.error("generatePngImageBlob error",e)})).done((function(t){p.publish("Sharing Action",{contextData:["projectId"],eventAction:"BeginDownload",slide:"publish"}),function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"png";var n=e("<a></a>");e(document.body).append(n);var a=_e.docNameInput.getText()+"."+o;if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(t,a);else{var r=window.URL.createObjectURL(t);n.attr("href",r),n.attr("download",a),n[0].click(),window.URL.revokeObjectURL(r)}}(t,o?"jpg":"png"),p.publish("Sharing Action",{contextData:["projectId"],eventAction:"Download"})}))}})}function qt(e){const o=e.originalEvent.detail.mediaType.split("_")[1];za().done((function(){("png"===o&&Re.shouldSuggestTransparentBackground()?Kt("png"===o):t.resolve(!1)).done(e=>{"boolean"==typeof e&&We(s,a,o,e).done()})}))}function Jt(){za().done((function(){p.publish("downloadPDFButtonPressed"),Ce(s,a),$t()}))}function Zt(){_e.sharePostButton.el.hideMenuDropdown()}function eo(){za().done((function(){window.marvel.events.trigger("upload-to-facebook-current-doc")}))}function to(){za().done((function(){window.marvel.events.trigger("upload-to-twitter-current-doc")}))}function oo(){var e=Re.getSelectedForma();e&&e.isTypeLockup()&&oe.LockupStyle.isPath(e.style.layout)&&(_e.tabButtonTextShape.isSelected&&_e.tabButtonTextType.select(),_e.tabButtonTextShape.disable())}function no(){_e.tabButtonTextShape.isEnabled()||_e.tabButtonTextShape.enable()}function ao(){var e=Re.getTextForSelectedLockup();if(e){var o=Re.getSelectedForma();_e.textCapture.prompt(e).then((function(n){if(n&&n!==e){var a=n.length.toString(),r=o.source;if(oe.FormaSourceUtils.isDesignIngredient(r)){var i=oe.BadgeFacade.getDesignIngredientIDAndType(r);p.publish("designIngredient:textEdited",{contextualData1:"id:"+i.id,contextualData2:"type:"+i.type,contextualData7:"lengthOfText:"+a})}else{var s=o.style,l=s.font.fontData.postScriptName,d=function(e){switch(e.backing){case oe.LockupBacking.None:return"none";case oe.LockupBacking.Rows:return"row";case oe.LockupBacking.BannerHorizontal:return"bannerHorizontal";case oe.LockupBacking.BannerVertical:return"bannerVertical";case oe.LockupBacking.Knockout:return"knockout";case oe.LockupBacking.LegacyShadow:return"none";default:if(e.backingArtworkID)return e.backingArtworkID}return"none"}(s);p.publish("customTextEdited",{contextualData7:"lengthOfText:"+a,contextualData10:"fontName:"+l,contextualData12:"shapeName:"+d})}return Re.setTextForSelectedLockup(n)}return t.resolve()})).done(_e.posterAdornments.showSelectionBox)}}function ro(){var e=!1;At(),Re.downloadNewLockupRandomFontsAsync(),_e.textCapture.prompt("").then((function(o){if(o){var n=o.length.toString();return p.publish("customTextAdded",{contextualData7:"lengthOfText:"+n}),e=!0,Re.addNewLockup(o,{select:!0})}return t.resolve()})).done((function(){e&&(_e.tabButtonTextType.select(),_e.posterAdornments.showSelectionBox())}))}function io(){var e,t=Re.getAllSelectedFormas();t&&(e=t,Re.canDuplicateFormae(e)?Re.duplicateFormae(e).done():Co())}function so(t){p.publish("editImage:cropPressed"),e("#PostApp").addClass("crop-scrim"),e("#PostTopBar").addClass("crop-scrim").append('<div class="full-scrim"></div>'),e("#PostTopBar").find(".full-scrim").on("click",(function(e){po()})),Re.enterCropMode().then((function(){_e.tabButtonCrop.select(),_e.sidebarCrop.show(),_e.sidebarCrop.moveToSection(t)}))}function lo(e){Re.applyAspectRatioCropToImage(e).done()}function co(e){Re.applyShapeMaskToImage(e).done()}function po(){uo(),Re.exitCropMode().then((function(){_e.tabButtonBackgroundImage.select(),_e.sidebarBackground.show()}))}function uo(){e("#PostApp").removeClass("crop-scrim"),e("#PostTopBar").removeClass("crop-scrim"),e("#PostTopBar").find(".full-scrim").remove()}function go(){p.publish("editImage:layerSelected",{contextualData1:"imageLayer:floating"}),Re.setImageAsForeground().done()}function mo(){p.publish("editImage:layerSelected",{contextualData1:"imageLayer:background"}),Re.setImageAsBackground().done()}function bo(){var e=Re.getAllSelectedFormas();if(e){var t=Re.getDeleteInfo(e);if(t.isDeleteable&&t.isBackgroundImage)var o=new M({headerText:"i18n.dialogs.delete.kHeaderText",contentText:"i18n.dialogs.delete.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.delete.kDeleteContentButtonLabel",onClick:function(){Re.replaceImagesWithColors(null,[]).done(),o.hide()}},{class:"pill pill-primary-on-light",label:"i18n.dialogs.delete.kDeletePhotoSectionLabel",onClick:function(){wo(e),o.hide()}},{class:"pill pill-secondary-on-light",label:"i18n.common.kCancel",onClick:function(){o.hide()}}]});else t.isBackgroundImage?Re.replaceImagesWithColors(null,[]).done():t.isDeleteable&&wo(e)}}function ho(e){const t=Re.getAllSelectedFormas();Re.groupItems(t,!0,e.method)}function fo(e){const t=Re.getAllSelectedFormas();Re.ungroupItems(t,!0,e.method)}function wo(e){e=e||Re.getAllSelectedFormas(),Re.deleteFormae(e).done()}function vo(t,o){var n=e("#swapCellThumbnail");if(n.length)n.css({top:o.y+5+"px",left:o.x-50+"px"});else{var a=e('<div id="swapCellThumbnail"></div>').css({position:"absolute",top:o.y+5+"px",left:o.x-50+"px",opacity:.5,"box-shadow":"0px 0px 4px 0px"});if(e("body").append(a),t.isBackgroundImage()){var r=Re.getImagePreviewData(t),i=e('<img src="'+r.url+'">').css({"max-height":"100px","max-width":"100px"});a.append(i)}else{var s=t.style.colors.fieldPrimary;if(s){var l=de.rgb2hex(de.solidColor2Rgba(s)),d=t.frame.width>t.frame.height;a.css({background:"#"+l,height:d?t.frame.height/t.frame.width*100+"px":"100px",width:d?"100px":t.frame.width/t.frame.height*100+"px"})}}}}function ko(){e("#swapCellThumbnail").remove()}function To(t){e("#swapScrim").remove();var o=t.finalFrame,n=_e.poster.getViewScale(),a=_e.poster.$el.offset(),r=a.top+o.minY*n,i=a.left+o.minX*n,s=(o.maxY-o.minY)*n,l=(o.maxX-o.minX)*n,d=e('<div id="swapScrim"></div>').css({background:"rgba(0,0,0,.25)",outline:"solid white 4px",top:r,left:i,height:s,width:l,position:"absolute"});e("body").append(d)}function Io(){e("body").find("#swapScrim").remove()}function Po(){_e.sidebarCrop.recordFormaResize()}function Co(){var e=new M({headerText:"i18n.dialogs.tooManyImages.kHeaderText",contentText:"i18n.dialogs.tooManyImages.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){e.hide()}}]});e.show()}function So(e){e=e||{},_e.posterAdornments.hideSelectionBox(),It=Re.getSelectedFormaId()||"",Re.deselect({silent:!0}),_e.tabButtonIcon.select(),_e.tabButtonIconColor.hide({silent:!0,preventSelection:!0}),e.setHome=!0,dt||(e.context=e.context||{},e.context.class_name="DooploImagePickerContext",e.context.search_string=function(){let e=["badge","fun","spark","circle","singer","arrow","heart","star","flower","rectangle","love","party","triangle","square","oval","phone","food","sun"];ut.featureEnabled("use-translation-service-for-icon-search")&&(e=["iconSearch.kBadge","iconSearch.kFun","iconSearch.kSpark","iconSearch.kCircle","iconSearch.kSinger","iconSearch.kArrow","iconSearch.kHeart","iconSearch.kStar","iconSearch.kFlower","iconSearch.kRectangle","iconSearch.kLove","iconSearch.kParty","iconSearch.kTriangle","iconSearch.kSquare","iconSearch.kOval","iconSearch.kPhone","iconSearch.kFood","iconSearch.kSun"]);var t=Math.floor(Math.random()*(e.length+1));return v.translate(e[t])}(),dt=!0),e.label="Add icon",Ao(e),At(),p.publish("editor:addIconPressed")}function Bo(e){p.publish("editor:addImagePressed"),e=e||{},Re.canAddMoreImages(1)?(lt=!1,_e.posterAdornments.hideSelectionBox(),It=Re.getSelectedFormaId()||"",Re.deselect({silent:!0}),_e.tabButtonBackgroundImage.select(),_e.tabButtonBackgroundColor.hide({silent:!0,preventSelection:!0}),_e.tabButtonBackgroundLooks.hide({silent:!0,preventSelection:!0}),e.setHome=!0,e.label="Add photo",e.disallowClose=Re.backgroundImageFormas().length<1,yo(e),_e.changeIconModalPanel.hide(),At()):Co()}function xo(e){e=e||{},lt=!0;var t=Re.getSelectedForma();t&&(Re.isIcon(t)?(_e.tabButtonIcon.select(),e.label="Replace icon","dooplo"===t.contentNode.mediaMetadata.searchSource&&(e.context=e.context||{},e.context.class_name="DooploImagePickerContext",e.context.search_string=t.contentNode.mediaMetadata.searchTerm),Ao(e)):(e.label="Replace photo",t.isImage()&&t.childCount>0&&t.childAt(0).contentNode.mediaMetadata&&"dooplo"===t.childAt(0).contentNode.mediaMetadata.searchSource&&(e.context=e.context||{},e.context.class_name="DooploImagePickerContext",e.context.search_string=t.childAt(0).contentNode.mediaMetadata.searchTerm),yo(e)))}function yo(e){if("boolean"!=typeof(e=e||{}).disallowClose){var t=Re.getSelectedForma();t&&(t.isImage()||t.isGridCell())?e.disallowClose=!1:e.disallowClose=Re.imageFormas().length<1}_e.imagePicker.show(e),_e.changeImageModalPanel.show(e),_e.imagePicker.removeSelection(),e.label&&_e.imagePicker.setTitle(e.label),e.setHome&&_e.imagePicker.home(),_e.imagePicker.setCloseButtonVisibility(!e.disallowClose)}function Do(){p.publish("editor:addTextPressed",{sparkFormat:"post"}),Re.triggerTextSidebarDisplayed(),_e.tabButtonAddText.select(),_e.addTextSidebar.show(),p.publish("addTextSidebarDisplayed"),At()}function Ao(e){e=e||{},_e.iconPicker.show(e),_e.changeIconModalPanel.show(e),_e.iconPicker.removeSelection(),e.label&&_e.iconPicker.setTitle(e.label),e.setHome&&_e.iconPicker.home(),_e.iconPicker.setCloseButtonVisibility(!e.disallowClose)}function Lo(){p.publish("editor:addLogoPressed"),ut.featureEnabled("entitle-brand-kit")?(At(),_e.tabButtonLogo.select(),_e.changeImageModalPanel.hide(),_e.changeIconModalPanel.hide()):l.showMerchPopover({$element:_e.addContentButton.$el,position:"bottom-left",width:320,positionOffset:-4,touchpointName:"postLogoButton"})}function Eo(){p.publish("uploadNewLogoSelected"),_e.posterAdornments.hideSelectionBox(),At()}var Mo=n.throttle((function(e,t){Re.applyGridStyle(e,t).done(),p.publish("layoutSelected",{layoutID:e.gridStyle.name})}),40);function Wo(e){if("Original"===e.id){var t=Re.getOriginalImageSize();if(!t)return;e=oe.DesignSizeLibrary.getOriginalSize(t.width,t.height)}_e.poster.disable();var o=!1;return _e.watermarkCoachmark&&!at&&(_e.watermarkCoachmark.hide(),o=!0),_e.posterAdornments.hideSelectionBox(),Re.setPageSizeFromDesignSize(e).then((function(){_e.imageWrapper.update({aspect:e.aspectRatio||1}),o&&(o=ia()),_e.sidebarBackground.updateFilters({tileAspect:e.aspectRatio||1}),n.delay((function(){_e.poster.enable()}),50),o&&!at&&_e.watermarkCoachmark.show(),p.publish("canvasSizeSelected",{aspectRatio:e.aspectRatio||1,targetId:e.id})}))}var Fo=n.throttle((function(e){"Custom"===e.id?function(){var e=Re.getPageExportData(),t=e.pixelDimensions,o=Re.getDocumentSizeId(),n=e.format,a=e.ppi;"Custom"===o&&(n=Re.getPageCustomSizeFormat(),a=Re.getPageCustomSizePPI());var r=new W({currentExportSize:t,currentFormat:n,currentPPI:a});r.events.subscribe("submit",(function(e){e.exportData.format===n&&t.width===e.exportData.pixelWidth&&t.height===e.exportData.pixelHeight||(Wo(oe.DesignSizeLibrary.getCustomSize(e.exportData.width,e.exportData.height,e.exportData.format,e.exportData.ppi)),p.publish("customSizeSet",{dimensions:e.exportData.width+"x"+e.exportData.height+" "+e.exportData.format}))})),r.events.subscribe("cancel",(function(){_e.sidebarResize.selectDocumentSizeWithId(Re.getDocumentSizeId(),{silent:!0}),p.publish("customSizeCancelled")}))}():Wo(e)}),40);function No(t,o,n){n.silent||!e(n.target).closest("[class*='tile-shuffle-button']").length&&0!==o||(0===o?Re.setColorPalette(t,{shuffle:!0}).done():Re.shuffleColorPalette().done())}function Ro(e){e=e||{};var t,o=Re.getDocumentSizeId();o===kt&&"Custom"!==o||(kt=o,_e.imageWrapper.update({aspect:Re.getPageAspectRatio()}),_e.sidebarResize.selectDocumentSizeWithId(Re.getDocumentSizeId(),{silent:!0})),_e.tabButtonPalette&&_e.tabButtonPalette.isSelected()&&Ut(),_e.tabButtonTheme&&(t=Re.getThemeId())!==Tt&&(_e.sidebarTheme.selectThemeWithid(t,{silent:!0}),Tt=t),e.formaAdded&&Ho(),wt=!0}var zo=n.throttle((function(e,t){e.manifestPromise().then((function(e){return Re.applyDesignTheme(e,t)})).done((function(){p.publish("designVariationSelected",{contextualData1:"variationTemplateDocumentId:"+e.assetId,contextualData2:"numShuffles:"+t})}))}),40),Oo=n.throttle((function(e){e.manifestPromise().done((function(t){Re.addBadge(t,e.assetId).done()}))}),40);function Uo(e){e.data.forma.isTypeLockup()&&_e.tabButtonTheme&&_e.tabButtonTheme.isSelected()&&_e.sidebarTheme.setDesigns({aspectRatio:Re.getPageAspectRatio(),wordCount:Re.getLockupWordCount(),iconCount:Re.getIconCount(),imageCount:Re.getPotentialBackgroundImageCount(),manifest:Re.getManifestData(),docId:Re.getDocumentCCID()}),e.selected&&!_e.sidebarBackground.isHidden()&&_e.sidebarBackground.updateFilters({whilePanelVisibleOnly:!0,image:Re.getImagePreviewData(Re.getSelectedForma())})}function jo(e){e.duplicatedImage&&Re.updateConstrainedImages(),Ho()}function Go(e){_o(),_e.posterAdornments.dismissPopUp(),e.deletedImage&&Re.updateConstrainedImages()}function Ho(){_o()}function _o(){_e.tabButtonTheme&&_e.tabButtonTheme.isSelected()&&Ot()}function Ko(e){var t;Re.isMultiSelect()?(t=Re.getSettableFeatures(),_e.sidebarMultiselect.update({attributes:t}),_e.multiselectTabsWrapper.isActive()||_e.tabButtonMultiselect.select()):Re.isGroupSelect()?function(){var e=Re.getSettableFeatures();_e.sidebarGroup.update({attributes:e}),_e.groupTabsWrapper.isActive()||_e.tabButtonGroup.select()}():function(e){_e.downloadButton&&_e.downloadButton.el.hideDownloadList();_e.sharePostButton&&_e.sharePostButton.el.hideMenuDropdown();Array.isArray(e.forma)&&(e.forma=e.forma[0]);if(_e.changeImageModalPanel.hide(),_e.changeIconModalPanel.hide(),e.forma){if("Root"===e.forma.kind)_e.tabButtonBackgroundImage.hide(),_e.tabButtonBackgroundLooks.hide(),_e.tabButtonBackgroundColor.isHidden()&&_e.tabButtonBackgroundColor.show(),_e.tabButtonBackgroundColor.isSelected()||_e.tabButtonBackgroundColor.select();else if(e.forma.isTypeLockup())p.publish("editor:textSelected"),_e.textTabsWrapper.isActive()||_e.tabButtonTextType.select();else if(e.forma.isLogo())_e.logoTabsWrapper.isActive()||_e.tabButtonLogo.select();else if(Re.isIcon(e.forma))_e.iconTabsWrapper.isActive()||_e.tabButtonIcon.select(),_e.tabButtonIconColor.show({silent:!0,preventSelection:!0});else if(e.forma.isImage()){_e.tabButtonBackgroundImage.isHidden()&&_e.tabButtonBackgroundImage.show({silent:!0,preventSelection:!0});var t=e.forma.isVideo();t&&_e.tabButtonBackgroundLooks.hide(),_e.tabButtonBackgroundLooks.isHidden()&&!t&&(_e.tabButtonBackgroundColor.hide(),_e.tabButtonBackgroundLooks.show({silent:!0,preventSelection:!0}),_e.tabButtonBackgroundColor.show({silent:!0,preventSelection:!0}));var o=e.forma.controller,n=o.kind===oe.FrameController.KIND&&o.isBackgroundImageWithAlpha();if(Re.inCropMode())return;_e.backgroundTabsWrapper.isActive()&&(n||_e.tabButtonBackgroundImage.isSelected()||_e.tabButtonBackgroundLooks.isSelected())||_e.tabButtonBackgroundImage.select(),e.forma.controller.moveable&&_e.tabButtonBackgroundColor.hide()}else e.forma.isGridCell()&&(_e.tabButtonBackgroundLooks.hide(),_e.tabButtonBackgroundColor.isHidden()&&_e.tabButtonBackgroundColor.show({silent:!0,preventSelection:!1}),_e.tabButtonBackgroundColor.isSelected()||_e.tabButtonBackgroundColor.select());(e.forma.isBackgroundImage()||e.forma.isGridCell())&&(_e.tabButtonBackgroundColor.isHidden()&&_e.tabButtonBackgroundColor.show({silent:!0,preventSelection:!0}),e.forma.controller.moveable?_e.tabButtonBackgroundImage.hide():_e.tabButtonBackgroundImage.isHidden()&&_e.tabButtonBackgroundImage.show({silent:!0,preventSelection:!0}))}else oa()}(e)}function Vo(){if(!Re.isMultiSelect()){var e=Re.getSelectedForma();e&&(e.isTypeLockup()?ao():(e.isImage()&&!e.isLogo()||Re.isIcon(e))&&xo())}}function $o(e){let{backgroundColor:t}=e;_e.errorDialogs.imageCorruptedModal||(_e.errorDialogs.imageCorruptedModal=new M({headerText:'\n            <span class="error-modal-header">\n              <span>i18n.dialogs.corruptedDocument.kHeaderText</span>\n              <i class="error-modal-header__icon"></i>\n            </span>\n          ',contentText:'<div class="error-modal-content">\n                <span>i18n.dialogs.corruptedDocument.kContentText</span>\n                <span class="error-modal-content_placeholder-indicator" style="background-color: #'.concat(t,';"></span>\n              </div>'),dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.corruptedDocument.kButtonLabel",onClick:function(){_e.errorDialogs.imageCorruptedModal.hide()}}]})),_e.errorDialogs.imageCorruptedModal.show()}function Xo(){if(_e.sidebarLayout){var e=_e.sidebarResize.getSelected(),t=Re.getDocumentSize(),o=Re.getImageSizeIfFullBleed(),n=o&&o.width&&o.height&&Math.atan(o.height/o.width)*(4/Math.PI),a=t&&t.width&&t.height&&Math.atan(t.height/t.width)*(4/Math.PI),r=Math.abs(n-a)<=.01;e&&e.item&&"original"===e.item.data.aspect&&!r&&_e.sidebarResize.deselectSelected()}}function Yo(){var e=v.toLocaleKey(Re.getUndoDescription());e?(_e.undo.update({hoverLabel:"i18n.app.kActionLabel",context:{"action-type":"i18n.app.kUndo","action-name":"i18n.actions."+e}}),_e.undo.enable()):(_e.undo.update({hoverLabel:"i18n.app.kUndo"}),_e.undo.disable());var t=v.toLocaleKey(Re.getRedoDescription());t?(_e.redo.update({hoverLabel:"i18n.app.kActionLabel",context:{"action-type":"i18n.app.kRedo","action-name":"i18n.actions."+t}}),_e.redo.enable()):(_e.redo.update({hoverLabel:"i18n.app.kRedo"}),_e.redo.disable());const o=Re.getWatermarkEnabledForDoc();je!==o&&(_e.poster.setWatermark(o),Gt(o))}function Qo(){Jo(),Re.updateConstrainedImages(),Re.validateDoc("undo")}function qo(){Jo(),Re.updateConstrainedImages(),Re.validateDoc("redo")}function Jo(){_e.sidebarBackground&&!_e.sidebarBackground.isHidden()&&_e.sidebarBackground.selectCurrentColor({silent:!0}),_e.sidebarIcon&&!_e.sidebarIcon.isHidden()&&_e.sidebarIcon.selectCurrentColor({silent:!0}),_e.sidebarText&&!_e.sidebarText.isHidden()&&_e.sidebarText.selectCurrentColor({silent:!0}),_e.sidebarPalette&&!_e.sidebarPalette.isHidden()&&_e.sidebarPalette.selectCurrentPalette({silent:!0})}function Zo(){Re.deselect()}function en(){_e.addTextSidebar.hide()}function tn(){cn()}function on(){_e.undo.show(),_e.redo.show(),_e.sidebarCrop.hide()}function nn(){cn()}function an(){Re.ensureLockupSelected(),cn()}function rn(){ua(re.currentBrandElements()),cn()}function sn(){cn()}function ln(){cn()}function dn(){cn()}function cn(){_e.tabButtonPalette.isSelected()&&_e.sidebarPalette.unbindColorPicker(),_e.sidebarTemplates&&!_e.sidebarTemplates.isHidden()&&_e.sidebarTemplates.switchedToLocalTabSet()}function pn(e){e=e||{},_e.sidebarLayout.isHidden()&&Re.disableAutomaticLayoutMode(),e.component&&(ct=e.component,_e.brandIndicator&&(ct===_e.sidebarTemplates?(_e.brandIndicator.hide(),_e.postControlStrip.update({panels:[{id:"PostBrandIndicatorContainer",size:"0px"},{id:"PostSidebar",size:"auto"}]})):(_e.brandIndicator.show(),_e.postControlStrip.update({panels:[{id:"PostBrandIndicatorContainer",size:"50px"},{id:"PostSidebar",size:"auto"}]}))))}function un(){pn({component:_e.sidebarLayout}),"layout"!==_e.sidebarGlobal.activeSidebarId()&&(_e.sidebarGlobal.showSidebarWithId("layout"),p.publish("editor:layoutPressed"))}function gn(){return p.publish("editor:resizePressed"),ke.run("PostResize").catch(e=>{Oe.error("Ran into error with PostResize experiment",e)}).done(),!ut.featureEnabled("post-resize-is-paid-feature")||gt.tryPremiumFeature({$element:_e.tabButtonResize.$el,position:"left",touchpointName:"postResizeButton"})}function mn(){pn({component:_e.sidebarResize}),"resize"!==_e.sidebarGlobal.activeSidebarId()&&(_e.sidebarGlobal.showSidebarWithId("resize"),p.publish("layoutResizeDisplayed"))}function bn(){pn({component:_e.sidebarTemplates}),"templates"!==_e.sidebarGlobal.activeSidebarId()&&_e.sidebarGlobal.showSidebarWithId("templates")}function hn(){pn({component:_e.sidebarTheme}),"theme"!==_e.sidebarGlobal.activeSidebarId()&&(_e.sidebarGlobal.showSidebarWithId("theme"),_e.sidebarTheme.setDefaultSelection(),Ot(),p.publish("editor:designFilterPressed"))}function fn(){pn({component:_e.sidebarPalette}),"palette"!==_e.sidebarGlobal.activeSidebarId()&&(_e.sidebarGlobal.showSidebarWithId("palette"),Ut({updateSelection:!0}),p.publish("editor:colorPressed"),Re.triggerEnteredPalette())}function wn(e){var t=(e=e||{}).tabId||"type";switch(_e.sidebarText.showSidebarWithId(t),pn({component:_e.sidebarText}),_e.posterAdornments.handleTextTabSelected(),p.publish("textSidebarDisplayed"),p.publish("text"+t.toLowerCase()+"SidebarDisplayed"),t){case"type":p.publish("textSidebarDisplayed:type");break;case"color":p.publish("textSidebarDisplayed:color");break;case"shape":p.publish("textSidebarDisplayed:shape");break;case"style":p.publish("textSidebarDisplayed:style");break;case"effects":p.publish("textSidebarDisplayed:effects")}}function vn(e){var t=(e=e||{}).tabId||"color";_e.sidebarBackground.isHiding()&&null==e.reselectWhenHiding?n.delay((function(){e.reselectWhenHiding=!0,vn(e)}),200):(_e.sidebarBackground.showSidebarWithId(e.tabId),pn({component:_e.sidebarBackground}),p.publish("photoSidebarDisplayed"),"image"===t?p.publish("backgroundSidebarDisplayed:image"):"color"===t?p.publish("backgroundSidebarDisplayed:color"):"looks"===t&&p.publish("backgroundSidebarDisplayed:looks"))}function kn(){pn({component:_e.sidebarLogo}),_e.sidebarLogo.show(),p.publish("logoSidebarDisplayed")}function Tn(e){var t=(e=e||{}).tabId||"icon";_e.sidebarIcon.showSidebarWithId(e.tabId),pn({component:_e.sidebarIcon}),"icon"===t?p.publish("iconSidebarDisplayed:icon"):"color"===t&&p.publish("iconSidebarDisplayed:color")}var In=[],Pn=!1;function Cn(){return e.each(In,(function(e,t){t&&t.abort()})),"If you leave now, the latest changes to your Post design will not be saved."}function Sn(){e(window).on("beforeunload",Cn)}function Bn(){e(window).off("beforeunload",Cn)}function xn(e,t,o){In.push(t)}function yn(t,o,n){var a=e.inArray(o,In);In.splice(a,1)}function Dn(e){En(e,zn,!0)}function An(e){var t,o=Kn(e.info);lt&&(t=Re.getSelectedForma()),Re.createFormaFromSVG(e.files[0],o,t),p.publish("addedIconToProject:icon")}function Ln(){return!ut.featureEnabled("post-pgm-poster")||!ut.featureEnabled("post-enable-image-frames")}function En(t,o){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(lt||Re.canAddMoreImages(1)){o=o||Un;var a=Re.getSelectedForma();if((lt||null!=a&&a.isShape())&&(t.replacementForma=a,_e.posterAdornments.showImageMenu(),t.replacementForma&&("Root"===t.replacementForma.kind?t.replacementForma=null:t.replacementFrame=t.replacementForma.finalFrame)),n&&(t.floatingImageStrategy=oe.FloatingImageStrategy.IfHasAlphaOrIsLogo),n||null!=t.replacementForma)Fn(t,o);else{p.publish("editor:addImagePressed",{contextualData1:"numImages:1",contextualData2:"actionType:success"});var r=Re.backgroundImageFormas().length>0?"kChoosePhotoAddToCollageButtonLabel":"kChoosePhotoPinToBackgroundButtonLabel";if(Ln())return t.floatingImageStrategy=oe.FloatingImageStrategy.IfHasAlphaOrIsLogo,void Fn(t,o);var i=new M({id:"PostImageLayerPicker",headerText:"i18n.dialogs.choosePhotoLayer.kHeaderText",contentText:'<div class="image-layer-picker-visualization">\n           <span class="background-layer-visualization"></span>\n           <span class="foreground-layer-visualization"></span>\n           </div>',dismissable:!1,addButtonParent:!0,onShow:function(){e(".background-layer-visualization").click((function(){Wn(t,o,i)})),e(".foreground-layer-visualization").click((function(){Mn(t,o,i)}))},onHide:function(){e(".background-layer-visualization").off("click",Wn),e(".foreground-layer-visualization").off("click",Mn)},buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.choosePhotoLayer.kChoosePhotoMoveFreelyButtonLabel",onClick:function(){Mn(t,o,i)}},{class:"pill pill-primary-on-light",label:"i18n.dialogs.choosePhotoLayer."+r,onClick:function(){Wn(t,o,i)}}]})}}else Co()}function Mn(e,t,o){p.publish("editor:imageLayerPressed",{contextualData1:"imageLayer:floating"}),e.floatingImageStrategy=oe.FloatingImageStrategy.Always,Fn(e,t),o.hide()}function Wn(e,t,o){p.publish("editor:imageLayerPressed",{contextualData1:"imageLayer:background"}),e.floatingImageStrategy=oe.FloatingImageStrategy.Never,Fn(e,t),o.hide()}function Fn(e,o){var n=t.defer();o(e,n),n.promise.done()}var Nn=1600;function Rn(e){p.publish("brandKitLogoApplied"),_e.poster&&_e.poster.events.publish("image-loading-begin"),p.publish("editor:logoAdded"),Re.addLogo(e).then((function(){_e.poster&&_e.poster.events.publish("image-loading-end")}))}function zn(e,o){_e.poster&&_e.poster.events.publish("image-loading-begin");var n,a,r=e.files[0];return(n=r,a=URL.createObjectURL(n),g.load(a).then((function(e){return Gn(e)}))).then(e=>{var n=t.defer();if(e.width<180||e.height<180)var a=new M({headerText:"i18n.panels.addNewLogo.kSizeWarningHeader",contentText:"i18n.panels.addNewLogo.kSizeWarningContent",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"i18n.components.buttons.kContinue",onClick:function(){a.hide(),n.resolve(e)}},{class:"pill pill-secondary-on-light",label:"i18n.common.kCancel",onClick:function(){_e.poster&&_e.poster.events.publish("image-loading-end"),a.hide(),n.reject(),o.resolve()}}]});else n.resolve(e);return n.promise}).then(o=>{var n=o.getContext("2d");return e.hasAlpha=Hn(n,o.width,o.height),e.hasAlpha?(_n(o),jn(o)):t.resolve(r)}).then(o=>{if(e.processedImgData=o,!ut.featureEnabled("entitle-brand-kit")||"brandkit"===e.source)return t.resolve(o);var n=re.currentBrandElements(),a=!n||!n.logos||n.logos.length<1;return re.addLogoToCurrentBrand(o,a)}).then(t=>(e.isLogo=!0,t&&(fa(!0),e.sparkElementId=t.getValue("id"),e.sparkRoles=t.getValue("ac#roles")),Un(e,o))).catch(e=>t.resolve())}function On(e){var t={files:[{source:"adobestock",mimeType:e.newItemInfo.mimeType,original:{link:e.newItemInfo.href,height:e.newItemInfo.height,width:e.newItemInfo.width},preview:{link:e.newItemInfo.href,height:e.newItemInfo.height,width:e.newItemInfo.width},thumbnail:{link:e.newItemInfo.thumb.url,height:e.newItemInfo.thumb.height,width:e.newItemInfo.thumb.width},licenseInfo:e.newItemInfo.info}],info:e.newItemInfo.info};lt=!0,En(t,Un)}function Un(o,a,r,i,s){a=a||t.defer(),r=r||t.defer(),i=i||!1,s=s||!1,Re.validateDoc("addImageBegin"),Pn||(Pn=!0,e(document).on("ajaxSend",xn),e(document).on("ajaxComplete",yn));var l=Date.now();Xe.promise.isFulfilled()&&(Xe=t.defer()),Sn();var c=o.processedImgData||o.files[0],u=c.type||c.mimeType||"image/jpeg";"dooplo"===c.source&&c.preview.link.indexOf(".png")>-1&&"image/png"!==u&&(u="image/png");var m,b,h,f,w,v,k,T=Kn(o.info),I=c instanceof Blob,P="Adobe Stock"===T.sourceName,C="google drive"===c.source,S=null,B=o.isLogo;return _e.poster&&_e.poster.events.publish("image-loading-begin"),t().then((function(){if(I||P||C)return t.resolve();var e=c.thumbnail||c.small||c.preview,o="/api/post/v1/proxy?url="+encodeURIComponent(e.link);return["dropbox","cc","lightroom","ccl"].indexOf(c.source)>-1&&(o=e.link),g.load(o)})).then((function(e){if(I||P||C)return t.resolve();var n=Gn(e),a=n.getContext("2d");if(S=Hn(a,n.width,n.height)){if(lt)return t.resolve();_n(n)}return m=n.toDataURL(),Re.addOrReplaceImage({id:null,imageId:null,metadata:T,isLowResImage:!0,isNewPostImage:i,url:m,width:n.width,height:n.height,mimeType:u,replacementForma:o.replacementForma,replacementFrame:o.replacementFrame,sparkRoles:o.sparkRoles,sparkElementId:o.sparkElementId,hasAlpha:S,forceReplacement:lt,floatingImageStrategy:o.floatingImageStrategy})})).then((function(e){return v=e&&e.formaId,k=e&&e.contentNodeId,I||P||C||lt&&S||!_e.poster?e:(r.resolve(),n.delay((function(){_e.poster&&_e.poster.events.publish("image-loading-end")}),350),e)})).then((function(e){if(e=e||{},_e.savingIndicator&&_e.savingIndicator.show(),c instanceof Blob)return Re.saveImageComponent(c,u);var t=function(e,t){if(e instanceof Blob)return e;var o=e.source,n=e.original.link,a=e.original.width,r=e.original.height;if("dooplo"===e.source&&e.original.width&&e.original.height&&e.original.width*e.original.height>Nn*Nn){var i=t._links.rendition.filter((function(e){return!!(e.href&&e.width&&e.height)&&e.width*e.height<Nn*Nn}));i.sort((function(e,t){return e.width<t.width?-1:e.width>t.width?1:0}));var s=i.pop();s&&(o="dooplocdn",n=s.href,a=s.width,r=s.height)}return o||Oe.error("getBestRenditionForImageSaving source is falsy, imgData is ",e),{source:o,assetId:n,width:a,height:r}}(c,o.info);return f=t.width,w=t.height,d(Re.saveImageComponent,{maxAttempts:3})({source:t.source,assetId:t.assetId},u,null,e.contentNodeId,e.contentNodeId)})).then((function(e){return c instanceof Blob?g.loadImageFromBlob(c).then((function(t){return f=t.width,w=t.height,e})).catch((function(){return t.reject()})):e})).then((function(e){return b=e,h=Ee.decodeUrl(b.encodedUrl),g.load(h)})).then((function(e){var t;return null===S&&(t=Gn(e),S=Hn(t.getContext("2d"),t.width,t.height)),f=e.width,w=e.height,S&&!B?(t||(t=Gn(e)),_n(t),f=t.width,w=t.height,jn(t)):e})).then((function(e){return!S||B?e:(_e.savingIndicator&&_e.savingIndicator.show(),Re.saveImageComponent(e,u))})).then((function(e){return!S||B?e:(b=e,h=Ee.decodeUrl(b.encodedUrl),g.load(h))})).then((function(e){if(B){var t={url:b.encodedUrl,pixelWidth:e.width,pixelHeight:e.height,mimeType:u,acRoles:o.sparkRoles,id:o.sparkElementId,componentId:b.component.id};return p.publish("editor:logoAdded"),Re.addLogo(t)}var n={id:b.component.id,imageId:null,metadata:T,isLowResImage:!1,isNewPostImage:i,url:b.encodedUrl,width:f||e.width,height:w||e.height,mimeType:u,replacementForma:o.replacementForma,replacementFrame:o.replacementFrame,lowResImageUrl:m,hasAlpha:S,forceReplacement:lt,contentNodeId:k,floatingImageStrategy:o.floatingImageStrategy};return m?Re.replaceImageWithHighRes(n):Re.addOrReplaceImage(n)})).then((function(e){return e&&e.formaId&&(v=e.formaId),r.resolve()})).then((function(){Re.updateConstrainedImages();var e=Date.now()-l;return p.publish("post:addImageEnd",{contextualData1:"timeElapsedMs:"+e,contextualData2:"imageSource:"+c.source}),Xe.promise})).then((function(){Pn=!1,e(document).off("ajaxSend",xn),e(document).off("ajaxComplete",yn),In=[],Re.validateDoc("addImageSuccess"),a&&a.resolve(),(I||lt&&S)&&n.delay((function(){_e.poster&&_e.poster.events.publish("image-loading-end")}),350)})).catch((function(e){if(e instanceof Re.ActionError&&Re.shouldReloadOnActionFailure())return Oe.error("doAction",e.message),void ta();var t;if(o.replacementForma||o.replacementFrame?(Oe.error("failed to replace image",e),Re.cleanupInvalidImageWithColorSync(v,k,[]),t="i18n.dialogs.addOrReplaceImageFailed.kContentTextReplace"):(Oe.error("failed to add image",e),Re.cleanupInvalidImageSync(v,k),t="i18n.dialogs.addOrReplaceImageFailed.kContentText"),!s)var n=new M({headerText:"i18n.dialogs.addOrReplaceImageFailed.kHeaderText",contentText:t,dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.addOrReplaceImageFailed.kOK",onClick:function(){n.hide()}}]});_e.poster&&_e.poster.events.publish("image-loading-end"),Re.updateConstrainedImages(),Re.validateDoc("addImageFail"),a.reject(),r.reject()})).done(),r.promise}function jn(e,o){var n=t.defer();return e.toBlob?e.toBlob((function(e){n.resolve(e)}),o):n.resolve(e.msToBlob()),n.promise}function Gn(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t}function Hn(e,t,o){for(var n=e.getImageData(0,0,t,o).data,a=3,r=n.length;a<r;a+=4)if(0===n[a])return!0;return!1}function _n(e){for(var t,o=e.width,n=e.height,a=o,r=n,i=0,s=0,l=e.getContext("2d"),d=l.getImageData(0,0,o,n),c=0;c<n;c++)for(var p=0;p<o;p++)t=4*(c*o+p),d.data[t+3]>0&&(p<a?a=p:p>i&&(i=p),c<r?r=c:c>s&&(s=c));var u=i-a+1,g=s-r+1,m=l.getImageData(a,r,u,g);return e.width=u,e.height=g,l.putImageData(m,0,0),e}function Kn(e,t){var o={};if(e){var n="unknown",a="unknown",r={};const t={STOCK:"Adobe Stock",UNSPLASH:"Unsplash",PIXABAY:"pixabay",NOUN:"The Noun Project",CCL:"Creative Cloud Libraries"};e.source&&e.source.name&&(e.source.name===t.STOCK?n="adobestock":e.source.name===t.UNSPLASH||e.source.name===t.PIXABAY||e.source.name===t.NOUN?n="dooplo":e.source.name===t.CCL&&(n="ccl"),a=e.source.name===t.NOUN?e.id:e.source.name===t.CCL?e.assetID:e.image_id?e.image_id.toString():e.id||"unknown",e.source.name===t.CCL&&(r.ccl={created_date:e.created_date,modified_date:e.modified_date,library_id:e.albumId,library_name:e.albumName})),o={source:n,search:e.searchText,rootProperties:i({license:{asset_id:a,owner:e.owner?e.owner.name:"unknown",photo_name:e.title,source_name:e.source?e.source.name:"unknown",source_url:e.context?e.context.href:"unknown",tags:e.tags instanceof Array?e.tags.join(","):"",type:e.license?e.license.short_name:"unknown"}},r)}}var s=oe.MediaMetadata.fromProperties(o);return t&&(s.designIntent=oe.MediaMetadata.DESIGNINTENT_LOGO),s}function Vn(e){e&&e.id&&0===e.id.indexOf("bk_")&&p.publish("usedBrandKitPalette"),p.publish("paletteSelected")}const $n=function(){let e,o,n,a=!1,r=!1;return function(){var i,l;if(!it)return Xe.promise.isPending()||(Xe=t.defer()),Re.validateDoc("saveBegin"),i=s.currentDoc.getDataFromRoot("cp#isExported"),"boolean"==typeof(l=Re.getIsExported())&&l!==i&&Re.setIsExported(i),Re.postDocumentHasHighResImageSaveableState().then(i=>{if(_e.savingIndicator&&_e.savingIndicator.show(),a)return o||(o=t.defer()),r=!0,o.promise;a=!0,n=Date.now(),p.publish("saveDocumentBegin"),s.currentDoc&&window.marvel.logger.beginTrackingFlow("saveProjectFromEditor",{sparkFormat:"post",projectId:s.currentDoc.id}),e||(e=t.defer());const l=Re.imageFormas();for(let e=0;e<l.length;e++){const t=l[e];null==t.contentNode?Oe.error("saving image with no contentNode"):null==t.contentNode.url&&Oe.error("saving image with no url")}Sn();let d,c,u;u="edit-template"===tt.operation||"new-template-from-template"===tt.operation||ut.featureEnabled("post-preview-image-disabled2")?t():_e.poster.getRendition({width:1200,imageQuality:.94}),u.then(e=>(d=e,_e.poster.getRendition({width:500,imageQuality:.94}))).then(e=>(c=e,Qe===pt.TEMPLATE&&re.currentBrandKit()&&et?ie.setUsedBrandElementsData(re.currentBrandKit(),et,Re,!1):t.resolve(null))).then(()=>Re.saveWithRenditions(d,c,i)).then(()=>{if(_e.docNameInput){const e=_e.docNameInput.getText();s.currentDoc.setProjectName(e)}e.resolve();const t=Date.now()-n;d?p.publish("saveDocumentEnd",{saveTimeElapsedMs:t,docId:s.currentDoc.id,previewImageSize:d.size}):p.publish("saveDocumentEnd",{saveTimeElapsedMs:t,docId:s.currentDoc.id}),a=!1,s.currentDoc&&window.marvel.logger.endTrackingFlow("saveProjectFromEditor"),Re.validateDoc("saveSuccess"),r&&Re.canSave()?(r=!1,e=o,$n()):(_e.savingIndicator&&_e.savingIndicator.hide(),e=null,Bn(),Xe.resolve()),o=null},o=>{a=!1,e.reject(o),_e.savingIndicator&&_e.savingIndicator.hide(),Oe.error("Failed to save Post project",o),Re.validateDoc("saveFail"),e=null,Bn(),Xe.reject(o),function(e){function o(){window.location.pathname.includes("/design/post/")||window.location.reload()}if("UPDATE_CONFLICT"===e.code)var n=new M({headerText:"i18n.dialogs.saveFailedMergeConflict.kHeaderText",contentText:"i18n.dialogs.saveFailedMergeConflict.kContentText",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.saveFailedMergeConflict.kRefresh",onClick:function(){n.hide(),(Xe=t.defer()).resolve(),window.location.reload()}}]});else var a=new M({headerText:"i18n.dialogs.saveFailed.kHeaderText",contentText:"i18n.dialogs.saveFailed.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.saveFailed.kRefresh",onClick:function(){a.hide(),(Xe=t.defer()).resolve(),window.location.reload()}},{class:"pill pill-secondary-on-light",label:"i18n.dialogs.saveFailed.kTryAgain",onClick:function(){a.hide(),$n(),za().done(o)}}]})}(o)})}).done(),e;st=!0}}();var Xn=n.debounce($n,4e3);function Yn(){it=!0}function Qn(){it=!1,st&&(qn(),st=!1)}function qn(){Xe.promise.isFulfilled()&&(Sn(),Xe=t.defer()),Xn()}function Jn(){return Xn&&Xn.cancel(),$n(),ut.featureEnabled("spark-home-enabled")?(vt=!0,La()):Xe.promise}function Zn(e,t,o){Ke.push(e.events.subscribe(t,o))}function ea(e,t){var o=_e.poster.$el.offset(),n=_e.poster.getViewScale(),a=_e.poster.getWidth(),r=_e.poster.getHeight(),i=e.pageX-o.left,s=e.pageY-o.top;i>0&&i<a&&s>0&&s<r?_e.poster.getColorAtPoint({x:Math.round(i/n),y:Math.round(s/n)}).then((function(o){var n=de.rgb2hex(o);"click"===e.type?t.handleEyeDropperClicked(n):t.handleEyeDropperMoved(n,e)})):"click"===e.type?t.handleEyeDropperClicked(!1):t.handleEyeDropperMoved(!1,e)}function ta(e){const t=new M({headerText:"i18n.dialogs.mustReloadEditor.kHeaderText",contentText:e||"i18n.dialogs.mustReloadEditor.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.mustReloadEditor.kRefresh",onClick:function(){t.hide(),window.location.reload()}}]});t.show()}function oa(e){(e=e||{}).silent="boolean"==typeof e.silent&&e.silent,_e.posterAdornments&&_e.posterAdornments.dismissPopUp(),_e.globalTabsWrapper&&!_e.globalTabsWrapper.isActive()&&(_e.textTabsWrapper.hide(),_e.backgroundTabsWrapper.hide(),_e.logoTabsWrapper.hide(),_e.globalTabsWrapper.show()),_e.tabButtonLayout&&_e.tabButtonLayout.isSelected()&&_e.sidebarLayout.returnFromSelectionState(),_e.tabButtonPalette&&_e.tabButtonPalette.isSelected()&&_e.sidebarPalette.rebindColorPicker(),_e.sidebarTemplates&&!_e.sidebarTemplates.isHidden()&&(_e.sidebarTemplates.returnedToGlobalSidebarState(),_e.brandIndicator&&(_e.brandIndicator.hide(),_e.postControlStrip.update({panels:[{id:"PostBrandIndicatorContainer",size:"0px"},{id:"PostSidebar",size:"auto"}]})))}function na(){const e=Re.getRootForma().page;return{sizeID:e.sizeID,pageSize:e.pageSize,exportData:e.exportData}}function aa(){let e=!0;if(!s.currentDoc.belongsToUser()){const t=re.currentBrandKit();t&&!1!==re.currentBrandElements().showBrandInUI&&t.getLogosSync().length||(e=!1)}e?_e.addContentLogoButton.enable():_e.addContentLogoButton.disable()}async function ra(e){(p.publish("showEditor"),He&&Qe===qe||await Et().catch(Oe.error),_e.addContentLogoButton&&aa(),Zn(Re,"save-requested",qn),Zn(Re,"design-updated",Ro),Zn(Re,"forma-updated",Uo),Zn(Re,"formae-duplicated",jo),Zn(Re,"formae-deleted",Go),Zn(Re,"forma-added",Ho),Zn(Re,"forma-selected",Ko),Zn(Re,"filter-applied",_e.sidebarBackground.updateFilters),Zn(Re,"undo-redo-state-changed",Yo),Zn(Re,"undo-finished",Qo),Zn(Re,"redo-finished",qo),Zn(Re,"forma-drag-start",Yn),Zn(Re,"forma-drag-end",Qn),Zn(Re,"layer-double-tapped",Vo),Zn(Re,"show-image-forma-corrupted-modal",$o),Zn(Re,"current-brand-changed",va),Zn(Re,"exit-crop-mode",uo),Zn(Re,"enter-char-style-mode",oo),Zn(Re,"exit-char-style-mode",no),Zn(Re,"force-reload-editor",ta),Zn(_e.posterAdornments,"buttonpress-style",_e.tabButtonTextType.select),Zn(_e.posterAdornments,"buttonpress-edit",ao),Zn(_e.posterAdornments,"buttonpress-duplicate",io),Zn(_e.posterAdornments,"buttonpress-delete",bo),Zn(_e.posterAdornments,"buttonpress-group",ho),Zn(_e.posterAdornments,"buttonpress-ungroup",fo),Zn(_e.posterAdornments,"buttonpress-addText",ro),Zn(_e.posterAdornments,"buttonpress-change-photo",xo),Zn(_e.posterAdornments,"buttonpress-logo",Lo),Zn(_e.posterAdornments,"create-swap-thumbnail",vo),Zn(_e.posterAdornments,"remove-swap-thumbnail",ko),Zn(_e.posterAdornments,"handle-drag",Po),Zn(_e.posterAdornments,"create-swap-forma-overlay",To),Zn(_e.posterAdornments,"remove-swap-forma-overlay",Io),Zn(_e.posterAdornments,"stock-image-licensed",On),Zn(_e.posterAdornments,"post-interaction-layer-clicked",(function(){_e.docNameInput.$el.is(":focus")&&_e.docNameInput.blur(),_e.downloadButton&&_e.downloadButton.el.hideDownloadList(),_e.sharePostButton&&_e.sharePostButton.el.hideMenuDropdown(),Dt&&At()})),Zn(_e.sidebarText,"buttonpress-edit",ao),Zn(_e.sidebarText,"buttonpress-delete",bo),Zn(_e.sidebarText,"buttonpress-addText",ro),Zn(_e.sidebarText,"get-new-brandkit-colors",ma),Zn(_e.sidebarText,"eyedropper-changed",(function(e){ea(e,_e.sidebarText)})),Zn(_e.sidebarText,"buttonpress-close",oa),Zn(_e.sidebarText,"size-slide-start",_e.posterAdornments.hideSelectionBox),Zn(_e.sidebarText,"size-slide-end",_e.posterAdornments.showSelectionBox),Zn(_e.poster,"rendered-image-layer-url-changed",Xo),Zn(_e.poster,"watermark-footprint-changed",(function(e){_e.watermarkButton.update({height:e.height+"%",width:e.width+"%"}),sa(),la()})),Zn(_e.sidebarTheme,"item-selected",zo),Zn(_e.sidebarTheme,"brand-button-pressed",ca),Zn(_e.sidebarBackground,"buttonpress-change-photo",xo),Zn(_e.sidebarBackground,"buttonpress-add-photo",Bo),Zn(_e.sidebarBackground,"filter-selected",(function(e,t,o){Re.setImageFilterForSelection(e,t,o).done()})),Zn(_e.sidebarBackground,"bg-color-selected",(function(e){Re.setColorForSelection(e).done()})),Zn(_e.sidebarBackground,"image-forma-replace-with-color",Re.updateConstrainedImages),Zn(_e.sidebarBackground,"eyedropper-changed",(function(e){ea(e,_e.sidebarBackground)})),Zn(_e.sidebarBackground,"buttonpress-close",oa),Zn(_e.sidebarBackground,"buttonpress-set-foreground",go),Zn(_e.sidebarBackground,"buttonpress-set-background",mo),Zn(_e.sidebarBackground,"buttonpress-crop",so),Zn(_e.sidebarLayout,"grid-item-selected",Mo),Zn(_e.sidebarResize,"size-item-selected",Fo),Zn(_e.sidebarPalette,"item-selected",No),Zn(_e.sidebarPalette,"item-selected",Vn),Zn(_e.sidebarPalette,"eyedropper-changed",(function(e){ea(e,_e.sidebarPalette)})),Zn(_e.sidebarPalette,"update-palette-color",(function(e,t){Re.updateColorInTheme(e,t).done()})),Zn(_e.sidebarLogo,"item-selected",Rn),Zn(_e.sidebarLogo,"buttonpress-uploadNewLogo",Eo),Zn(_e.sidebarLogo,"logo-uploaded",Dn),Zn(_e.sidebarLogo,"buttonpress-closeLogoPanel",oa),Zn(_e.sidebarIcon,"buttonpress-replace-icon",xo),Zn(_e.sidebarIcon,"icon-color-selected",(function(e,t){Re.setColorForSelection(e,t).done()})),Zn(_e.sidebarIcon,"hide-icon-picker",(function(){_e.changeIconModalPanel.hide()})),Zn(_e.sidebarIcon,"eyedropper-changed",(function(e){ea(e,_e.sidebarIcon)})),Zn(_e.iconPicker,"item-selected",An),Zn(_e.iconPicker,"hide",(function(){_e.changeIconModalPanel.hide()})),Zn(_e.addTextSidebar,"badge-selected",Oo),Zn(_e.addTextSidebar,"buttonpress-addTextPanel",oa),Zn(_e.sidebarCrop,"crop-shape-selected",co),Zn(_e.sidebarCrop,"crop-aspect-ratio-selected",lo),Zn(_e.sidebarCrop,"close-crop-picker",po),Zn(_e.imagePicker,"item-selected",En),Zn(_e.imagePicker,"hide",(function(){_e.changeImageModalPanel.hide()})),Zn(_e.sidebarBackground,"hide-image-picker",(function(){_e.changeImageModalPanel.hide()})),Zn(_e.colorPicker,"brand-color-added",ma),Zn(_e.colorPicker,"colorChangeModal",(function(e){"begin"===e.type?Re.beginBranch():"confirm"!==e.type&&"cancel"!==e.type||Re.endBranch("confirm"===e.type)})),_e.brandIndicator&&Zn(_e.brandIndicator,"switch-brand",Bt),ut.featureEnabled("entitle-brand-kit")&&!ut.featureEnabled("hide-premium-font-onboarding")&&(_e.tabButtonTextType.$el.addClass("premium-highlight-badge"),_e.sidebarText.events.subscribe("font-picker-opened",(function(){_e.tabButtonTextType.$el.removeClass("premium-highlight-badge")}))),_e.imagePicker&&_e.imagePicker.home(),Qe===pt.TEMPLATE?_e.topColorStrip.$el.css({background:"#ffffff"}):_e.topColorStrip.$el.css({background:"#10c459"}),_e.collabStatusButton)&&Ct(s.currentDoc.getCollaboration()&&"NONE"!==s.currentDoc.getCollaboration());!function(){const e=Re.getRootForma(),t=e.filterWithCallback(e=>e.isSticker()),o=e.filterWithCallback(e=>!!e.animation),n=e.filterWithCallback(e=>e.isVideo());if(t.length>0||o.length>0||n.length>0){const e=new M({headerText:"i18n.dialogs.minisFeatureNotice.kHeaderText",contentText:"i18n.dialogs.minisFeatureNotice.kContentText",buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.minisFeatureNotice.kButtonLabel",onClick:function(){e.hide()}}]});e.show()}}(),_e.poster&&(je?(_e.poster.setWatermark(!0),p.publish("editor:watermarkShown",{payToRemove:Ge})):_e.poster.setWatermark(!1)),je?_e.watermarkButton.isHidden()&&_e.watermarkButton.show():_e.watermarkButton.hide(),Qe!==pt.TEMPLATE&&(e.showShareButton?_e.sharePostButton.show():_e.sharePostButton.hide(),e.showDownloadButton?_e.downloadButton.show():_e.downloadButton.hide()),e.showFacebookUpdateCoverButton?_e.facebookUpdateCover.show():_e.facebookUpdateCover.hide(),e.showFacebookUploadButton?_e.facebookUploadButton.show():_e.facebookUploadButton.hide(),e.showTwitterUpload?_e.twitterUpload.show():_e.twitterUpload.hide(),_e.sidebarTheme.setCoreWrapper(Re),_e.sidebarText.setCoreWrapper(Re),_e.sidebarBackground.setCoreWrapper(Re),_e.sidebarLogo.setCoreWrapper(Re),_e.sidebarIcon.setCoreWrapper(Re),_e.sidebarMultiselect.setCoreWrapper(Re),_e.sidebarGroup.setCoreWrapper(Re),_e.sidebarLayout.setCoreWrapper(Re),_e.sidebarLayout.deselectSelected(),_e.sidebarCrop.setCoreWrapper(Re),_e.sidebarResize.setCoreWrapper(Re),_e.sidebarResize.deselectSelected(),_e.debugView&&_e.debugView.setCoreWrapper(Re),_e.postEditorView.show(),_e.windowPanel.resize(),_e.sidebarTemplates&&(tt.projectContext||(tt.projectContext=s.getProjectContexts()),_e.sidebarTemplates.setupSessionData(tt,s.currentDoc,rt,nt,ut.featureEnabled("is-paid-user")),_e.sidebarTemplates.setCoreWrapper(Re));var t=Date.now(),o=_e.poster.events.subscribe("rendered",(function(){var e=Date.now()-t;p.publish("post:posterInitialRenderEnd",{contextualData1:"timeElapsedMs:"+e,contextualData2:"editorOperation:"+tt.operation,contextualData3:"numImages:"+Re.imageFormas().length}),_e.sidebarTemplates&&_e.sidebarTemplates.events.publish("poster-initial-render-end"),o.remove()}));_e.poster.update({core:Re}),Re.setViewScale(_e.poster.getViewScale()),_e.posterAdornments.setPageElement(Ne),_e.posterAdornments.setCoreWrapper(Re),_e.posterAdornments.enable(),_e.imageWrapper.update({aspect:_e.poster.getAspect()}),_e.brandIndicator&&_e.brandIndicator.update({collaborationStatus:s.currentDoc.getCollaboration()||"NONE",isEntitled:ut.featureEnabled("entitle-brand-kit"),navigateToCreateBrandMethod:xa}),_e.sidebarBackground.update();var n,a,r=_e.poster.getWatermarkFootprint();_e.watermarkButton.update({height:r.height+"%",width:r.width+"%"}),sa(),la(),Qe===pt.TEMPLATE?(_e.tabButtonResize.select(),n=ie.getTemplateName(et),a=v.translate(bt)):(e.startingMenu?"colors"===e.startingMenu?_e.tabButtonPalette.select():"layout"===e.startingMenu?_e.tabButtonLayout.select():"resize"===e.startingMenu?_e.tabButtonResize.select():"templates"===e.startingMenu?(_e.tabButtonTemplates.select(),delete e.startingMenu):_e.tabButtonTheme.select():e.showImageModalPanelOnload?(_e.tabButtonBackgroundImage.select(),_e.changeImageModalPanel.show()):"remix"===tt.operation||"new-from-template"===tt.operation?_e.tabButtonLayout.select():_e.tabButtonTheme.select(),n=s.currentDoc.getProjectName(),a=v.translate(mt)),_e.docNameInput&&((n=n||a)===a?(_e.docNameInput.$el.addClass("placeholder"),_e.docNameInput.$el.removeClass("named")):(_e.docNameInput.$el.removeClass("placeholder"),_e.docNameInput.$el.addClass("named")),_e.docNameInput.setText(n)),window.addEventListener("resize",(function(e){At(),_e.posterAdornments.handleWindowResize(),la()})),Yo()}function ia(){if(je&&_e.imageWrapper&&_e.watermarkButton){var e=_e.poster.getWatermarkFootprint();return _e.imageWrapper.getWidth()>=e.width&&_e.imageWrapper.getHeight()>=e.height}return!1}function sa(){var e=ia();je&&(e?(_e.poster.setWatermark(!0),_e.watermarkButton.show()):(_e.poster.setWatermark(!1),_e.watermarkButton.hide()))}function la(){if(je){var e=_e.poster.getWatermarkFootprint(),t=_e.imageWrapper.getHeight(),o=_e.imageWrapper.getWidth(),n=o-o*(e.width/100)/2,a=t*(1-e.height/100);_e.watermarkCoachmark&&je&&!at&&_e.watermarkCoachmark.reposition(),!at&&_e.watermarkCoachmark&&_e.watermarkButton.isHidden()&&!_e.watermarkCoachmark.isHidden()&&_e.watermarkCoachmark.hide(),_e.watermarkTooltip&&(_e.watermarkTooltip.update({left:n-41,top:a-48}),_e.watermarkButton.isHidden()&&!_e.watermarkTooltip.isHidden()&&_e.watermarkTooltip.hide())}}function da(e){const o=re.currentBrandElements();if(!o||!o.activated)return t.resolve(null);e||o.coreBrandPromise&&o.coreBrandPromise.isFulfilled()||pa(o),_e.poster&&_e.poster.events.publish("image-loading-begin");const n=e?se.getLiteCoreBrand(o):o.coreBrandPromise,a=o.belongsToUser?re.checkForRestrictedFonts():t.resolve([]);let r;return n.then(e=>(r=e,a)).then((function(e){if(e.length){const o=t.defer();return window.marvel.events.trigger("missing-brand-fonts-ux",{doc:s.currentDoc,missingFonts:e,defer:o}),o.promise.then(e=>e?t.resolve():t.reject({brandFontsVerificationFailed:!0}))}return t.resolve()})).then(()=>r?Re.brandDocument(r):t.resolve()).then(()=>{_e.poster&&_e.poster.events.publish("image-loading-end")}).catch(e=>{if(e&&e.brandFontsVerificationFailed)return t.resolve();const o=e&&e.message?": ".concat(e.message):"";return Oe.error("brandDocument error ".concat(o),e),t.resolve()})}function ca(e){const t=re.currentBrandElements();"INCOMING"!==s.currentDoc.getCollaboration()||t&&(!t||!1!==t.showBrandInUI)?t&&t.activated?(da().done(),p.publish("brandifyApplied")):window.marvel.events.trigger("spark-post-show-brandify-onboarding",{element:e.$element}):Ae.showAlert(v.translate("dialogs.brandifySharedProjectAlert.kHeaderText"),v.translate("dialogs.brandifySharedProjectAlert.kContentText"),{okText:v.translate("dialogs.brandifySharedProjectAlert.kButtonLabel")})}function pa(e){e&&e.coreBrandPromise?e.coreBrandPromise.done(()=>(oe.Host.setAuthoringContext(e.coreBrand),e.coreBrand)):oe.Host.setAuthoringContext(null)}function ua(e){_e.sidebarLogo&&(e&&e.primaryLogoPromise?_e.sidebarLogo.updateListOfBrandKitLogos(e):_e.sidebarLogo.updateListOfBrandKitLogos([]))}function ga(e){var t=e&&e.activated?e:null;_e.sidebarPalette&&_e.sidebarPalette.setListOfBrandKitPalettes(t),_e.sidebarText&&_e.sidebarText.setBrandKitColors(Re.getBrandKitColorsPalettesForSelectedLockup(t)),_e.sidebarBackground&&_e.sidebarBackground.setBrandKitColors(t),_e.sidebarIcon&&_e.sidebarIcon.setBrandKitColors(t),_e.colorPicker&&_e.colorPicker.update({authoringContext:re.currentBrandKit()})}function ma(){!function(e){const o=re.currentBrandElements();!ut.featureEnabled("entitle-brand-kit")||o&&!1===o.showBrandInUI?t():re.refreshBrandColors().then((function(t){pa(t),e&&ga(t)}))}(!0)}function ba(e){e=e||re.currentBrandElements();const t=re.currentBrandKit();let o=e;e&&!1===e.showBrandInUI&&(o=null),ua(o),ga(o),_e.sidebarText&&_e.sidebarText.setBrandkit(e&&!1!==e.showBrandInUI?t:null),_e.sidebarTheme&&_e.sidebarTheme.setBrandKitThemes(o),_e.brandIndicator&&_e.brandIndicator.setBrand(e,t)}function ha(e,t){pa(e),t&&ba(e)}function fa(e,o){return re.refreshCachedCurrentBrandElements().then(Ma(o,t=>{ha(t,e)})).catch(e=>{if(e&&e.message===Fe.STALE_SESSION)return t.reject(e);Oe.error("refreshCurrentBrandElements: ".concat(e))})}function wa(e){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return re.switchCurrentAuthoringContext(e).then(e=>(ha(e,!0),e.coreBrandPromise)).then(e=>{if(o)return Re.changeBranding(e)}).timeout(3e5).catch(e=>{const o=e?e.message:"";return Ae.showAlert(v.translate("dialogs.switchBrandFailureAlert.kHeaderText"),v.translate("dialogs.switchBrandFailureAlert.kContentText"),{okText:v.translate("dialogs.switchBrandFailureAlert.kButtonLabel")}),Oe.error("switchBrand error: ".concat(o),e),t.reject()})}function va(e){e!==(re.currentBrandElements()&&re.currentBrandElements().id)&&wa(e,!1)}var ka=!1;function Ta(t){if(!m.disableCustomKeyboardShortcuts){var o=!1,n=window.navigator.platform.indexOf("Mac")>-1,a=e(t.target).is("input, textarea"),r=t.ctrlKey,i=n&&t.metaKey,s=t.shiftKey,l=t.which;if(r||i)switch(l){case 65:a||(s?Re.deselectAll():Re.selectAll(),o=!0);break;case 83:r+s&&(ka=!0),o=!0;break;case 84:s&&ka&&(console.info("saving a copy as template"),Ue.saveAsCopyToTemplate().then((function(){Oe.info("save complete")}),(function(e){Oe.error("save failed",e)}))),o=!0;break;case 90:a||(s?Ft():Wt(),o=!0);break;case 89:a||(Ft(),o=!0)}o&&t.preventDefault()}}function Ia(t){e(t.target).is("#PosterImageWrapper")||1===e(t.target).closest("#PosterImageWrapper").length||1===e(t.target).closest("#selectionPopUp").length||_e.globalTabsWrapper.isActive()||oa()}function Pa(e,t){var o=jt(e),n={width:o.width,height:o.height,imageQuality:o.imageQuality};return n.outputFormat=t||"image/jpeg",n}let Ca;function Sa(e){if(e=e||{},!Ca){Ca=t.defer();const n=Date.now();o.e(47).then(function(a){const r=o("+7aA"),i=Date.now();Oe.info("headless load time = "+(i-n)),("string"==typeof e.authoringContextId?re.getBrandKitById(e.authoringContextId):t.resolve()).then(e=>r.initialize(e)).done(()=>{const e=Date.now();Oe.info("headless init time = ".concat(e-i)),Ca.resolve(r)})}.bind(null,o)).catch(o.oe)}return Ca.promise}function Ba(e){Da(e,"home")}function xa(e){Da(e,"create_brand")}function ya(e){Da(e,"organizer")}function Da(e,t){var o="/";if("organizer"===t?o+="projects":"create_brand"===t&&(o+="branding/create"),e="boolean"==typeof e&&e,Xn&&Xn.cancel(),vt=!0,e)Xe.resolve();else{if(Aa())return void Ea({returnPath:o});$n()}za().done((function(){window.marvel.navigate(o,{trigger:!0})}))}function Aa(){return ut.featureEnabled("spark-home-enabled")&&"new"===tt.operation&&"blank"===tt.workflow&&!wt}function La(){const e=t.defer();return Xe.promise.finally((function(){s.waitForQuiet().then((function(){e.resolve()}))})),e.promise}function Ea(e){e=e||{};const o=t.defer(),n=new M({headerText:"i18n.dialogs.saveNonDirtyNewBlank.kHeaderText",contentText:"i18n.dialogs.saveNonDirtyNewBlank.kContentText",dismissable:!0,onDismissed:function(){o.resolve({dismissed:!0})},buttons:[{class:"pill pill-primary-on-dark",label:"i18n.dialogs.saveNonDirtyNewBlank.kDontSave",onClick:function(){n.hide(),o.resolve(!1)}},{class:"pill pill-secondary-on-light",label:"i18n.dialogs.saveNonDirtyNewBlank.kSaveProject",onClick:function(){n.hide(),o.resolve(!0)}}]});o.promise.then((function(o){if(!o.dismissed)if($n(),o)La().done((function(){e.returnPath?window.marvel.navigate(e.returnPath,{trigger:!0}):e.defer&&e.defer.resolve()}));else{const o=new M({headerText:"i18n.dialogs.saveNonDirtyNewBlank.kDeleteProgress",contentText:'<div class="postspinner postspinner-small"></div>',dismissable:!1});o.show();const n=function(){o.hide()};window.marvel.events.once("design-view-unloading",n),La().done((function(){const o=t.defer();window.marvel.events.trigger("delete-current-doc",{doc:s.currentDoc,defer:o}),o.promise.then((function(){e.returnPath?window.marvel.navigate(e.returnPath,{trigger:!0}):e.defer&&e.defer.resolve()}))}))}}))}function Ma(e,o){var n=this;return function(){if("number"==typeof e&&e!==Ve)return t.reject(new Error(Fe.STALE_SESSION));var a=[].slice.apply(arguments);try{var r=o.apply(n,a);return r}catch(e){return t.reject(e)}}}function Wa(e){e&&e.message===Fe.STALE_SESSION?Oe.error("Abandoning stale session. May be benign."):(window.marvel.events.trigger("hide-interstitial"),!e||e.userCanceledNPW||e.doNotLog||e.isWebGLUnavailable?(e&&e.isWebGLUnavailable&&Oe.warn("Failed to enable Post editor due to WebGL unavailability"),Da(!0)):(e.url=window.location.href,Oe.error("error enabling Post editor",e),_e.windowPanel.show(),_e.errorDialogs.enableEditorErrorModal=ye(e,()=>{Da(!0)})))}function Fa(e){var t;return t=(e=e||{}).tags?e.tags.includes("remixpaid")?"paid":"free":e.templateType||"none",{tagNames:e.tags?"["+e.tags.join(", ")+"]":"[]",templateType:t,templateId:e.id?e.id:"none"}}function Na(e){e=e||nt;var t=function(){if(Re){var e,t={},o=Re.getDocumentOriginalSizeId().toLowerCase(),n=Re.getDocumentSizeId().toLowerCase();e=o===oe.FormaPage.DEFAULT_ORIGINAL_SIZE_ID.toLowerCase()?"unknown":o!==n,t.originalSize=o,t.exportSize=n,t.hasResized=e;var a=Re.getAllDesignIngredientIDsAndTypes();a.length&&(t.designIngredientId=a[0].id);var r=Re.getColorPaletteId();r&&(t.color=r);var i=Re.getAppliedLayoutId();i&&(t.layout=i),t.includesPaidAdobeFonts=Ue.includesPaidAdobeFonts(),t.contentCountsString=Re.getContentCountsString(),t.extendedContentCountsString=Re.getExtendedContentCountsString();var s=Re.getAppliedVariationTemplateId();s?(t.designFilter=s,t.hasVariationTemplate=!0):t.hasVariationTemplate=!1;const l=Re.getUserFontSizesInDocument();if(l&&l.length){const e=Math.min(...l).toFixed(1),o=Math.max(...l).toFixed(1);t.fontSizeString="fontSizeMin:".concat(e,";fontSizeMax:").concat(o)}return t}return{originalSize:"unknown",exportSize:"unknown",hasResized:"unknown",designIngredientId:"unknown",color:"unknown",layout:"unknown",includesPaidAdobeFonts:"unknown",textCount:"unknown",imageCount:"unknown",iconCount:"unknown",logoCount:"unknown",designIngredientCount:"unknown",designFilter:"unknown",hasVariationTemplate:"unknown",fontSizeString:"unknown"}}();return n.extend({},e,t)}function Ra(e,o,n){return n?t({tags:null,templateType:"brand",id:e}):e?function(e,t){if(e&&t)return new pe({cpServiceDomain:t}).getAssetMetadataWithRetry(e)}(e,o):t({})}function za(e){var t="string"==typeof e?e:"i18n.app.kSavingPost";return Xe.promise.isPending()&&(Ye&&t===Ze||(Ye=new M({headerText:t,contentText:'<div class="postspinner postspinner-large"></div>',dismissable:!1}),Ze=t),Ye.show()),Xe.promise.finally((function(){Ye&&Ye.hide()})).done(),Xe.promise}return Ue.enable=function(o,a){var r=++Ve;if(o){_e.errorDialogs.fontMissingNoticeModal&&_e.errorDialogs.fontMissingNoticeModal.hide(),Ne=o,_e.windowPanel?_e.windowPanel.update({parentDomElement:Ne,hidden:!0}):_e.windowPanel=new x({id:"PostWindowPanel",parentDomElement:Ne,hidden:!0});var i=Date.now(),d=!He,c=0;nt={};var u,g,m="new"===(tt=a).operation;qe=Qe,Qe=pt.DOCUMENT,"edit-template"===tt.operation&&(Qe=pt.TEMPLATE);var f={};Ue.enabled=!0,ce.resetLoadingTimes();var k,T,I=(k=h.getSetting(Te.keys.POST_WATERMARK_UNLOCKED).catch(e=>{const o=e?e.message:"";return Oe.warn("Error fetching user settings for watermark status. Error: ".concat(o),e),t.resolve(!1)}),T=ut.loadFeatures(),Promise.all([k,T]).then((function(e){var t=e[0],o=ut.featureEnabled("show-remove-branding-flow"),n=ut.featureEnabled("remove-branding-enabled");return!t&&o&&n?(h.setSetting(Te.keys.POST_WATERMARK_UNLOCKED,!0),!0):t}))),P=t.allSettled([Xe.promise,ut.loadFeatures()]);b.doSerial([P,function(){return v.initLocalization(v.sparkSelectedLocale)}]).then(Ma(r,(function(){window.marvel.events.on("saved-composite-doc",xt),ut.featureEnabled("entitle-brand-kit")&&window.marvel.events.on("onboarding-premium-templates-remove",Pt),window.marvel.events.on("document-collaboration-changed",St),oe.Host.setFeatureController(ut)}))).then(Ma(r,(function(){if(ut.featureEnabled("entitle-brand-kit")||"remix"!==tt.operation)return t.resolve();var e=t.defer();return(ot=Ra(tt.cpAssetId,tt.cpServiceDomain||"cc-api-cp.adobe.io",!1)).then(Ma(r,t=>{const{tags:o,id:n,alias:a}=t;o&&o.includes("remixpaid")?(window.marvel.events.trigger("hide-interstitial"),_e.windowPanel.show(),l.showMerchMessagingModal({workflow:"remixPremiumTemplate",destinationUrl:tt.routeFragment,asset:{id:n,alias:a,tags:o,isPremiumTemplate:!0,remixable:!0,remixpaid:!0,app:"post"},analyticsPage:"editor:post",analyticsFullTagNames:"[".concat(o.join(", "),"]")}),window.marvel.events.on("upgrade-view-closed",()=>{window.marvel.events.off("upgrade-view-closed"),e.reject({message:"user not entitled to remix premium template",doNotLog:!0})})):e.resolve()})).catch((function(t){e.reject(t)})),e.promise}))).then(Ma(r,(function(){var e=t.defer(),o=document.createElement("canvas").getContext("webgl");if(!1===(null!==o&&o instanceof WebGLRenderingContext)){var n=function(){var e="Unknown",t="Unknown",o=document.createElement("canvas");if(o){var n=o.getContext("webgl")||o.getContext("experimental-webgl");if(n){var a=n.getExtension("WEBGL_debug_renderer_info");a&&(e=n.getParameter(a.UNMASKED_VENDOR_WEBGL),t=n.getParameter(a.UNMASKED_RENDERER_WEBGL))}}return{vendor:e,renderer:t,platform:navigator.platform,userAgent:navigator.userAgent}}();p.publish("webGLUnavailable",n),_e.errorDialogs.webglWarningModal=new M({headerText:"i18n.dialogs.webGLDisabled.kHeaderText",contentText:"i18n.dialogs.webGLDisabled.kContentText<br/><br/>Vendor: "+n.vendor+"<br/>Renderer: "+n.renderer+"<br/>Platform: "+n.platform+"<br/>UserAgent: "+n.userAgent,dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){_e.errorDialogs.webglWarningModal.hide(),e.reject({isWebGLUnavailable:!0})}}]}),window.marvel.events.trigger("hide-interstitial"),_e.windowPanel.show(),_e.errorDialogs.webglWarningModal.show()}else p.publish("webGLAvailable"),e.resolve();return e.promise}))).then(Ma(r,(function(){if(!m)return t.resolve();_e.newPostWorkflow||(_e.newPostWorkflow=new z({parent:_e.windowPanel})),p.publish("newProjectWorkflowLoaded"),ut.featureEnabled("post-max-static-npw")&&(a.isMaxStaticNpw=!0);var e=ut.featureEnabled("post-redesinged-npw");a.useRedesignedNewProjectWorkflow=e;var o=Date.now(),n=_e.newPostWorkflow.prompt(a);return _e.windowPanel.show(),n.then((function(e){rt=u=e,c=Date.now()-o,window.marvel.events.trigger("show-interstitial",{typeName:"post"})}))}))).then(Ma(r,(function(){return function(e,t){return(t=t||{}).belongsToUser="boolean"!=typeof t.belongsToUser||t.belongsToUser,e=ut.featureEnabled("entitle-brand-kit")?e:null,re.loadBrandKit(e,t).then(e=>{const o=!!(t.belongsToUser||e&&!e.belongsToUser()),n=e&&o?e.getId():null;oe.Host.brandkitManager.activateBrand(n)})}(tt.contextId||s.currentDoc.getDCXRoot().getValue("authctx#ctxid"),{skipReload:!0,belongsToUser:"INCOMING"!==s.currentDoc.getCollaboration(),isEntitledUser:ut.featureEnabled("entitle-brand-kit")})}))).then(Ma(r,(function(){return e=re.currentBrandKit(),ce.load({loadForEditor:!0,authoringContext:e});var e}))).then(Ma(r,()=>fa(!1,r))).then(Ma(r,(function(){const e=re.currentBrandKit(),t=re.currentBrandElements();if(m){t&&t.activated&&((g="true"===tt.branded)?p.publish("paidProjectStartBranded"):p.publish("paidProjectStartUnbranded"))}else{if("edit-template"===tt.operation||"new-from-template"===tt.operation||"new-template-from-template"===tt.operation)return et=e.getThemeById(tt.templateId),f.persistSource=ue.fromTemplate(e,et),"new-template-from-template"===tt.operation?(p.publish("createdTemplateFromTemplate"),ie.createEmptyPostTemplate(e).then(Ma(r,(function(t){return f.persistSave=ge.toTemplateLocal(e,et,ge.CommitChanges.AUTO),tt.newTemplateId=t.id,f})))):("edit-template"===tt.operation?(p.publish("editedTemplate"),f.persistSave=ge.toTemplateLocal(e,et,ge.CommitChanges.AUTO)):(p.publish("projectCreated",{projectId:s.currentDoc.id}),p.publish("createdBrandedProject",{projectId:s.currentDoc.id,templateName:et._data["theme#data"].name,themeletId:tt.templateId}),p.publish("createdProjectFromTemplate"),yt(s.currentDoc.id),f.persistSave=ge.toDocument(s.currentDoc)),f);"remix"===tt.operation?(Ee.setCPServiceDomain(tt.cpServiceDomain),yt(s.currentDoc.id),new pe({cpServiceDomain:tt.cpServiceDomain}).trackRepeatableActivity(tt.cpAssetId,"remix_count"),f={persistSource:new Me({assetId:tt.cpAssetId,cpServiceDomain:tt.cpServiceDomain}),persistSave:ge.toDocument(s.currentDoc)}):(Ee.setCPServiceDomain(""),f={persistSource:ue.fromDocument(s.currentDoc),persistSave:ge.toDocument(s.currentDoc)})}return f}))).then(Ma(r,(function(e){return(Re=new w(e)).whenInitialized().then(Ma(r,(function(){ce.logLoadingTimes();var e=Re.missingFontListInDoc();e.length>0&&function(e){var t=e.join(", ");_e.errorDialogs.fontMissingNoticeModal||(_e.errorDialogs.fontMissingNoticeModal=new M({headerText:"i18n.dialogs.fontMissingNotice.kHeaderText",contentText:v.translate("dialogs.fontMissingNotice.kContentText",{missingFontNames:t}),buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.fontMissingNotice.kEditButtonLabel",onClick:function(){_e.errorDialogs.fontMissingNoticeModal.hide(),p.publish("missingFontsWhenOpenReplaceButtonPressed")}},{class:"pill pill-secondary-on-light",label:"i18n.dialogs.fontMissingNotice.kCancelButtonLabel",onClick:function(){_e.errorDialogs.fontMissingNoticeModal.hide(),Da(!0),p.publish("missingFontsWhenOpenCancelButtonPressed")}}]})),_e.errorDialogs.fontMissingNoticeModal.show()}(e),oe.Host.setCoreWrapper(Re),Re.validateDoc("open"),$e.resolve(Re)})))}))).then(Ma(r,(function(){if("remix"===tt.operation){var e;if(tt.aspectId||tt.customSize)if(tt.customSize){var o=tt.customSize.split(":");4===o.length&&(e=oe.DesignSizeLibrary.getCustomSize(o[0],o[1],o[2],o[3]))}else e=oe.DesignSizeLibrary.getById(tt.aspectId);return(e?Re.setPageSizeFromDesignSize(e):t.resolve()).then(Ma(r,(function(){return Re.recordOriginalSize()})))}return m?Re.setPageSizeFromDesignSize(u.shapeData).then(Ma(r,(function(){return Re.recordOriginalSize()}))).then(Ma(r,(function(){if(!a.useRedesignedNewProjectWorkflow&&g||!u.image)return t.resolve();if(u.image&&(wt=!0),Array.isArray(u.image)){var e,o=[];return u.image.forEach((function(n){var a=t.defer();a.promise.catch((function(){if(!e){var t=new M({headerText:"i18n.dialogs.addImageError.kHeaderText",contentText:"i18n.dialogs.addImageError.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"Ok",onClick:function(){t.hide()}}]});_e.errorDialogs.addImageErrorOverlay=t,e=!0}})),o.push(Un(n,a,null,!0,!0))})),t.allSettled(o)}return Un(u.image,null,null,!0,null).catch((function(){return t.resolve()}))}))).then(Ma(r,(function(){return Re.initializeNewPost(u)}))).then(Ma(r,(function(){return g?da(!0):t.resolve()}))).then(Ma(r,(function(){p.publish("projectCreated",{projectId:s.currentDoc.id,aspectRatio:u.shapeData.aspectRatio,targetId:u.shapeData.id,id:u.id,textLength:u.text.length,workflow:a.workflow}),g&&p.publish("createdBrandedProject",{projectId:s.currentDoc.id})}))):t.resolve()}))).then(Ma(r,(function(){var e="remix"===tt.operation,o="new-from-template"===tt.operation,n=tt.cpServiceDomain||"cc-api-cp.adobe.io",a=Re.getRemixParentsCpIds(),i=tt.cpAssetId||(a?a[a.length-1]:null),l=o?tt.templateId:Re.getAuthoringContextThemeId();return o&&Re.setAuthoringContextThemeId(tt.templateId),ot||(ot=Ra(i,n,!!l)),ot.then(Ma(r,(function(t){e&&(s.currentDoc.name="",Re.setRemixParentCpId(t.id)),nt=Fa(t)}))).catch((function(o){return o&&o.message===Fe.STALE_SESSION?t.reject(o):e?t.reject(o):(Oe.warn("Failed to get parent CP metadata for a non-remix flow",o),nt=Fa(null),t.resolve())}))}))).then(Ma(r,(function(){if("remix"!==tt.operation&&"new-from-template"!==tt.operation)return t.resolve();var e=t.defer();return 0===Re.getRootForma().childCount?(_e.errorDialogs.notRemixableOverlay=new M({headerText:"i18n.dialogs.remixFailed.kHeaderText",contentText:"i18n.dialogs.remixFailed.kContentText",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){_e.errorDialogs.notRemixableOverlay.hide(),e.reject(),Da(!0)}}]}),window.marvel.events.trigger("hide-interstitial"),_e.windowPanel.show(),_e.errorDialogs.notRemixableOverlay.show()):(qn(),e.resolve()),e.promise}))).then(Ma(r,(function(){return I}))).then(Ma(r,(function(e){Ge=ut.hasExperimentFeature("post-watermark-pay-to-remove","postWatermarkExperimentV2",{eventName:"payToRemoveWatermarkVariantAssignment",eventData:{},pageName:"editor:post"},{eventName:"removeOnceVariantAssignment",eventData:{},pageName:"editor:post"});var o=ut.featureEnabled("entitle-brand-kit"),n=ut.featureEnabled("post-create-template-contentteam");return je=!n&&(!e&&!o&&(!!Ge||("remix"===tt.operation||Re.getWatermarkEnabledForDoc()))),Re.setWatermarkEnabledForDoc(je),h.getSetting(Te.keys.POST_WATERMARK_COACHMARK_DISMISSED).then(Ma(r,(function(e){at=e}))).catch(e=>{const o=e?e.message:"";if(o===Fe.STALE_SESSION)return t.reject(e);Oe.warn("Error fetching user settings for watermark coachmark. Error: ".concat(o),e),at=!1})}))).then(Ma(r,(function(){Re.resetUserActions(),Re.monitorTransactions(),ra(function(e){e=e||{};var t=ft.default;if(e.workflow&&ft.hasOwnProperty(e.workflow)&&(t=n.clone(ft[e.workflow])),e.startingMenu&&(t.startingMenu=e.startingMenu),!t.isDefault&&e.buttons){var o=e.buttons;o.indexOf("facebook_upload")>=0&&(t.showFacebookUploadButton=!0),o.indexOf("share")>=0&&(t.showShareButton=!0),o.indexOf("download")>=0&&(t.showDownloadButton=!0)}return n.each(ht,(function(o){var a;n.isUndefined(e[o])||(a="true"===e[o]||"false"!==e[o]&&e[o],t[o]=a)})),t}(a)).then(Ma(r,()=>{Qe===pt.TEMPLATE&&(Je={templateName:ie.getTemplateName(et)}),_e.windowPanel.show(),window.marvel.events.trigger("hide-interstitial"),ba(re.currentBrandElements())})).catch(Oe.error)}))).then(Ma(r,(function(){var t=["new","new-from-theme","new-from-template","remix"].indexOf(tt.operation)>=0,o=re.currentBrandElements()||{id:""};p.publish("project:editorDisplayed",{isBranded:!n.isEmpty(s.currentDoc.getDCXRoot().getValue("authctx#ctxid")),contextualData23:o.isDefault?"":o.id,isNewProject:t,sparkFormat:"post",contextData:["projectId"],includesUploadedFonts:Ue.includesUploadedFonts(),contextualData5:"tagNames:"+nt.tagNames,contextualData6:"templateType:"+nt.templateType,contextualData24:"collabStatus:"+s.currentDoc.getCollaborationForAnalytics(),templateId:nt.templateId}),window.marvel.events.trigger("editor-displayed",{appName:"post"});var a=Date.now()-i;c&&(a-=c),p.publish("post:editorStartupEnd",{contextualData1:"timeElapsedMs:"+a,contextualData2:"editorOperation:"+tt.operation,contextualData3:"isFreshLoad:"+d,contextualData4:"hasActivatedBrand:"+(!!o&&o.activated),contextualData5:"timeSpentInNpw:"+c}),e(document).on("keydown",Ta),e("#PostCanvasSection").on("click",Ia)}))).then(Ma(r,()=>{"new"!==tt.operation&&(Re.replaceCorruptImageFrames()&&(Oe.error("Replacing corrupt images in document during open"),_e.errorDialogs.replacedLowResImagesModal||(_e.errorDialogs.replacedLowResImagesModal=new M({headerText:'\n                  <span class="error-modal-header">\n                    <span>i18n.dialogs.corruptImageReplacement.kHeaderText</span>\n                    <i class="error-modal-header__icon"></i>\n                  </span>\n                ',contentText:'<div class="error-modal-content">\n                      <span>i18n.dialogs.corruptImageReplacement.kContentText</span>\n                      <span class="error-modal-content_placeholder-indicator" style="background-color: #FF0000;"></span>\n                    </div>',dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.corruptImageReplacement.kButtonLabel",onClick:()=>_e.errorDialogs.replacedLowResImagesModal.hide()}]})),_e.errorDialogs.replacedLowResImagesModal.show()))})).catch(Wa).done()}},Ue.getMetadataForExportAnalytics=function(e,o){return Ra(e,"cc-api-cp.adobe.io",o).then((function(e){return Na(Fa(e))})).catch((function(e){return Oe.error("getMetadataForExportAnalytics: error while fetching metadata from CP",e),t(!1)}))},Ue.disable=function(){Ue.enabled=!1,re.resetBrandCaches(),et=null,Je=null,wt=!1,rt=null,Object.keys(_e.errorDialogs).forEach(e=>_e.errorDialogs[e].hide()),oa({silent:!0}),_e.windowPanel&&_e.windowPanel.hide(),$e=t.defer(),ot=null,Xe.promise.done((function(){_e.poster&&_e.poster.update({core:void 0}),_e.posterAdornments&&_e.posterAdornments.disable(),_e.postEditorView&&_e.postEditorView.hide(),_e.newPostWorkflow&&_e.newPostWorkflow.hide(),window.marvel.events.off("saved-composite-doc",xt),window.marvel.events.off("onboarding-premium-templates-remove",Nt),window.marvel.events.off("upgrade-view-closed"),window.marvel.events.off("document-collaboration-changed",St),function(){for(var e=0;e<Ke.length;e++)Ke[e].remove();Ke=[]}(),e(document).off("keydown",Ta),e("#PostCanvasSection").off("click",Ia)}))},Ue.handleUnload=function(){if(!Re||!Re.getDocument())return t();var e=Re.getAllStringForFormaUsedWheelSuggestions();if(e.length>0&&p.publish("lockupStyleCaptured",{contextualData1:"styleString:".concat(e),contextualData2:"location:EditorClose"}),!vt&&Aa()){var o=t.defer();return Ea({defer:o}),o.promise}return vt=!1,za()},Ue.getCurrentDocumentSynthesizedName=function(){return Re.getCurrentDocumentSynthesizedName()},Ue.getCurrentDocumentDescription=function(){return Re.getCurrentDocumentDescription()},Ue.getRemixAncestorsIntoMachineTags=function(e){return Re.getRemixAncestorsIntoMachineTags(e)},Ue.getDocumentSize=function(){return Re.getDocumentSize()},Ue.getCoreWrapperPromise=function(){return $e.promise},Ue.saveAsCopyToTemplate=function(){var e,t;return _e.poster.getRendition({width:500,imageQuality:.75}).then((function(e){return t=e,r.getController()})).then((function(e){return e.getGlobalActiveContext()})).then((function(t){if(!(e=t))throw new Error("No current BrandKit.");return ie.createEmptyPostTemplate(e)})).then((function(o){var n=ge.toTemplateExternal(e,o,ge.CommitChanges.AUTO);return Re.saveCopyWithRenditions(n,null,t)}))},Ue.getDownloadImageBlobPromise=function(e,t){if(Ue.enabled){Ue.reportNounProjectIds();const e=Pa(Re,t);return _e.poster.getRendition(e)}let o;return Sa({authoringContextId:e.getDCXRoot().getValue("authctx#ctxid")}).then(t=>{const n=ue.fromDocument(e),a=new be;return o=new w({persistSource:n,persistSave:a}),o.whenInitialized().then(()=>t)}).then(e=>{Ue.reportNounProjectIds(o);const n=Pa(o,t);return e.getRenditionBlobPromise(o,n)})},Ue.reportNounProjectIds=function(t){var o;if(Re)o=Re.getUnreportedNounProjectIds();else{if(!t)return void Oe.error("can not report Icons, due to core wrapper not being initialized");o=t.getUnreportedNounProjectIds()}var n="https://"+window.marvel.settings.dooplo+"/api/v1/report/usage?api_key=MarvelCP1",r=window.adobeIMS.getAccessToken();o.length&&e.ajax({headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",url:n,data:JSON.stringify({ids:o}),beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+r),e.setRequestHeader("X-Api-Key",a.key)},success:function(e,a,r){"success"!==a?Oe.error("error reporting Noun Project icon Ids","Requested "+n+". Got back "+r.statusCode+": "+r.body):(Re?Re.setNounProjectIdsReported(o):t&&t.setNounProjectIdsReported(o),qn())},error:function(e){Oe.error("error reporting Noun Project icon Ids","Requested "+n+". Got back "+e.responseText)}})},Ue.getCompositeImageFiles=function(e){var o;return Sa().then((function(){var t=ue.fromDocument(e),n=new be;return(o=new w({persistSource:t,persistSave:n})).whenInitialized()})).then((function(){var e=o.imageFormas(),n=[];e.forEach((function(e){n.push(g.load(Ee.decodeUrl(e.contentNode.url)))}));var a=[];return t.all(n).then((function(){for(var e=[],o=[],n=0;n<arguments[0].length;n++){var r=arguments[0][n];if(r instanceof HTMLImageElement){o.push(r.src);var i=r.src.substring(r.src.lastIndexOf("=")+1),s=Gn(r);e.push(jn(s,i))}}return t.all(e).then((function(){for(var e=0;e<arguments[0].length;e++){var t=arguments[0][e],n=new RegExp(/asset_id=([^&]*)/),r=n.exec(o[e])[1],i=o[e].substring(o[e].lastIndexOf("/")+1);a.push({name:r+"."+i,assetId:r,blob:t})}return a})).catch((function(e){Oe.error("getCompositeImageFiles fail-1",e)}))})).catch((function(e){Oe.error("getCompositeImageFiles fail-2",e)}))}))},Ue.includesUploadedFonts=function(){return!!Re&&Re.includesUploadedFonts()},Ue.includesPaidAdobeFonts=function(){return Re?Re.getDocFontSourceUsage().indexOf(oe.describeFontSource(oe.FontSource.TYPEKIT_PREMIUM))>-1:(Oe.warn("includesPaidAdobeFonts: Unable to get font usage info from doc - coreWrapper unavailable"),"unknown")},Ue.getRemixParentsCpIds=function(){return Re?Re.getRemixParentsCpIds():(Oe.warn("getRemixParentsCpIds: Unable to get remix parent ids from doc - coreWrapper unavailable"),null)},Ue.getConstrainedImages=function(){return Re?Re.getConstrainedImages():(Oe.warn("getConstrainedImages: Unable to get constrained images info from doc - coreWrapper unavailable"),null)},Ue.getFontsUsed=function(){var e=t.defer();return $e.promise.done((function(){Re?e.resolve(Re.getFontsUsed()):e.reject("coreWrapper is undefined")}),(function(){e.reject("could not load coreWrapper")})),e.promise},Ue.setCPProjectId=function(e){Re&&Re.setCPProjectID(e)},Ue.setCPAlias=function(e){Re&&Re.setCommunityPlatformAlias(e)},Ue.setCPAssetId=function(e){Re&&Re.setCommunityPlatformAssetID(e)},Ue.setPublishedContentEtag=function(e){Re&&Re.setPublishedEtag(e)},Ue}.apply(t,n))||(e.exports=a)}}]);
//# sourceMappingURL=theo-web-view_e27cd5be-a3a4c7c4.js.map