(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[18],{"6Rk9":function(e,r,t){var n,o=r,a=t("oAGj"),i=t("sIWg");o.GeometryFacade=(n=function(){},a.defineClass({name:"GeometryFacade",ctor:n,statics:{getFormaeBounds:function(e,r){void 0===r&&(r=!1);var t=i.TheoRect.Zero;if(e.length>0)if(r){var n=e.map((function(e){return e.controller.getUserPerceivedFrame()}),this);t=n.reduce((function(e,r){return e.unionWith(r)}),n[0])}else{var o=e[0];t=e.reduce((function(e,r){return e.unionWith(r.finalFrame)}),o.finalFrame)}return t},unionFrame:function(e,r){if(void 0===r&&(r=null),0==e.length)return null;for(var t=r||e[0].parent,n=null,o=a.iter(e);!o.done;o.next()){for(var i=o.value,l=i.placement,s=i.parent;null!=s&&s!=t;)l=l.concat(s.placement),s=a.opt(s,(function(e){return e.parent}));var u=i.boundsInCoordSpace(l);n=null==n?u:n.unionWith(u)}return n}}}),n)},"6h7+":function(e,r,t){var n,o,a,i=r,l=t("oAGj"),s=t("Tq01"),u=t("dHJt"),c=t("CWW7"),d=t("yGNn"),m=t("G1DZ"),f=t("8t9B");i.AddBadgeParams=(n=function(e){void 0===e&&(e=null),this.controllerType=e},o={},l.defineClass({name:"AddBadgeParams",ctor:n,superName:"CoreObject",statics:{DEFAULTS:{get:function(){return void 0===o.DEFAULTS&&(o.DEFAULTS=new n),o.DEFAULTS}}}}),n),i.BadgeFacade=(a=function(){},l.defineClass({name:"BadgeFacade",ctor:a,statics:{addBadge:function(e,r,t,n){void 0===n&&(n=null);var o=l.clone(a.getFormaeToCopy(e,l.opt(n,(function(e){return e.controllerType}))));return 0==o.length?d.CorePromise.reject("Badge is empty"):c.CreationFacade.copyItems(l.clone(o),t).then((function(e){var t=l.clone(e);return a.recordSources(r,l.clone(o),l.clone(t)),new u.BadgeLayoutController(l.clone(t)).update(),t.forEach(a.onBadgeFormaPlaced),new s.FormaActionResult(l.clone(t))}))},getDesignIngredientIDAndType:function(e){return{id:m.FormaSourceUtils.stripNamespace(e),type:"lockup"}},getFormaeToCopy:function(e,r){var t;return e.firstPage.root.filterByControllerKind((t=r)||null!=t?t:f.TypeLockupController.KIND)},onBadgeFormaPlaced:function(e){var r;(r=l.as(e.controller,f.TypeLockupController))&&(r.updateScoring(),r.styleController.doesLockupContrastWithBackground()||r.shuffleColorAssignment())},recordSources:function(e,r,t){for(var n=t.length>1,o=l.iter(l.toSequence(t));!o.done;o.next()){var i=o.value,s=i.offset;i.element.source=a.makeSourceDescriptor(e,n?r[s].formaID:null)}},makeSourceDescriptor:function(e,r){var t;return null!=(t=r)?m.FormaSourceNamespace.DesignIngredient+e+":"+t:m.FormaSourceNamespace.DesignIngredient+e}}}),a)},CWW7:function(e,r,t){var n,o,a,i=r,l=t("oAGj"),s=t("Tq01"),u=t("0wFF"),c=t("KSe6"),d=t("kYI4"),m=t("SpAV"),f=t("vYM0"),g=t("gXiO"),p=t("yGNn"),F=t("FNB+"),C=t("cmoc"),v=t("V3yt"),h=t("ZK0l"),y=t("pnSN"),I=t("X0GW"),A=t("iCxV"),D=t("q5zr"),k=t("fdtz"),T=t("MYNe"),S=t("c+uM"),b=t("tGKA"),B=t("VkKB"),M=t("K17h"),x=t("uxH+"),P=t("K0Rh"),E=t("JO5d"),N=t("djAF"),_=t("35Q0"),L=t("lJxM"),R=t("T6jX"),w=t("8t9B"),O=t("1NAc"),G=t("LGJg"),U=t("sW6f"),X=t("WWR6"),Y=t("zjod"),K=t("QTen");i.FloatingImageStrategy=l.defineEnum("FloatingImageStrategy",{IfHasAlphaOrIsLogo:0,Always:1,Never:2}),i.AddFormaParentingHint=l.defineEnum("AddFormaParentingHint",{defaultHandling:0,addToRoot:1,doNotAddFormaForContentToTree:2}),i.AddFormaParams=(n=function(e,r,t,n,o){void 0===e&&(e=s.ControllerSettingsBehaviorEnum.IgnoreControllerSettings),void 0===r&&(r=!0),void 0===t&&(t=null),void 0===n&&(n=i.FloatingImageStrategy.IfHasAlphaOrIsLogo),void 0===o&&(o=i.AddFormaParentingHint.defaultHandling),this.behavior=e,this.suggestPlacement=r,this.formaToReplace=t,this.floatingImageStrategy=n,this.parentingHint=o},o={},l.defineClass({name:"AddFormaParams",ctor:n,superName:"CoreObject",statics:{DEFAULTS:{get:function(){return void 0===o.DEFAULTS&&(o.DEFAULTS=new n),o.DEFAULTS}},makeWithFormaToReplace:function(e){return new n(void 0,void 0,e)},makeWithFormaToReplace:function(e,r){return new n(void 0,void 0,e,void 0,r)}}}),n),i.CreationFacade=(a=function(){g.CoreObject.call(this)},l.defineClass({name:"CreationFacade",ctor:a,superName:"CoreObject",statics:{addImage:function(e,r,t,n,o,s,u,c,d){var f,g;return void 0===s&&(s=null),void 0===u&&(u=!1),void 0===c&&(c=i.AddFormaParams.DEFAULTS),void 0===d&&(d=null),(f=e.document)&&(g=f.controller)?p.CorePromise.resolve(null).then((function(e){var i;if(i=l.as(f.content.createNode(D.ImageContentNode.KIND,null),D.ImageContentNode)){var C;if(i.url=r,i.mimeType=t,i.pixelWidth=n,i.pixelHeight=o,C=d)for(var v=l.iter(C);!v.done;v.next()){var h=v.key;e=v.value,i.setTag(h,e)}return null!=s&&(i.hasAlpha=s),u&&i.createImageFeatures(),a.addContent(g.document.firstPage,i,null,!1,c).then((function(e){var r;return(r=l.as(e,F.Forma))?(r.isImage()&&R.TheoDocumentUtils.updateConstrainedImageInfo(g.document),r):(m.CoreAssert.fail("expected a forma result from CreationFacade.addContent","CreationFacade.addImage","CreationFacade.swift",147),null)}))}return p.CorePromise.reject("imageCN is nil")})):p.CorePromise.reject("document has no controller")},addLibraryShape:function(e,r,t,n){var o;return(o=l.as(e.createFormaWithController(N.ShapeForma.KIND,E.ShapeController.KIND),N.ShapeForma))?(e.root.appendChild(o),o.intent=F.Forma.INTENT_ICON,_.ShapeLibrary.applyToShapeForma(o,r),o.style.colors.fieldPrimary=n,o.controller.fit(t),p.CorePromise.resolve(o)):p.CorePromise.reject("could not create shape forma")},addText:function(e,r,t,n){var o;return void 0===n&&(n=i.AddFormaParams.DEFAULTS),(o=e.document)?p.CorePromise.resolve(null).then((function(e){var i;return(i=l.as(o.content.createNode(L.TextContentNode.KIND,null),L.TextContentNode))?(i.text=r,a.addContent(o.firstPage,i,void 0,void 0,n).then((function(e){var r;return(r=l.as(e,F.Forma))?r:(m.CoreAssert.fail("Unexpected result from AddContentAction, expected a Forma","CreationFacade.addText","CreationFacade.swift",210),null)})).then((function(e){return t?(r=l.as(e,F.Forma))&&(n=l.as(r.controller,w.TypeLockupController))&&(o=l.as(r.style,S.LockupStyle))&&(a=o.font)?v.FontFacade.ensureFontLoaded(a.fontData).then((function(e){return n.updateGroup(),r})):p.CorePromise.reject("unable to inspect created lockup for style and font"):e;var r,n,o,a}))):p.CorePromise.reject("textCN is nil")})):p.CorePromise.reject("document has no controller")},duplicateItems:function(e,r,t){var n,o,i=l.clone(T.LayerFacade.sortInZOrder(l.clone(e)));return a.copyItems(l.clone(i)).then((function(e){var a=l.clone(e);if(0==!a.length&&(r&&a.forEach((function(e){return e.move(b.Matrix2D.translationXY(25,25))})),t&&a[0].page.document.controller.selection.replaceSelectionWithFormae(l.clone(a)),((n=l.opt(l.opt(a[0].page.document,(function(e){return e.controller})),(function(e){return e.enableMoveableChildren})))||null!=n)&&n&&i.length==a.length))for(var s=l.iter(l.range(0,i.length,!1));!s.done;s.next()){var u=s.value;((o=l.opt(i[u].controller,(function(e){return e.userGroupChild})))||null!=o)&&o&&l.opt(i[u].parent,(function(e){return e.appendChild(a[u])}))}return a}))},remapReferences:function(e,r){if(e.page!=r.page){var t,n,o=e.style,a=r.style;if((t=o.colorLibrary)&&(n=a.colorLibrary)){var i,s,u={};f.ColorLibraryMap.remapColors(a.colors,t,n,u),(i=l.as(a,S.LockupStyle))&&(s=i.characterStyles[w.TypeLockupController.HIGHLIGHT_STYLE])&&f.ColorLibraryMap.remapColors(s.colors,t,n,u)}}},copyItems:function(e,r){if(void 0===r&&(r=null),0==e.length)return p.CorePromise.resolve([]);var t;if(t=e[0].page.document){var n=e.filter((function(e){return l.opt(e.controller,(function(e){return 1==e.duplicatable}))}),this);if(0==n.length)return p.CorePromise.resolve([]);var o=[],i=!1,s=p.CorePromise.resolve(null);return n.forEach((function(e){s=s.then((function(t){return e.controller.copyTo(r).then((function(r){var t;return(t=l.as(r,F.Forma))?(t.isImage()&&(i=!0),a.remapReferences(e,t),o.push(t),t):null}))}))})),s.then((function(e){return i&&R.TheoDocumentUtils.updateConstrainedImageInfo(l.opt(r,(function(e){return e.document}))||t),o}))}return p.CorePromise.reject("copyItems: no document?")},deleteFormae:function(e,r){var t,n;if(e.length>0&&(n=e[0].page.document)){for(var o,a,i=!1,s=!1,m=!1,f=l.iter(e);!f.done;f.next()){var g=f.value;if(!(g instanceof P.RootForma)){var p;if(g.isImage()&&(s=!0),g.isLogo()?d.BrandingFacade.isImageBrandedLogo(g)&&(i=!0):g.isTypeLockup()?d.BrandingFacade.doesLockupUseBrandedFonts(g)&&(i=!0):g.hasIntent(F.Forma.INTENT_ICON)&&l.opt(A.Host.logging,(function(e){return e.logToAnalytics(u.AnalyticsConstants.kAnalyticsIconDeleted,{})})),g.isVideo()&&(m=!0),n.controller.selection.isSelected(g)&&n.controller.selection.deselectForma(g),p=g.parent){var C=g.parent;for(l.opt(l.as(p.controller,h.GroupController),(function(e){return e.removeFormaFromGroup(g)}));((t=l.opt(l.opt(C,(function(e){return e.controller})),(function(e){return e.userGroup})))||null!=t)&&t;){var v=C.parent;C.childCount<=1?I.GroupFacade.ungroupItems([C]):I.GroupFacade.updateUserGroupBounds(C),C=v}}var y=g.controller.settings;null!=y&&y==g.page.document.controller.controllerSettingsState.settings&&(g.page.document.controller.controllerSettingsState.settings=null)}}(o=l.as(n.firstPage.root.controller,x.RootController))&&(a=o.getGridController())&&a.onFormaeDeleted(l.clone(e)),c.AnimationLibrary.updateCurrentStyle(n,m),i&&d.BrandingFacade.unBrandDocumentIfNoBrandedElements(n),s&&R.TheoDocumentUtils.updateConstrainedImageInfo(n)}l.opt(r,(function(e){return e()}))},addContentNodeToDocument:function(e,r){var t;(t=e)&&null==t.parent&&r.content.root.appendChild(t)},removeContentNodeFromDocument:function(e,r){var t;(t=e)&&r.content.root.removeChild(t)},addContent:function(e,r,t,n,o){var s,u,d,m,f;return void 0===t&&(t=null),void 0===n&&(n=!1),void 0===o&&(o=i.AddFormaParams.DEFAULTS),(s=e.document)&&(u=s.controller)?(a.addContentNodeToDocument(r,s),a.addContentNodeToDocument(t,s),M.MotionUtils.invalidateAnimation(s),(d=a.createFormaFromContent(e,r,t))?(m=o.formaToReplace)&&(f=l.as(l.opt(m.parent,(function(e){return e.controller})),h.GroupController))?(f.replaceChildWithForma(m,d,n),c.AnimationLibrary.updateCurrentStyle(s,d.isVideo()),p.CorePromise.resolve(d)):o.parentingHint==i.AddFormaParentingHint.doNotAddFormaForContentToTree?p.CorePromise.resolve(d):a.addForma(u.document.firstPage,d,o).then((function(e){return d})):p.CorePromise.reject("Could not create forma from content")):p.CorePromise.reject("No related document, or controller")},addForma:function(e,r,t){var n;return void 0===t&&(t=i.AddFormaParams.DEFAULTS),(n=r.controller)?n.addForma(e,r,t).then((function(n){var o;return r.isImage()&&R.TheoDocumentUtils.updateConstrainedImageInfo(e.document),(o=e.document)&&c.AnimationLibrary.updateCurrentStyle(o,r.isVideo()),t.behavior==s.ControllerSettingsBehaviorEnum.SetControllerSettings&&l.opt(l.opt(e.document,(function(e){return e.controller})),(function(e){return e.controllerSettingsState.settings=l.opt(r.controller,(function(e){return e.settings}))})),null})):p.CorePromise.resolve(null)},createFormaFromContent:function(e,r,t){var n,o,a,i,s,u,c;if((o=e.document)&&(a=o.controller))if(i=l.as(r,D.ImageContentNode)){var f=e.createForma(k.ImageForma.KIND);if(f.contentID=r.id,r.getTag(D.ImageContentNode.IMAGE_MASK_ROLE_TAG)==D.ImageContentNode.ROLE_MASK)f.intent=F.Forma.INTENT_IMAGE_MASK,n=f;else{switch(l.opt(i.mediaMetadata,(function(e){return e.designIntent}))){case"logo":null!=i.sparkElementID&&""!=i.sparkElementID&&d.BrandingFacade.brandDocumentForElement(o,i.sparkElementID,d.AUTHORING_CONTEXT_TYPE_LOGO),f.intent=F.Forma.INTENT_LOGO;break;case"pattern":f.intent=F.Forma.INTENT_PATTERN;break;case"icon":f.intent=F.Forma.INTENT_ICON;break;case"floating-image":f.intent=F.Forma.INTENT_FLOATING_IMAGE}(p=e.createForma(C.FrameForma.KIND)).appendChild(f),n=p}}else if(s=l.as(r,U.VideoContentNode)){var g,p,v=e.createForma(Y.VideoForma.KIND);v.videoContentNode=s,(g=l.as(v.style,K.VideoStyle))&&(g.duration=s.duration),null!=t&&(v.contentID=t.id),(p=e.createForma(C.FrameForma.KIND)).appendChild(v),n=p,l.opt(l.opt(v.contentNode,(function(e){return e.mediaMetadata})),(function(e){return e.designIntent==B.MediaMetadata.DESIGNINTENT_STICKER}))&&(v.intent=F.Forma.INTENT_STICKER)}else if(u=l.as(r,G.VectorContentNode)){m.CoreAssert.isFalse(l.opt(u.mediaMetadata,(function(e){return e.designIntent==B.MediaMetadata.DESIGNINTENT_ICON})),"can't create icon from VectorContentNode","CreationFacade.createFormaFromContent","CreationFacade.swift",668);var h=e.createForma(X.VectorForma.KIND);h.contentID=u.id,n=h}else if(c=l.as(r,L.TextContentNode)){var I=e.createForma(y.GroupForma.KIND),A=a.controllerFactory.createController(w.TypeLockupController.KIND,I);I.controller=A,A.contentNode=c,A.size=new O.TheoSize(400,300),n=I}return n}}}),a)},DP9v:function(e,r,t){var n,o,a=r,i=t("oAGj"),l=t("0wFF"),s=t("SpAV"),u=t("gXiO"),c=t("iCxV"),d=t("Kkml"),m=t("rrhp");a.MultiBrandFacade=(n=function(){u.CoreObject.call(this)},o={},i.defineClass({name:"MultiBrandFacade",ctor:n,superName:"CoreObject",statics:{_sparkACManager:{get:function(){return void 0===o._sparkACManager&&(o._sparkACManager=c.Host.brandkitManager.authoringContextManager),o._sparkACManager},set:function(e){o._sparkACManager=e}},acManager:{get:function(){var e;return(e=n._acManager)?e:n._sparkACManager}},_usingMockedACManager:!1,usingMockedACManager:{get:function(){return n._usingMockedACManager}},useMockACManager:function(e){n._acManager=e,n._usingMockedACManager=!0,n._defaultBrandkitID=null,n._activeBrandkitID=null},useDefaultACHelper:function(){n._acManager=n._sparkACManager,n._usingMockedACManager=!1,n._defaultBrandkitID=null,n._activeBrandkitID=null,n.determineDefaultBrand()},_defaultBrandkitID:null,defaultBrandkitID:{get:function(){return s.CoreAssert.isTrue(null==n._defaultBrandkitID||!i.isEmpty(n._defaultBrandkitID),void 0,"MultiBrandFacade","MultiBrandFacade.swift",57),n._defaultBrandkitID}},defaultBrand:{get:function(){var e;return(e=n.authoringContext(n.defaultBrandkitID))?e.isMinimal?null:e:null}},_activeBrandkitID:null,activeBrandkitID:{get:function(){return s.CoreAssert.isTrue(null==n._activeBrandkitID||!i.isEmpty(n._activeBrandkitID),void 0,"MultiBrandFacade","MultiBrandFacade.swift",86),n._activeBrandkitID}},setActiveBrandkitID:function(e){var r=n.activeBrandkitID;n._activeBrandkitID=null!=e&&i.isEmpty(e)?null:e,r!=n.activeBrandkitID&&(c.Host.logging.info("MultiBrandFacade.setActiveBrand: changing from "+n.brandInfo(r)+" to "+n.brandInfo(n.activeBrandkitID)),i.opt(c.Host.brandkitManager,(function(e){return e.sendActiveBrandChangedNotification(n.activeBrandkitID)})))},activeBrand:{get:function(){var e,r;return null==n.activeBrandkitID&&null!=n.defaultBrandkitID&&(n.usingMockedACManager||c.Host.logging.info("MultiBrandFacade.activeBrand: activeBrandkitID is nil, falling back to defaultBrandkit: "+((e=n.defaultBrandkitID)||null!=e?e:"none"))),n.authoringContext((r=n.activeBrandkitID)||null!=r?r:n.defaultBrandkitID)}},getBrand:function(e){return i.isEmpty(e.authoringContextID)?null:n.authoringContext(e.authoringContextID)},setActiveBrand:function(e){null==e?n.setActiveBrandkitID(null):i.isEmpty(e.authoringContextID)?n.setActiveBrandkitID(n.defaultBrandkitID):n.setActiveBrandkitID(e.authoringContextID)},authoringContext:function(e){return null==e||i.isEmpty(e)?null:n.acManager.authoringContext(e)},authoringContexts:{get:function(){return n.acManager.authoringContexts}},ownedAuthoringContexts:{get:function(){var e=[],r=i.clone(n.acManager.getOwnedAuthoringContextIDs());if(r.length>0){var t,o;null!=(t=n.defaultBrandkitID)&&(o=n.acManager.authoringContext(t))&&o.isDefault&&(e.push(o),r=r.filter((function(e){return e!=t}),this));for(var a=i.iter(r);!a.done;a.next()){var l,s=a.value;(l=n.acManager.authoringContext(s))&&e.push(l)}}return e}},ownedBrandCount:{get:function(){return n.ownedAuthoringContexts.length}},handleUndoRedoMessage:function(e){var r,t,n,o,a;if((o=i.as(e.changeAction,d.ChangeBrandingUserAction))&&null!=(a=e.changeDirection)){var l=(r=o.fromDocBrandID)||null!=r?r:"",s=(t=o.toBrandID)||null!=t?t:"";i.isEmpty(l)&&(a==m.UndoRedoChangeDirection.Undo?(c.Host.logging.info("MultiBrandManager.handleUndoRedoMessage: for Undo from "+s+" to none, resetting active brand to previous value "+((n=o.fromActiveBrandID)||null!=n?n:"none")),i.opt(c.Host.brandkitManager,(function(e){return e.activateBrand(o.fromActiveBrandID)}))):(c.Host.logging.info("MultiBrandManager.handleUndoRedoMessage: for Redo from none to "+s+", resetting active brand to new brand"),i.opt(c.Host.brandkitManager,(function(e){return e.activateBrand(s)}))))}},determineDefaultBrand:function(){var e,r,t=null,o=null,a=(e=i.opt(c.Host.brandkitManager,(function(e){return e.adobeID})))||null!=e?e:"";if(c.Host.logging.info("MultiBrandFacade.determineDefaultBrand: "+n.authoringContexts.length+" authoringContexts"),(!i.isEmpty(a)&&c.Host.brandkitManager.isBrandkitEnabled||n.usingMockedACManager)&&n.authoringContexts.length>0){var l=i.clone(n.ownedAuthoringContexts);switch(c.Host.logging.info("MultiBrandFacade.determineDefaultBrand: "+l.length+" ownedBrands"),l.length){case 0:t=null;break;case 1:l[0].isDefault&&(t=(o=l[0]).id,o.activated||c.Host.logging.info("MultiBrandFacade.determineDefaultBrand: default brand "+n.brandInfo(o.id)+" is a partial brand"));break;default:for(var u=i.iter(l);!u.done;u.next()){var d=u.value;if(d.isDefault){s.CoreAssert.isTrue(d.activated,"MultiBrandFacade.determineDefaultBrand found multiple brands, one of which is not activated","MultiBrandFacade.determineDefaultBrand","MultiBrandFacade.swift",251),t=(o=d).id;break}}}}null!=o&&o.isMinimal&&c.Host.logging.info("MultiBrandFacade.determineDefaultBrand: default brand is in minimal sync state!"),n.defaultBrandkitID!=t?(c.Host.logging.info("MultiBrandFacade.determineDefaultBrand: changing from "+n.brandInfo(n.defaultBrandkitID)+" to "+n.brandInfo(t)),n._defaultBrandkitID=t,n.usingMockedACManager||c.Host.brandkitManager.sendDefaultBrandChangedNotification(n.defaultBrandkitID)):c.Host.logging.info("MultiBrandFacade.determineDefaultBrand: no change, still using "+((r=n.defaultBrandkitID)||null!=r?r:"none"))},brandWasDeleted:function(e){n.determineDefaultBrand(),n.activeBrandkitID==e&&(c.Host.logging.info("MultiBrandFacade.onAuthoringContextDeleted:  Active Brand was deleted!"),n.setActiveBrandkitID(n.defaultBrandkitID))},brandInfo:function(e){var r,t="none";return(r=n.authoringContext(e))&&(t=r.name+":"+r.id),t},addBrandkit:function(e){var r;return 0!=n.ownedBrandCount&&i.opt(c.Host.logging,(function(e){return e.assertFailure("addBrandkit called when user already owns at least one Brandkit")})),(r=n.acManager.createAuthoringContext(e,!0))?(c.Host.platform.isIOS?i.opt(c.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsDataBrandkitCreatediOS,{})})):c.Host.platform.isAndroid&&i.opt(c.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsDataBrandkitCreatedAndroid,{})})),r):null}}}),n)},"LP+A":function(e,r,t){var n,o=r,a=t("oAGj"),i=t("gXiO"),l=t("iSwi"),s=t("LqGn");o.DesignSuggestionFacade=(n=function(){i.CoreObject.call(this)},a.defineClass({name:"DesignSuggestionFacade",ctor:n,superName:"CoreObject",statics:{createSuggestionsFromTemplate:function(e,r,t,n){void 0===n&&(n=10);var o=new l.RetargetSuggester(r,t,e),i=a.clone(o.createSuggestions()).filter((function(e){return e instanceof s.RetargetSuggestion}),this).map((function(e){return e}),this);return i.slice(0,Math.min(i.length,n))}}}),n)},MWx2:function(e,r,t){var n,o=r,a=t("oAGj");o.HandleFacade=(n=function(){},a.defineClass({name:"HandleFacade",ctor:n}),n)},MYNe:function(e,r,t){var n,o=r,a=t("oAGj"),i=t("gXiO");o.LayerFacade=(n=function(){i.CoreObject.call(this)},a.defineClass({name:"LayerFacade",ctor:n,superName:"CoreObject",statics:{sortInZOrder:function(e){var r=a.clone(e);return a.sortInPlace(r,(function(e,r){return n.getZOrder(e)<n.getZOrder(r)})),r},getZOrder:function(e){var r;return(r=e.controller)?r.getZOrder():0},setZOrder:function(e,r){a.opt(r.controller,(function(r){return r.setZOrder(e)}))},getMinLayerIndex:function(e){var r;return(r=e.controller)?r.getMinLayerIndex():0},getReorderableLayerCount:function(e){var r;return(r=e.controller)?r.getReorderableLayerCount():0}}}),n)},O8XL:function(e,r,t){var n,o,a=r,i=t("oAGj"),l=t("0wFF"),s=t("cZuM"),u=t("SpAV"),c=t("gXiO"),d=t("wNKJ"),m=t("FNB+"),f=t("iCxV"),g=t("tGKA"),p=t("3DEm");a.DistributeType=i.defineEnum("DistributeType",{HorizontalSpace:0,LeftEdge:1,CenterX:2,RightEdge:3,VerticalSpace:4,TopEdge:5,CenterY:6,BottomEdge:7,Row:8,Column:9}),a.describeDistributeType=function(e){switch(e){case 0:return"HorizontalSpace";case 1:return"LeftEdge";case 2:return"CenterX";case 3:return"RightEdge";case 4:return"VerticalSpace";case 5:return"TopEdge";case 6:return"CenterY";case 7:return"BottomEdge";case 8:return"Row";case 9:return"Column"}},a.FormaGeometryInfo=(n=function(){this.minEdge=99999999.9,this.maxEdge=-99999999.9,this.totalObjectSpan=0,this.interiorFormaeSortedByPosition=[]},i.defineClass({name:"FormaGeometryInfo",ctor:n,props:{getNumFormae:function(){return i.eq(m._equality_Forma_Forma,this.firstForma,this.lastForma)?this.interiorFormaeSortedByPosition.length+1:this.interiorFormaeSortedByPosition.length+2}}}),n),a.AlignmentFacade=(o=function(){c.CoreObject.call(this)},i.defineClass({name:"AlignmentFacade",ctor:o,superName:"CoreObject",statics:{arrangeFormae:function(e,r){i.opt(f.Host.logging,(function(t){return t.logToAnalytics(l.AnalyticsConstants.kAnalyticsFormaeArranged,{contextualData1:"horizontal: "+e,contextualData2:"formae count: "+r.length})})),o.distributeOrArrangeFormae(e?a.DistributeType.Row:a.DistributeType.Column,i.clone(r)),o.rescueFormae(i.clone(r))},distributeFormae:function(e,r){i.opt(f.Host.logging,(function(t){return t.logToAnalytics(l.AnalyticsConstants.kAnalyticsFormaeDistributed,{contextualData1:"type: "+a.describeDistributeType(e),contextualData2:"formae count: "+r.length})})),u.CoreAssert.isTrue(r.length>2,"not enough formae to distribute","AlignmentFacade.distributeFormae","AlignmentFacade.swift",79),u.CoreAssert.isTrue(e!=a.DistributeType.Row&&e!=a.DistributeType.Column,"Use arrangeFormae to do row/column layout","AlignmentFacade.distributeFormae","AlignmentFacade.swift",80),o.distributeOrArrangeFormae(e,i.clone(r)),o.rescueFormae(i.clone(r))},alignFormae:function(e,r){i.opt(f.Host.logging,(function(t){return t.logToAnalytics(l.AnalyticsConstants.kAnalyticsFormaeAligned,{contextualData1:"type: "+s.describeAlignmentType(e),contextualData2:"formae count: "+r.length})})),e==s.AlignmentType.CenterX||e==s.AlignmentType.CenterY?o.alignCenters(e,i.clone(r)):o.alignEdges(e,i.clone(r)),o.rescueFormae(i.clone(r))},rescueFormae:function(e){for(var r=i.iter(e);!r.done;r.next()){var t=r.value;d.DragFacade.rescueFormaToPageBounds(t)}},calculateFormaGeometryInfo:function(e,r){u.CoreAssert.isTrue(r.length>=2,"Not enough forma to distribute","AlignmentFacade.calculateFormaGeometryInfo","AlignmentFacade.swift",110);for(var t=new a.FormaGeometryInfo,n=i.iter(r);!n.done;n.next()){var l=n.value.controller.getUserPerceivedFrame();if(null!=l)switch(e){case 0:case 1:case 2:case 3:case 8:t.minEdge=p.MathUtils.minDouble(t.minEdge,l.minX),t.maxEdge=p.MathUtils.maxDouble(t.maxEdge,l.maxX),t.totalObjectSpan+=l.maxX-l.minX;break;case 4:case 5:case 6:case 7:case 9:t.minEdge=p.MathUtils.minDouble(t.minEdge,l.minY),t.maxEdge=p.MathUtils.maxDouble(t.maxEdge,l.maxY),t.totalObjectSpan+=l.maxY-l.minY}}var s=i.sort(r,(function(r,t){var n=r.controller.getUserPerceivedFrame(),o=t.controller.getUserPerceivedFrame();if(null!=n&&null!=o)switch(e){case 0:case 1:case 2:case 3:case 8:return n.minX<o.minX;case 4:case 5:case 6:case 7:case 9:return n.minY<o.minY}return!1}));t.firstForma=i.first(s),t.lastForma=i.last(s);for(var c=i.iter(s);!c.done;c.next()){var d=c.value,f=d.controller.getUserPerceivedFrame(),g=t.firstForma.controller.getUserPerceivedFrame(),F=t.lastForma.controller.getUserPerceivedFrame();switch(e){case 0:case 1:case 2:case 3:case 8:o.isVeryClose(g.minX,f.minX)&&f.width>g.width&&(t.firstForma=d),(f.maxX>F.maxX||o.isVeryClose(f.maxX,F.maxX)&&f.width>F.width)&&(t.lastForma=d);break;case 4:case 5:case 6:case 7:case 9:o.isVeryClose(g.minY,f.minY)&&f.height>g.height&&(t.firstForma=d),(f.maxY>F.maxY||o.isVeryClose(f.maxY,F.maxY)&&f.height>F.height)&&(t.lastForma=d)}}return i.remove(s,t.firstForma),i.eq(m._equality_Forma_Forma,t.firstForma,t.lastForma)||i.remove(s,t.lastForma),t.interiorFormaeSortedByPosition=i.clone(s),t},distributeOrArrangeFormae:function(e,r){var t=o.calculateFormaGeometryInfo(e,i.clone(r));u.CoreAssert.isTrue(null!=t.firstForma,"expected to have a firstForma computed","AlignmentFacade.distributeOrArrangeFormae","AlignmentFacade.swift",194),u.CoreAssert.isTrue(null!=t.lastForma,"expected to have a lastForma computed","AlignmentFacade.distributeOrArrangeFormae","AlignmentFacade.swift",195),u.CoreAssert.isTrue(t.getNumFormae()==r.length,"expected sorted formae to match formae list","AlignmentFacade.distributeOrArrangeFormae","AlignmentFacade.swift",196),e==a.DistributeType.Row||e==a.DistributeType.Column||e==a.DistributeType.VerticalSpace||e==a.DistributeType.HorizontalSpace?o.distributeSpaceOrMakeRowColumn(t,e):o.distributeEdges(t,e)},distributeEdges:function(e,r){u.CoreAssert.isTrue(e.getNumFormae()>=3,"expected at least 3 items to distribute","AlignmentFacade.distributeEdges","AlignmentFacade.swift",206),u.CoreAssert.isTrue(r==a.DistributeType.LeftEdge||r==a.DistributeType.CenterX||r==a.DistributeType.RightEdge||r==a.DistributeType.TopEdge||r==a.DistributeType.CenterY||r==a.DistributeType.BottomEdge,"unexpected distribute type","AlignmentFacade.distributeEdges","AlignmentFacade.swift",207);var t=0,n=0,o=e.firstForma.controller.getUserPerceivedFrame(),l=e.lastForma.controller.getUserPerceivedFrame();switch(u.CoreAssert.isTrue(null!=o&&null!=l,"expecting formae to have frames","AlignmentFacade.distributeEdges","AlignmentFacade.swift",214),r){case 1:t=o.minX,n=l.minX;break;case 5:t=o.minY,n=l.minY;break;case 3:t=o.maxX,n=l.maxX;break;case 7:t=o.maxY,n=l.maxY;break;case 2:t=(o.maxX+o.minX)/2,n=(l.maxX+l.minX)/2;break;case 6:t=(o.maxY+o.minY)/2,n=(l.maxY+l.minY)/2;break;default:u.CoreAssert.isTrue(!1,"unexpected distribute type","AlignmentFacade.distributeEdges","AlignmentFacade.swift",235)}for(var s=(n-t)/i.toDouble(e.getNumFormae()-1),c=t+s,d=i.iter(e.interiorFormaeSortedByPosition);!d.done;d.next()){var m=d.value,f=m.controller.getUserPerceivedFrame();if(null!=f){var p=0,F=0;switch(r){case 1:p=c-f.minX,c=f.minX+p+s;break;case 3:p=c-f.maxX,c=f.maxX+p+s;break;case 5:F=c-f.minY,c=f.minY+F+s;break;case 7:F=c-f.maxY,c=f.maxY+F+s;break;case 2:var C=(f.maxX+f.minX)/2;c=C+(p=c-C)+s;break;case 6:var v=(f.maxY+f.minY)/2;c=v+(F=c-v)+s;break;default:u.CoreAssert.isTrue(!1,"unexpected distribute type","AlignmentFacade.distributeEdges","AlignmentFacade.swift",275)}if(0!=p||0!=F){var h=new g.Matrix2D(1,0,0,1,p,F);i.opt(m.controller,(function(e){return e.move(h)}))}}}},isVeryClose:function(e,r){return p.MathUtils.absDouble(e-r)<1e-4},getRequiredShiftAmount:function(e,r,t){var n=0;if(t==a.DistributeType.Row||t==a.DistributeType.Column){var o,l,s=e.totalObjectSpan+r*i.toDouble(e.getNumFormae()-1),u=e.firstForma.controller.getUserPerceivedFrame();t==a.DistributeType.Row?(o=u.minX+s,l=e.firstForma.page.pageSize.width):(o=u.minY+s,l=e.firstForma.page.pageSize.height),o>l&&(n=s>l?t==a.DistributeType.Row?-1*u.minX:-1*u.minY:l-o)}return n},getFormaSpacingForRowCol:function(e,r){var t=e.totalObjectSpan/(10*i.toDouble(e.getNumFormae())),n=e.totalObjectSpan/(5*i.toDouble(e.getNumFormae())),a=e.totalObjectSpan/(2*i.toDouble(e.getNumFormae()));return r<0?0:o.isVeryClose(r,t)?n:o.isVeryClose(r,n)?a:o.isVeryClose(r,a)?0:t},distributeSpaceOrMakeRowColumn:function(e,r){var t,n;u.CoreAssert.isTrue(r==a.DistributeType.Row||r==a.DistributeType.Column||r==a.DistributeType.VerticalSpace||r==a.DistributeType.HorizontalSpace,"wrong distribute type","AlignmentFacade.distributeSpaceOrMakeRowColumn","AlignmentFacade.swift",358);var l,s=(e.maxEdge-e.minEdge-e.totalObjectSpan)/i.toDouble(e.getNumFormae()-1),c=e.interiorFormaeSortedByPosition.concat();r!=a.DistributeType.Row&&r!=a.DistributeType.Column||(c.push(e.lastForma),s=o.getFormaSpacingForRowCol(e,s)),l=r==a.DistributeType.Row||r==a.DistributeType.HorizontalSpace?((t=i.opt(e.firstForma.controller.getUserPerceivedFrame(),(function(e){return e.maxX})))||null!=t?t:0)+s:((n=i.opt(e.firstForma.controller.getUserPerceivedFrame(),(function(e){return e.maxY})))||null!=n?n:0)+s;var d=o.getRequiredShiftAmount(e,s,r);0!=d&&c.splice(0,0,e.firstForma);for(var f=i.iter(c);!f.done;f.next()){var p=f.value,F=p.controller.getUserPerceivedFrame();if(null!=F){var C=0,v=0;if(i.eq(m._equality_Forma_Forma,p,e.firstForma)&&!i.eq(m._equality_Forma_Forma,p,e.lastForma)?(u.CoreAssert.isTrue(0!=d,"shouldn't be moving first element","AlignmentFacade.distributeSpaceOrMakeRowColumn","AlignmentFacade.swift",399),r==a.DistributeType.Row?(C=d,l=F.maxX+C+s):(u.CoreAssert.isTrue(r==a.DistributeType.Column,"Shouldn't have a shift unless we're doing Row or Column layout","AlignmentFacade.distributeSpaceOrMakeRowColumn","AlignmentFacade.swift",405),v=d,l=F.maxY+v+s)):r==a.DistributeType.Row||r==a.DistributeType.HorizontalSpace?(C=l-F.minX,l=F.maxX+C+s):(v=l-F.minY,l=F.maxY+v+s),0!=C||0!=v){var h=new g.Matrix2D(1,0,0,1,C,v);i.opt(p.controller,(function(e){return e.move(h)}))}}}},alignCenters:function(e,r){u.CoreAssert.isTrue(e==s.AlignmentType.CenterX||e==s.AlignmentType.CenterY,void 0,"AlignmentFacade.alignCenters","AlignmentFacade.swift",435);for(var t=99999999.9,n=-99999999.9,o=i.iter(r);!o.done;o.next())null!=(d=(c=o.value).controller.getUserPerceivedFrame())&&(e==s.AlignmentType.CenterX?(t=p.MathUtils.minDouble(t,d.minX),n=p.MathUtils.maxDouble(n,d.maxX)):(t=p.MathUtils.minDouble(t,d.minY),n=p.MathUtils.maxDouble(n,d.maxY)));for(var a=(t+n)/2,l=i.iter(r);!l.done;l.next()){var c,d;if(null!=(d=(c=l.value).controller.getUserPerceivedFrame())){var m=0,f=0;if(e==s.AlignmentType.CenterX?m=a-(d.minX+d.maxX)/2:f=a-(d.minY+d.maxY)/2,0!=m||0!=f){var F=new g.Matrix2D(1,0,0,1,m,f);i.opt(c.controller,(function(e){return e.move(F)}))}}}},alignEdges:function(e,r){var t=99999999.9;e!=s.AlignmentType.Right&&e!=s.AlignmentType.Bottom||(t*=-1);for(var n=i.iter(r);!n.done;n.next())null!=(l=(a=n.value).controller.getUserPerceivedFrame())&&(e==s.AlignmentType.Left?t=p.MathUtils.minDouble(t,l.minX):e==s.AlignmentType.Right?t=p.MathUtils.maxDouble(t,l.maxX):e==s.AlignmentType.Top?t=p.MathUtils.minDouble(t,l.minY):e==s.AlignmentType.Bottom?t=p.MathUtils.maxDouble(t,l.maxY):u.CoreAssert.isTrue(!1,"align to type "+e+" not yet implemented","AlignmentFacade.alignEdges","AlignmentFacade.swift",498));for(var o=i.iter(r);!o.done;o.next()){var a,l;if(null!=(l=(a=o.value).controller.getUserPerceivedFrame())){var c=0,d=0;if(e==s.AlignmentType.Left?c=t-l.minX:e==s.AlignmentType.Right?c=t-l.maxX:e==s.AlignmentType.Top?d=t-l.minY:e==s.AlignmentType.Bottom&&(d=t-l.maxY),0!=c||0!=d){var m=new g.Matrix2D(1,0,0,1,c,d);i.opt(a.controller,(function(e){return e.move(m)}))}}}}}}),o)},T8w7:function(e,r,t){var n,o=r,a=t("oAGj"),i=t("gXiO"),l=t("uxH+");o.OpacityFacade=(n=function(){i.CoreObject.call(this)},a.defineClass({name:"OpacityFacade",ctor:n,superName:"CoreObject",statics:{applyOpacity:function(e,r){for(var t=a.iter(r);!t.done;t.next()){var n=t.value;a.opt(n.controller,(function(r){return r.applyOpacity(e)}))}},getOpacityForForma:function(e){var r;return(r=a.opt(e.controller,(function(e){return e.currentOpacity})))||null!=r?r:1},applyBackgroundOpacity:function(e,r){var t;(t=a.as(r.root.controller,l.RootController))&&t.setBackgroundTransparency(e)},getBackgroundOpacity:function(e){var r;return(r=a.as(e.root.controller,l.RootController))?r.getBackgroundTransparency():1}}}),n)},V3yt:function(e,r,t){var n,o=r,a=t("oAGj"),i=t("yGNn"),l=t("iCxV");o.FontFacade=(n=function(){},a.defineClass({name:"FontFacade",ctor:n,statics:{ensureFontLoaded:function(e){switch(e.availability){case 1:var r;return(r=l.Host.fontProvider)?new i.CorePromise((function(t,n){return r.loadFont(e,(function(){return t(e)}),(function(){return n("could not load font")}))})):i.CorePromise.reject("Host.fontProvider not available; can't load font.");case 2:return i.CorePromise.resolve(e);case 3:return i.CorePromise.reject("font cannot be loaded");case 0:return i.CorePromise.reject("font unknown loadable")}}}}),n)},X0GW:function(e,r,t){var n,o=r,a=t("oAGj"),i=t("SpAV"),l=t("gXiO"),s=t("yGNn"),u=t("FNB+"),c=t("ZK0l"),d=t("pnSN"),m=t("6Rk9"),f=t("iCxV"),g=t("MYNe"),p=t("tGKA"),F=t("JFv5"),C=t("sIWg");o.GroupFacade=(n=function(){l.CoreObject.call(this)},a.defineClass({name:"GroupFacade",ctor:n,superName:"CoreObject",statics:{groupItems:function(e){return 0==e.length?s.CorePromise.resolve([]):(r=n.createGroupFromFormae(a.clone(e)))?(r.intent=u.Forma.INTENT_USER_GROUP,s.CorePromise.resolve(r)):s.CorePromise.reject("couldn't create a group");var r},updateUserGroupBounds:function(e){i.CoreAssert.isTrue(e.controller.userGroup,void 0,"GroupFacade.updateUserGroupBounds","GroupFacade.swift",33);var r=a.clone(e.childrenAsArray);if(r.length>0){for(var t={},n=m.GeometryFacade.unionFrame(a.clone(r)),o=a.iter(r);!o.done;o.next())t[(d=o.value).formaID]=d.finalFrame,e.root.appendChild(d,!0);var l=e.placement.calculateTransformValuesSKRT(),s=p.Matrix2D.rotation(l.rotCosine,l.rotSine).transformPoint(n.origin);e.bounds=C.TheoRect.fromSize(n.size),e.placement=e.placement.translateXY(s.x,s.y);for(var u=a.iter(r);!u.done;u.next()){var c,d=u.value;e.appendChild(d,!0),(c=d.finalFrame)&&(t[d.formaID].equalWithAccuracy(c,.001)||f.Host.logging.warning("error. a child's position changed in updateUserGroupBounds."))}}},updateUserGroupHierarchy:function(e){for(var r,t=e;((r=a.opt(a.opt(t,(function(e){return e.controller})),(function(e){return e.userGroup})))||null!=r)&&r;)n.updateUserGroupBounds(t),t=a.opt(t,(function(e){return e.parent}))},createGroupFromFormae:function(e){var r;if(0==e.length)return null;var t,n,o=m.GeometryFacade.unionFrame(a.clone(e)),i=e.concat(),l=a.as(a.opt(a.first(e),(function(e){return e.page.createFormaWithController(d.GroupForma.KIND,c.GroupController.KIND)})),d.GroupForma);if((t=l)&&(n=o)){a.opt(a.opt(a.first(e),(function(e){return e.parent})),(function(e){return e.appendChild(t)})),t.intent=u.Forma.INTENT_USER_GROUP,t.placement=p.Matrix2D.translationXY(n.minX,n.minY),t.bounds=C.TheoRect.fromSize(n.size);var s=t.controller;s.preferredResizeType=F.ResizeLayoutType.Proportional,s.preserveResizeController=!0;for(var f=0,v=a.iter(i);!v.done;v.next()){var h=v.value;f=Math.max(f,(r=a.opt(h.parent,(function(e){return e.indexOfChild(h)})))||null!=r?r:0)}a.opt(t.parent,(function(e){return e.insertChildAt(t,f,!0)}));for(var y=a.iter(g.LayerFacade.sortInZOrder(a.clone(i)));!y.done;y.next())h=y.value,t.appendChild(h,!0);return t}return null},cleanupGroup:function(e){for(var r,t=a.iter(e.childrenAsArray);!t.done;t.next()){var n=t.value,o=(r=a.opt(e.parent,(function(r){return r.indexOfChild(e)})))||null!=r?r:e.childCount;a.opt(e.parent,(function(e){return e.insertChildAt(n,o,!0)}))}e.removeFromParent()},ungroupItems:function(e){var r,t;if(0==e.length)return s.CorePromise.resolve([]);for(var o=[],i=[],l=[],u=!1,c=a.iter(e);!c.done;c.next()){var d,m=c.value;((r=a.opt(m.controller,(function(e){return e.userGroup})))||null!=r)&&r?(a.append(o,m.childrenAsArray),a.append(l,m.childrenAsArray)):(g=m.controller)&&(d=g.userGroupRoot)&&(u=!0,o.push(m),a.append(l,d.childrenAsArray))}for(var f=a.iter(l);!f.done;f.next()){var g,p,F,C;if((g=(m=f.value).controller)&&(p=m.parent)&&(F=a.opt(m.parent,(function(e){return e.parent})))&&null!=(C=F.indexOfChild(p))&&g.userGroupChild)if(F.insertChildAt(m,C,!0),p.childCount<=1){for(var v=a.iter(p.childrenAsArray);!v.done;v.next()){var h=v.value,y=(t=F.indexOfChild(p))||null!=t?t:F.childCount;F.insertChildAt(h,y,!0),u||o.push(h)}p.removeFromParent()}else i.includes(p)||i.push(p)}for(var I=a.iter(i);!I.done;I.next()){var A=I.value;n.updateUserGroupBounds(A)}return s.CorePromise.resolve(a.clone(o))},getGroupDepth:function(e){var r,t=0;return e.visit(u.FormaTraversal.PreOrder,(function(e,n,o){return((r=a.opt(e.controller,(function(e){return e.userGroupChild})))||null!=r)&&r&&(t=Math.max(t,n)),!1})),t}}}),n)},cYKp:function(e,r,t){var n,o=r,a=t("oAGj"),i=t("gXiO");o.AnimationFacade=(n=function(){i.CoreObject.call(this)},a.defineClass({name:"AnimationFacade",ctor:n,superName:"CoreObject",statics:{applyAnimationStyle:function(e,r){r.animationLibrary.modifyModelForAnimation(e,r.root)},shuffleAnimationStyle:function(e,r){return r.animationLibrary.getNextAnimationStyleOfSameType(e)}}}),n)},"gBh/":function(e,r,t){var n,o=r,a=t("oAGj"),i=t("gXiO");o.ColorThemeFacade=(n=function(){i.CoreObject.call(this)},a.defineClass({name:"ColorThemeFacade",ctor:n,superName:"CoreObject",statics:{applyColorTheme:function(e,r,t){t.colorLibraryController.applyColorTheme(a.clone(e),r,!0)},shuffleColorTheme:function(e){e.colorLibraryController.shuffleColorAssignments()},modifyColorTheme:function(e,r,t){t.colorLibraryController.setTheoColorToLibrary(e,r)}}}),n)},gpZI:function(e,r,t){var n,o,a=r,i=t("oAGj"),l=t("SpAV"),s=t("gXiO"),u=t("ascj"),c=t("6ZWm"),d=t("cmoc"),m=t("lmwz"),f=t("c+uM"),g=t("T6jX"),p=t("8t9B");a.SavedColorState=(n=function(e,r,t,n){this.formae=i.clone(e),this.colorLibraryState=r,this.primaryColorIDs=i.clone(t),this.secondaryColorIDs=i.clone(n)},i.defineClass({name:"SavedColorState",ctor:n,superName:"CoreObject"}),n),a.ColorFacade=(o=function(){s.CoreObject.call(this)},i.defineClass({name:"ColorFacade",ctor:o,superName:"CoreObject",statics:{applyColorsToForma:function(e,r,t,n){void 0===t&&(t=!1),void 0===n&&(n=0);var a,l,s=n%2==0?u.ColorRole.FieldPrimary:u.ColorRole.FieldSecondary;if(e.isTypeLockup())return(a=i.opt(i.as(e.controller,p.TypeLockupController),(function(e){return e.styleController})))&&(t&&i.opt(i.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.selection.inCharStyleMode=!0})),o.getDominantColorRoleOfLockup(e)==u.ColorRole.FieldSecondary&&(s=s==u.ColorRole.FieldPrimary?u.ColorRole.FieldSecondary:u.ColorRole.FieldPrimary),a.applyColors(i.clone(r),s)),e;if(e instanceof d.FrameForma){if(l=g.TheoDocumentUtils.getCellBackgroundShape(e))i.opt(l.controller,(function(e){return e.applyColors(i.clone(r),s)}));else if(null!=i.as(e.controller,c.FrameController))return m.ImageFacade.replaceImageWithColors(e,i.clone(r))}else i.opt(e.controller,(function(e){return e.applyColors(i.clone(r),s)}));return e},applyColorsToFormae:function(e,r,t,n){return void 0===t&&(t=!1),void 0===n&&(n=0),e.map((function(e){return o.applyColorsToForma(e,i.clone(r),t,n)}),this)},getDominantColorRoleOfLockup:function(e){var r;if(e.isTypeLockup()&&(r=i.opt(i.as(e.controller,p.TypeLockupController),(function(e){return e.styleController})))){var t=r.targetedLockupStyle;return t.textLook==f.LockupTextLook.KnockoutOnly||t.textLook==f.LockupTextLook.OutlineOnly?u.ColorRole.FieldSecondary:u.ColorRole.FieldPrimary}return u.ColorRole.FieldPrimary},getSavedColorState:function(e){var r,t;l.CoreAssert.isTrue(e.length>0,"empty Forma array","ColorFacade.getSavedColorState","ColorFacade.swift",96);var n=e[0].page.colorLibraryController.recordUndoState(),o=e.map((function(e){return(r=e.style.colors.colorID(u.ColorRole.FieldPrimary))||null!=r?r:""}),this),s=e.map((function(e){return(t=e.style.colors.colorID(u.ColorRole.FieldSecondary))||null!=t?t:""}),this);return new a.SavedColorState(i.clone(e),n,i.clone(o),i.clone(s))}}}),o)},kYI4:function(e,r,t){var n,o=r,a=t("oAGj"),i=t("0wFF"),l=t("SpAV"),s=t("CWW7"),u=t("gXiO"),c=t("yGNn"),d=t("ascj"),m=t("QgZx"),f=t("ZK0l"),g=t("iCxV"),p=t("3lr5"),F=t("q5zr"),C=t("fdtz"),v=t("c+uM"),h=t("VkKB"),y=t("umUn"),I=t("VJ9E"),A=t("8t9B");o.AUTHORING_CONTEXT_TYPE_LOGO="LOGO",o.AUTHORING_CONTEXT_TYPE_FONT="FONT",o.AUTHORING_CONTEXT_TYPE_COLOR="COLOR",o.SPARK_LOGO_ROLE_PRIMARY="primary-logo",o.SPARK_LOGO_ROLE_SECONDARY="secondary-logo",o.SPARK_LOGO_ROLE_POST_STAMP="post-stamp",o.IAuthoringContextManager=a.defineProtocol("IAuthoringContextManager",{authoringContexts:"Array<IAuthoringContext>",authoringContext:"(String) -> IAuthoringContext",getOwnedAuthoringContextIDs:"() -> Array<String>",createAuthoringContext:"(String, Boolean) -> IAuthoringContext"}),o.IAuthoringContext=a.defineProtocol("IAuthoringContext",{id:"String",name:"String",activated:"Boolean",isDefault:"Boolean",contextID:"String",colors:"Array<IAuthoringContextColor>",fonts:"Array<IAuthoringContextFont>",logos:"Array<IAuthoringContextLogo>",isMinimal:"Boolean",isValidVersion:"Boolean",ownedByCurrentUser:"Boolean",isBrandkitComplete:"() -> Boolean"}),o.IAuthoringContextColor=a.defineProtocol("IAuthoringContextColor",{id:"String",acRoles:"Array<String>",red:"Double",green:"Double",blue:"Double",alpha:"Double"}),o.IAuthoringContextFont=a.defineProtocol("IAuthoringContextFont",{id:"String",acRoles:"Array<String>",sourceType:"String",descriptor:"FontDescriptor"}),o.IAuthoringContextLogo=a.defineProtocol("IAuthoringContextLogo",{id:"String",acRoles:"Array<String>",acName:"String",url:"String",pixelWidth:"Integer",pixelHeight:"Integer",mimeType:"String"}),o.BrandingFacade=(n=function(){u.CoreObject.call(this)},a.defineClass({name:"BrandingFacade",ctor:n,superName:"CoreObject",statics:{brandifyDocument:function(e,r,t,o,a){return void 0===t&&(t=!0),void 0===o&&(o=!0),void 0===a&&(a=!0),l.CoreAssert.isTrue(""!=r.id,void 0,"BrandingFacade.brandifyDocument","BrandingFacade.swift",120),n.addBrandLogo(e,r,o).then((function(o){return a&&n.brandifyColors(e,r),t&&n.brandifyFonts(e,r),null}))},addBrandLogo:function(e,r,t){void 0===t&&(t=!0);var i=c.CorePromise.resolve(null);if(t){var l,u=r.logos.filter((function(e){return!a.isEmpty(e.url)&&e.acRoles.includes(o.SPARK_LOGO_ROLE_POST_STAMP)}),this);if((l=a.first(u))&&null==a.first(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==C.ImageForma.KIND})))){var d=n.makeLogoContentNode(l,e);i=i.then((function(r){return s.CreationFacade.addContent(e.firstPage,d,void 0,void 0,new s.AddFormaParams(void 0,void 0,null))}))}}return i},brandifyColors:function(e,r,t){void 0===t&&(t=!1),n.updateBrandedColorPalette(e,r,t)},updateBrandedColorPalette:function(e,r,t){for(var n=0,o=0,i=a.clone(e.firstPage.colorLibraryController.getTheoColorsUsedInDocument()),s=a.iter(i);!s.done;s.next()){var u=s.value;u.isBrandkitSecondaryColor()&&(o+=1),u.isBrandkitShade()&&(n+=1)}for(var c=o>0&&o>=n,m=[],f=a.iter(r.colors);!f.done;f.next()){var g=f.value,p=y.TheoColor.init_bb45(g);(c&&(p.isBrandkitSecondaryColor()||p.isBrandkitPrimaryColor())||!c&&p.isBrandkitShade())&&m.push(p)}if(m.length>0){var F;if(t)if(null!=(h=e.firstPage.root.controller.getGridController())){l.CoreAssert.isTrue(h.gridStyle.gridCells.length>=1,"expecting to have a grid with at least one cell","BrandingFacade.updateBrandedColorPalette","BrandingFacade.swift",216);var C=h.forma.childAt(0).style.colors.colorID(d.ColorRole.FieldPrimary);null!=C&&(F=e.firstPage.colorLibraryController.getTheoColorForKey(C))}else{var v=e.firstPage.root.style.colors.colorID(d.ColorRole.FieldPrimary);null!=v&&(F=e.firstPage.colorLibraryController.getTheoColorForKey(v))}if(e.firstPage.colorLibraryController.applyColorTheme(a.clone(m),"brandkit"),t){if(null!=F){var h,I=e.firstPage.colorLibraryController.getKeyOfColorInTheme(F);null==I&&(I=e.firstPage.colorLibraryController.addNewThemeKeyWithColor(F)),null!=(h=e.firstPage.root.controller.getGridController())?h.forma.childAt(0).style.colors.setColorId(d.ColorRole.FieldPrimary,I):e.firstPage.root.style.colors.setColorId(d.ColorRole.FieldPrimary,I)}}else e.firstPage.colorLibraryController.shuffleColorAssignments()}else a.info("addBranding asked to update color palette, but brandkit doesn't have any colors. Hope that's ok.")},brandifyFonts:function(e,r){var t=n.getTheoFontForRole(I.TheoFont.SPARK_FONT_ROLE_HEADLINE,r);if(null==t)if(r.fonts.length>0){var o,i=r.fonts[0];(o=n.getFontFromIncludedFonts(i.descriptor))?t=I.TheoFont.init_9e5c(o,i.id,a.clone(i.acRoles)):(a.info("addBranding asked to apply fonts, but brandkit doesn't have a headline font, so we're just picking some random font. Hope that's ok."),t=I.TheoFont.init_9e5c(g.Host.fontProvider.getIncludedFonts(e).fontAt(0)))}else a.info("addBranding asked to apply fonts, but brandkit doesn't have any fonts. Hope that's ok.");if(null!=t){for(var l=!1,s=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!s.done;s.next()){var u,c=s.value;(u=a.as(c.style,v.LockupStyle))&&(u.font=t,l=!0)}0==l&&a.info("addBranding asked to apply fonts, but document contains no text lockups, so we can't. Hope that's ok.")}},getTheoFontForRole:function(e,r){for(var t,o=a.iter(r.fonts);!o.done;o.next()){var i,l=o.value;if(i=n.getFontFromIncludedFonts(l.descriptor)){var s=I.TheoFont.init_9e5c(i,l.id,a.clone(l.acRoles));if(s.getSparkFontRole()==e){t=s;break}}}return t},getFontFromIncludedFonts:function(e){if(null==e)return null;var r,t=g.Host.fontProvider.getIncludedFonts(p.ANY_DOCUMENT);return null!=(r=t.indexOf(e))?t.fontAt(r):null},changeBranding:function(e,r){return c.CorePromise.resolve(null).then((function(t){return null==r?""==e.authoringContextID?null:n.removeBranding(e):e.authoringContextID==r.id?null:""==e.authoringContextID?(a.opt(g.Host.brandkitManager,(function(e){return e.activateBrand(r.id)})),null):n.addBranding(e,r)}))},addBranding:function(e,r){return l.CoreAssert.isTrue(""!=r.id,void 0,"BrandingFacade.addBranding","BrandingFacade.swift",408),n.applyLogoForAddBranding(e,r).then((function(t){return a.opt(g.Host.fontProvider,(function(e){return e.registerBrandFonts(r.id)})),n.applyBrandFontsForAddBranding(e,r),n.applyColorsForAddBranding(e,r),a.opt(g.Host.brandkitManager,(function(e){return e.activateBrand(r.id)})),e.authoringContextID=r.id,null}))},applyLogoForAddBranding:function(e,r){for(var t=[],o=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==C.ImageForma.KIND})));!o.done;o.next()){var i=o.value;t.push(i)}for(var l=c.CorePromise.resolve(null),u=a.iter(t);!u.done;u.next()){var d=u.value,m=a.as(e.content.nodeByID(d.contentID),F.ImageContentNode),f=n.getReplacementLogoContentNode(e,r,m.getSparkLogoRole());null!=f&&(l=l.then((function(r){return s.CreationFacade.addContent(e.firstPage,f,void 0,void 0,new s.AddFormaParams(void 0,void 0,d.parent))})))}return l},applyColorsForAddBranding:function(e,r){for(var t=[],n=a.iter(r.colors);!n.done;n.next()){var o=n.value;t.push(y.TheoColor.init_bb45(o))}t.length>0&&e.firstPage.colorLibraryController.updateSparkColorsByRole(a.clone(t))},applyBrandFontsForAddBranding:function(e,r){for(var t,n=[],o=a.iter(r.fonts);!o.done;o.next()){var i=o.value,l=I.TheoFont.init_a314(i);n.push(l),l.getSparkFontRole()==I.TheoFont.SPARK_FONT_ROLE_BODY&&(t=l)}for(var s=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!s.done;s.next()){var u,c=s.value;if(u=a.as(c.style,v.LockupStyle)){var d;if((d=u.font)&&d.isSparkFont()){for(var m,f=t,g=a.iter(n);!g.done;g.next())if(i=g.value,d.getSparkFontRole()==i.getSparkFontRole()){f=i;break}(m=f)&&(u.font=m)}for(var p=a.iter(u.characterStyles);!p.done;p.next()){var F,C=p.value;if((F=C.font)&&F.isSparkFont()){f=t;for(var h=a.iter(n);!h.done;h.next())if(i=h.value,F.getSparkFontRole()==i.getSparkFontRole()){f=i;break}null!=f&&(C.font=f)}}}}},getReplacementLogoContentNode:function(e,r,t){for(var i,l=a.iter(r.logos);!l.done;l.next())for(var s=l.value,u=a.iter(s.acRoles);!u.done;u.next()){var c=u.value;if(c==t)return n.makeLogoContentNode(s,e);c==o.SPARK_LOGO_ROLE_PRIMARY&&(i=s)}return null!=i?n.makeLogoContentNode(i,e):null},removeBranding:function(e){return n.removeAllBrandkitFontsAndLogos(e),e.authoringContextID="",c.CorePromise.resolve(null)},removeAllBrandkitFontsAndLogos:function(e){var r;if(r=e.controller)for(var t=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()||e.isLogo()})));!t.done;t.next()){var o=t.value;if(o.isTypeLockup()){var i,s;if((i=a.as(o.style,v.LockupStyle))&&(s=i.font)&&s.isSparkFont()){var u=n.getNonBKFontForRemapping(s);a.info("Replacing brandkit font "+s.fontData.postScriptName+" with non-BK font "+u.postScriptName),i.font=I.TheoFont.init_9e5c(u)}}else{var c;r.selection.deselectForma(o),(c=o.parent)&&a.opt(a.as(c.controller,f.GroupController),(function(e){return e.removeFormaFromGroup(o)}));var d=o.controller.settings;null!=d&&d==r.controllerSettingsState.settings&&(r.controllerSettingsState.settings=null)}}else l.CoreAssert.fail("Document has no controller","BrandingFacade.removeAllBrandkitFontsAndLogos","BrandingFacade.swift",565)},getNonBKFontForRemapping:function(e){return e.fontData.source==m.FontSource.EMBEDDED?e.fontData:e.fontData.serif?e.fontData.blackness>=7?n.getFontWithPostscriptName("CantataOne-Regular"):e.fontData.italic?n.getFontWithPostscriptName("OldStandardTT-Italic"):n.getFontWithPostscriptName("Lora-Regular"):e.fontData.calligraphic?n.getFontWithPostscriptName("Yellowtail"):e.fontData.blackness>=7?n.getFontWithPostscriptName("SourceSansPro-Black"):e.fontData.italic?n.getFontWithPostscriptName("CallunaSans-Italic"):n.getFontWithPostscriptName("Raleway")},getFontWithPostscriptName:function(e){return g.Host.fontProvider.descriptorForPostScriptName(e,p.ANY_DOCUMENT)},brandDocumentForElement:function(e,r,t){var n=g.Host.brandkitManager.brandkitForElement(r,t);l.CoreAssert.isTrue(null!=n,"Adding a branded "+t+", but can't find the brandkit it belongs to","BrandingFacade.brandDocumentForElement","BrandingFacade.swift",612),a.opt(g.Host.logging,(function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataBrandkitElementUsed,{elementType:t})})),null!=n&&(""==e.authoringContextID?(a.info("** Branding document, because it now contains a branded element of type "+t),a.opt(g.Host.logging,(function(r){return r.logToAnalytics(i.AnalyticsConstants.kAnalyticsEventAddedBrandingToProject,{projectID:e.uuid})}))):e.authoringContextID!=n.id&&a.info("** Re-Branding document, because it was branded (for a different brand) and now contains a branded element of type "+t),e.authoringContextID=n.id)},unBrandDocumentIfNoBrandedElements:function(e){""!=e.authoringContextID&&(n.doesDocumentContainBrandedElements(e,!1)||(e.authoringContextID="",a.info("** Unbranding document, because it no longer contains any branded elements")))},isDocumentBranded:function(e,r){return""!=e.authoringContextID&&(!r||n.getDocumentBrandedElementsUsage(e,!0).length>0)},kBrandUsageColor:"color",kBrandUsageFont:"font",kBrandUsageCustomFont:"customFont",kBrandUsageLogo:"logo",getDocumentBrandedElementsUsage:function(e,r,t){void 0===t&&(t=!0);var o=!1,i=!1,l=!1,s=!1,u=[];if(!r&&e.firstPage.colorLibraryController.areAnySparkColorsInUse()&&(u.push(n.kBrandUsageColor),o=!0,1==t))return u;for(var c=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()||e.isTypeLockup()})));!c.done;c.next()){var d=c.value;if(d.isTypeLockup())!i&&n.doesLockupUseBrandedFonts(d)&&(u.push(n.kBrandUsageFont),i=!0),!l&&n.doesLockupUseCustomFonts(d)&&(u.push(n.kBrandUsageCustomFont),l=!0);else if(!s&&d.isLogo()&&null!=d.contentID){var m;(m=a.as(e.content.nodeByID(d.contentID),F.ImageContentNode))&&null!=m.sparkElementID&&""!=m.sparkElementID&&(u.push(n.kBrandUsageLogo),s=!0)}if(t&&(o||i||l||s))return u;if(o&&i&&l&&s)break}return u},doesDocumentContainBrandedElements:function(e,r){return n.getDocumentBrandedElementsUsage(e,r).length>0},areSparkFontsInUse:function(e,r){if(0==r.length)return!1;for(var t=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!t.done;t.next()){var n,o=t.value;if(n=a.as(o.style,v.LockupStyle)){var i;if((i=n.font)&&null!=i.sparkElementID&&i.sparkElementID.length>0&&r.includes(i.sparkElementID))return!0;for(var l=a.iter(n.characterStyles);!l.done;l.next()){var s;if((s=l.value.font)&&null!=s.sparkElementID&&s.sparkElementID.length>0&&r.includes(s.sparkElementID))return!0}}}return!1},updateSparkFont:function(e,r){for(var t=!1,n=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!n.done;n.next()){var o,i=n.value;if(o=a.as(i.style,v.LockupStyle)){var s;if(s=o.font){var u=s.sparkElementID;null!=u&&u.length>0&&u==r.id&&(t=!0,o.font=I.TheoFont.init_a314(r))}for(var c=a.iter(o.characterStyles);!c.done;c.next()){var d=c.value;null!=d.font&&null!=d.font.sparkElementID&&d.font.sparkElementID.length>0&&d.font.sparkElementID==r.id&&(t=!0,d.font=I.TheoFont.init_a314(r))}}}l.CoreAssert.isTrue(t,"asked to update spark font which isn't currently used.","BrandingFacade.updateSparkFont","BrandingFacade.swift",834)},relinkSparkFont:function(e,r,t){for(var n=!1,o=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!o.done;o.next()){var i,s=o.value;if(i=a.as(s.style,v.LockupStyle)){var u;if(u=i.font){var c=u.sparkElementID;null!=c&&c.length>0&&c==r&&(n=!0,i.font=I.TheoFont.init_a314(t))}for(var d=a.iter(i.characterStyles);!d.done;d.next()){var m=d.value;null!=m.font&&null!=m.font.sparkElementID&&m.font.sparkElementID.length>0&&m.font.sparkElementID==r&&(n=!0,m.font=I.TheoFont.init_a314(t))}}}l.CoreAssert.isTrue(n,"asked to relink spark font which isn't currently used.","BrandingFacade.relinkSparkFont","BrandingFacade.swift",873)},doesLockupUseBrandedFonts:function(e){var r;if(r=a.as(e.style,v.LockupStyle)){var t;if((t=r.font)&&null!=t.sparkElementID&&t.sparkElementID.length>0)return!0;for(var n=a.iter(r.characterStyles);!n.done;n.next()){var o=n.value;if(null!=o.font&&null!=o.font.sparkElementID&&o.font.sparkElementID.length>0)return!0}}else l.CoreAssert.isTrue(!1,"doesLockupUseBrandedFonts called for something which is not a type lockup","BrandingFacade.doesLockupUseBrandedFonts","BrandingFacade.swift",906);return!1},doesLockupUseCustomFonts:function(e){var r;if(r=a.as(e.style,v.LockupStyle)){var t;if((t=r.font)&&t.fontData.source==m.FontSource.USER_UPLOAD)return!0;for(var n=a.iter(r.characterStyles);!n.done;n.next()){var o=n.value;if(null!=o.font&&o.font.fontData.source==m.FontSource.USER_UPLOAD)return!0}}else l.CoreAssert.isTrue(!1,"doesLockupUseCustomFonts called for something which is not a type lockup","BrandingFacade.doesLockupUseCustomFonts","BrandingFacade.swift",941);return!1},areSparkLogosInUse:function(e,r){if(0==r.length)return!1;for(var t=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==C.ImageForma.KIND})));!t.done;t.next()){var n,o=t.value;if((n=a.as(e.content.nodeByID(o.contentID),F.ImageContentNode))&&null!=n.sparkElementID&&""!=n.sparkElementID&&r.includes(n.sparkElementID))return!0}return!1},updateSparkLogo:function(e,r){for(var t=!1,o=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==C.ImageForma.KIND})));!o.done;o.next()){var i=o.value,u=a.as(e.content.nodeByID(i.contentID),F.ImageContentNode);if(a.opt(u,(function(e){return null!=e.sparkElementID&&a.opt(u,(function(e){return""!=e.sparkElementID}))&&r.id==a.opt(u,(function(e){return e.sparkElementID}))}))){t=!0;var c=n.makeLogoContentNode(r,e);s.CreationFacade.addContent(e.firstPage,c,void 0,void 0,new s.AddFormaParams(void 0,void 0,i.parent))}}l.CoreAssert.isTrue(t,"asked to update spark logo which isn't currently used.","BrandingFacade.updateSparkLogo","BrandingFacade.swift",993)},relinkSparkLogo:function(e,r,t){for(var o=!1,i=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==C.ImageForma.KIND})));!i.done;i.next()){var u=i.value,c=a.as(e.content.nodeByID(u.contentID),F.ImageContentNode);if(a.opt(c,(function(e){return null!=e.sparkElementID&&a.opt(c,(function(e){return""!=e.sparkElementID}))&&r==a.opt(c,(function(e){return e.sparkElementID}))}))){o=!0;var d=n.makeLogoContentNode(t,e);s.CreationFacade.addContent(e.firstPage,d,void 0,void 0,new s.AddFormaParams(void 0,void 0,u.parent))}}l.CoreAssert.isTrue(o,"asked to relink spark logo which isn't currently used.","BrandingFacade.relinkSparkLogo","BrandingFacade.swift",1017)},isImageBrandedLogo:function(e){var r;return!(null==e.contentID||!(r=a.as(e.page.document.content.nodeByID(e.contentID),F.ImageContentNode))||!e.isLogo()||null==r.sparkElementID||""==r.sparkElementID)},makeLogoContentNode:function(e,r){var t=r.content.createNode(F.ImageContentNode.KIND,null);return t.url=e.url,t.pixelWidth=e.pixelWidth,t.pixelHeight=e.pixelHeight,t.mimeType=e.mimeType,t.setRoles(a.clone(e.acRoles)),t.sparkElementID=e.id,t.mediaMetadata=h.MediaMetadata.init_36a2(void 0,void 0,void 0,void 0,void 0,void 0,"brandkit",void 0,void 0,void 0,void 0,h.MediaMetadata.DESIGNINTENT_LOGO),t},areSparkColorsInUse:function(e,r){return 0!=r.length&&e.firstPage.colorLibraryController.areSparkColorsInUse(a.clone(r))},updateSparkColor:function(e,r){return e.firstPage.colorLibraryController.updateSparkColor(y.TheoColor.init_bb45(r))},getBrandkitColorsForUI:function(e,r){var t,n,o=!1,i=[];if((t=a.as(a.opt(r,(function(e){return e.controller})),A.TypeLockupController))&&t.styleController.isCurrentlyShowingMultipleColors()){o=!0;var l=t.lockupStyle.colors.theoColor(d.ColorRole.FieldPrimary),s=t.lockupStyle.colors.theoColor(d.ColorRole.FieldSecondary);null!=l&&l.isBrandkitColor()&&null!=s&&s.isBrandkitColor()&&(i=[l,s])}for(var u=[],c=a.iter(e.colors);!c.done;c.next()){var m=c.value,f=y.TheoColor.init_bb45(m);if(0==o)u.push([f]),f.isBrandkitPrimaryColor()&&(n=f,f.isBrandkitShade()&&u.push([y.TheoColor.init_bb45(m)]));else{var g=0,p="";if(f.isBrandkitPrimaryColor())n=f,g=5;else if(f.isBrandkitSecondaryColor())g=3;else if(f.isBrandkitShade()){g=1;var F=f.getBrandkitShadeRole();if(F.startsWith(y.SHADE_ROLE_PREFIX)){var C=F.substr(y.SHADE_ROLE_PREFIX.length),v=(a.toInt(C)+3)%7;p=y.SHADE_ROLE_PREFIX+a.toString(v)}}else g=1;for(var h=0,I=a.clone(a.shuffle(e.colors)),D=a.iter(I);!D.done;D.next()){var k=D.value,T=y.TheoColor.init_bb45(k);if((""==p&&Math.abs(f.rgbColor.lightness-T.rgbColor.lightness)>30||p==T.getBrandkitShadeRole())&&(u.push([f,T]),(h+=1)>=g))break}}}if(o&&i.length>0){for(var S=!1,b=a.iter(u);!b.done;b.next()){var B=b.value;if(B[0].sparkElementID==i[0].sparkElementID&&B[1].sparkElementID==i[1].sparkElementID){S=!0;break}}S||u.push(a.clone(i))}return a.sortInPlace(u,(function(e,r){var t=e[0],o=r[0];if(null!=n){if(t===n)return o!==n;if(o===n)return!1}if(t.isBrandkitSecondaryColor())return!o.isBrandkitSecondaryColor()||t.rgbColor.lightness<o.rgbColor.lightness;if(o.isBrandkitSecondaryColor())return!1;var a=t.getBrandkitShadeRole(),i=o.getBrandkitShadeRole();return null!=a?null==i||a<i:null==i&&t.rgbColor.lightness<o.rgbColor.lightness})),u},getTheoColorForSolidColor:function(e,r){if(null!=e)for(var t=a.iter(e.colors);!t.done;t.next()){var n=t.value,o=y.TheoColor.init_bb45(n);if(o.rgbColor.isEqual(r))return o}return y.TheoColor.init_5344(r,null,null)}}}),n)},lmwz:function(e,r,t){var n,o=r,a=t("oAGj"),i=t("SpAV"),l=t("aO0D"),s=t("gpZI"),u=t("CWW7"),c=t("gXiO"),d=t("yGNn"),m=t("Bpjk"),f=t("ascj"),g=t("FNB+"),p=t("6ZWm"),F=t("cmoc"),C=t("P83h"),v=t("9Lk3"),h=t("4mVB"),y=t("iCxV"),I=t("Qlvz"),A=t("q5zr"),D=t("fdtz"),k=t("uWOl"),T=t("tGKA"),S=t("uxH+"),b=t("K0Rh"),B=t("JO5d"),M=t("djAF"),x=t("35Q0"),P=t("fAXt"),E=t("8t9B"),N=t("oKlP"),_=t("sIWg"),L=t("zjod");o.ImageFacade=(n=function(){c.CoreObject.call(this)},a.defineClass({name:"ImageFacade",ctor:n,superName:"CoreObject",statics:{replaceImageWithColors:function(e,r){var t=e;if(e instanceof F.FrameForma||e instanceof D.ImageForma&&e.parent instanceof F.FrameForma){var n,o,i=a.as(e,F.FrameForma)||e.parent;(n=a.as(e.parent,b.RootForma))?(u.CreationFacade.deleteFormae([i],null),null!=r&&s.ColorFacade.applyColorsToForma(n,a.clone(r)),t=n):(t=i,(o=a.opt(a.as(i.controller,p.FrameController),(function(e){return e.replaceWithColoredShape()})))&&(null!=r?s.ColorFacade.applyColorsToForma(o,a.clone(r)):a.opt(o.controller,(function(e){return e.shuffleColorAssignment()})),t=o))}return t},replaceImagesWithColors:function(e,r){return e.map((function(e){return n.replaceImageWithColors(e,a.clone(r))}),this)},applyImageFilter:function(e,r,t){a.clone(t?n.getBackgroundImagesFromPage(e.document.firstPage):e.selection.asFormaArray()).forEach((function(e){var t;if(t=n.getImageFormaForForma(e)){r.adjustments=I.ImageAdjustments.createDefault();var o=t.style;r.adjustments=o.adjustments,n.applyImageStyle(r,[e])}}))},applyImageStyle:function(e,r){for(var t=a.iter(r);!t.done;t.next()){var o,i=t.value;(o=n.getImageFormaForForma(i))&&(a.opt(a.opt(o.root,(function(e){return e.animation})),(function(e){return e.invalidate()})),o.applyStyle(e))}},getImageStyleForForma:function(e){var r;return(r=n.getImageFormaForForma(e))?a.as(r.style,k.ImageStyle):null},isFrame:function(e){return e instanceof F.FrameForma},getImageContentForForma:function(e){var r;return(r=n.getImageFormaForForma(e))?r.contentNode:null},getImageFormaForForma:function(e){var r,t,n;if(r=a.as(e,D.ImageForma))return r;if(t=a.as(e,L.VideoForma))return t;if((n=a.as(e,F.FrameForma))&&n.childCount>0){for(var o=a.iter(n.childrenAsArray);!o.done;o.next()){var i,l=o.value;if(i=a.as(l,D.ImageForma))return i}return null}return null},getMaskFormaForForma:function(e){var r;return(r=n.getFrameFormaForForma(e))?r.findAuxiliary((function(e){return e.hasIntent(g.Forma.INTENT_IMAGE_MASK)})):a.opt(e,(function(e){return 1==e.hasIntent(g.Forma.INTENT_IMAGE_MASK)}))?e:null},getVideoFormaForForma:function(e){var r;return(r=a.as(e,F.FrameForma))&&r.childCount>0?a.as(r.childAt(0),L.VideoForma):a.as(e,L.VideoForma)},getFrameFormaForForma:function(e){var r,t;return(r=a.as(a.opt(e,(function(e){return e.parent})),F.FrameForma))?r:(t=a.as(e,D.ImageForma))?a.as(t.parent,F.FrameForma):a.as(e,F.FrameForma)},getBackgroundImagesFromPage:function(e){for(var r=[],t=a.iter(e.root.filterWithCallback((function(e){return e.kind==F.FrameForma.KIND&&e.isBackgroundImage()&&e.childCount>0})));!t.done;t.next()){var n=t.value;r.push(n.childAt(0))}return r},getCropRatioId:function(e){var r;return(r=n.getFrameFormaForForma(e))?r.cropRatioId:m.CropRatioPresetLibrary.FREEFORM_ID},setImageCropToFreeform:function(e){var r;if((r=n.getFrameFormaForForma(e))&&r.cropRatioId!=m.CropRatioPresetLibrary.FREEFORM_ID){var t=new C.FormaTransformChangedEvent(r);r.beginUpdate(t),r.cropRatioId=m.CropRatioPresetLibrary.FREEFORM_ID,r.endUpdate(t)}},usesFreeformCropPreset:function(e){return n.getCropRatioId(e)==m.CropRatioPresetLibrary.FREEFORM_ID},migrateImageRotationToFrame:function(e,r){var t,n,o=e.placement.transformValues;if((t=r.bounds)&&(n=r.parent)){var a=Math.atan2(o.rotSine,o.rotCosine);if(Math.abs(a)>.001){var i=T.Matrix2D.rotation(o.rotCosine,o.rotSine),l=T._asterisk_TheoPoint_Matrix2D(t.evalXY(.5,.5),r.totalPlacement),s=T._asterisk_Matrix2D_Matrix2D(T._asterisk_Matrix2D_Matrix2D(T.Matrix2D.translation(N._negate_TheoPoint(l)),i),T.Matrix2D.translation(l)),u=T._asterisk_Matrix2D_Matrix2D(T._asterisk_Matrix2D_Matrix2D(n.totalPlacement,s),n.totalPlacement.inverse);r.move(u),P.TransformFacade.rotateForma(e,-a),o=e.placement.transformValues}}return o},resetCrop:function(e){var r,t,o,l;if((r=n.getFrameFormaForForma(e))&&(t=a.as(r.controller,p.FrameController))&&(o=e.bounds)&&(l=e.page.root.bounds)){var s=l.insetXY(10,10),u=e.finalFrame||s,c=u.center,d=new C.FormaTransformChangedEvent(r);r.beginUpdate(d);for(var f=n.migrateImageRotationToFrame(e,r),g=f.xscale,F=f.yscale,v=!1,h=0;!v&&h<10;){var y=o.transform(T.Matrix2D.scalingXY(g,F)),I=_.TheoRect.fromSize(y.size);t.setBoundsWithCropType(I,p.CropType.FitBorder);var A=(u=e.finalFrame||s).center;if(t.move(T.Matrix2D.translation(N._minus_TheoPoint_TheoPoint(c,A))),0==e.totalPlacement.transformPoints(a.clone(o.points)).filter((function(e){return s.containsPoint(e)}),this).length){u=e.finalFrame||s;var D=s.intersectionWith(u)||s,k=Math.max(u.width/D.width,u.height/D.height);k=Math.max(k,1.05),0==h&&(c=D.center),g/=k,F/=k,h+=1}else v=!0}10==h&&i.CoreAssert.warning("resetCrop did not converge"),r.cropRatioId=m.CropRatioPresetLibrary.ORIGINAL_ID,r.endUpdate(d),t.updateCropModeImage()}},cropImageToRatio:function(e,r,t){var o,l,s,u,c;if(void 0===r&&(r=0),void 0===t&&(t=null),n.canCropImage(e)){if(n.removeMaskForForma(e),(l=n.getFrameFormaForForma(e))&&(s=n.getImageFormaForForma(e))&&(u=s.finalFrame)&&(c=s.bounds)){var d,f;r<=0?(f=c.aspectRatio,d=m.CropRatioPresetLibrary.ORIGINAL_ID):(f=r,d=(o=m.CropRatioPresetLibrary.getIdForRatio(r))||null!=o?o:m.CropRatioPresetLibrary.FREEFORM_ID);var g=l.controller,F=u.origin,v=new C.FormaTransformChangedEvent(l);l.beginUpdate(v);var h=t||l.bounds,y=_.TheoRect.fromSize(h.fitAspectRatioWithin(f)),I=g.isImageCropped()?p.CropType.PreserveFocusAndScale:p.CropType.FitBorder;g.setBoundsWithCropType(y,I);var A=a.opt(s.finalFrame,(function(e){return e.origin}))||N.TheoPoint.ZERO;g.move(T.Matrix2D.translation(N._minus_TheoPoint_TheoPoint(F,A))),l.cropRatioId=d,l.endUpdate(v),g.updateCropModeImage()}}else i.CoreAssert.warning("Asked to crop an image that can't be.")},inCropMode:function(e){return n.pageInCropMode(a.opt(e,(function(e){return e.page})))},pageInCropMode:function(e){var r;return null!=(r=a.opt(a.opt(a.opt(e,(function(e){return e.document})),(function(e){return e.controller})),(function(e){return e.selection.inCropMode})))&&r},enterCropMode:function(e){var r,t;return!(!(r=a.as(a.opt(e.parent,(function(e){return e.controller})),p.FrameController))||!(t=a.opt(e.controller,(function(e){return e.owner})))||(t.selection.inCropMode=!0,r.enterCropMode(),0))},exitCropMode:function(e){var r;if((n=a.as(a.opt(e.parent,(function(e){return e.controller})),p.FrameController))&&(r=a.opt(e.controller,(function(e){return e.owner})))&&(r.selection.inCropMode=!1,n.cleanupCropVisualization()),a.as(e.controller,S.RootController)&&(r=a.opt(e.controller,(function(e){return e.owner})))){r.selection.inCropMode=!1;for(var t=a.iter(e.filterByKind(F.FrameForma.KIND));!t.done;t.next()){var n,o=t.value;(n=a.as(o.controller,p.FrameController))&&n.cleanupCropVisualization()}}},getTempCropImageForForma:function(e){var r;if(r=a.opt(a.opt(e,(function(e){return e.parent})),(function(e){return e.visitAsArray(g.FormaTraversal.JustChildren)})))for(var t=a.iter(r);!t.done;t.next()){var n=t.value;if(n.hasIntent(g.Forma.INTENT_TEMP_IMAGE_CROP)&&n.kind==F.FrameForma.KIND)return n}return null},canSetBackgroundImage:function(e){var r,t;return!(!(r=a.as(e,F.FrameForma))||!(t=r.controller))&&e.isImage()&&!r.isLogo()&&t.floating&&!e.isSticker()&&!t.userGroupMember},canSetFloatingImage:function(e){var r,t;return!(!(r=e)||!(t=r.controller))&&e.isImage()&&!r.isLogo()&&!t.floating&&!r.isVideo()&&!t.userGroupMember},isPotentialBackgroundImage:function(e){var r;return!!(r=a.as(e,F.FrameForma))&&(!r.isLogo()&&!r.hasAlpha()&&!r.isSticker()&&!r.controller.userGroupMember||r.isBackgroundImage())},canCropImage:function(e){var r,t;return!(!(r=n.getFrameFormaForForma(e))||!(t=r.controller))&&!r.isLogo()&&t.floating&&!e.isSticker()},addHiddenImageToGrid:function(e){var r,t,o;(r=a.opt(a.as(a.opt(e.root,(function(e){return e.controller})),S.RootController),(function(e){return e.getGridController()})))&&(t=a.as(e,F.FrameForma))&&(o=n.getImageFormaForForma(t))&&(o.style.opacity=1,o.intent=g.Forma.INTENT_GRID_CELL,t.intent=g.Forma.INTENT_GRID_CELL,t.allowUserMove=!1,r.removeFormaFromGroup(t),r.addFormaToGroup(t))},setBackgroundImage:function(e){e.isBackgroundImage()||(i.CoreAssert.isTrue(n.canSetBackgroundImage(e),void 0,"ImageFacade.setBackgroundImage","ImageFacade.swift",505),n.setBackgroundOrFloatingImage(e,!0))},setFloatingImage:function(e){var r;(r=e.controller)&&r.floating||(i.CoreAssert.isTrue(n.canSetFloatingImage(e),void 0,"ImageFacade.setFloatingImage","ImageFacade.swift",515),n.setBackgroundOrFloatingImage(e,!1))},setBackgroundOrFloatingImage:function(e,r){var t,o,i,l;if((t=a.opt(a.as(a.opt(e.root,(function(e){return e.controller})),S.RootController),(function(e){return e.getGridController()})))&&(o=a.as(e,F.FrameForma))&&(i=n.getImageFormaForForma(o))&&(l=o.finalFrame)){var s,u=a.opt(i.finalFrame,(function(e){return e.intersectionWith(l)})),c=new C.FormaStyleChangedEvent(t.forma);if(t.forma.beginUpdate(c),e.isBackgroundImage()&&r||!e.isBackgroundImage()&&!r)return;r&&(n.formaHasMask(o)&&n.removeMaskForForma(e),a.opt(i.controller,(function(e){return e.rotate(o.rotationInRadians())})),i.style.opacity=1,o.cropRatioId=m.CropRatioPresetLibrary.FREEFORM_ID,null!=(s=t.getBasicShapeLayoutColor())&&a.opt(e.root,(function(e){return e.style.colors.setColorId(f.ColorRole.FieldPrimary,s)})));var d=!1;if(!r&&null!=t.formaMappingSwiftDict[o.formaID]){var p=t.gridStyle.name.includes(h.GridStyle.SINGLE_LAYOUT_NAME)||t.gridStyle.name.includes(h.GridStyle.BALANCED_LAYOUT_NAME)||t.gridStyle.name==h.GridStyle.CUSTOM_LAYOUT_NAME;(t.getBackgroundShapes().length>0||!p)&&(t.removeFormaWithoutGridModification(o),d=!0)}if(d||t.removeFormaFromGroup(o),o.allowUserMove=!r,o.intent=r?g.Forma.INTENT_GRID_CELL:g.Forma.INTENT_FLOATING_IMAGE,i.intent=r?g.Forma.INTENT_GRID_CELL:g.Forma.INTENT_FLOATING_IMAGE,!r){var v=l.center;(null!=u?u.area/l.area:1)<.8?(o.bounds=_.TheoRect.fromSize(u.size),v=u.center):o.bounds=a.opt(o.bounds,(function(e){return e.scale(.95,new N.TheoPoint(0,0))})),o.moveCenterToPoint(v)}if(t.addFormaToGroupWithCurrentImage(o),!r){var y=a.clone(o.parent.filterByControllerKind(E.TypeLockupController.KIND));y.length>0&&o.parent.insertBefore(o,y[0],!0)}t.forma.endUpdate(c)}},formaHasMask:function(e){return null!=n.getMaskFormaForForma(e)},formaHasShapeMask:function(e){return n.getMaskFormaForForma(e)instanceof M.ShapeForma},setMaskForForma:function(e,r){var t;if(t=n.getFrameFormaForForma(e)){var o,a,i,l=new C.FormaContentChangedEvent(t);if(t.beginUpdate(l),(o=n.getMaskFormaForForma(t))&&t.removeAuxiliary(o),(a=r)&&t.appendAuxiliary(a),e.endUpdate(l),i=n.getImageFormaForForma(e)){var s=new C.FormaContentChangedEvent(i);i.beginUpdate(s),i.endUpdate(s)}}},removeMaskForForma:function(e){n.setMaskForForma(e,null)},getMaskForForma:function(e){var r,t,o,i,s=n.getMaskFormaForForma(e);return(r=a.as(s,M.ShapeForma))&&null!=(t=r.shapeLibraryID)?l.CropAssetLibrary.getCropShapeFromID(t):(o=a.as(s,D.ImageForma))&&null!=(i=o.contentNode.getTag(A.ImageContentNode.ASSET_ID_TAG))?l.CropAssetLibrary.getRasterMaskFromID(i):null},applyMaskToForma:function(e,r,t,o){var i;if(void 0===t&&(t=null),void 0===o&&(o=!1),i=a.as(e,F.FrameForma)){var s,u,c,f=null,g=new C.FormaApplyMaskEvent(i);return i.beginUpdate(g),(s=a.as(r,l.CropShape))?f=n.applyShapeMaskToImage(e,s.id,t,o):(u=a.as(r,l.RasterMask))&&(f=n.applyRasterMaskToImage(e,u,t,o)),(c=f)?c.then((function(e){var r;if(r=a.as(i.controller,p.FrameController)){if(n.formaHasMask(i)){var t=new C.FormaGeometryChangedEvent(i);i.beginUpdate(t),r.fitChildrenToFrame(),i.endUpdate(t)}r.fitting=p.FitType.None,r.updateCropModeImage()}return i.cropRatioId=m.CropRatioPresetLibrary.NONE_ID,i.endUpdate(g),e})):d.CorePromise.reject("Invalid CropAsset type.")}return d.CorePromise.reject("Invalid frame.")},applyShapeMaskToImage:function(e,r,t,o){var i;if(void 0===t&&(t=null),void 0===o&&(o=!1),i=a.as(e,F.FrameForma)){var l,s,u,c,m,f=n.formaHasMask(i),C=a.opt(a.opt(n.getImageFormaForForma(i),(function(e){return e.finalFrame})),(function(e){return e.origin}));if((l=t)&&a.opt(a.as(i.controller,p.FrameController),(function(e){return e.setBoundsWithCropType(l,p.CropType.PreserveFocusAndScale)})),n.removeMaskForForma(i),null!=r&&(s=a.as(i.page.createFormaWithController(M.ShapeForma.KIND,B.ShapeController.KIND),M.ShapeForma))){x.ShapeLibrary.applyToShapeForma(s,r);var v,h,y=s.canonicalArtwork;if(!o&&(v=y.bounds)&&(h=i.bounds)){var I=h.fitAspectRatioWithin(v.aspectRatio);i.bounds=_.TheoRect.fromXYWH(h.minX,h.minY,I.width,I.height)}s.preScale=null,s.allowUserMove=!1,s.intent=g.Forma.INTENT_IMAGE_MASK,n.setMaskForForma(i,s)}return(h=i.bounds)&&(u=a.opt(n.getImageFormaForForma(i),(function(e){return e.bounds})))&&!n.formaHasMask(i)&&f&&null==t&&(I=h.fitAspectRatioWithin(u.aspectRatio),i.bounds=_.TheoRect.fromXYWH(h.minX,h.minY,I.width,I.height)),(c=C)&&(m=a.opt(a.opt(n.getImageFormaForForma(i),(function(e){return e.finalFrame})),(function(e){return e.origin})))&&i.move(T.Matrix2D.translation(N._minus_TheoPoint_TheoPoint(c,m))),d.CorePromise.resolve(n.getMaskFormaForForma(e))}return d.CorePromise.reject("frame is nil")},applyRasterMaskToImage:function(e,r,t,o){var i,l,s;if(void 0===t&&(t=null),void 0===o&&(o=!1),(i=n.getFrameFormaForForma(e))&&(l=r)&&null!=(s=y.Host.resourceUtils.urlForResource("raster",l.id))){var c=new u.AddFormaParams(void 0,void 0,void 0,void 0,u.AddFormaParentingHint.doNotAddFormaForContentToTree),m={"image-role":A.ImageContentNode.ROLE_MASK,"asset-id":l.id};return u.CreationFacade.addImage(i.page,s,l.mimeType,l.width,l.height,!1,void 0,c,a.clone(m)).then((function(e){var r;return(r=a.as(e,D.ImageForma))?(n.setMaskForForma(i,r),r):d.CorePromise.reject("imageCN is nil")}))}return d.CorePromise.reject("frame is invalid")},canAddImages:function(e,r){return r+e.filterByControllerKind(p.FrameController.KIND).length<=v.GridController.MAX_IMAGE_COUNT}}}),n)},pmb0:function(e,r,t){var n,o=r,a=t("oAGj"),i=t("VQVe"),l=t("FNB+"),s=t("KkVW"),u=t("3/rh"),c=t("Pn67"),d=t("nQ+V"),m=t("SAU6"),f=t("nUE5");o.EXPOSE_MOTION_STYLE=!1,o.MotionFacade=(n=function(){},a.defineClass({name:"MotionFacade",ctor:n,statics:{ANIM_STYLE_NAME_STACKED:"Stacked",ANIM_STYLE_NAME_COMPOSITE:"Composite",getCurrentAnimationStyle:function(){return n._animStyle},applyEntryToForma:function(e,r){var t=f.MotionSource.getSourceAnimation(r.srcId,e);r.logic.apply(e,t,a.clone(r.args))},canApplyStyle:function(e){return e.name==n.ANIM_STYLE_NAME_STACKED||e.name==n.ANIM_STYLE_NAME_COMPOSITE||e.name==i.AnimationStyle.NAME_DYNAMIC&&3==e.variant},createAllAnimationStyles:function(){return o.EXPOSE_MOTION_STYLE?[i.AnimationStyle.init_e14f(n.ANIM_STYLE_NAME_STACKED,0,1,i.AnimationStyleCategory.Text),i.AnimationStyle.init_e14f(n.ANIM_STYLE_NAME_COMPOSITE,0,1,i.AnimationStyleCategory.Text)]:[]},applyStyle:function(e,r){if(n.canApplyStyle(r))if(n._animStyle=r,r.name==i.AnimationStyle.NAME_DYNAMIC)n.applyEntryToForma(e,new m.MotionEntryStackedRoot);else{var t,o=[],f=new c.MotionEntryNone;e.visitAll(l.FormaTraversal.PreOrder,(function(e){n.applyEntryToForma(e,f),e.isTypeLockup()&&o.push(e)})),(t=a.first(o))&&(r.name==n.ANIM_STYLE_NAME_COMPOSITE?(n.applyEntryToForma(t,new s.MotionEntryDropIn),n.applyEntryToForma(t,new u.MotionEntryFadeIn)):r.name==n.ANIM_STYLE_NAME_STACKED&&n.applyEntryToForma(t,new d.MotionEntryStacked))}}}}),n)},wNKJ:function(e,r,t){var n,o=r,a=t("oAGj"),i=t("SpAV"),l=t("gXiO"),s=t("quOg"),u=t("FNB+"),c=t("6ZWm"),d=t("cmoc"),m=t("OdB2"),f=t("P83h"),g=t("9Lk3"),p=t("ZK0l"),F=t("pnSN"),C=t("X0GW"),v=t("iCxV"),h=t("fdtz"),y=t("lmwz"),I=t("tGKA"),A=t("KIfs"),D=t("K0Rh"),k=t("djAF"),T=t("6Tzw"),S=t("T6jX"),b=t("oKlP"),B=t("sIWg");o.DragFacade=(n=function(){l.CoreObject.call(this)},a.defineClass({name:"DragFacade",ctor:n,superName:"CoreObject",statics:{processBeginFormaDrag:function(e){var r=e.dragDelegate.dragController,t=a.opt(r,(function(e){return e.owner.document.firstPage}));a.opt(t,(function(e){return e.publish(new m.BeginFormaDragMessage(t))})),a.opt(r,(function(r){return r.afterProcessBeginFormaDrag(e)}))},processFormaDrag:function(e){var r=e.dragDelegate.dragController;a.opt(r,(function(r){return r.beforeProcessFormaDrag(e)}));var t=[],o=!(1==e.dragDelegate.modifierKeys.control)&&1==e.dragDelegate.draggedFormae.length;return e.dragDelegate.forEachDraggedForma((function(r,a){t=t.concat(n.processOneFormaDrag(e,r,a,o))})),a.opt(r,(function(r){return r.afterProcessFormaDrag(e)})),t},processOneFormaDrag:function(e,r,t,o){var i=[],l=e.drag;if(null==e.dragDelegate.dragController.owner)return i;if(null==r.controller)return i;var u=e.dragDelegate.dragController.owner,c=r.controller,d=u.selection;if(!c.moveable||u.interactionMode==s.InteractionMode.SelectionFocused&&d.selectedCount>0&&!d.isSelected(r))return i;var g=new f.FormaTransformChangedEvent(r);r.beginUpdate(g),n.doMove(l,r,t,d),o&&(i=a.clone(n.doSnap(l,r,t))),r.endUpdate(g);var p=u.document.firstPage;return p.publish(new m.FormaDragMessage(p)),i},doMove:function(e,r,t,n){var o,l=a.opt(r.parent,(function(e){return e.totalPlacement.inverse}))||I.Matrix2D.Identity,s=e.freeMovement(l),u=s.movement;switch(s.rise,s.run,o=r.parent instanceof d.FrameForma?r.parent.bounds.center:I._asterisk_TheoPoint_Matrix2D(r.bounds.center,t),e.dragMode){case 1:u=e.noScale(l,o);break;case 2:u=e.noRotation(l,o)}i.CoreAssert.isFalse(0==u.determinant,void 0,"DragFacade.doMove","DragFacade.swift",101),I._asterisk_Matrix2D_Matrix2D(I._asterisk_Matrix2D_Matrix2D(I.Matrix2D.translation(o),u),I.Matrix2D.translation(b._negate_TheoPoint(o))),e.uncommitedMovement=u;var c,m=I._asterisk_Matrix2D_Matrix2D(t,u);(c=r.controller)&&c.place(m)},doSnap:function(e,r,t){var n,o,i=[];o=r.parent instanceof d.FrameForma?r.parent.bounds.center:I._asterisk_TheoPoint_Matrix2D(r.bounds.center,t);var l,s=r.bounds.locatePoint(r.placement.inverse.transformPoint(o)),c=e.dragMode==A.DragMode.NoScaleNoSkew,m=e.activePace();l=!(!(n=a.opt(v.Host.platform,(function(e){return e.isWeb})))&&null==n||!n)||m==A.DragPace.MediumPace||e.currentlySnapped,e.dragMode==A.DragMode.UniformScaleNoRotationNoSkew&&(l=!1);var f,p,F,C=a.clone(r.filterByControllerKind(g.GridController.KIND,u.FormaTraversal.NearestAncestor));if((f=a.as(a.opt(a.first(C),(function(e){return e.controller})),g.GridController))&&f.isChildSwappable(r)&&l&&(l=c),(p=y.ImageFacade.getFrameFormaForForma(r))&&(l=p.controller.floating),F=r.controller){var h=e.currentlySnapped;if(e.currentlySnapped=!1,l){var D,k=F.setSnappedPlacement(c?s:null,8/e.viewportScale,!1);(D=k.snapLines)&&(i=a.clone(D)),null!=k.movement&&(e.currentlySnapped=!0),!h&&e.currentlySnapped&&e.commitDrag()}}return i},processEndFormaDrag:function(e){var r,t,o,i=e.dragDelegate.dragController;if(o=a.as(i,c.FrameController))o.processEndFormaDrag(e);else{var l=e.drag.viewportScale,s=26/l,u=0;e.drag.pointers.length>1&&(u=24/l),T.SelectionFacade.enableAdditionalMultiSelectGestures()&&a.opt(i,(function(r){return r.owner.selection.replaceSelectionWithFormae(a.clone(e.dragDelegate.draggedFormae))}));var d=!(!(r=a.opt(i,(function(e){return e.owner.selection.inCropMode})))&&null==r)&&r;e.dragDelegate.forEachDraggedForma((function(e,r){n.rescueFormaToPageBounds(e,s,u),d||!(t=a.opt(e.controller,(function(e){return e.userGroupChild})))&&null==t||!t||C.GroupFacade.updateUserGroupHierarchy(e.parent)}));var f=a.opt(i,(function(e){return e.owner.document.firstPage}));a.opt(f,(function(e){return e.publish(new m.EndFormaDragMessage(f))})),e.dragDelegate.forEachDraggedForma((function(e,r){var t;if(t=a.opt(e.root,(function(e){return e.filterWithCallback((function(e){return e instanceof F.GroupForma&&null!=e.controller}))})))for(var n=a.iter(t);!n.done;n.next()){var o,i=n.value;(o=a.as(i.controller,p.GroupController))&&o.canClaimForma(e)&&o.claimForma(e)}else v.Host.logging.error("Error: forma has not root "+e.print())})),a.opt(i,(function(r){return r.afterProcessEndFormaDrag(e)}))}},rescueFormaToPageBounds:function(e,r,t){var o;if(void 0===r&&(r=50),void 0===t&&(t=50),o=e.root){var a=o.bounds,i=I.Matrix2D.Identity;n.rescueToArbitraryBounds(e,a,i,r,t)}},rescueToArbitraryBounds:function(e,r,t,n,o){var l;if(l=e.parent){var s=e.totalPlacement,u=e.bounds,c=n*Math.sqrt(Math.abs(t.determinant)),d=r.insetXY(c,c),m=u.maximumSpan(s);if(m<o){i.CoreAssert.isTrue(m>0,void 0,"DragFacade.rescueToArbitraryBounds","DragFacade.swift",264);var f=s.transformPoint(u.center),g=I.Matrix2D.translation(f.multiply(-1)).concat(I.Matrix2D.uniformScaling(o/m).concat(I.Matrix2D.translation(f))),p=(F=l.totalPlacement).concat(g.concat(F.inverse));a.opt(e.controller,(function(e){return e.move(p)}))}if(s=e.totalPlacement,!B.TheoRect.PointInCommon(u,I._asterisk_Matrix2D_Matrix2D(s,t.inverse),r)){var F,C=B.TheoRect.JustTouch(u,s,d,t);p=(F=l.totalPlacement).concat(C.concat(F.inverse)),a.opt(e.controller,(function(e){return e.move(p)}))}}},getSwappableFormae:function(e){var r=a.first(e.dragDelegate.draggedFormae);a.opt(r,(function(e){return e.kind==h.ImageForma.KIND}))&&(r=a.opt(r,(function(e){return e.parent})));var t=e.dragDelegate.dragController,o=a.opt(a.opt(t,(function(e){return e.owner})),(function(e){return e.document})),i=[];return null==r||null==o?i:(o.firstPage.root.visitAll(u.FormaTraversal.PreOrder,(function(e){n.isFormaSwappable(e,o)&&i.push(e)})),i)},getSwapState:function(e,r,t,o,i){var l=n.getSwapTargetForma(e,a.clone(r),t),s=o;(s||null!=l)&&(s=!0,null!=i&&a.opt(a.first(e.dragDelegate.draggedFormae),(function(e){return e.placement=i})));var u=e.drag.pointers[0].currentLocation,c=a.opt(a.opt(e.dragDelegate.dragController.owner,(function(e){return e.document})),(function(e){return e.firstPage.formaAtPoint(u)})),d=null!=c&&c.kind==D.RootForma.KIND;return null==l&&d&&(l=t,s=o),[s,l]},getSwapTargetForma:function(e,r,t){var o=e.drag;if(1!=e.dragDelegate.draggedFormae.length)return null;var i=a.first(e.dragDelegate.draggedFormae);a.opt(i,(function(e){return e.kind==h.ImageForma.KIND}))&&(i=a.opt(i,(function(e){return e.parent})));var l=e.dragDelegate.dragController,s=a.opt(a.opt(l,(function(e){return e.owner})),(function(e){return e.document}));if(1!=o.pointers.length||null==i||null==s)return null;if(!n.isFormaSwappable(i,s))return null;var c=o.pointers[0].currentLocation,d=s.firstPage.pageSize;if(c.x<0||c.x>d.width||c.y<0||c.y>d.height)return null;for(var m=null,f=a.iter(r);!f.done;f.next()){var g=f.value;if(g.finalFrame.containsPoint(c)&&n.inSwappableRegion(i,g,c,s)){m=g;break}}return null==t&&a.eq(u._equality_Forma_Forma,m,i)&&(m=null),m},isFormaSwappable:function(e,r){return!(e.kind==D.RootForma.KIND||e.kind==F.GroupForma.KIND||null!=e.controller&&e.controller.moveable||!e.isGridCell()||null==n.getGridForma(r)||(t=a.as(e,k.ShapeForma))&&null!=S.TheoDocumentUtils.getCellBackgroundImage(t));var t},getGridForma:function(e){var r=a.clone(e.firstPage.root.filterByControllerKind(g.GridController.KIND));return r.length>0?r[0]:null},inSwappableRegion:function(e,r,t,o){var a=n.getGridForma(o),i=0;if(null!=a&&(i=a.controller.spacing),null==e.finalFrame||null==r.finalFrame)return!1;var l=e.finalFrame.minY==r.finalFrame.maxY+i,s=e.finalFrame.maxY==r.finalFrame.minY-i,u=e.finalFrame.minX==r.finalFrame.maxX+i,c=e.finalFrame.maxX==r.finalFrame.minX-i,d=l&&u||l&&c||s&&u||s&&c,m=e.finalFrame.minY>=r.finalFrame.minY&&e.finalFrame.minY<=r.finalFrame.maxY||r.finalFrame.minY>=e.finalFrame.minY&&r.finalFrame.minY<=e.finalFrame.maxY||d,f=e.finalFrame.minX>=r.finalFrame.minX&&e.finalFrame.minX<=r.finalFrame.maxX||r.finalFrame.minX>=e.finalFrame.minX&&r.finalFrame.minX<=e.finalFrame.maxX||d,g=l&&m,p=s&&m,F=u&&f,C=c&&f;if(g||p||F||C){var v=r.finalFrame.minY,h=r.finalFrame.maxY,y=r.finalFrame.minX,I=r.finalFrame.maxX,A=h-v,D=I-y;return g&&(h-=.2*A),p&&(v+=.2*A),F&&(I-=.2*D),C&&(y+=.2*D),t.x>=y&&t.y>=v&&t.x<=I&&t.y<=h}return!0}}}),n)},x35w:function(e,r,t){var n,o=r,a=t("oAGj"),i=t("SpAV"),l=t("gXiO"),s=t("ascj"),u=t("FNB+"),c=t("9Lk3"),d=t("uxH+");o.GridFacade=(n=function(){l.CoreObject.call(this)},a.defineClass({name:"GridFacade",ctor:n,superName:"CoreObject",statics:{getPageGrid:function(e,r){var t=a.clone(e.root.filterByControllerKind(c.GridController.KIND));return t.length>0?a.as(t[0].controller,c.GridController):r?a.opt(a.as(e.root.controller,d.RootController),(function(e){return e.createGridControllerIfNone()})):null},createPaddedCollage:function(e){var r;return(r=n.getPageGrid(e,!0))?(r.setMarginAndSpacing(10,10),r.forma.root.style.colors.setColorId(s.ColorRole.FieldPrimary,"white"),r.forma):(i.CoreAssert.fail("couldn't get a grid controller","GridFacade.createPaddedCollage","GridFacade.swift",45),null)},setPageGridParameters:function(e,r,t){var o;(o=n.getPageGrid(e,!0))?isNaN(r)||isNaN(t)?isNaN(r)?isNaN(t)||(o.margin=t):o.spacing=r:o.setMarginAndSpacing(r,t):i.CoreAssert.fail("couldn't get a grid controller","GridFacade.setPageGridParameters","GridFacade.swift",67)},isChildSwappable:function(e){var r,t=a.clone(e.filterByControllerKind(c.GridController.KIND,u.FormaTraversal.NearestAncestor));return!!(r=a.as(a.opt(a.first(t),(function(e){return e.controller})),c.GridController))&&r.isChildSwappable(e)},swapChildren:function(e,r){var t,o=a.clone(e.filterByControllerKind(c.GridController.KIND,u.FormaTraversal.NearestAncestor));(t=a.as(a.opt(a.first(o),(function(e){return e.controller})),c.GridController))&&n.isChildSwappable(e)&&n.isChildSwappable(r)&&t.swapGridChildren(e,r)},setMoveableShift:function(e,r){e.moveableShift=r},getMoveableShift:function(e){return e.moveableShift},applyGridStyle:function(e,r,t){var o;(o=n.getPageGrid(t,!1))?o.applyStyle(e,r):i.CoreAssert.fail("couldn't get a grid controller","GridFacade.applyGridStyle","GridFacade.swift",127)}}}),n)}}]);
//# sourceMappingURL=vendors_npm_spark_62e2d343-c6ad1428.js.map