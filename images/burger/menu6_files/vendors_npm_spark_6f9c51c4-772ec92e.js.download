(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[21],{"01gE":function(e,t,n){var o,r=t,a=n("oAGj"),i=n("CMNw"),s=n("PSFa"),l=n("elwG"),c=n("qUXk"),u=n("u+mS"),d=n("eLsM"),p=n("hsXA"),h=n("JU+l"),m=n("9X7Y");r.GroupSelectionDesignController=(o=function(e,t){c.DesignController.call(this),this.handles=new p.StandardHandlesHandler(e,t,this),this.drag=new u.MultiObjectDragHandler(e,t,this),this.click=new l.StandardClickHandler(e),this.resize=new h.MultiObjectResizeHandler(e,t,a.clone(e.selection.asFormaArray()),this),this.actions=new i.StandardActionHandler(e),this.rotate=new m.StandardRotateHandler(e,t,this),this.attributes=new s.StandardAttributesHandler(e),this.featureSets=new d.StandardFeatureSetHandler(e)},a.defineClass({name:"GroupSelectionDesignController",ctor:o,superName:"DesignController"}),o)},"25Jq":function(e,t,n){var o,r=t,a=n("oAGj"),i=n("CMNw"),s=n("PSFa"),l=n("elwG"),c=n("qUXk"),u=n("u+mS"),d=n("eLsM"),p=n("hsXA"),h=n("G9CY"),m=n("JU+l"),f=n("9X7Y");r.SingleSelectionDesignController=(o=function(e,t){c.DesignController.call(this),this.handles=new p.StandardHandlesHandler(e,t,this),this.drag=new u.DragFacadeBasedDragHandler(e,t,this),this.click=new l.StandardClickHandler(e),this.resize=new m.SingleItemResizeHandler(e,t,e.selection.formaAt(0),this),this.move=new h.StandardMoveHandler(e,t,this),this.rotate=new f.StandardRotateHandler(e,t,this),this.actions=new i.StandardActionHandler(e),this.attributes=new s.StandardAttributesHandler(e),this.featureSets=new d.StandardFeatureSetHandler(e)},a.defineClass({name:"SingleSelectionDesignController",ctor:o,superName:"DesignController"}),o)},"3nOH":function(e,t,n){var o,r=t,a=n("oAGj"),i=n("CMNw"),s=n("PSFa"),l=n("elwG"),c=n("qUXk"),u=n("u+mS"),d=n("eLsM"),p=n("hsXA"),h=n("JU+l");r.MultiSelectionDesignController=(o=function(e,t){c.DesignController.call(this),this.handles=new p.StandardHandlesHandler(e,t,this),this.drag=new u.MultiObjectDragHandler(e,t,this),this.click=new l.StandardClickHandler(e),this.resize=new h.MultiObjectResizeHandler(e,t,a.clone(e.selection.asFormaArray()),this),this.actions=new i.StandardActionHandler(e),this.attributes=new s.StandardAttributesHandler(e),this.featureSets=new d.StandardFeatureSetHandler(e)},a.defineClass({name:"MultiSelectionDesignController",ctor:o,superName:"DesignController"}),o)},"434x":function(e,t,n){var o,r=t,a=n("oAGj"),i=n("Tq01"),s=n("yGNn"),l=n("wNKJ"),c=n("fAXt"),u=n("Kkml");r.NudgeAction=(o=function e(t,n){this.delta=t,this.formaeToNudge=a.clone(n),i.Action.call(this,e.TYPE)},a.defineClass({name:"NudgeAction",ctor:o,superName:"Action",statics:{TYPE:"NudgeAction"},props:{getUserAction:function(e){var t=a.clone(e.selection.IDs);return u.UserActions.NudgeItem(t.join(","))},execute:function(e){var t=a.clone(this.formaeToNudge||e.selection.asFormaArray());c.TransformFacade.nudgeFormaeInPageSpace(a.clone(t),this.delta);for(var n=a.iter(t);!n.done;n.next()){var o=n.value;l.DragFacade.rescueFormaToPageBounds(o,50,0)}return s.CorePromise.resolve(null)}}}),o)},"5+WR":function(e,t,n){var o,r,a,i=t,s=n("oAGj"),l=n("KgU+"),c=n("PSFa"),u=n("KSe6"),d=n("AnBp");i.AnimationStyleAttribute=(o=function(e,t,n,o){this.selected=s.clone(n),this.page=t,this.options=s.clone(o),d.EditorAttributeBase.call(this,e)},s.defineClass({name:"AnimationStyleAttribute",ctor:o,superName:"EditorAttributeBase",statics:{PAGE_LEVEL_KEY:"animationStyle-page",sameArray:function(e,t){if(e.length==t.length){for(var n=s.iter(s.range(0,e.length,!1));!n.done;n.next()){var o=n.value;if(!e[o].equals(t[o]))return!1}return!0}return!1},_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;return!!(t=s.as(e,o))&&this.key==t.key&&o.sameArray(s.clone(this.selected),s.clone(t.selected))&&o.sameArray(s.clone(this.options),s.clone(t.options))},createAction:function(e){if(1==this.selected.length&&e.name==this.selected[0].name){var t=this.page.animationLibrary.getNextAnimationStyleOfSameType(this.selected[0]);return new l.ApplyAnimationStyleAction(t,this.page)}return new l.ApplyAnimationStyleAction(e,this.page)}}}),o),i.AnimationAttributesHandler=(r=function(){c.AttributeHandlerBase.call(this)},a={},s.defineClass({name:"AnimationAttributesHandler",ctor:r,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===a.instance&&(a.instance=new r),a.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t;if(t=s.opt(s.opt(e,(function(e){return e.document})),(function(e){return e.firstPage}))){var n=s.clone(u.AnimationLibrary.getDisplayableAnimationStyles(t.root)),o=t.animationController.animationStyle||t.animationLibrary.getNoneStyle();return[new i.AnimationStyleAttribute(i.AnimationStyleAttribute.PAGE_LEVEL_KEY,t,[o],s.clone(n))]}return[]}}}),r)},"7S/6":function(e,t,n){var o,r=t,a=n("oAGj"),i=n("SpAV"),s=n("H3ZP"),l=n("nQ/X"),c=n("qUXk"),u=n("01gE"),d=n("3nOH"),p=n("QLFD"),h=n("25Jq");r.DesignControllerFactory=(o=function(){},a.defineClass({name:"DesignControllerFactory",ctor:o,props:{getNewDesignController:function(e){var t,n,o,r;return(r=this.owner)?o=0==r.selection.selectedCount?new p.NoSelectionDesignController(r,e):r.selection.inCharStyleMode?new l.CharStyleModeDesignController(r,e):1==r.selection.selectedCountInDocument?r.selection.inCropMode?new s.CropModeDesignController(r,e):!(t=a.opt(a.opt(r.selection.formaAt(0),(function(e){return e.controller})),(function(e){return e.userGroupMember})))&&null==t||!t||r.enableMoveableChildren&&(!(n=a.opt(a.opt(r.selection.formaAt(0),(function(e){return e.controller})),(function(e){return e.userGroup})))&&null==n||!n)?new h.SingleSelectionDesignController(r,e):new u.GroupSelectionDesignController(r,e):new d.MultiSelectionDesignController(r,e):(i.CoreAssert.fail("owner has gone out of scope, yet we are still asking to create design controllers","DesignControllerFactory.getNewDesignController","DesignControllerFactory.swift",44),o=new c.DesignController),o}}}),o)},"9X7Y":function(e,t,n){var o,r,a,i=t,s=n("oAGj"),l=n("Tq01"),c=n("H1Z2"),u=n("lmwz");i.IRotateHandler=s.defineProtocol("IRotateHandler",{beginRotate:"(BoxReference) -> Void",updateRotate:"(BoxReference, Double) -> Void",endRotate:"(BoxReference) -> Void"}),i.NullRotateHandler=(o=function(){},r={},s.defineClass({name:"NullRotateHandler",ctor:o,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new o),r.instance}},_implements:function(e){return"IRotateHandler"==e}},props:{beginRotate:function(e){},updateRotate:function(e,t){},endRotate:function(e){}}}),o),i.StandardRotateHandler=(a=function(e,t,n){this.formaUnderRotation=null,this.initialImagePlacement=null,this.lastAppliedTotalDeltaRadians=0,this.dc=e,this.model=t,this.delegate=n,this.actionScope=null},s.defineClass({name:"StandardRotateHandler",ctor:a,statics:{_implements:function(e){return"IRotateHandler"==e}},props:{beginRotate:function(e){this.lastAppliedTotalDeltaRadians=0},updateRotate:function(e,t){var n;if(null==this.actionScope){if(Math.abs(t)>0){var o,r;s.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()})),this.actionScope=s.opt(this.dc,(function(e){return e.undoRedoMgr.gestureScope})),this.formaUnderRotation=s.opt(this.dc,(function(e){return e.selection.formaAt(0)})),((n=s.opt(this.dc,(function(e){return e.selection.inCropMode})))||null!=n)&&n&&(o=u.ImageFacade.getImageFormaForForma(this.formaUnderRotation))&&(this.formaUnderRotation=o,this.initialImagePlacement=s.opt(this.formaUnderRotation,(function(e){return e.placement}))),(r=s.opt(this.formaUnderRotation,(function(e){return e.controller})))&&r.userGroupChild&&!r.enableChildMove&&(this.formaUnderRotation=r.userGroupRoot,this.initialImagePlacement=s.opt(this.formaUnderRotation,(function(e){return e.placement}))),this.applyRotation(e,t)}}else this.applyRotation(e,t)},endRotate:function(e){var t;(t=this.model)&&(t.beginUpdates(),t.mutable.snapLines.clear(),t.updatesComplete()),null!=this.actionScope&&(s.opt(this.dc,(function(e){return e.undoRedoMgr.endGesture(!0)})),this.actionScope=null)},applyRotation:function(e,t){var n=this,o=this.lastAppliedTotalDeltaRadians;if(t!=this.lastAppliedTotalDeltaRadians){var r,a=t-this.lastAppliedTotalDeltaRadians;if(this.lastAppliedTotalDeltaRadians=t,r=this.formaUnderRotation){var i=e.placement.transformPoint(e.bounds.center);s.opt(this.dc,(function(e){return e.doActionWithCompletion(new c.RotateHandleAction(r,a,i,n.initialImagePlacement),(function(e,t){var r,a,i=[];if((r=s.as(e,l.PlacementActionResult))&&(a=r.snapResult)){var c,u,d;if((c=a.snapLines)&&(i=s.clone(c)),u=a.movement){var p=u.transformValues;n.lastAppliedTotalDeltaRadians+=Math.atan2(p.rotSine,p.rotCosine)}(d=n.model)&&(d.beginUpdates(),d.mutable.snapLines.setAll(s.clone(i)),o!=n.lastAppliedTotalDeltaRadians&&s.opt(n.delegate,(function(e){return e.handles.updateHandles(d.mutable.handles)})),d.updatesComplete())}}))}))}}}}}),a)},"9tXS":function(e,t,n){var o,r=t,a=n("oAGj"),i=n("Tq01"),s=n("yGNn"),l=n("Kkml"),c=n("7EVG");r.SetWatermarkAction=(o=function e(t){this.watermark=t,i.Action.call(this,e.TYPE)},a.defineClass({name:"SetWatermarkAction",ctor:o,superName:"Action",statics:{TYPE:"SetWatermarkAction"},props:{getUserAction:function(e){return l.UserActions.SetWatermark()},execute:function(e){return c.WatermarkFacade.setWatermark(this.watermark,e.document),s.CorePromise.resolve(null)}}}),o)},CMNw:function(e,t,n){var o,r,a,i=t,s=n("oAGj"),l=n("Tq01"),c=n("SpAV"),u=n("yGNn");i.IActionHandler=s.defineProtocol("IActionHandler",{canDoAction:"(Action) -> Boolean",doActionWithCallback:"(Action, (ActionResult, Any) -> Void) -> Void",doAction:"(Action) -> CorePromise"}),i.NullActionHandler=(o=function(){},r={},s.defineClass({name:"NullActionHandler",ctor:o,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new o),r.instance}},_implements:function(e){return"IActionHandler"==e}},props:{canDoAction:function(e){return!1},doActionWithCallback:function(e,t){t(null,null)},doAction:function(e){return u.CorePromise.resolve(null)}}}),o),i.StandardActionHandler=(a=function(e){this.actionQueue=[],this.executingAction=null,this.dc=e},s.defineClass({name:"StandardActionHandler",ctor:a,statics:{_implements:function(e){return"IActionHandler"==e}},props:{canDoAction:function(e){var t;return(t=this.dc)?e.canDo(t):(c.CoreAssert.fail("Still calling actions when the controller has been destroyed","StandardActionHandler.canDoAction","ActionHandler.swift",47),!1)},finishAction:function(){this.executingAction=null;var e=s.first(this.actionQueue);null!=e&&(this.actionQueue.shift(),this.doActionWithCallback(e[0],e[1]))},doActionWithCallback:function(e,t){var n,o=this;null!=this.executingAction?this.actionQueue.push([e,t]):(n=this.dc)?s.opt(n.document,(function(r){return r.firstPage.animationController.stopWithCallback((function(){o.executingAction=e;var r=null,a=e.getUserAction(n);if(a.undoable)n.undoRedoMgr.beginUserActionAsync(a).then((function(t){return e.execute(n)})).finished((function(i,s){r=i,n.undoRedoMgr.endUserActionAsync().then((function(t){return e.updateSelection(n)})).then((function(e){return s?t(l.ActionResult.fromPromiseAny(r),null):t(null,r),null})).finished((function(e,t){o.finishAction(),c.CoreAssert.isTrue(t,"Failed in complete callback for action "+a.description,"StandardActionHandler.doActionWithCallback","ActionHandler.swift",96)})),c.CoreAssert.isTrue(s,"Failed to execute undoable action "+a.description,"StandardActionHandler.doActionWithCallback","ActionHandler.swift",99)}));else{var i=s.opt(n.document,(function(e){return e.beginTransaction(a.description)}));e.execute(n).then((function(e){return r=e,s.opt(i,(function(e){return e.end()})),i=null,e})).then((function(t){return e.updateSelection(n)})).then((function(e){return t(l.ActionResult.fromPromiseAny(r),null)})).fail((function(e){return c.CoreAssert.fail("Failed to execute non-undoable action "+a.description,"StandardActionHandler.doActionWithCallback","ActionHandler.swift",128),s.opt(i,(function(e){return e.rollback()})),t(null,e),null})).finished((function(e,t){return o.finishAction()}))}}))})):c.CoreAssert.fail("Still calling actions when the controller has been destroyed","StandardActionHandler.doActionWithCallback","ActionHandler.swift",143)},doAction:function(e){var t=this;return new u.CorePromise((function(n,o){return t.doActionWithCallback(e,(function(e,t){var r;null!=(r=t)?o(r):n(e)}))}))}}}),a)},D89E:function(e,t,n){var o,r=t,a=n("oAGj"),i=n("1HsO"),s=n("tGKA");r.SwapModeHandleGenerator=(o=function(){this.swapTarget=null},a.defineClass({name:"SwapModeHandleGenerator",ctor:o,statics:{_implements:function(e){return"IHandleGenerator"==e}},props:{setSwapTargetForma:function(e){this.swapTarget=e},clearSwapTargetForma:function(){this.swapTarget=null},addHandles:function(e){var t=null;return null!=this.swapTarget&&(t=this.swapTarget.finalFrame),null==t?[]:[new i.BoxTransformHandles(new i.BoxReference(s.Matrix2D.Identity,t),[i.TransformType.Translate],[],i.TransformType.None,"")]}}}),o)},G9CY:function(e,t,n){var o,r,a,i=t,s=n("oAGj"),l=n("Tq01"),c=n("H1Z2"),u=n("oKlP");i.IMoveHandler=s.defineProtocol("IMoveHandler",{beginMove:"(BoxReference) -> Void",updateMove:"(BoxReference, TheoPoint, Double) -> Void",endMove:"(BoxReference) -> Void"}),i.NullMoveHandler=(o=function(){},r={},s.defineClass({name:"NullMoveHandler",ctor:o,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new o),r.instance}},_implements:function(e){return"IMoveHandler"==e}},props:{beginMove:function(e){},updateMove:function(e,t,n){},endMove:function(e){}}}),o),i.StandardMoveHandler=(a=function(e,t,n){this.formaUnderMove=null,this.lastAppliedTotalDelta=u.TheoPoint.ZERO,this.dc=e,this.model=t,this.delegate=n,this.actionScope=null},s.defineClass({name:"StandardMoveHandler",ctor:a,statics:{_implements:function(e){return"IMoveHandler"==e}},props:{beginMove:function(e){this.lastAppliedTotalDelta=u.TheoPoint.ZERO},updateMove:function(e,t,n){var o;null==this.actionScope?t.isEqual(u.TheoPoint.ZERO)||(s.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()})),this.actionScope=s.opt(this.dc,(function(e){return e.undoRedoMgr.gestureScope})),this.formaUnderMove=s.opt(this.dc,(function(e){return e.selection.formaAt(0)})),(o=s.opt(this.formaUnderMove,(function(e){return e.controller})))&&o.userGroupChild&&!this.dc.enableMoveableChildren&&(this.formaUnderMove=s.opt(this.formaUnderMove,(function(e){return e.parent}))),this.applyMove(e,t,n)):this.applyMove(e,t,n)},endMove:function(e){var t;(t=this.model)&&(t.beginUpdates(),t.mutable.snapLines.clear(),t.updatesComplete(),null!=this.actionScope&&(s.opt(this.dc,(function(e){return e.undoRedoMgr.endGesture(!0)})),this.actionScope=null))},applyMove:function(e,t,n){var o=this,r=this.lastAppliedTotalDelta;if(!t.isEqual(this.lastAppliedTotalDelta)){var a,i=u._minus_TheoPoint_TheoPoint(t,this.lastAppliedTotalDelta);if(this.lastAppliedTotalDelta=t,a=this.formaUnderMove){var d=e.placement.transformPoint(e.bounds.center);s.opt(this.dc,(function(e){return e.doActionWithCompletion(new c.MoveHandleAction(a,i,d,n),(function(e,t){var n,a,i=[];if((n=s.as(e,l.PlacementActionResult))&&(a=n.snapResult)){var c,d,p;if((c=a.snapLines)&&(i=s.clone(c)),d=a.movement){var h=d.transformValues;o.lastAppliedTotalDelta=o.lastAppliedTotalDelta.add(new u.TheoPoint(h.tx,h.ty))}(p=o.model)&&(p.beginUpdates(),p.mutable.snapLines.setAll(s.clone(i)),r!=o.lastAppliedTotalDelta&&s.opt(o.delegate,(function(e){return e.handles.updateHandles(p.mutable.handles)})),p.updatesComplete())}}))}))}}}}}),a)},H1Z2:function(e,t,n){var o,r,a,i,s,l=t,c=n("oAGj"),u=n("Tq01"),d=n("yGNn"),p=n("wNKJ"),h=n("Pil/"),m=n("9Lk3"),f=n("tGKA"),g=n("fAXt"),A=n("8t9B"),v=n("oKlP"),T=n("Kkml");l.DragAction=(o=function e(t,n){this.event=t,this.swapTargetForma=n,u.Action.call(this,e.TYPE)},c.defineClass({name:"DragAction",ctor:o,superName:"Action",statics:{TYPE:"DragAction"},props:{getUserAction:function(e){return null!=this.swapTargetForma?T.UserActions.SwapCells():T.UserActions.MoveItem()},execute:function(e){var t,n;if(t=c.as(this.event,h.FormaDragEvent)){if(null==this.swapTargetForma){var o=c.clone(p.DragFacade.processFormaDrag(t));return d.CorePromise.resolve(new u.DragActionResult(c.clone(o)))}}else if(n=c.as(this.event,h.EndFormaDragEvent)){var r,a;if(p.DragFacade.processEndFormaDrag(n),(r=this.getDraggedFormaForEvent(n))&&(a=this.swapTargetForma)){var i,s=c.clone(c.opt(e.document,(function(e){return e.firstPage.root.filterByControllerKind(m.GridController.KIND)})));i=c.opt(s,(function(e){return null!=e.length&&s.length>0}))?c.as(s[0].controller,m.GridController):null,c.opt(i,(function(e){return e.swapGridChildren(a,r)}))}}return d.CorePromise.resolve(null)},getDraggedFormaForEvent:function(e){var t,n;return 0==!e.dragDelegate.draggedFormae.length&&(n=c.first(e.dragDelegate.draggedFormae),((t=c.opt(n,(function(e){return e.isImage()})))||null!=t)&&t&&(n=c.opt(n,(function(e){return e.parent})))),n}}}),o),l.MoveHandleAction=(r=function e(t,n,o,r){this.forma=t,this.delta=n,this.origin=o,this.scale=r,u.Action.call(this,e.TYPE)},c.defineClass({name:"MoveHandleAction",ctor:r,superName:"Action",statics:{TYPE:"MoveHandleAction"},props:{getUserAction:function(e){return T.UserActions.MoveItem()},execute:function(e){var t=this;g.TransformFacade.transformFormaeInPageSpaceAboutPoint([this.forma],f.Matrix2D.translation(new v.TheoPoint(this.delta.x,this.delta.y)),this.origin);var n=c.opt(this.forma.controller,(function(e){return e.setSnappedPlacement(null,8/t.scale,!1)}));return d.CorePromise.resolve(new u.PlacementActionResult(n))}}}),r),l.ResizeHandleAction=(a=function e(t,n,o,r){this.forma=t,this.spotPt=n,this.anchorSpot=o,this.newBounds=r,u.Action.call(this,e.TYPE)},c.defineClass({name:"ResizeHandleAction",ctor:a,superName:"Action",statics:{TYPE:"ResizeHandleAction"},props:{getUserAction:function(e){return T.UserActions.ResizeItem()},execute:function(e){var t=this;return 1==this.spotPt.x&&.5==this.spotPt.y&&this.forma.controller instanceof A.TypeLockupController?this.forma.controller.recalculateTracking(this.newBounds.size):.5==this.spotPt.x&&1==this.spotPt.y&&this.forma.controller instanceof A.TypeLockupController?this.forma.controller.recalculateLeading(this.newBounds.size):c.opt(this.forma.controller,(function(e){return e.onEvent(new h.FormaResizeEvent(t.forma,t.newBounds.size,t.anchorSpot))})),d.CorePromise.resolve(null)}}}),a),l.RotateHandleAction=(i=function e(t,n,o,r){this.forma=t,this.deltaRadians=n,this.origin=o,this.initialPlacement=r,u.Action.call(this,e.TYPE)},c.defineClass({name:"RotateHandleAction",ctor:i,superName:"Action",statics:{TYPE:"RotateHandleAction"},props:{getUserAction:function(e){return T.UserActions.RotateItem()},execute:function(e){g.TransformFacade.transformFormaeInPageSpaceAboutPoint([this.forma],f.Matrix2D.rotation(Math.cos(this.deltaRadians),Math.sin(this.deltaRadians)),this.origin,this.initialPlacement);var t=c.opt(this.forma.controller,(function(e){return e.setSnappedPlacement(new v.TheoPoint(.5,.5),20,!1)}));return d.CorePromise.resolve(new u.PlacementActionResult(t))}}}),i),l.CharRangeHandleAction=(s=function e(t,n,o,r,a){this.forma=t,this.newPoint=n,this.lastPoint=a,this.beginForma=o,this.leftHandle=r,u.Action.call(this,e.TYPE)},c.defineClass({name:"CharRangeHandleAction",ctor:s,superName:"Action",statics:{TYPE:"CharRangeHandleAction"},props:{getUserAction:function(e){return T.UserActions.ModifyStyleRanges()},execute:function(e){var t;return(t=c.as(this.forma.controller,A.TypeLockupController))&&t.updateTouches(this.newPoint,this.beginForma,this.leftHandle,this.lastPoint),d.CorePromise.resolve(new u.FormaActionResult([this.forma]))}}}),s)},H3ZP:function(e,t,n){var o,r=t,a=n("oAGj"),i=n("elwG"),s=n("u+mS"),l=n("25Jq");r.CropModeDesignController=(o=function(e,t){l.SingleSelectionDesignController.call(this,e,t),this.drag=new s.CroppingDragFacadeBasedDragHandler(e,t,this),this.click=new i.CropModeClickHandler(e)},a.defineClass({name:"CropModeDesignController",ctor:o,superName:"SingleSelectionDesignController"}),o)},"JU+l":function(e,t,n){var o,r,a,i,s=t,l=n("oAGj"),c=n("SpAV"),u=n("wNKJ"),d=n("FNB+"),p=n("Pil/"),h=n("P83h"),m=n("ZK0l"),f=n("pnSN"),g=n("H1Z2"),A=n("NkBu"),v=n("MYNe"),T=n("tGKA"),C=n("JFv5"),S=n("voLh"),F=n("T6jX"),y=n("oKlP"),P=n("sIWg");s.IResizeHandler=l.defineProtocol("IResizeHandler",{handleBeginSelectionBoxResize:"(BoxReference, TheoPoint) -> Void",handleSelectionBoxResize:"(BoxReference, TheoPoint, TheoPoint, Double) -> Void",handleEndSelectionBoxResize:"(BoxReference, TheoPoint) -> Void"}),s.NullResizeHandler=(o=function(){},r={},l.defineClass({name:"NullResizeHandler",ctor:o,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new o),r.instance}},_implements:function(e){return"IResizeHandler"==e}},props:{handleBeginSelectionBoxResize:function(e,t){},handleSelectionBoxResize:function(e,t,n,o){},handleEndSelectionBoxResize:function(e,t){}}}),o),s.locate=function(e,t,n){return new y.TheoPoint((e.x-t.x)/(n.x-t.x),(e.y-t.y)/(n.y-t.y))},s.eval=function(e,t,n){return new y.TheoPoint((1-e.x)*t.x+e.x*n.x,(1-e.y)*t.y+e.y*n.y)},s.SingleItemResizeHandler=(a=function(e,t,n,o){this.dc=e,this.model=t,this.forma=n,this.delegate=o},l.defineClass({name:"SingleItemResizeHandler",ctor:a,statics:{_implements:function(e){return"IResizeHandler"==e}},props:{handleBeginSelectionBoxResize:function(e,t){var n=this;l.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()})),l.opt(this.forma.controller,(function(e){return e.onEvent(new p.BeginFormaResizeEvent(n.forma,t))}))},handleSelectionBoxResize:function(e,t,n,o){var r=this,a=Math.sqrt(Math.abs(e.placement.determinant))*Math.abs(o),i=new y.TheoPoint(1-t.x,1-t.y),c=e.bounds,u=e.placement.inverse.transformPoint(n),d=s.locate(u,e.bounds.eval(i),e.bounds.eval(t));if(!(isFinite(d.x)&&d.x<0||isFinite(d.y)&&d.y<0)){var p;p=.5==t.x?P.TheoRect.fromPoints(c.evalXY(0,i.y),new y.TheoPoint(c.maxX,u.y)):.5==t.y?P.TheoRect.fromPoints(c.evalXY(i.x,0),new y.TheoPoint(u.x,c.maxY)):P.TheoRect.fromPoints(c.eval(i),u);var h=this.forma.placement.extractedScale;p=p.scaleXY(h.scale.x,h.scale.y);var m=50/a,f=10/a;this.forma.controller instanceof A.ImageController&&(m=100/a,f=100/a),p.width<f||p.height<f||p.width+p.height<m||l.opt(this.dc,(function(e){return e.doActionWithCompletion(new g.ResizeHandleAction(r.forma,t,i,p),(function(e,t){var n,o;(n=r.model)&&(o=r.delegate)&&(n.beginUpdates(),o.handles.updateHandles(n.mutable.handles),n.updatesComplete())}))}))}},handleEndSelectionBoxResize:function(e,t){var n=this;l.opt(this.dc,(function(e){return e.undoRedoMgr.endGesture(!0)}));var o=l.opt(l.opt(this.dc,(function(e){return e.document})),(function(e){return e.beginTransaction("finish_resize")}));l.opt(this.forma.controller,(function(e){return e.onEvent(new p.EndFormaResizeEvent(n.forma))})),u.DragFacade.rescueFormaToPageBounds(this.forma),l.opt(o,(function(e){return e.mergeWithPrevious()}))}}}),a),s.MultiObjectResizeHandler=(i=function(e,t,n,o){this.group_=null,this.passedARThreshold_=!1,this.dc=e,this.model=t,this.formae_=l.clone(v.LayerFacade.sortInZOrder(l.clone(n))),this.delegate=o},l.defineClass({name:"MultiObjectResizeHandler",ctor:i,statics:{_implements:function(e){return"IResizeHandler"==e}},props:{handleBeginSelectionBoxResize:function(e,t){var n,o;if(0!=this.formae_.length){var r=l.opt(l.opt(this.dc,(function(e){return e.document})),(function(e){return e.beginTransaction("create_resize_group")}));this.passedARThreshold_=!1;for(var a,i,s,u,h,g,A=!0,v=null,y=l.iter(this.formae_);!y.done;y.next()){var H=y.value;((n=l.opt(H.controller,(function(e){return e.userGroupMember})))||null!=n)&&n?null==v?v=H.controller.enableChildMove?H.controller.userGroup?l.as(H,f.GroupForma):H.parent:H.controller.userGroupRoot||l.as(H,f.GroupForma):v!=H.parent&&(A=!1):A=!1}if(A&&(a=v)&&(i=a.finalFrame))return this.group_=a,this.startSize_=i.size,(h=a.controller).preferredResizeType=C.ResizeLayoutType.Proportional,h.preserveResizeController=!0,l.opt(r,(function(e){return e.end()})),void l.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()}));if(this.group_=l.as(l.opt(this.formae_[0].parent,(function(e){return e.page.createFormaWithController(f.GroupForma.KIND,m.GroupController.KIND)})),f.GroupForma),(s=this.formae_[0].parent)&&(u=this.group_)&&(h=l.as(u.controller,m.GroupController))&&(g=F.TheoDocumentUtils.unionFinalFrame(l.clone(this.formae_)))){var w=(o=s.indexOfChild(this.formae_[0]))||null!=o?o:s.childCount;s.insertChildAt(u,w),h.preferredResizeType=C.ResizeLayoutType.Proportional,h.preserveResizeController=!0,u.placement=T.Matrix2D.translationXY(g.minX,g.minY),u.bounds=P.TheoRect.fromSize(g.size),u.intent=d.Forma.INTENT_INFERRED_TEMP_GROUP;for(var D=l.iter(this.formae_);!D.done;D.next())H=D.value,u.appendChild(H,!0);l.opt(l.as(h.resizeLayoutController,S.ProportionalLayoutController),(function(e){return e.setInitBounds()})),this.startSize_=g.size,h.onEvent(new p.BeginFormaResizeEvent(u,t)),l.opt(this.dc,(function(e){return e.selection.selectForma(u,!1)}))}l.opt(r,(function(e){return e.end()})),l.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()}))}else c.CoreAssert.fail("no children to multi-select resize","MultiObjectResizeHandler.handleBeginSelectionBoxResize","ResizeHandler.swift",173)},handleSelectionBoxResize:function(e,t,n,o){var r=this;if(null!=this.group_){var a=Math.sqrt(Math.abs(e.placement.determinant))*Math.abs(o),i=new y.TheoPoint(1-t.x,1-t.y),c=e.bounds,u=e.placement.inverse.transformPoint(n),d=s.locate(u,e.bounds.eval(i),e.bounds.eval(t));if(!(isFinite(d.x)&&d.x<0||isFinite(d.y)&&d.y<0)){var p,m=50/a,f=10/a;if(!((p=.5==t.x?P.TheoRect.fromPoints(c.evalXY(0,i.y),new y.TheoPoint(c.maxX,u.y)):.5==t.y?P.TheoRect.fromPoints(c.evalXY(i.x,0),new y.TheoPoint(u.x,c.maxY)):P.TheoRect.fromPoints(c.eval(i),u)).width<f||p.height<f||p.width+p.height<m)){var A=p.size;if(null!=this.startSize_){var v=this.startSize_.similarity(A);v<.04?(v<.01&&(this.passedARThreshold_=!1),this.passedARThreshold_||(A=this.startSize_.myAspectRatioClosestCorner(A))):this.passedARThreshold_=!0}var T=new h.FormaAnimationTransactionEvent(this.group_);T.duration=0,this.group_.beginUpdate(T),l.opt(this.dc,(function(e){return e.doActionWithCompletion(new g.ResizeHandleAction(r.group_,t,i,P.TheoRect.fromSize(A)),(function(e,t){var n,o,a;(n=r.group_)&&n.endUpdate(T),(o=r.model)&&(a=r.delegate)&&(o.beginUpdates(),a.handles.updateHandles(o.mutable.handles),o.updatesComplete())}))}))}}}},handleEndSelectionBoxResize:function(e,t){var n,o,r=this;l.opt(this.dc,(function(e){return e.undoRedoMgr.endGesture(!0)}));var a=l.opt(l.opt(this.dc,(function(e){return e.document})),(function(e){return e.beginTransaction("create_resize_group")}));if(l.opt(l.opt(this.group_,(function(e){return e.controller})),(function(e){return e.onEvent(new p.EndFormaResizeEvent(r.group_))})),!(n=l.opt(l.opt(this.group_,(function(e){return e.controller})),(function(e){return e.userGroup})))&&null==n||!n){l.opt(this.dc,(function(e){return e.selection.deselectForma(r.group_,!1)}));for(var i=l.iter(this.formae_);!i.done;i.next()){var s=i.value,c=(o=this.group_.parent.indexOfChild(this.group_))||null!=o?o:this.group_.childCount;this.group_.parent.insertChildAt(s,c,!0)}l.opt(this.group_,(function(e){return e.removeFromParent()})),this.group_=null}l.opt(a,(function(e){return e.mergeWithPrevious()}))}}}),i)},Mr7n:function(e,t,n){var o,r=t,a=n("oAGj"),i=n("Pil/"),s=n("1HsO"),l=n("oKlP");r.StandardHandleProcessor=(o=function(e){this.model=e},a.defineClass({name:"StandardHandleProcessor",ctor:o,statics:{_implements:function(e){return"IHandleProcessor"==e}},props:{updateHandles:function(e){this.model.beginUpdates(),e.updateHandles(this.model.mutable.handles),this.model.updatesComplete()},handleTransformEvent:function(e,t){var n,o,r,i,l;if(n=a.as(t.handle,s.BoxTransformHandles))if(o=a.as(t,s.MoveTransformEvent))switch(o.stage){case 0:e.activeTransform=s.TransformType.Translate,a.opt(e.delegate,(function(e){return e.move.beginMove(n.reference)})),this.updateHandles(e);break;case 1:a.opt(e.delegate,(function(e){return e.move.updateMove(n.reference,o.totalDelta,o.viewportScale)}));break;case 2:e.activeTransform=s.TransformType.None,a.opt(e.delegate,(function(e){return e.move.endMove(n.reference)})),this.updateHandles(e)}else if(r=a.as(t,s.RotateAboutCenterTransformEvent))switch(r.stage){case 0:e.activeTransform=s.TransformType.RotateAboutCenter,a.opt(e.delegate,(function(e){return e.rotate.beginRotate(n.reference)})),this.updateHandles(e);break;case 1:a.opt(e.delegate,(function(e){return e.rotate.updateRotate(n.reference,r.totalDeltaRadians)}));break;case 2:e.activeTransform=s.TransformType.None,a.opt(e.delegate,(function(e){return e.rotate.endRotate(n.reference)})),this.updateHandles(e)}else if(i=a.as(t,s.CornerTranslateTransformEvent)){var c=this.canonicalPointForTransformType(i.transformType);switch(i.stage){case 0:e.activeTransform=i.transformType,a.opt(e.delegate,(function(e){return e.resize.handleBeginSelectionBoxResize(n.reference,c)})),this.updateHandles(e);break;case 1:a.opt(e.delegate,(function(e){return e.resize.handleSelectionBoxResize(n.reference,c,i.position,i.viewportScale)}));break;case 2:e.activeTransform=s.TransformType.None,a.opt(e.delegate,(function(e){return e.resize.handleEndSelectionBoxResize(n.reference,c)})),this.updateHandles(e)}}else if(l=a.as(t,s.SideTranslateTransformEvent))switch(c=this.canonicalPointForTransformType(l.transformType),l.stage){case 0:e.activeTransform=l.transformType,a.opt(e.delegate,(function(e){return e.resize.handleBeginSelectionBoxResize(n.reference,c)})),this.updateHandles(e);break;case 1:a.opt(e.delegate,(function(e){return e.resize.handleSelectionBoxResize(n.reference,c,l.position,l.viewportScale)}));break;case 2:e.activeTransform=s.TransformType.None,a.opt(e.delegate,(function(e){return e.resize.handleEndSelectionBoxResize(n.reference,c)})),this.updateHandles(e)}return!0},handleFormaDragEvents:function(e,t){return t instanceof i.BeginFormaDragEvent&&(e.activeTransform=s.TransformType.Translate,this.updateHandles(e)),a.opt(e.delegate,(function(e){return e.drag.handleFormaDragEvents(t)})),t instanceof i.EndFormaDragEvent&&(e.activeTransform=s.TransformType.None,this.updateHandles(e)),!0},canonicalPointForTransformType:function(e){switch(e){case 4:return new l.TheoPoint(0,0);case 5:return new l.TheoPoint(1,0);case 6:return new l.TheoPoint(0,1);case 7:return new l.TheoPoint(1,1);case 10:return new l.TheoPoint(.5,0);case 11:return new l.TheoPoint(.5,1);case 8:return new l.TheoPoint(0,.5);case 9:case 12:return new l.TheoPoint(1,.5);case 13:return new l.TheoPoint(.5,1);default:return l.TheoPoint.ZERO}}}}),o)},PSFa:function(e,t,n){var o,r,a,i=t,s=n("oAGj"),l=n("5+WR"),c=n("ascj"),u=n("AnBp"),d=n("FNB+"),p=n("lmwz"),h=n("37nf"),m=n("T8w7"),f=n("umUn");i.IAttributesHandler=s.defineProtocol("IAttributesHandler",{updateAttributes:"(AttributesState) -> Void"}),i.NullAttributesHandler=(o=function(){},r={},s.defineClass({name:"NullAttributesHandler",ctor:o,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new o),r.instance}},_implements:function(e){return"IAttributesHandler"==e}},props:{updateAttributes:function(e){}}}),o),i.IAttributeHandler=s.defineProtocol("IAttributeHandler",{calculate:"(DocumentController) -> Array<IEditorAttribute>"}),i.AttributeHandlerBase=(a=function(){},s.defineClass({name:"AttributeHandlerBase",ctor:a}),a),i.ImageAttributeHandler=function(){var e=function(){i.AttributeHandlerBase.call(this)},t={};return s.defineClass({name:"ImageAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return s.opt(e,(function(e){return e.selection.forEachSelected((function(e){var n=p.ImageFacade.getImageStyleForForma(e);if(null!=n){for(var o=!1,r=s.iter(t);!r.done;r.next()){var a=r.value;if(n.equals(a)){o=!0;break}}o||t.push(n)}}))})),[new u.ImageAttribute(s.clone(t))]}}}),e}(),i.OpacityAttributeHandler=function(){var e=function(){i.AttributeHandlerBase.call(this)},t={};return s.defineClass({name:"OpacityAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return s.opt(e,(function(e){return e.selection.forEachSelected((function(e){var n=m.OpacityFacade.getOpacityForForma(e);t.includes(n)||t.push(n)}))})),[new u.OpacityAttribute(s.clone(t))]}}}),e}(),i.ControllerSettingAttributeHandler=function(){var e=function(){i.AttributeHandlerBase.call(this)},t={};return s.defineClass({name:"ControllerSettingAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return s.opt(e,(function(e){return e.selection.forEachSelected((function(e){var n=s.opt(e.controller,(function(e){return e.settings}));null!=n&&t.push(n)}))})),[new u.ControllerSettingAttribute(s.clone(t))]}}}),e}(),i.MediaMetadataAttributeHandler=function(){var e=function(){i.AttributeHandlerBase.call(this)},t={};return s.defineClass({name:"MediaMetadataAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return s.opt(e,(function(e){return e.selection.forEachSelected((function(e){var n=h.ImageUtils.getMediaMetadataForForma(e);null!=n&&t.push(n)}))})),[new u.MediaMetadataAttribute(s.clone(t))]}}}),e}(),i.ColorAttributeHandler=function(){var e=function(){i.AttributeHandlerBase.call(this)},t={};return s.defineClass({name:"ColorAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=s.clone(s.opt(e,(function(e){return e.selection.IDs}))||[]),n=[];if(0==t.length);else if(1==t.length){var o,r,a;if(o=s.opt(s.opt(e,(function(e){return e.document})),(function(e){return e.firstPage.formaByID(t[0])})))if(null!=(r=o.style.colors.colorID(c.ColorRole.FieldPrimary)))(a=o.page.colorLibraryController.getTheoColorForKey(r))?n.push(a):n.push(null);else n.push(null)}else{var i=!0;if(s.opt(e,(function(e){return e.selection.forEachSelected((function(e){e.hasIntent(d.Forma.INTENT_GRID_CELL)||"Root"==e.kind||(i=!1)}))})),i){n=[];var l=[];s.opt(e,(function(e){return e.selection.forEachSelected((function(e){var t,o;null!=(t=e.style.colors.colorID(c.ColorRole.FieldPrimary))?(o=e.page.colorLibraryController.getTheoColorForKey(t))?n.push(o):n.push(null):n.push(null)}))})),n.length>0&&l.push(n[0]);for(var p=s.iter(s.range(0,n.length-1,!0));!p.done;p.next()){var h=p.value;if(!s.eq(f._equality_TheoColor_TheoColor,l[0],n[h])){l[0]=null;break}}n=s.clone(l)}}return[new u.ColorAttribute(s.clone(n))]}}}),e}(),i.StandardAttributesHandler=function(){var e=function(e){this.dc=e},t={};return s.defineClass({name:"StandardAttributesHandler",ctor:e,statics:{handlers:{get:function(){return void 0===t.handlers&&(t.handlers=e.allHandlers()),t.handlers}},allHandlers:function(){var e=[];return e.push(i.OpacityAttributeHandler.instance),e.push(i.MediaMetadataAttributeHandler.instance),e.push(i.ImageAttributeHandler.instance),e.push(i.ColorAttributeHandler.instance),e.push(i.ControllerSettingAttributeHandler.instance),e.push(l.AnimationAttributesHandler.instance),e},_implements:function(e){return"IAttributesHandler"==e}},props:{updateAttributes:function(t){this.updateFrom(t,s.clone(e.handlers))},updateFrom:function(e,t){e.clear();for(var n=s.iter(t);!n.done;n.next())for(var o=n.value,r=s.clone(o.calculate(this.dc)),a=s.iter(r);!a.done;a.next()){var i=a.value;e.add(i)}}}}),e}()},QLFD:function(e,t,n){var o,r=t,a=n("oAGj"),i=n("CMNw"),s=n("PSFa"),l=n("elwG"),c=n("qUXk"),u=n("u+mS"),d=n("eLsM"),p=n("hsXA"),h=n("JU+l");r.NoSelectionDesignController=(o=function(e,t){c.DesignController.call(this),this.handles=new p.StandardHandlesHandler(e,t,this),this.drag=new u.DragFacadeBasedDragHandler(e,t,this),this.click=new l.StandardClickHandler(e),this.resize=h.NullResizeHandler.instance,this.actions=new i.StandardActionHandler(e),this.attributes=new s.StandardAttributesHandler(e),this.featureSets=new d.StandardFeatureSetHandler(e)},a.defineClass({name:"NoSelectionDesignController",ctor:o,superName:"DesignController"}),o)},bqbo:function(e,t,n){var o,r,a,i,s,l,c,u,d,p,h,m,f,g=t,A=n("oAGj"),v=n("Tq01"),T=n("0wFF"),C=n("aO0D"),S=n("yGNn"),F=n("iCxV"),y=n("lmwz"),P=n("T6jX"),H=n("Kkml");g.ReplaceImagesWithColorsAction=(o=function e(t,n,o){void 0===o&&(o=!0),this.formae=A.clone(t),this.colors=A.clone(n),this.selectReplacements=o,v.Action.call(this,e.TYPE)},A.defineClass({name:"ReplaceImagesWithColorsAction",ctor:o,superName:"Action",statics:{TYPE:"ReplaceImagesWithColorsAction"},props:{getUserAction:function(e){return H.UserActions.ReplaceImageWithShape()},execute:function(e){var t=A.clone(this.formae||e.selection.asFormaArray()),n=A.clone(y.ImageFacade.replaceImagesWithColors(A.clone(t),A.clone(this.colors)));return P.TheoDocumentUtils.updateConstrainedImageInfo(e.document),0==n.length?S.CorePromise.reject("did not get any Forma back from ImageFacade.replaceImageWithColors"):(this.newSelection=A.clone(n),S.CorePromise.resolve(new v.FormaActionResult(A.clone(n))))},updateSelection:function(e){return null!=this.newSelection&&this.selectReplacements&&e.selection.replaceSelectionWithFormae(A.clone(this.newSelection)),this.newSelection}}}),o),g.SetImageFilterAction=(r=function e(t,n){void 0===n&&(n=!1),this.style=t,this.applyFilterToAllBackgroundImages=n,v.Action.call(this,e.TYPE)},A.defineClass({name:"SetImageFilterAction",ctor:r,superName:"Action",statics:{TYPE:"SetImageFilterAction"},props:{getUserAction:function(e){return H.UserActions.ApplyFilter()},execute:function(e){return y.ImageFacade.applyImageFilter(e,this.style,this.applyFilterToAllBackgroundImages),S.CorePromise.resolve(null)}}}),r),g.ShuffleImageFilterAction=(a=function e(t,n,o){void 0===o&&(o=!1),this.style=t,this.page=n,this.applyFilterToAllBackgroundImages=o,v.Action.call(this,e.TYPE)},A.defineClass({name:"ShuffleImageFilterAction",ctor:a,superName:"Action",statics:{TYPE:"ShuffleImageFilterAction"},props:{getUserAction:function(e){return H.UserActions.ShuffleFilter()},execute:function(e){var t=this.page.imageFilterLibrary.getNextImageStyleOfSameType(this.style,!0);return null!=t&&y.ImageFacade.applyImageFilter(e,t,this.applyFilterToAllBackgroundImages),S.CorePromise.resolve(new v.ImageStyleActionResult(t))}}}),a),g.ChangeImageAdjustmentsAction=(i=function(){},A.defineClass({name:"ChangeImageAdjustmentsAction",ctor:i,superName:"Action",statics:{TYPE:"ChangeImageAdjustmentsAction",ActionWithDictionary:function(e,t){return void 0===t&&(t=null),i.init_f8e4(A.clone(e),A.clone(t))},ActionWithKeyValue:function(e,t,n){return void 0===n&&(n=null),i.init_dd66(e,t,A.clone(n))}},props:{init_dd66:function(e,t,n){void 0===n&&(n=null),this.adjustments=A.dict([e,t]),this.formaeToAdjust=A.clone(n),v.Action.call(this,i.TYPE)},init_f8e4:function(e,t){void 0===t&&(t=null),this.adjustments=A.clone(e),this.formaeToAdjust=A.clone(t),v.Action.call(this,i.TYPE)},getUserAction:function(e){return H.UserActions.ChangeImageAdjustments()},execute:function(e){var t=this;return A.clone(this.formaeToAdjust||e.selection.asFormaArray()).forEach((function(e){if(e.isImage()){var n,o=y.ImageFacade.getImageFormaForForma(e);if(n=A.opt(o,(function(e){return e.style}))){for(var r=A.iter(t.adjustments);!r.done;r.next()){var a=r.key,i=r.value;n.adjustments=A.opt(n.adjustments,(function(e){return e.copyWithNewValue(i,a)}))}A.opt(o,(function(e){return e.applyStyle(n)}))}for(var s=A.iter(A.keys(t.adjustments));!s.done;s.next())a=s.value,A.opt(F.Host.logging,(function(e){return e.logToAnalytics(T.AnalyticsConstants.kAnalyticsDataImageAdjusted,{contextualData1:"type: "+a})}))}})),S.CorePromise.resolve(null)}}}),i),g.ApplyShapeMaskToImageAction=(s=function e(t,n,o){void 0===n&&(n=null),void 0===o&&(o=null),this.forma=t,this.shapeId=n,this.usingFrameBounds=o,v.Action.call(this,e.TYPE)},A.defineClass({name:"ApplyShapeMaskToImageAction",ctor:s,superName:"Action",statics:{TYPE:"ApplyShapeMaskToImageAction"},props:{getUserAction:function(e){return H.UserActions.ApplyShapeMaskToImage()},execute:function(e){var t,n,o;return null!=(t=this.shapeId)?(n=C.CropAssetLibrary.getCropShapeFromID(t))&&(o=y.ImageFacade.getFrameFormaForForma(this.forma))?y.ImageFacade.applyMaskToForma(o,n,this.usingFrameBounds).thenReturn(null):S.CorePromise.reject("Failed to apply shape mask to forma"):(y.ImageFacade.removeMaskForForma(this.forma),S.CorePromise.resolve(null))}}}),s),g.ApplyRasterMaskToImageAction=(l=function e(t,n,o){void 0===n&&(n=null),void 0===o&&(o=null),this.forma=t,this.rasterMaskId=n,this.usingFrameBounds=o,v.Action.call(this,e.TYPE)},A.defineClass({name:"ApplyRasterMaskToImageAction",ctor:l,superName:"Action",statics:{TYPE:"ApplyRasterMaskToImageAction"},props:{getUserAction:function(e){return H.UserActions.ApplyRasterMaskToImage()},execute:function(e){var t,n,o;return null!=(t=this.rasterMaskId)?(n=C.CropAssetLibrary.getRasterMaskFromID(t))&&(o=y.ImageFacade.getFrameFormaForForma(this.forma))?y.ImageFacade.applyMaskToForma(o,n,this.usingFrameBounds).thenReturn(null):S.CorePromise.reject("Failed to apply raster mask to forma"):(y.ImageFacade.removeMaskForForma(this.forma),S.CorePromise.resolve(null))}}}),l),g.SetImageAsFloatingAction=(c=function e(){v.Action.call(this,e.TYPE)},A.defineClass({name:"SetImageAsFloatingAction",ctor:c,superName:"Action",statics:{TYPE:"SetImageAsFloatingAction"},props:{getUserAction:function(e){return H.UserActions.SetImageAsFloating()},execute:function(e){var t;return(t=e.selection.formaAt(0))&&y.ImageFacade.setFloatingImage(t),S.CorePromise.resolve(null)}}}),c),g.SetImageAsBackgroundAction=(u=function e(){v.Action.call(this,e.TYPE)},A.defineClass({name:"SetImageAsBackgroundAction",ctor:u,superName:"Action",statics:{TYPE:"SetImageAsBackgroundAction"},props:{getUserAction:function(e){return H.UserActions.SetImageAsBackground()},execute:function(e){var t;return(t=e.selection.formaAt(0))&&y.ImageFacade.setBackgroundImage(t),S.CorePromise.resolve(null)}}}),u),g.AddHiddenImageToGridAction=(d=function e(t){this.formae=A.clone(t),v.Action.call(this,e.TYPE)},A.defineClass({name:"AddHiddenImageToGridAction",ctor:d,superName:"Action",statics:{TYPE:"AddHiddenImageToGridAction"},props:{getUserAction:function(e){return H.UserActions.AddHiddenImageToGrid()},execute:function(e){for(var t=A.iter(this.formae);!t.done;t.next()){var n;(n=t.value.parent)&&y.ImageFacade.addHiddenImageToGrid(n)}return S.CorePromise.resolve(null)}}}),d),g.EnterCropModeAction=(p=function e(t){this.forma=t,v.Action.call(this,e.TYPE)},A.defineClass({name:"EnterCropModeAction",ctor:p,superName:"Action",statics:{TYPE:"EnterCropModeAction"},props:{getUserAction:function(e){return H.UserActions.EnterCropMode()},execute:function(e){var t;return(t=y.ImageFacade.getImageFormaForForma(this.forma))&&y.ImageFacade.enterCropMode(t),S.CorePromise.resolve(null)}}}),p),g.ExitCropModeAction=(h=function e(){v.Action.call(this,e.TYPE)},A.defineClass({name:"ExitCropModeAction",ctor:h,superName:"Action",statics:{TYPE:"ExitCropModeAction"},props:{getUserAction:function(e){return H.UserActions.ExitCropMode()},execute:function(e){var t;return(t=A.opt(e.document,(function(e){return e.firstPage.root})))&&y.ImageFacade.exitCropMode(t),S.CorePromise.resolve(null)}}}),h),g.SetImageCropToFreeformAction=(m=function e(t){this.forma=t,v.Action.call(this,e.TYPE)},A.defineClass({name:"SetImageCropToFreeformAction",ctor:m,superName:"Action",statics:{TYPE:"SetImageCropToFreeformAction"},props:{getUserAction:function(e){return H.UserActions.SetImageCropToFreeform()},execute:function(e){return y.ImageFacade.removeMaskForForma(this.forma),y.ImageFacade.setImageCropToFreeform(this.forma),S.CorePromise.resolve(null)}}}),m),g.CropImageToRatioAction=(f=function e(t,n,o){void 0===n&&(n=0),void 0===o&&(o=null),this.forma=t,this.ratio=n,this.usingFrameBounds=o,v.Action.call(this,e.TYPE)},A.defineClass({name:"CropImageToRatioAction",ctor:f,superName:"Action",statics:{TYPE:"CropImageToRatioAction"},props:{getUserAction:function(e){return H.UserActions.CropImageToRatio()},execute:function(e){return y.ImageFacade.cropImageToRatio(this.forma,this.ratio,this.usingFrameBounds),S.CorePromise.resolve(null)}}}),f)},cEBg:function(e,t,n){var o,r,a=t,i=n("oAGj"),s=n("Tq01"),l=n("yGNn"),c=n("K9Oa"),u=n("Kkml");a.ChangePageSizeAction=(o=function e(t,n){this.page=t,this.designSize=n,s.Action.call(this,e.TYPE)},i.defineClass({name:"ChangePageSizeAction",ctor:o,superName:"Action",statics:{TYPE:"ChangePageSizeAction"},props:{getUserAction:function(e){return u.UserActions.ChangePageSize()},execute:function(e){return c.PageFacade.setPageDesignSize(this.page,this.designSize),l.CorePromise.resolve(null)}}}),o),a.RecordOriginalPageSizeAction=(r=function e(t){this.page=t,s.Action.call(this,e.TYPE)},i.defineClass({name:"RecordOriginalPageSizeAction",ctor:r,superName:"Action",statics:{TYPE:"RecordOriginalPageSizeAction"},props:{getUserAction:function(e){return u.UserActions.RecordOriginalPageSize()},execute:function(e){return this.page.originalSizeID=this.page.sizeID,l.CorePromise.resolve(null)}}}),r)},cRpU:function(e,t,n){var o,r,a,i,s,l,c,u,d,p,h,m,f,g,A,v,T,C,S,F,y,P=t,H=n("oAGj"),w=n("Tq01"),D=n("SpAV"),b=n("yGNn"),x=n("c+uM"),I=n("Vm85"),E=n("8t9B"),R=n("oKlP"),M=n("oKI3"),N=n("Kkml");P.SetTextAction=(o=function e(t,n){this.text=t,this.forma=n,w.Action.call(this,e.TYPE)},H.defineClass({name:"SetTextAction",ctor:o,superName:"Action",statics:{TYPE:"SetText"},props:{getUserAction:function(e){return N.UserActions.SetText(this.forma.formaID)},execute:function(e){return I.TextFacade.replaceTextForLockup(this.forma,this.text),b.CorePromise.resolve(null)}}}),o),P.SetFontAction=(r=function e(t,n){void 0===n&&(n=!1),this.font=t,this.charStyleMode=n,w.Action.call(this,e.TYPE)},H.defineClass({name:"SetFontAction",ctor:r,superName:"Action",statics:{TYPE:"SetFont"},props:{getUserAction:function(e){return N.UserActions.SetFont(e.selection.IDs.join(","))},execute:function(e){var t=H.clone(e.selection.asFormaArray());return I.TextFacade.setFont(this.font,H.clone(t),this.charStyleMode),1==t.length&&H.opt(H.as(t[0].controller,E.TypeLockupController),(function(e){return e.snapSizeToBounds()})),b.CorePromise.resolve(null)}}}),r),P.ChangeTextLayoutAndAlignmentAction=(a=function e(t,n,o,r,a,i){void 0===o&&(o=!1),void 0===r&&(r=M.TextPathID.UNSET),void 0===a&&(a=null),void 0===i&&(i=x.VerticalLockupAlignment.UNSET),x.LockupStyle.isPath(t)?(r==M.TextPathID.Custom&&null==a||r!=M.TextPathID.Custom&&null!=a)&&D.CoreAssert.warning("pathID/customPath mismatch"):r==M.TextPathID.UNSET&&null==a||D.CoreAssert.warning("Why are we providing a path or path id with a non-path layout?"),this.layout=t,this.alignment=n,this.pathID=r,this.customPath=a,this.charStyleMode=o,this.verticalAlignment=i,w.Action.call(this,e.TYPE)},H.defineClass({name:"ChangeTextLayoutAndAlignmentAction",ctor:a,superName:"Action",statics:{TYPE:"ChangeTextLayoutAndAlignment"},props:{getUserAction:function(e){return N.UserActions.ChangeTextAlignment(e.selection.IDs.join(","))},execute:function(e){var t=H.clone(e.selection.asFormaArray());return I.TextFacade.setLayoutAndAlignment(this.layout,this.alignment,H.clone(t),this.charStyleMode,this.pathID,this.customPath,this.verticalAlignment),t.forEach((function(e){return H.opt(H.as(e.controller,E.TypeLockupController),(function(e){return e.snapSizeToBounds()}))})),b.CorePromise.resolve(null)}}}),a),P.ChangeTextLineSpacingAction=(i=function e(t,n){void 0===n&&(n=!1),this.lineSpacing=t,this.charStyleMode=n,w.Action.call(this,e.TYPE)},H.defineClass({name:"ChangeTextLineSpacingAction",ctor:i,superName:"Action",statics:{TYPE:"ChangeTextLineSpacing"},props:{getUserAction:function(e){return N.UserActions.ChangeLineSpacing()},execute:function(e){return I.TextFacade.setLineSpacing(this.lineSpacing,H.clone(e.selection.asFormaArray()),this.charStyleMode),b.CorePromise.resolve(null)}}}),i),P.ChangeTextAttributesAction=(s=function e(t,n,o,r,a,i){void 0===r&&(r=!1),void 0===a&&(a=M.TextPathID.UNSET),void 0===i&&(i=null),this.layout=t,this.alignment=n,this.lineSpacing=o,this.charStyleMode=r,this.pathID=a,this.customPath=i,w.Action.call(this,e.TYPE)},H.defineClass({name:"ChangeTextAttributesAction",ctor:s,superName:"Action",statics:{TYPE:"ChangeTextAttributes"},props:{getUserAction:function(e){return N.UserActions.ChangeTextAttributes()},execute:function(e){return this.layout==x.LockupLayout.SKIP&&this.alignment==x.LockupAlignment.SKIP||I.TextFacade.setLayoutAndAlignment(this.layout,this.alignment,H.clone(e.selection.asFormaArray()),this.charStyleMode,this.pathID,this.customPath),isNaN(this.lineSpacing)||I.TextFacade.setLineSpacing(this.lineSpacing,H.clone(e.selection.asFormaArray()),this.charStyleMode),b.CorePromise.resolve(null)}}}),s),P.SetFontSizeAction=(l=function e(t,n,o){void 0===n&&(n=new R.TheoPoint(.5,.5)),void 0===o&&(o=null),this.size=t,this.pin=n,this.formae=H.clone(o),w.Action.call(this,e.TYPE)},H.defineClass({name:"SetFontSizeAction",ctor:l,superName:"Action",statics:{TYPE:"SetFontSize"},props:{getUserAction:function(e){return N.UserActions.SetFontSize()},execute:function(e){return I.TextFacade.setFontSize(this.size,H.clone(this.formae||e.selection.asFormaArray()),this.pin),b.CorePromise.resolve(null)}}}),l),P.MatchSizeAction=(c=function e(t,n,o){this.size=t,this.snapSizes=H.clone(n),this.pin=o,w.Action.call(this,e.TYPE)},H.defineClass({name:"MatchSizeAction",ctor:c,superName:"Action",statics:{TYPE:"MatchSize"},props:{getUserAction:function(e){return isNaN(this.size)?N.UserActions.MatchSize():N.UserActions.ResizeItem()},execute:function(e){var t;return t=isNaN(this.size)?I.TextFacade.matchNextSize(H.clone(this.snapSizes),this.pin,H.clone(e.selection.asFormaArray())):I.TextFacade.matchNearestSize(this.size,H.clone(this.snapSizes),this.pin,H.clone(e.selection.asFormaArray())),b.CorePromise.resolve(new w.DoubleActionResult(t))}}}),c),P.SetLineBreakAction=(u=function e(t,n){void 0===n&&(n=!1),this.lineBreak=t,this.charStyleMode=n,w.Action.call(this,e.TYPE)},H.defineClass({name:"SetLineBreakAction",ctor:u,superName:"Action",statics:{TYPE:"SetLineBreak"},props:{getUserAction:function(e){return N.UserActions.ToggleLineBreak()},execute:function(e){return I.TextFacade.setLineBreak(this.lineBreak,H.clone(e.selection.asFormaArray()),this.charStyleMode),b.CorePromise.resolve(null)}}}),u),P.SetNextSpacingSequenceAction=(d=function e(t){this.sequence=t,w.Action.call(this,e.TYPE)},H.defineClass({name:"SetNextSpacingSequenceAction",ctor:d,superName:"Action",statics:{TYPE:"SetNextSpacingSequence"},props:{getUserAction:function(e){return N.UserActions.SetNextSpacingSequence()},execute:function(e){return I.TextFacade.setNextSpacingSequence(this.sequence,H.clone(e.selection.asFormaArray())),b.CorePromise.resolve(null)}}}),d),P.SetTrackingAction=(p=function e(t,n){this.tracking=t,this.pin=n,w.Action.call(this,e.TYPE)},H.defineClass({name:"SetTrackingAction",ctor:p,superName:"Action",statics:{TYPE:"SetTracking"},props:{getUserAction:function(e){return N.UserActions.SetTracking()},execute:function(e){return I.TextFacade.setTracking(this.tracking,this.pin,H.clone(e.selection.asFormaArray())),b.CorePromise.resolve(null)}}}),p),P.SetLeadingAction=(h=function e(t,n){this.leading=t,this.pin=n,w.Action.call(this,e.TYPE)},H.defineClass({name:"SetLeadingAction",ctor:h,superName:"Action",statics:{TYPE:"SetLeading"},props:{getUserAction:function(e){return N.UserActions.SetLeading()},execute:function(e){return I.TextFacade.setLeading(this.leading,this.pin,H.clone(e.selection.asFormaArray())),b.CorePromise.resolve(null)}}}),h),P.SetPaddingAction=(m=function e(t){this.padding=t,w.Action.call(this,e.TYPE)},H.defineClass({name:"SetPaddingAction",ctor:m,superName:"Action",statics:{TYPE:"SetPadding"},props:{getUserAction:function(e){return N.UserActions.SetPadding()},execute:function(e){return I.TextFacade.setPadding(this.padding,H.clone(e.selection.asFormaArray())),b.CorePromise.resolve(null)}}}),m),P.SetTextLookAction=(f=function e(t){this.look=t,w.Action.call(this,e.TYPE)},H.defineClass({name:"SetTextLookAction",ctor:f,superName:"Action",statics:{TYPE:"SetTextLook"},props:{getUserAction:function(e){return N.UserActions.SetTextLook(e.selection.IDs.join(","))},execute:function(e){return I.TextFacade.setTextLook(this.look,H.clone(e.selection.asFormaArray())),b.CorePromise.resolve(null)}}}),f),P.SetTextEffectsAttributesAction=(g=function e(t,n,o){this.outlineStrokeWeight=t,this.shadowOffset=n,this.shadowAngle=o,w.Action.call(this,e.TYPE)},H.defineClass({name:"SetTextEffectsAttributesAction",ctor:g,superName:"Action",statics:{TYPE:"SetTextEffectsAttributes"},props:{getUserAction:function(e){return N.UserActions.SetTextEffectsAttributes()},execute:function(e){return I.TextFacade.setTextEffectsAttributes(this.outlineStrokeWeight,this.shadowOffset,this.shadowAngle,H.clone(e.selection.asFormaArray())),b.CorePromise.resolve(null)}}}),g),P.SetHighlightMethodAction=(A=function e(t,n){void 0===n&&(n=!1),this.method=t,this.charStyleMode=n,w.Action.call(this,e.TYPE)},H.defineClass({name:"SetHighlightMethodAction",ctor:A,superName:"Action",statics:{TYPE:"SetHighlightMethod"},props:{getUserAction:function(e){return N.UserActions.SetHighlightMethod(e.selection.IDs.join(","))},execute:function(e){return I.TextFacade.setHightlightMethod(this.method,H.clone(e.selection.asFormaArray()),this.charStyleMode),b.CorePromise.resolve(null)}}}),A),P.EnterCharStyleModeAction=(v=function e(t){this.forma=t,w.Action.call(this,e.TYPE)},H.defineClass({name:"EnterCharStyleModeAction",ctor:v,superName:"Action",statics:{TYPE:"EnterCharStyleMode"},props:{getUserAction:function(e){var t,n=!1;return(t=H.as(this.forma.controller,E.TypeLockupController))&&(n=0==t.charStyleRanges.length),N.UserActions.EnterCharStyleMode(n)},execute:function(e){return e.selection.inCharStyleMode=!0,I.TextFacade.setCharStyleMode(this.forma,!0),b.CorePromise.resolve(null)}}}),v),P.ExitCharStyleModeAction=(T=function e(t){this.forma=t,w.Action.call(this,e.TYPE)},H.defineClass({name:"ExitCharStyleModeAction",ctor:T,superName:"Action",statics:{TYPE:"ExitCharStyleMode"},props:{getUserAction:function(e){return N.UserActions.ExitCharStyleMode()},execute:function(e){return e.selection.inCharStyleMode=!1,I.TextFacade.setCharStyleMode(this.forma,!1),b.CorePromise.resolve(null)}}}),T),P.ApplyCharStyleAction=(C=function e(t,n,o,r){this.textForma=t,this.characterStyle=n,this.applyMode=o,this.startRange=r,w.Action.call(this,e.TYPE)},H.defineClass({name:"ApplyCharStyleAction",ctor:C,superName:"Action",statics:{TYPE:"ApplyCharStyle"},props:{getUserAction:function(e){return N.UserActions.ApplyCharStyle()},execute:function(e){var t=I.TextFacade.applyCharStyle(this.textForma,this.characterStyle,this.applyMode,this.startRange,!0);return b.CorePromise.resolve(new w.TextRangeActionResult(t))}}}),C),P.ApplyCharStyleWithoutUIAction=(S=function(e,t,n,o){this.textForma=e,this.characterStyle=t,this.applyMode=n,this.startRange=o,w.Action.call(this,P.ApplyCharStyleAction.TYPE)},H.defineClass({name:"ApplyCharStyleWithoutUIAction",ctor:S,superName:"Action",statics:{TYPE:"ApplyCharStyleWithoutUI"},props:{getUserAction:function(e){return N.UserActions.ApplyCharStyleWithoutUI()},execute:function(e){var t=I.TextFacade.applyCharStyle(this.textForma,this.characterStyle,this.applyMode,this.startRange,!1);return b.CorePromise.resolve(new w.TextRangeActionResult(t))}}}),S),P.UpdateCharStyleRangeAction=(F=function e(t,n,o){this.forma=t,this.changedRange=n,this.replacementLength=o,w.Action.call(this,e.TYPE)},H.defineClass({name:"UpdateCharStyleRangeAction",ctor:F,superName:"Action",statics:{TYPE:"UpdateCharStyleRange"},props:{getUserAction:function(e){return N.UserActions.UpdateCharStyleRange(this.forma.formaID)},execute:function(e){return I.TextFacade.updateCharStyleRange(this.forma,this.changedRange,this.replacementLength),b.CorePromise.resolve(null)}}}),F),P.ApplyTextStyleSuggestionAction=(y=function e(t,n,o,r){this.style=t,this.forma=n,this.wheelEvaluator=o,this.useEnhancedWheel=r,w.Action.call(this,e.TYPE)},H.defineClass({name:"ApplyTextStyleSuggestionAction",ctor:y,superName:"Action",statics:{TYPE:"ApplyTextStyleSuggestion"},props:{getUserAction:function(e){return N.UserActions.ApplyTextStyleSuggestion(this.forma.formaID)},execute:function(e){var t=I.TextFacade.applyTextStyleSuggestion(this.style,this.forma,this.wheelEvaluator,this.useEnhancedWheel);return b.CorePromise.resolve(new w.LockupStyleActionResult(t))}}}),y)},eLsM:function(e,t,n){var o,r,a,i=t,s=n("oAGj"),l=n("cmoc"),c=n("G/OM"),u=n("fdtz"),d=n("lmwz"),p=n("37nf"),h=n("djAF"),m=n("8t9B"),f=n("zjod");i.IFeatureSetHandler=s.defineProtocol("IFeatureSetHandler",{updateFeatureSets:"(FeatureSetsState) -> Void"}),i.NullFeatureSetHandler=(o=function(){},r={},s.defineClass({name:"NullFeatureSetHandler",ctor:o,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new o),r.instance}},_implements:function(e){return"IFeatureSetHandler"==e}},props:{updateFeatureSets:function(e){}}}),o),i.StandardFeatureSetHandler=(a=function(e){this.dc=e},s.defineClass({name:"StandardFeatureSetHandler",ctor:a,statics:{_implements:function(e){return"IFeatureSetHandler"==e}},props:{updateFeatureSets:function(e){var t,n,o,r,a,i,p,g,A,v=this,T=0,C=0,S=0,F=0,y=0,P=0,H=0,w=!1,D=!1,b=!1,x=!1,I=0,E=!1,R=!1,M=!1,N=!1,k=0,G=0,U=(t=s.opt(this.dc,(function(e){return e.selection.selectedCount})))||null!=t?t:0,B=!1;s.opt(this.dc,(function(e){return e.selection.forEachSelected((function(e){var t;e.isTypeLockup()&&(T+=1),(e instanceof u.ImageForma||e instanceof l.FrameForma)&&(S+=1),e instanceof f.VideoForma?F+=1:(t=s.as(e,l.FrameForma))&&t.childAt(0)instanceof f.VideoForma&&(F+=1),e instanceof h.ShapeForma&&(y+=1),((n=s.opt(e.controller,(function(e){return e.moveable})))||null!=n)&&n&&(C+=1),((o=s.opt(e.controller,(function(e){return e.opacityChangeable})))||null!=o)&&o&&(G+=1),((r=s.opt(e.controller,(function(e){return e.canMultiSelect})))||null!=r)&&r&&(P+=1),((a=s.opt(e.controller,(function(e){return e.canGroup})))||null!=a)&&a&&(H+=1),((i=s.opt(e.controller,(function(e){return e.userGroupMember})))||null!=i)&&i&&(e.controller.userGroup&&!e.controller.userGroupChild?w=!0:e.controller.userGroup||(w=!e.controller.enableChildMove)),((p=s.opt(e.controller,(function(e){return e.deleteable})))||null!=p)&&p&&(I+=1),((g=s.opt(e.controller,(function(e){return e.duplicatable})))||null!=g)&&g&&(k+=1),B=B||e.isShape()||e.isTypeLockup(),1==U&&(v.hasLicenseInfo(e)&&(D=!0),s.opt(e.controller,(function(e){return null!=e.settings}))&&(b=!0),((A=s.opt(e.controller,(function(e){return e.replaceable})))||null!=A)&&A&&(E=!0),e.controller instanceof m.TypeLockupController&&(x=!0),R=d.ImageFacade.canCropImage(e),M=d.ImageFacade.canSetBackgroundImage(e),N=d.ImageFacade.canSetFloatingImage(e))}))})),S>0&&(B=!1),e.clear(),1==T&&1==U&&e.add(new c.TextFrameAttributesFeature),C==U&&C>1&&e.add(new c.AlignSpacingAttributesFeature(!0,C>2,!0,!0)),G==U&&G>0&&e.add(new c.OpacityAttributesFeature),U>0&&e.add(new c.FormaEditFeature(P==U,k==U,H==U&&H>1,w,B,I==U,b,x)),S+y==U&&e.add(new c.ImageFeature(S==U&&S>0,E,D,R,M,N)),F==U&&e.add(new c.VideoAttributesFeature)},hasLicenseInfo:function(e){var t=p.ImageUtils.getMediaMetadataForForma(e);return!(null==t||!t.sourceHasLicense())}}}),a)},elwG:function(e,t,n){var o,r,a,i,s=t,l=n("oAGj"),c=n("0wFF"),u=n("FNB+"),d=n("iCxV"),p=n("lmwz"),h=n("6Tzw");s.IClickHandler=l.defineProtocol("IClickHandler",{handleClick:"(FormaClickEvent) -> Void",handleDoubleClick:"(FormaDoubleClickEvent) -> Void"}),s.NullClickHandler=(o=function(){},r={},l.defineClass({name:"NullClickHandler",ctor:o,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new o),r.instance}},_implements:function(e){return"IClickHandler"==e}},props:{handleClick:function(e){},handleDoubleClick:function(e){}}}),o),s.StandardClickHandler=(a=function(e){this.dc=e},l.defineClass({name:"StandardClickHandler",ctor:a,statics:{_implements:function(e){return"IClickHandler"==e}},props:{nearestSelectable:function(e,t){var n,o,r=null;if(r=((n=l.opt(l.opt(e,(function(e){return e.controller})),(function(e){return e.selectable})))||null!=n)&&n?e:l.opt(e,(function(e){return e.visit(u.FormaTraversal.NearestAncestor,(function(e,t,n){return!(!(o=l.opt(e.controller,(function(e){return e.selectable})))&&null==o)&&o}))})),this.dc.selection.inCharStyleMode)return r;var a,i,s=1==t.modifierKeys.shift||1==t.modifierKeys.command||1==t.modifierKeys.control;if((a=l.opt(r,(function(e){return e.controller})))&&(i=a.userGroupRoot)){if(s&&this.dc.selection.isSelected(i))return r=i;for(var c=[i],d=l.clone(i.filterWithCallback((function(e){return null!=e.controller}))),p=[],h=l.iter(d);!h.done;h.next()){var m,f,g,A=h.value;if((m=A.totalPlacement.inverse)&&(f=A.bounds)&&(g=t.clickLocation)){var v=m.transformPoint(g);!f.containsPoint(v)||!A.controller.selectable||A.controller.userGroup&&!this.dc.enableMoveableChildren||l.containsEq(c,A,u._equality_Forma_Forma)||(A.controller.userGroup?c.push(A):p.splice(0,0,A))}}c=c.concat(p);var T=!1;if(r=l.first(c),c.length>1)for(var C=l.iter(l.range(0,c.length,!1));!C.done;C.next()){var S=C.value;this.dc.selection.isSelected(c[S])&&(r=c[P=S==c.length-1?0:S+1],T=!0)}if(!T)for(var F=l.iter(this.dc.selection.asFormaArray());!F.done;F.next()){var y=F.value;if(y.isDescendent(i))if(this.dc.enableMoveableChildren){for(var P=0,H=l.iter(l.range(0,c.length,!1));!H.done;H.next())S=H.value,y.isDescendent(c[S])&&(P=Math.min(S+1,c.length-1));r=c[P]}else r=l.last(c)}}return r},handleClick:function(e){var t,n=this;if(t=this.nearestSelectable(e.forma,e)){var o,r=1==e.modifierKeys.shift||1==e.modifierKeys.command||1==e.modifierKeys.control;o=d.Host.platform.isWeb?"Web":d.Host.platform.isIOS?"iOS":d.Host.platform.isAndroid?"Android":"Unknown",r&&!this.dc.selection.inCharStyleMode?this.dc.selection.isSelected(t)?(this.dc.selection.deselectForma(t),l.opt(d.Host.logging,(function(e){return e.logToAnalytics(c.AnalyticsConstants.kAnalyticsEventClickOccured,{contextualData2:"New selected count: "+l.toString(n.dc.selection.selectedCount),contextualData3:"Did deselect: yes",contextualData4:"Platform: "+o})}))):this.canAddToSelection(t)&&(h.SelectionFacade.selectFormae([t]),l.opt(d.Host.logging,(function(e){return e.logToAnalytics(c.AnalyticsConstants.kAnalyticsEventClickOccured,{contextualData2:"New selected count: "+l.toString(n.dc.selection.selectedCount),contextualData3:"Did deselect: no",contextualData4:"Platform: "+o})}))):this.dc.selection.isSelected(t)?d.Host.platform.isWeb||this.dc.selection.inCropMode||this.dc.selection.deselectForma(t):l.opt(d.Host.platform,(function(e){return 1==e.isWeb||n.dc.selection.selectedCount<2||t.controller.canMultiSelect}))&&!this.dc.selection.inCropMode&&(this.dc.selection.inCharStyleMode=!1,this.dc.selection.replaceSelection(t),this.dc.controllerSettingsState.settings=null)}l.opt(this.dc,(function(t){return t.notifyClick(e)}))},canAddToSelection:function(e){var t,n,o;if(l.opt(this.dc,(function(e){return 0==e.selection.selectedCount})))return!0;if(o=l.opt(this.dc,(function(e){return e.selection.formaAt(0)}))){var r=e;return r.isImage()&&(r=p.ImageFacade.getFrameFormaForForma(r)||e),!(!(t=l.opt(r.controller,(function(e){return e.moveable})))&&null==t)&&t&&!(!(n=l.opt(o.controller,(function(e){return e.moveable})))&&null==n)&&n}return!0},handleDoubleClick:function(e){l.opt(e.forma.controller,(function(t){return t.onEvent(e)})),l.opt(this.dc,(function(t){return t.notifyDoubleClick(e)}))}}}),a),s.CropModeClickHandler=(i=function(e){s.StandardClickHandler.call(this,e)},l.defineClass({name:"CropModeClickHandler",ctor:i,superName:"StandardClickHandler",statics:{_implements:function(e){return"IClickHandler"==e}},props:{handleDoubleClick:function(e){}}}),i)},hsXA:function(e,t,n){var o,r,a,i,s=t,l=n("oAGj"),c=n("1HsO"),u=n("t1qz"),d=n("Mr7n");s.IHandlesHandler=l.defineProtocol("IHandlesHandler",{handleTransformEvent:"(HandleTransformEvent) -> Void",handleFormaDragEvents:"(PSMFormaDragControllerEvent) -> Void",updateHandles:"(IMutableHandlesModel) -> Void"}),s.NullHandlesHandler=(o=function(){},r={},l.defineClass({name:"NullHandlesHandler",ctor:o,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new o),r.instance}},_implements:function(e){return"IHandlesHandler"==e}},props:{handleTransformEvent:function(e){},handleFormaDragEvents:function(e){},updateHandles:function(e){}}}),o),s.IHandleGenerator=l.defineProtocol("IHandleGenerator",{addHandles:"(BaseHandlesHandler) -> Array<BaseHandle>"}),s.IHandleProcessor=l.defineProtocol("IHandleProcessor",{handleTransformEvent:"(BaseHandlesHandler, HandleTransformEvent) -> Boolean",handleFormaDragEvents:"(BaseHandlesHandler, PSMFormaDragControllerEvent) -> Boolean"}),s.BaseHandlesHandler=(a=function(e,t){this.dc=null,this.model=null,this.delegate=null,this.activeTransform=c.TransformType.None,this.handleGenerators=[],this.handleProcessors=[],this.dc=e,this.delegate=t},l.defineClass({name:"BaseHandlesHandler",ctor:a,superName:"CoreObject",statics:{_implements:function(e){return"IHandlesHandler"==e}},props:{handleTransformEvent:function(e){for(var t=l.iter(this.handleProcessors);!t.done&&!t.value.handleTransformEvent(this,e);t.next());},handleFormaDragEvents:function(e){for(var t=l.iter(this.handleProcessors);!t.done&&!t.value.handleFormaDragEvents(this,e);t.next());},updateHandles:function(e){for(var t=[],n=l.iter(this.handleGenerators);!n.done;n.next()){var o=n.value;l.append(t,o.addHandles(this))}e.setAll(l.clone(t))},addHandleGenerator:function(e){this.handleGenerators.push(e)},removeHandleGenerator:function(e){this.handleGenerators=this.handleGenerators.filter((function(t){return t!==e}),this)},clearHandleGenerators:function(){this.handleGenerators=[]},addHandleProcessor:function(e){this.handleProcessors.push(e)},removeHandleProcessor:function(e){this.handleProcessors=this.handleProcessors.filter((function(t){return t!==e}),this)},clearHandleProcessors:function(){this.handleProcessors=[]}}}),a),s.StandardHandlesHandler=(i=function(e,t,n){s.BaseHandlesHandler.call(this,e,n),this.addHandleGenerator(u.StandardHandleGenerator.instance),this.addHandleProcessor(new d.StandardHandleProcessor(t))},l.defineClass({name:"StandardHandlesHandler",ctor:i,superName:"BaseHandlesHandler",statics:{_implements:function(e){return"IHandlesHandler"==e}}}),i)},j89o:function(e,t,n){var o,r,a=t,i=n("oAGj"),s=n("Tq01"),l=n("yGNn"),c=n("T8w7"),u=n("Kkml");a.SetOpacityAction=(o=function e(t,n){void 0===n&&(n=null),this.opacity=t,this.formae=i.clone(n),s.Action.call(this,e.TYPE)},i.defineClass({name:"SetOpacityAction",ctor:o,superName:"Action",statics:{TYPE:"SetOpacityAction"},props:{getUserAction:function(e){return u.UserActions.ChangeOpacity()},execute:function(e){return c.OpacityFacade.applyOpacity(this.opacity,i.clone(this.formae||e.selection.asFormaArray())),l.CorePromise.resolve(null)}}}),o),a.SetBackgroundOpacityAction=(r=function e(t,n){this.opacity=t,this.page=n,s.Action.call(this,e.TYPE)},i.defineClass({name:"SetBackgroundOpacityAction",ctor:r,superName:"Action",statics:{TYPE:"SetBackgroundOpacityAction"},props:{getUserAction:function(e){return u.UserActions.SetBackgroundOpacity()},execute:function(e){return c.OpacityFacade.applyBackgroundOpacity(this.opacity,this.page),l.CorePromise.resolve(null)}}}),r)},nELi:function(e,t,n){var o,r,a=t,i=n("oAGj"),s=n("Tq01"),l=n("0wFF"),c=n("yGNn"),u=n("wNKJ"),d=n("FNB+"),p=n("6ZWm"),h=n("X0GW"),m=n("iCxV"),f=n("fdtz"),g=n("fAXt"),A=n("Kkml");a.ScaleAction=(o=function e(t,n,o){void 0===o&&(o=!0),this.scale=t,this.formaeToScale=i.clone(n),this.groupScale=o,s.Action.call(this,e.TYPE)},i.defineClass({name:"ScaleAction",ctor:o,superName:"Action",statics:{TYPE:{get:function(){return"ScaleAction"}}},props:{getUserAction:function(e){return A.UserActions.ScaleItem()},execute:function(e){var t,n,o,r,a=(null!=this.formaeToScale?i.clone(this.formaeToScale):e.selection.asFormaArray().map((function(e){var t=i.clone(e.filterByKind(f.ImageForma.KIND,d.FormaTraversal.JustChildren));return t.length>0&&!t[0].controller.floating?t[0]:e}),this)).filter((function(e){return!(!(t=i.opt(e.controller,(function(e){return e.scalable})))&&null==t)&&t}),this),s=null;a.length>1&&this.groupScale&&(o=h.GroupFacade.createGroupFromFormae(i.clone(a)))&&(a.splice(0),a.push(o),s=o);for(var A=i.iter(a);!A.done;A.next()){var v,T=A.value;g.TransformFacade.scaleForma(T,this.scale),u.DragFacade.rescueFormaToPageBounds(T),(v=(n=i.as(T.controller,p.FrameController))||null!=n?n:i.as(i.opt(T.parent,(function(e){return e.controller})),p.FrameController))&&(v.updateParentGroup(),v.fitChildrenToFrame()),T.isImage()?i.opt(m.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsDataImageResized,{})})):T.isShape()?i.opt(m.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsDataShapeResized,{})})):T.isText()&&i.opt(m.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsDataTextResized,{})}))}return(r=s)&&h.GroupFacade.cleanupGroup(r),c.CorePromise.resolve(null)}}}),o),a.RescueAction=(r=function(){},i.defineClass({name:"RescueAction",ctor:r,superName:"Action",statics:{TYPE:{get:function(){return"RescueAction"}}},props:{init_d41d:function(){s.Action.call(this,r.TYPE)},init_e169:function(e){this.formaeToRescue=i.clone(e),s.Action.call(this,r.TYPE)},getUserAction:function(e){return A.UserActions.RescueItem()},execute:function(e){var t;return(null!=this.formaeToRescue?i.clone(this.formaeToRescue):e.selection.asFormaArray().map((function(e){var t=i.clone(e.filterByKind(f.ImageForma.KIND,d.FormaTraversal.JustChildren));return t.length>0&&!t[0].controller.floating?t[0]:e}),this)).filter((function(e){return!(!(t=i.opt(e.controller,(function(e){return e.scalable})))&&null==t)&&t}),this).forEach((function(e){var t;i.as(e,f.ImageForma)&&(t=i.as(i.opt(e.parent,(function(e){return e.controller})),p.FrameController))?(t.updateParentGroup(),t.fitChildrenToFrame()):u.DragFacade.rescueFormaToPageBounds(e)})),c.CorePromise.resolve(null)}}}),r)},"nQ/X":function(e,t,n){var o,r=t,a=n("oAGj"),i=n("CMNw"),s=n("PSFa"),l=n("elwG"),c=n("qUXk"),u=n("u+mS"),d=n("eLsM"),p=n("hsXA");r.CharStyleModeDesignController=(o=function(e,t){this.dc=e,c.DesignController.call(this),this.handles=new p.BaseHandlesHandler(e,this),this.drag=new u.DragFacadeBasedDragHandler(e,t,this),this.click=new l.StandardClickHandler(e),this.actions=new i.StandardActionHandler(e),this.attributes=new s.StandardAttributesHandler(e),this.featureSets=new d.StandardFeatureSetHandler(e)},a.defineClass({name:"CharStyleModeDesignController",ctor:o,superName:"DesignController"}),o)},"o+xL":function(e,t,n){var o,r=t,a=n("oAGj"),i=n("Tq01"),s=n("0wFF"),l=n("yGNn"),c=n("6ZWm"),u=n("pnSN"),d=n("X0GW"),p=n("iCxV"),h=n("lmwz"),m=n("Kkml");r.RotateAction=(o=function e(t,n,o,r){void 0===r&&(r=!0),this.angle=t,this.initialImagePlacement=n,this.formaeToRotate=a.clone(o),this.groupRotation=r,i.Action.call(this,e.TYPE)},a.defineClass({name:"RotateAction",ctor:o,superName:"Action",statics:{TYPE:{get:function(){return"RotateAction"}}},props:{getUserAction:function(e){return m.UserActions.RotateItem()},execute:function(e){var t,n=null;null!=this.formaeToRotate?n=a.clone(this.formaeToRotate):(n=[],e.selection.selectedCount>0&&e.selection.forEachSelected((function(e){return n.push(e)})));var o=a.clone(n).filter((function(e){return a.opt(e.controller,(function(e){return 1==e.rotateable}))}),this);if(0==o.length)return l.CorePromise.resolve(null);var r,i,m=null;o.length>1&&this.groupRotation&&(r=d.GroupFacade.createGroupFromFormae(a.clone(o)))&&(o.splice(0),o.push(r),m=r);for(var f=a.iter(o);!f.done;f.next()){var g,A,v=f.value;if((g=h.ImageFacade.getImageFormaForForma(v))&&(A=this.initialImagePlacement)){var T=A.transformValues,C=g.placement.transformValues,S=C.xscale>0?1:-1,F=C.yscale>0?1:-1;g.placement=g.placement.scaleTo(T.xscale*S,T.yscale*F)}var y,P=this.angle;v.controller.rotate(P),(y=(t=a.as(v.controller,c.FrameController))||null!=t?t:a.as(a.opt(v.parent,(function(e){return e.controller})),c.FrameController))&&(y.updateParentGroup(),y.fitChildrenToFrame()),v.isImage()?a.opt(p.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataImageRotated,{})})):v.isShape()?a.opt(p.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataShapeRotated,{})})):v.isText()?a.opt(p.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataTextRotated,{})})):v.kind==u.GroupForma.KIND&&a.opt(p.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataMultiRotated,{})}))}return(i=m)&&d.GroupFacade.cleanupGroup(i),l.CorePromise.resolve(null)}}}),o)},p8vO:function(e,t,n){var o,r,a,i,s=t,l=n("oAGj"),c=n("Tq01"),u=n("4mEG"),d=n("SpAV"),p=n("CWW7"),h=n("yGNn"),m=n("iCxV"),f=n("mBzD"),g=n("q5zr"),A=n("VkKB"),v=n("RkYL"),T=n("Yspk"),C=n("Kkml"),S=n("mxdD"),F=n("QTen");s.ChangeVideoVolumeAction=(o=function e(t){void 0===t&&(t=F.VideoStyle.volumeOff),this.volumeLevel=t,c.Action.call(this,e.TYPE)},l.defineClass({name:"ChangeVideoVolumeAction",ctor:o,superName:"Action",statics:{TYPE:"ChangeVideoVolumeAction"},props:{getUserAction:function(e){return C.UserActions.ChangeVideoVolume()},execute:function(e){return S.VideoFacade.changeVideoVolume(l.clone(e.selection.asFormaArray()),this.volumeLevel),h.CorePromise.resolve(null)}}}),o),s.UpdateVideoStyleTrimAction=(r=function e(t,n,o,r,a,i){var s;void 0===i&&(i=null),this.forma=t,this.newTrim=n,this.padding=o,this.isLocalVideo=r,this.posterParams=a,c.Action.call(this,(s=i)||null!=s?s:e.TYPE)},l.defineClass({name:"UpdateVideoStyleTrimAction",ctor:r,superName:"Action",statics:{TYPE:{get:function(){return"UpdateVideoStyleTrimAction"}}},props:{getUserAction:function(e){return C.UserActions.TrimVideo()},executeIfAble:function(e){var t,n;if((t=l.as(this.forma.style,F.VideoStyle))&&(n=this.forma.videoContentNode)){if(!this.isLocalVideo)return t.startTime=this.newTrim.start,t.endTime=this.newTrim.end,this.updatePoster(e),h.CorePromise.resolve(new c.FormaActionResult([this.forma]));var o=T.TheoTimeRange.makeFromDuration(n.originalDuration),r=T.TheoTimeRange.makeFromStartAndDuration(n.offsetInOriginal||v.TheoTime.Zero,n.duration),a=this.newTrim.padBy(this.padding.seconds,o);if(d.CoreAssert.isTrue(o.contains(r),void 0,"UpdateVideoStyleTrimAction.executeIfAble","VideoActions.swift",70),d.CoreAssert.isTrue(o.contains(this.newTrim),void 0,"UpdateVideoStyleTrimAction.executeIfAble","VideoActions.swift",71),n.wasTrimmed&&r.contains(a))return t.startTime=this.newTrim.start.subtract(r.start),t.endTime=this.newTrim.end.subtract(r.start),this.updatePoster(e),h.CorePromise.resolve(new c.FormaActionResult([this.forma]))}return null},updatePoster:function(e){var t,n,o;(t=this.posterParams)&&(n=e.document)&&(o=l.as(n.content.createNode(g.ImageContentNode.KIND,null),g.ImageContentNode))&&(o.url=t.url,o.mimeType=t.mimeType,o.pixelWidth=t.width,o.pixelHeight=t.height,p.CreationFacade.removeContentNodeFromDocument(this.forma.contentNode,n),this.forma.contentNode=o,p.CreationFacade.addContentNodeToDocument(o,n))},execute:function(e){return this.executeIfAble(e)||h.CorePromise.reject("Cannot trim video - trim window outside of content")}}}),r),s.VideoInfoUpdate=(a=function(e,t){this.pre=e,this.post=t},l.defineClass({name:"VideoInfoUpdate",ctor:a}),a),s.TrimVideoAction=(i=function e(t,n,o,r,a,i,l,c,u){this.videoURL=o,this.videoID=n,this.outputURL=a,this.mimeType=r,this.progress=i,s.UpdateVideoStyleTrimAction.call(this,t,l,c,!0,u,e.TYPE),d.CoreAssert.isTrue(null==n&&null!=o||null!=n&&null==o,void 0,"TrimVideoAction.init","VideoActions.swift",162)},l.defineClass({name:"TrimVideoAction",ctor:i,superName:"UpdateVideoStyleTrimAction",statics:{TYPE:{get:function(){return"TrimVideoAction"}}},props:{execute:function(e){var t,n=this;if(C=s.UpdateVideoStyleTrimAction.prototype.executeIfAble.call(this,e))return C;if(t=this.forma.videoContentNode){var o,r=T.TheoTimeRange.makeFromDuration(t.originalDuration),a=T.TheoTimeRange.makeFromStartAndDuration(t.offsetInOriginal||v.TheoTime.Zero,t.duration),i=this.newTrim.padBy(this.padding.seconds,r);if(d.CoreAssert.isTrue(r.contains(a),void 0,"TrimVideoAction.execute","VideoActions.swift",179),d.CoreAssert.isTrue(r.contains(this.newTrim),void 0,"TrimVideoAction.execute","VideoActions.swift",180),o=m.Host.videoUtils){var c,p,g,C=null,S=this.outputURL,F=this.progress;if(null!=(c=this.videoURL)?C=o.getAttributesForVideoAtUrl(c).then((function(e){return o.trimVideoAtUrl(c,S,i,F).then((function(t){return new s.VideoInfoUpdate(l.as(e,f.VideoInfo),l.as(t,f.VideoInfo))}))})):null!=(p=this.videoID)&&(C=o.getAttributesForVideoWithId(p).then((function(e){return o.trimVideoWithId(p,S,i,F).then((function(t){return new s.VideoInfoUpdate(l.as(e,f.VideoInfo),l.as(t,f.VideoInfo))}))}))),g=C)return g.then((function(o){var r,c,d;if((r=l.as(o,s.VideoInfoUpdate))&&(c=r.pre)&&(d=r.post)){var p=i.start,m=c.duration,f=new u.ReplaceVideoFormaContentAction(n.forma,n.outputURL,n.mimeType,d.width,d.height,d.duration,p,a.duration,p,m,l.clone([]),n.posterParams,!1,t.mediaMetadata||A.MediaMetadata.init_36a2(),t.localIdentifier);return e.designController.actions.doAction(f)}return h.CorePromise.reject("Unexpected trim results")}))}}return h.CorePromise.reject("An error occurred while trimming")}}}),i)},qUXk:function(e,t,n){var o,r,a,i=t,s=n("oAGj"),l=n("CMNw"),c=n("PSFa"),u=n("elwG"),d=n("gXiO"),p=n("u+mS"),h=n("eLsM"),m=n("hsXA"),f=n("G9CY"),g=n("JU+l"),A=n("9X7Y");i.HandlerFactory=(o=function(){},s.defineClass({name:"HandlerFactory",ctor:o,props:{drag:{get:function(){return p.NullDragHandler.instance}},click:{get:function(){return u.NullClickHandler.instance}},resize:{get:function(){return g.NullResizeHandler.instance}},rotate:{get:function(){return A.NullRotateHandler.instance}},actions:{get:function(){return l.NullActionHandler.instance}},handles:{get:function(){return m.NullHandlesHandler.instance}},attributes:{get:function(){return c.NullAttributesHandler.instance}},featureSets:{get:function(){return h.NullFeatureSetHandler.instance}}}}),o),i.DesignController=(r=function(){this.click=u.NullClickHandler.instance,this.drag=p.NullDragHandler.instance,this.resize=g.NullResizeHandler.instance,this.move=f.NullMoveHandler.instance,this.rotate=A.NullRotateHandler.instance,this.actions=l.NullActionHandler.instance,this.handles=m.NullHandlesHandler.instance,this.attributes=c.NullAttributesHandler.instance,this.featureSets=h.NullFeatureSetHandler.instance,d.CoreObject.call(this)},a={},s.defineClass({name:"DesignController",ctor:r,superName:"CoreObject",statics:{NullController:{get:function(){return void 0===a.NullController&&(a.NullController=new r),a.NullController}}},props:{configureEditorModel:function(e){this.handles.updateHandles(e.mutable.handles),this.attributes.updateAttributes(e.mutable.attributes),this.featureSets.updateFeatureSets(e.mutable.featureSets)}}}),r)},sTUO:function(e,t,n){var o,r=t,a=n("oAGj"),i=n("Tq01"),s=n("yGNn"),l=n("MYNe"),c=n("Kkml");r.ChangeZOrderAction=(o=function e(t){this.zIndex=t,i.Action.call(this,e.TYPE)},a.defineClass({name:"ChangeZOrderAction",ctor:o,superName:"Action",statics:{TYPE:"ChangeZOrderAction"},props:{getUserAction:function(e){return c.UserActions.ChangeZOrder()},execute:function(e){var t=e.selection.formaAt(0);return l.LayerFacade.setZOrder(this.zIndex,t),s.CorePromise.resolve(null)}}}),o)},t1qz:function(e,t,n){var o,r,a=t,i=n("oAGj"),s=n("SpAV"),l=n("FNB+"),c=n("cmoc"),u=n("iCxV"),d=n("1HsO"),p=n("c+uM"),h=n("tGKA"),m=n("8t9B");a.StandardHandleGenerator=(o=function(){},r={},i.defineClass({name:"StandardHandleGenerator",ctor:o,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new o),r.instance}},_implements:function(e){return"IHandleGenerator"==e}},props:{addHandles:function(e){var t,n;if(n=i.opt(e.dc,(function(e){return e.selection}))){var o=i.clone(n.asFormaArray());return 0==o.length?this.handleNoSelectionCase(e):n.inCharStyleMode?this.handleCharStyleSelectionCase(e,i.clone(o)):1==o.length?n.inCropMode||!(t=i.opt(o[0].controller,(function(e){return e.userGroupMember})))&&null==t||!t?this.handleSingleSelectionCase(e,o[0]):this.handleGroupSelectionCase(e,o[0]):this.handleMultiSelectionCase(e,i.clone(o))}return[]},handleNoSelectionCase:function(e){return[]},handleSingleSelectionCase:function(e,t){var n,o,r,a,s,u,h=[];if((s=t.controller)&&(u=t.bounds)){var f=[],g=[];s.moveable&&(f.push(d.TransformType.Translate),t.isShape()&&!t.hasIntent(l.Forma.INTENT_ICON)||g.push(d.BoxHandleDisplayHint.ThinOutline));var A,v=!(!(n=i.opt(s.owner,(function(e){return e.selection.inSpacingMode})))&&null==n)&&n;t.isTypeLockup()&&(g.push(d.BoxHandleDisplayHint.TextFrame),(A=i.as(s,m.TypeLockupController))&&(A.text.length>300&&g.push(d.BoxHandleDisplayHint.SuppressResizeAnimation),p.LockupStyle.isKnockoutLook(A.lockupStyle.textLook)&&g.push(d.BoxHandleDisplayHint.SuppressResizeAnimation)));var T=!(!(o=i.opt(s.owner,(function(e){return e.selection.inCropMode})))&&null==o)&&o;if(T&&g.push(d.BoxHandleDisplayHint.CropMode),!s.rotateable||v||T||(f.push(d.TransformType.RotateAboutCenter),t instanceof c.FrameForma&&!s.moveable&&g.push(d.BoxHandleDisplayHint.SuppressRotationHandle)),!s.userGroupChild||((r=i.opt(s.owner,(function(e){return e.enableMoveableChildren})))||null!=r)&&r){s.floating&&!t.isGridCell()&&(f.push(d.TransformType.TopLeftCornerTranslate),t.isTypeLockup()&&v&&!p.LockupStyle.isPath((a=i.opt(i.as(t.style,p.LockupStyle),(function(e){return e.layout})))||null!=a?a:p.LockupLayout.Standard)?(f.push(d.TransformType.LetterSpacing),f.push(d.TransformType.LineSpacing)):(f.push(d.TransformType.TopRightCornerTranslate),f.push(d.TransformType.BottomLeftCornerTranslate),f.push(d.TransformType.BottomRightCornerTranslate)));for(var C=i.iter(s.visibleSelectionHandlePositions);!C.done;C.next()){var S=C.value;.5==S.x?0==S.y?f.push(d.TransformType.TopSideTranslate):f.push(d.TransformType.BottomSideTranslate):.5==S.y&&(0==S.x?f.push(d.TransformType.LeftSideTranslate):f.push(d.TransformType.RightSideTranslate))}}h.push(new d.BoxTransformHandles(new d.BoxReference(t.totalPlacement,u),i.clone(f),i.clone(g),e.activeTransform,t.formaID))}return h},handleGroupSelectionCase:function(e,t){var n=[],o=[d.TransformType.RotateAboutCenter,d.TransformType.TopLeftCornerTranslate,d.TransformType.TopRightCornerTranslate,d.TransformType.BottomLeftCornerTranslate,d.TransformType.BottomRightCornerTranslate];if(s.CoreAssert.isTrue(t.controller.userGroupMember,void 0,"StandardHandleGenerator.handleGroupSelectionCase","StandardHandleGenerator.swift",156),t.controller.userGroupChild){var r=[];e.dc.enableMoveableChildren?(r.push(d.BoxHandleDisplayHint.ThinOutline),t.controller.userGroup&&r.push(d.BoxHandleDisplayHint.GroupOutlineColor)):(r.push(d.BoxHandleDisplayHint.SuppressTranslationHandle),r.push(d.BoxHandleDisplayHint.WideOutline));var a=i.clone(e.dc.enableMoveableChildren?o:[d.TransformType.Translate]);n.push(new d.BoxTransformHandles(new d.BoxReference(t.totalPlacement,t.bounds),i.clone(a),i.clone(r),e.activeTransform,t.formaID));var l=e.dc.enableMoveableChildren?t.parent:t.controller.userGroupRoot,c=l.bounds,p=[d.BoxHandleDisplayHint.GroupOutlineColor];e.dc.enableMoveableChildren?p.push(d.BoxHandleDisplayHint.WideOutline):(p.push(d.BoxHandleDisplayHint.SuppressTranslationHandle),p.push(d.BoxHandleDisplayHint.ThinOutline),c=c.outsetXY(8,8)),n.splice(0,0,new d.BoxTransformMultipleFormae(new d.BoxReference(l.totalPlacement,c),i.clone(e.dc.enableMoveableChildren?[]:o),i.clone(p),e.activeTransform,u.Host.platform.isIOS?t.formaID:l.formaID,[l.formaID]))}else n.push(new d.BoxTransformMultipleFormae(new d.BoxReference(t.totalPlacement,t.bounds),i.clone(o),[d.BoxHandleDisplayHint.ThinOutline,d.BoxHandleDisplayHint.GroupOutlineColor],e.activeTransform,t.formaID,[t.formaID]));return n},handleMultiSelectionCase:function(e,t){var n=[],o=[];o.push(d.BoxHandleDisplayHint.ThinOutline);for(var r=[],a=null,s=i.iter(t);!s.done;s.next()){var c=s.value,u=c.finalFrame,p=c.formaID;if(a=null==a?u:a.unionWith(u),c.hasIntent(l.Forma.INTENT_INFERRED_TEMP_GROUP)){a=c.finalFrame;break}r.includes(p)||r.push(p)}if(i.sortInPlace(r),null==a)return[];var m=[d.TransformType.Translate,d.TransformType.TopLeftCornerTranslate,d.TransformType.TopRightCornerTranslate,d.TransformType.BottomLeftCornerTranslate,d.TransformType.BottomRightCornerTranslate];return n.push(new d.BoxTransformMultipleFormae(new d.BoxReference(h.Matrix2D.Identity,a),i.clone(m),i.clone(o),e.activeTransform,r.reduce((function(e,t){return e+"/"+t}),""),i.clone(r))),n},handleCharStyleSelectionCase:function(e,t){return[]}}}),o)},"u+mS":function(e,t,n){var o,r,a,i,s,l=t,c=n("oAGj"),u=n("Tq01"),d=n("0wFF"),p=n("mD2h"),h=n("wNKJ"),m=n("FNB+"),f=n("Pil/"),g=n("cmoc"),A=n("iCxV"),v=n("H1Z2"),T=n("hsXA"),C=n("lmwz"),S=n("D89E");l.IDragHandler=c.defineProtocol("IDragHandler",{handleFormaDragEvents:"(PSMFormaDragControllerEvent) -> Void"}),l.NullDragHandler=(o=function(){},r={},c.defineClass({name:"NullDragHandler",ctor:o,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new o),r.instance}},_implements:function(e){return"IDragHandler"==e}},props:{handleFormaDragEvents:function(e){},isDragging:function(){return!1}}}),o),l.DragFacadeBasedDragHandler=(a=function(e,t,n){this.dragging=!1,this.swappableFormae=[],this.swapTargetForma=null,this.inSwapMode=!1,this.originalPlacement=null,this.swapModeHandleGenerator=new S.SwapModeHandleGenerator,this.originalHandleGenerators=[],this.dc=e,this.model=t,this.delegate=n},c.defineClass({name:"DragFacadeBasedDragHandler",ctor:a,statics:{_implements:function(e){return"IDragHandler"==e}},props:{updateHandles:function(){var e,t;(e=this.model)&&(t=this.delegate)&&(e.beginUpdates(),t.handles.updateHandles(e.mutable.handles),e.updatesComplete())},handleFormaDragEvents:function(e){var t,n,o,r,a,i,s=this;if((t=this.dc)&&(n=this.model)&&(o=this.delegate))if(r=c.as(e,f.BeginFormaDragEvent)){(P=c.as(o.handles,T.BaseHandlesHandler))&&(this.originalHandleGenerators=c.clone(P.handleGenerators)),this.swappableFormae=c.clone(h.DragFacade.getSwappableFormae(r)),null!=c.first(e.dragDelegate.draggedFormae)&&(this.originalPlacement=c.opt(c.first(e.dragDelegate.draggedFormae),(function(e){return e.placement}))),t.undoRedoMgr.beginGesture();var l=c.opt(t.document,(function(e){return e.beginTransaction("begin_forma_drag")}));h.DragFacade.processBeginFormaDrag(r),c.opt(l,(function(e){return e.end()})),this.updateHandles()}else if(a=c.as(e,f.FormaDragEvent)){var g=this.swapTargetForma;if(t.designControllerHandlesSwap){var C=c.opt(t.document,(function(e){return e.beginTransaction("enter_swap_mode")})),S=h.DragFacade.getSwapState(a,c.clone(this.swappableFormae),g,this.inSwapMode,this.originalPlacement),F=S[0],y=S[1];this.inSwapMode=F,this.swapTargetForma=y,c.opt(C,(function(e){return e.end()}))}if(null==(H=this.getDraggedFormaForEvent(e)))return;if(!c.eq(m._equality_Forma_Forma,this.swapTargetForma,g)){var P=c.as(o.handles,T.BaseHandlesHandler);c.opt(P,(function(e){return e.clearHandleGenerators()})),null==this.swapTargetForma||c.eq(m._equality_Forma_Forma,this.swapTargetForma,H)?(c.opt(P,(function(e){return e.removeHandleGenerator(s.swapModeHandleGenerator)})),this.swapModeHandleGenerator.clearSwapTargetForma()):(c.opt(P,(function(e){return e.addHandleGenerator(s.swapModeHandleGenerator)})),this.swapModeHandleGenerator.setSwapTargetForma(this.swapTargetForma))}this.inSwapMode||t.doActionWithCompletion(new v.DragAction(a,null),(function(e,t){var o,r;(o=c.as(e,u.DragActionResult))&&(r=o.snapLines)&&(n.beginUpdates(),n.mutable.snapLines.setAll(c.clone(r)),n.updatesComplete())})),this.inSwapMode&&(n.beginUpdates(),n.mutable.activeSwap.setActive(new p.ActiveSwap(H,a.drag.pointers[0].currentLocation)),n.updatesComplete()),this.updateHandles()}else if(i=c.as(e,f.EndFormaDragEvent)){c.opt(A.Host.logging,(function(n){return n.logToAnalytics(d.AnalyticsConstants.kAnalyticsFormaeDragged,{contextualData1:"Selected count: "+t.selection.selectedCount,contextualData2:"Dragged count: "+e.dragDelegate.draggedFormae.length})})),n.beginUpdates(),n.mutable.snapLines.clear(),n.updatesComplete();var H=this.getDraggedFormaForEvent(e);if(this.inSwapMode){if(P=c.as(o.handles,T.BaseHandlesHandler)){P.clearHandleGenerators();for(var w=c.iter(this.originalHandleGenerators);!w.done;w.next()){var D=w.value;P.addHandleGenerator(D)}}if(n.beginUpdates(),n.mutable.activeSwap.setActive(new p.ActiveSwap(null,null)),n.updatesComplete(),null==H)return t.selection.clearSelection(),this.updateHandles(),this.swapTargetForma=null,this.inSwapMode=!1,this.originalPlacement=null,void t.undoRedoMgr.endGesture(!1);null==this.swapTargetForma||c.eq(m._equality_Forma_Forma,this.swapTargetForma,H)?(t.selection.replaceSelection(H),this.updateHandles(),this.swapTargetForma=null,this.inSwapMode=!1,this.originalPlacement=null,t.undoRedoMgr.endGesture(!1)):t.doActionWithCompletion(new v.DragAction(i,this.swapTargetForma),(function(e,n){t.selection.replaceSelection(H),s.updateHandles(),s.swapTargetForma=null,s.inSwapMode=!1,s.originalPlacement=null,t.undoRedoMgr.endGesture(!0)}))}else t.doActionWithCompletion(new v.DragAction(i,null),(function(e,n){s.updateHandles(),s.swapTargetForma=null,s.inSwapMode=!1,s.originalPlacement=null,t.undoRedoMgr.endGesture(!0)}))}},getDraggedFormaForEvent:function(e){var t,n;return 0==!e.dragDelegate.draggedFormae.length&&(n=c.first(e.dragDelegate.draggedFormae),((t=c.opt(n,(function(e){return e.isImage()})))||null!=t)&&t&&(n=c.opt(n,(function(e){return e.parent})))),n}}}),a),l.CroppingDragFacadeBasedDragHandler=(i=function(e,t,n){l.DragFacadeBasedDragHandler.call(this,e,t,n)},c.defineClass({name:"CroppingDragFacadeBasedDragHandler",ctor:i,superName:"DragFacadeBasedDragHandler",statics:{_implements:function(e){return"IDragHandler"==e}},props:{getDraggedFormaForEvent:function(e){var t,n=l.DragFacadeBasedDragHandler.prototype.getDraggedFormaForEvent.call(this,e);return c.opt(n,(function(e){return e.kind==g.FrameForma.KIND}))&&(t=C.ImageFacade.getImageFormaForForma(n))&&(n=t),n}}}),i),l.MultiObjectDragHandler=(s=function(e,t,n){this.startPlacements={},this.basePlacements={},this.dragging=!1,this.dc=e,this.model=t,this.delegate=n},c.defineClass({name:"MultiObjectDragHandler",ctor:s,statics:{_implements:function(e){return"IDragHandler"==e}},props:{updateHandles:function(){var e,t;(e=this.model)&&(t=this.delegate)&&(e.beginUpdates(),t.handles.updateHandles(e.mutable.handles),e.updatesComplete())},handleFormaDragEvents:function(e){var t,n,o,r,a,i=this;(t=this.dc)&&(n=this.model)&&((o=c.as(e,f.BeginFormaDragEvent))?(h.DragFacade.processBeginFormaDrag(o),t.undoRedoMgr.beginGesture(),this.updateHandles()):(r=c.as(e,f.FormaDragEvent))?t.doActionWithCompletion(new v.DragAction(r,null),(function(e,t){var o,r;(o=c.as(e,u.DragActionResult))&&(r=o.snapLines)&&(n.beginUpdates(),n.mutable.snapLines.setAll(c.clone(r)),n.updatesComplete(),i.updateHandles())})):(a=c.as(e,f.EndFormaDragEvent))&&(c.opt(A.Host.logging,(function(n){return n.logToAnalytics(d.AnalyticsConstants.kAnalyticsFormaeDragged,{contextualData1:"Selected count: "+t.selection.selectedCount,contextualData2:"Dragged count: "+e.dragDelegate.draggedFormae.length})})),n.beginUpdates(),n.mutable.snapLines.clear(),n.updatesComplete(),t.doActionWithCompletion(new v.DragAction(a,null),(function(e,n){i.updateHandles(),t.undoRedoMgr.endGesture(!0)})),this.updateHandles()))},isDragging:function(){return this.dragging}}}),s)},vV1H:function(e,t,n){var o,r=t,a=n("oAGj"),i=n("Tq01"),s=n("0wFF"),l=n("yGNn"),c=n("iCxV"),u=n("Kkml");r.FlipAction=(o=function e(t,n){void 0===t&&(t=!1),void 0===n&&(n=null),this.vertical=t,this.formaeToFlip=a.clone(n),i.Action.call(this,e.TYPE)},a.defineClass({name:"FlipAction",ctor:o,superName:"Action",statics:{TYPE:{get:function(){return"FlipAction"}}},props:{getUserAction:function(e){return u.UserActions.FlipItem()},execute:function(e){var t=this,n=null;return null!=this.formaeToFlip?n=a.clone(this.formaeToFlip):(n=[],e.selection.selectedCount>0&&e.selection.forEachSelected((function(e){return n.push(e)}))),a.clone(n).filter((function(e){return a.opt(e.controller,(function(e){return 1==e.flippable}))}),this).forEach((function(e){e.controller.flip(t.vertical),e.isImage()?a.opt(c.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataImageFlipped,{})})):e.isShape()?a.opt(c.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataShapeFlipped,{})})):e.isText()&&a.opt(c.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataTextFlipped,{})}))})),l.CorePromise.resolve(null)}}}),o)},x6FH:function(e,t,n){var o,r,a,i,s,l=t,c=n("oAGj"),u=n("Tq01"),d=n("yGNn"),p=n("x35w"),h=n("Kkml");l.CreatePaddedCollageAction=(o=function e(){u.Action.call(this,e.TYPE)},c.defineClass({name:"CreatePaddedCollageAction",ctor:o,superName:"Action",statics:{TYPE:"CreatePaddedCollageAction"},props:{getUserAction:function(e){return h.UserActions.CreateCollage()},execute:function(e){var t,n;return(t=c.opt(e.document,(function(e){return e.firstPage})))?(n=p.GridFacade.createPaddedCollage(t))?d.CorePromise.resolve(new u.FormaActionResult([n])):d.CorePromise.reject("could not get or create page grid"):d.CorePromise.reject("no document or page?")}}}),o),l.SetGridParametersAction=(r=function e(t,n){this.spacing=t,this.margin=n,u.Action.call(this,e.TYPE)},c.defineClass({name:"SetGridParametersAction",ctor:r,superName:"Action",statics:{TYPE:"SetGridParametersAction"},props:{getUserAction:function(e){return h.UserActions.SetLayoutMargin()},execute:function(e){var t;if(t=c.opt(e.document,(function(e){return e.firstPage}))){var n;if(p.GridFacade.setPageGridParameters(t,this.spacing,this.margin),this.spacing==this.margin&&(n=p.GridFacade.getPageGrid(t,!1))&&n.spacing!=n.margin){var o=Math.min(n.spacing,n.margin);p.GridFacade.setPageGridParameters(t,o,o)}return d.CorePromise.resolve(null)}return d.CorePromise.reject("no document or page?")}}}),r),l.SwapGridFormaAction=(a=function e(t,n){this.a=t,this.b=n,u.Action.call(this,e.TYPE)},c.defineClass({name:"SwapGridFormaAction",ctor:a,superName:"Action",statics:{TYPE:"SwapGridFormaAction"},props:{getUserAction:function(e){return h.UserActions.SwapGridCells()},execute:function(e){return p.GridFacade.isChildSwappable(this.a)&&p.GridFacade.isChildSwappable(this.b)?(p.GridFacade.swapChildren(this.a,this.b),d.CorePromise.resolve(null)):d.CorePromise.reject("grid children not swappable? or no grid controller?")}}}),a),l.SetGridStyleAction=(i=function e(t,n){this.style=t,this.variation=n,u.Action.call(this,e.TYPE)},c.defineClass({name:"SetGridStyleAction",ctor:i,superName:"Action",statics:{TYPE:"SetGridStyleAction"},props:{getUserAction:function(e){return h.UserActions.SetGridStyle()},execute:function(e){var t;return(t=c.opt(e.document,(function(e){return e.firstPage})))?(p.GridFacade.applyGridStyle(this.style,this.variation,t),d.CorePromise.resolve(null)):d.CorePromise.reject("no document or page?")}}}),i),l.EnterGridLayoutModeAction=(s=function e(){u.Action.call(this,e.TYPE)},c.defineClass({name:"EnterGridLayoutModeAction",ctor:s,superName:"Action",statics:{TYPE:"EnterGridLayoutModeAction"},props:{getUserAction:function(e){return h.UserActions.EnterGridLayoutMode()},execute:function(e){var t,n;return(t=c.opt(e.document,(function(e){return e.firstPage})))&&(n=p.GridFacade.getPageGrid(t,!0))?(n.enterLayoutMode(),d.CorePromise.resolve(null)):d.CorePromise.reject("no page or grid?")}}}),s)},"y/On":function(e,t,n){var o,r,a=t,i=n("oAGj"),s=n("Tq01"),l=n("0wFF"),c=n("yGNn"),u=n("FNB+"),d=n("P83h"),p=n("pnSN"),h=n("X0GW"),m=n("iCxV"),f=n("Kkml");a.GroupAction=(o=function e(t,n,o){void 0===t&&(t=null),void 0===n&&(n=!0),void 0===o&&(o=""),this.formaeToGroup=i.clone(t),this.selectGroup=n,this.method=o,s.Action.call(this,e.TYPE)},i.defineClass({name:"GroupAction",ctor:o,superName:"Action",statics:{TYPE:"GroupAction"},props:{getUserAction:function(e){return f.UserActions.GroupItems()},execute:function(e){var t=this;return h.GroupFacade.groupItems(i.clone(this.formaeToGroup||e.selection.asFormaArray())).then((function(e){var n=i.as(e,u.Forma);if(null!=n){var o;if(t.selectGroup&&(t.newSelection=[n]),o=i.as(n,p.GroupForma)){var r=h.GroupFacade.getGroupDepth(o);i.opt(m.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsDataGroupButton,{contextualData1:"count:"+o.childCount,contextualData2:"depth:"+r,contextualData3:"method:"+t.method})}))}return new s.FormaActionResult([n])}return c.CorePromise.reject("did not get a GroupForma back from GroupFacade.groupItems")}))},updateSelection:function(e){if(null!=this.newSelection&&this.selectGroup){e.selection.replaceSelectionWithFormae(i.clone(this.newSelection));for(var t=i.iter(this.newSelection);!t.done;t.next()){var n=t.value,o=new d.FormaGroupEvent(n);n.beginUpdate(o),n.endUpdate(o)}}return this.newSelection}}}),o),a.UngroupAction=(r=function e(t,n,o){void 0===t&&(t=null),void 0===n&&(n=!0),void 0===o&&(o=""),this.formaeToUngroup=i.clone(t),this.selectUngroup=n,this.method=o,s.Action.call(this,e.TYPE)},i.defineClass({name:"UngroupAction",ctor:r,superName:"Action",statics:{TYPE:"UngroupAction"},props:{getUserAction:function(e){return f.UserActions.UngroupItems()},execute:function(e){var t=this;return h.GroupFacade.ungroupItems(i.clone(this.formaeToUngroup||e.selection.asFormaArray())).then((function(e){var n;return(n=i.as(e,["Array",u.Forma]))?(t.selectUngroup&&(t.newSelection=i.clone(n)),i.opt(m.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsDataUngroupButton,{contextualData1:"count:"+n.length,contextualData3:"method:"+t.method})})),new s.FormaActionResult(i.clone(n))):c.CorePromise.reject("did not get a set of forma back from GroupFacade.ungroupItems")}))},updateSelection:function(e){if(null!=this.newSelection&&this.selectUngroup){e.selection.removeStaleSelections(),e.selection.selectFormae(i.clone(this.newSelection));for(var t=i.iter(this.newSelection);!t.done;t.next()){var n=t.value,o=new d.FormaUngroupEvent(n);n.beginUpdate(o),n.endUpdate(o)}}return this.newSelection}}}),r)},yHU1:function(e,t,n){var o,r,a,i=t,s=n("oAGj"),l=n("SpAV"),c=n("gXiO"),u=n("quOg"),d=n("FNB+"),p=n("Pil/"),h=n("fWxZ"),m=n("P83h"),f=n("iCxV"),g=n("1HsO"),A=n("lmwz"),v=n("g8Fi"),T=n("KIfs"),C=n("6Tzw"),S=n("mxdD");i.BeginPointerTrackingResponseEnum=s.defineEnum("BeginPointerTrackingResponseEnum",{TrackAsGroup:0,TrackWithinGroup:1,DoNotTrack:2}),i.IPSMDelegate=s.defineProtocol("IPSMDelegate",{handleEvent:"(PSMFormaControllerEvent) -> Void"}),i.nearestFormaWithController=function(e){return null==e?(s.opt(f.Host.logging,(function(e){return e.error("nearestFormaWithController nil startingForma")})),null):s.opt(e,(function(e){return e.visit(d.FormaTraversal.NearestAncestor,(function(e,t,n){return null!=e.controller}))}))},i.getNearestActionableController=function(e){return null==e?(s.opt(f.Host.logging,(function(e){return e.error("getNearestActionableController nil startingForma")})),null):e.visit(d.FormaTraversal.NearestAncestor,(function(e,t,n){var o;return!!(o=e.controller)&&(o.selectable||o.moveable)}))},i.targetForma=function(e,t,n){if(null==t)return[null,null];for(var o=i.getNearestActionableController(t),r=t;null!=o;){if(null==o.controller)return l.CoreAssert.fail("PSMpD getNearest calls failed","targetForma","FormaDrag.swift",79),[null,r];var a,s=p.BeginPointerTrackingEvent.init_bef7(o,[r],n);if(e.handleEvent(s),s.trackingResponse!=i.BeginPointerTrackingResponseEnum.TrackAsGroup)return s.trackingResponse==i.BeginPointerTrackingResponseEnum.TrackWithinGroup?[o.controller,r]:(l.CoreAssert.isTrue(s.trackingResponse==i.BeginPointerTrackingResponseEnum.DoNotTrack,void 0,"targetForma","FormaDrag.swift",105),[null,r]);if(!(a=o.parent))return[null,r];r=o,o=i.nearestFormaWithController(a),l.CoreAssert.isTrue(null!=o,"nearestFormaWithController unexpectedly returned nil for forma kind:"+a.kind,"targetForma","FormaDrag.swift",92)}return[null,r]},i.FormaState=(o=function(e,t){this.draggedForma_=e,this.startPlacement_=t},s.defineClass({name:"FormaState",ctor:o,props:{update:function(){this.startPlacement_=this.draggedForma_.placement},clone:function(){return new o(this.draggedForma_,this.startPlacement_)}}}),o),i.FormaPageDragDelegate=(r=function(e,t,n){this.draggedFormae_=[],this.delegate=e,this.dragController=t,this.modifierKeys={},c.CoreObject.call(this);for(var o=s.iter(n);!o.done;o.next()){var r=o.value;this.targetNewForma(r)}},s.defineClass({name:"FormaPageDragDelegate",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"ActiveDragDelegateProtocol"==e}},props:{draggedFormae:{get:function(){return this.draggedFormae_.map((function(e){return e.draggedForma_}),this)}},updateModifierKeys:function(e){e.pointers.length>0&&(this.modifierKeys=s.clone(e.pointers[0].modifierKeys))},targetNewForma:function(e){this.draggedFormae_.push(s.clone(new i.FormaState(e,e.placement)))},startPlacementObsolete:{get:function(){return s.first(this.draggedFormae_).startPlacement_}},forEachDraggedForma:function(e){for(var t=s.iter(this.draggedFormae_);!t.done;t.next()){var n=t.value;e(n.draggedForma_,n.startPlacement_)}},activeDragDidBegin:function(e){var t=new p.BeginFormaDragEvent(e);this.delegate.handleEvent(t)},activeDragDidActivate:function(e){return 1!=e.pointers.length||e.pointers[0].type!=v.PointerTypeEnum.Mouse},activeDragDidDeactivate:function(e,t){if(t){var n=new m.FormaAlignmentChangedEvent(s.first(this.draggedFormae),[],null);s.first(this.draggedFormae).beginUpdate(n),s.first(this.draggedFormae).endUpdate(n)}},activeDragClaimNewPointers:function(e,t,n){var o=[],r=[],a=e.pointers.length;l.CoreAssert.isTrue(a>0&&t.length>0,void 0,"FormaPageDragDelegate.activeDragClaimNewPointers","FormaDrag.swift",222);for(var i=!0,c=s.iter(this.draggedFormae);!c.done;c.next()){var u;if((u=c.value.controller)&&!u.rotateable){i=!1;break}}for(var d=s.iter(t);!d.done;d.next()){var p=d.value;n?o.push(p):i?r.push(p):o.push(p)}return e.commitWithNewPointers(r,!0),o=o.concat(r)},activeDragDidCommit:function(e){for(var t=s.iter(s.range(0,this.draggedFormae_.length,!1));!t.done;t.next()){var n=t.value;this.draggedFormae_[n].update()}},activeDragDidMove:function(e,t){var n=new p.FormaDragEvent(e);this.delegate.handleEvent(n),this.updateModifierKeys(e)},activeDragDidChangePace:function(e,t,n){},activeDragHeldPointerEndedAsTap:function(e,t){},activeDragDidEnd:function(e,t,n){if(t){var o=new p.EndFormaDragEvent(e);this.delegate.handleEvent(o)}else for(var r=s.opt(e.pointerStateMachine,(function(e){return e.owner})).selection,a=s.iter(n);!a.done;a.next()){var l=a.value;if(!l.cancelled){var c,u,d=s.opt(s.as(l.currentPage,h.FormaPage),(function(e){return e.formaAtPoint(l.startLocation,void 0,null)}));if(null==d)return;(c=i.getNearestActionableController(d))&&(l.tapCount%2==1?((u=new p.FormaClickEvent(c)).clickLocation=l.startLocation,u.modifierKeys=s.clone(e.activeDragDelegate.modifierKeys),!f.Host.platform.isWeb&&C.SelectionFacade.enableAdditionalMultiSelectGestures()&&null!=c.controller&&c.controller.canMultiSelect&&(r.selectedCount>1||n.length>1)&&(u.modifierKeys.shift=!0),this.delegate.handleEvent(u)):((u=new p.FormaDoubleClickEvent(c)).clickLocation=l.startLocation,u.modifierKeys=s.clone(e.activeDragDelegate.modifierKeys),this.delegate.handleEvent(u)))}}}}}),r),i.FormaPagePointerStateMachineDelegate=(a=function(e){this.myDrags=[],this.delegate=e,c.CoreObject.call(this)},s.defineClass({name:"FormaPagePointerStateMachineDelegate",ctor:a,superName:"CoreObject",statics:{_implements:function(e){return"PointerStateMachineDelegateProtocol"==e}},props:{activeDragDidFinish:function(e,t){s.remove(this.myDrags,t)},formaeInFlight:function(){for(var e=[],t=s.iter(this.myDrags);!t.done;t.next()){var n=t.value.activeDragDelegate;e=e.concat(n.draggedFormae)}return e},createDragsForPointers:function(e,t,n,o){for(var r=s.clone(t),a=s.clone(this.newDragsForPointers(e,r,n,o)),i=s.iter(a);!i.done;i.next()){var l=i.value;e.appendDrag(l),this.myDrags.push(l)}return r},newDragsForPointers:function(e,t,n,o){var r=[];if(0==t.length)return r;var a=s.as(e.owner,u.DocumentController),l=s.opt(a,(function(e){return e.selection})),c=function(e,t){var n,o;return(n=s.opt(e,(function(e){return e.viewportTransform})))?Math.sqrt(Math.abs(n.determinant)):(n=s.opt(s.opt(t,(function(e){return e.page.view})),(function(e){return e.getViewportTransform()})))?Math.sqrt(Math.abs(n.determinant)):null!=(o=s.opt(a,(function(e){return e.viewScale})))?o:1},p=!0;if(f.Host.platform.isWeb&&!l.inCropMode){p=!1;for(var m=s.iter(t);!m.done;m.next())if(m.value.type==v.PointerTypeEnum.Touch){p=!0;break}if(!p&&(C.SelectionFacade.isMultiSelect(l)||C.SelectionFacade.isGroupSelect(l))&&1==t.length&&t[0].type==v.PointerTypeEnum.Mouse){var F=s.clone(a.model.handles.getAll());if(F.length>0&&null!=s.as(F[0],g.BoxTransformHandles)){var y=F[0],P=y.reference.bounds,H=y.reference.placement.inverse.transformPoint(t[0].currentLocation);p=P.containsPoint(H)}}}var w,D=null,b=[];if(w=s.opt(l,(function(e){return e.asFormaArray()})))for(var x=s.iter(w);!x.done;x.next()){var I,E,R,M=x.value,N=M;s.opt(l,(function(e){return 1==e.inCropMode&&A.ImageFacade.isFrame(M)}))?(I=A.ImageFacade.getImageFormaForForma(M))&&(N=I):((E=S.VideoFacade.getVideoFormaForForma(M))&&(N=E),(R=A.ImageFacade.getImageFormaForForma(M))&&(R.isLogo()||(N=R)));var k=i.targetForma(this.delegate,N,l),G=k[0],U=k[1];(L=G)&&(V=U)&&(null==D?(D=L,b.push(V)):s.opt(D,(function(e){return e.kind==L.kind}))&&b.push(V))}if(p&&null!=D&&0==o){(J=new i.FormaPageDragDelegate(this.delegate,D,s.clone(b))).modifierKeys=s.clone(t[0].modifierKeys);for(var B=!0,z=s.iter(b);!z.done;z.next()){var Y=z.value;if((L=Y.controller)&&!L.rotateable){B=!1;break}}if(!B)for(;t.length>1;)t.pop();var _=new T.ActiveDrag(e,J,t,null,c(null,null));r.push(_)}for(;t.length>0;){var L,V,O=t.pop(),j=(N=s.opt(s.as(O.currentPage,h.FormaPage),(function(e){return e.formaAtPoint(O.startLocation,void 0,null)})),i.targetForma(this.delegate,N,l));if(G=j[0],U=j[1],(L=G)&&(V=U)){for(var W=s.iter(r);!W.done;W.next()){var K=W.value,q=K.activeDragDelegate,X=q.dragController==L&&s.eq(d._equality_Forma_Forma,s.first(q.draggedFormae),V);if(!n||X){if(V.controller.rotateable){var Z=[O];K.commitWithNewPointers(Z,!0)}_=K;break}}if(null==_){if(!n&&o+r.length>0)break;var J;(J=D==L&&s.containsEq(b,V,d._equality_Forma_Forma)&&o+r.length==0?new i.FormaPageDragDelegate(this.delegate,L,s.clone(b)):new i.FormaPageDragDelegate(this.delegate,L,[V])).modifierKeys=s.clone(O.modifierKeys),Z=[O],_=new T.ActiveDrag(e,J,Z,null,c(O,V)),r.push(_)}}}return r}}}),a)}}]);
//# sourceMappingURL=vendors_npm_spark_6f9c51c4-772ec92e.js.map